{
"version":3,
"file":"Builder.js",
"sourceRoot":"file:///",
"sources":["C:/HaxeToolkit/haxe/std/js/_std/EReg.hx","C:/HaxeToolkit/haxe/std/js/_std/HxOverrides.hx","C:/HaxeToolkit/haxe/std/Lambda.hx","C:/HaxeToolkit/haxe/lib/perf,js/1,1,8/src/Perf.hx","C:/HaxeToolkit/haxe/std/js/_std/Reflect.hx","C:/HaxeToolkit/haxe/std/js/_std/Std.hx","C:/HaxeToolkit/haxe/std/StringBuf.hx","C:/HaxeToolkit/haxe/std/StringTools.hx","C:/HaxeToolkit/haxe/std/js/_std/Type.hx","C:/HaxeToolkit/haxe/std/UInt.hx","C:/HaxeToolkit/haxe/std/Xml.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/Main.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/game/GameManager.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/game/iso/IsoManager.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/game/managers/CameraManager.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/game/managers/ClippingManager.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/game/managers/MouseManager.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/game/managers/PoolingManager.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/game/managers/SaveManager.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/game/GameObject.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/game/StateMachine.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/game/StateGraphic.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/game/sprites/Tile.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/game/sprites/Building.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/game/sprites/Ground.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/game/virtual/VCell.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/game/virtual/VBuilding.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/game/virtual/VGround.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/ui/CheatPanel.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/ui/UIComponent.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/ui/Screen.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/ui/GraphicLoader.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/ui/UIElement.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/ui/UIManager.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/ui/Button.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/ui/hud/ButtonBuild.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/perle/ui/hud/Hud.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/Config.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/Debug.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/game/CollisionManager.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/game/GameStage.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/game/factory/AnimFactory.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/game/factory/FlumpMovieAnimFactory.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/game/factory/FlumpSpriteAnimFactory.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/game/factory/MovieClipAnimFactory.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/loader/GameLoader.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/sounds/SoundManager.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/system/DeviceCapabilities.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/ui/Popin.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/ui/UIPosition.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/ui/smart/SmartComponent.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/ui/smart/SmartButton.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/ui/smart/TextSprite.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/ui/smart/UIBuilder.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/ui/smart/UIMovie.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/ui/smart/UISprite.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/flump/DisplayObjectKey.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/flump/MoviePlayer.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/flump/filters/AnimateTintFilter.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/flump/json/FlumpJSON.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/flump/library/FlumpLibrary.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/flump/library/Keyframe.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/flump/library/Label.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/flump/library/Layer.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/flump/library/Symbol.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/flump/library/MovieSymbol.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/flump/library/Point.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/flump/library/Rectangle.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/flump/library/SpriteSymbol.hx","C:/HaxeToolkit/haxe/std/haxe/Timer.hx","C:/HaxeToolkit/haxe/std/haxe/ds/ArraySort.hx","C:/HaxeToolkit/haxe/std/js/_std/haxe/ds/IntMap.hx","C:/HaxeToolkit/haxe/std/js/_std/haxe/ds/ObjectMap.hx","C:/HaxeToolkit/haxe/std/js/_std/haxe/ds/StringMap.hx","C:/HaxeToolkit/haxe/std/haxe/xml/Parser.hx","C:/HaxeToolkit/haxe/std/js/Boot.hx","C:/HaxeToolkit/haxe/std/js/Browser.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/pixi/flump/Movie.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/pixi/flump/Parser.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/pixi/flump/Resource.hx","C:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,3,0/src/pixi/flump/Sprite.hx","C:/HaxeToolkit/haxe/std/js/_std/Math.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/events/EventType.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/events/LoadEventType.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/events/MouseEventType.hx","C:/Documents/Cours_ISART_2017/builder/SVN/dev/Builder/src/com/isartdigital/utils/events/TouchEventType.hx"],
"sourcesContent":["/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:coreApi class EReg {\n\n\tvar r : HaxeRegExp;\n\n\tpublic inline function new( r : String, opt : String ) : Void {\n\t\tthis.r = new HaxeRegExp(r, opt.split(\"u\").join(\"\")); // 'u' (utf8) depends on page encoding\n\t}\n\n\tpublic function match( s : String ) : Bool {\n\t\tif( r.global ) r.lastIndex = 0;\n\t\tr.m = r.exec(s);\n\t\tr.s = s;\n\t\treturn (r.m != null);\n\t}\n\n\tpublic function matched( n : Int ) : String {\n\t\treturn if( r.m != null && n >= 0 && n < r.m.length ) r.m[n] else throw \"EReg::matched\";\n\t}\n\n\tpublic function matchedLeft() : String {\n\t\tif( r.m == null ) throw \"No string matched\";\n\t\treturn r.s.substr(0,r.m.index);\n\t}\n\n\tpublic function matchedRight() : String {\n\t\tif( r.m == null ) throw \"No string matched\";\n\t\tvar sz = r.m.index+r.m[0].length;\n\t\treturn r.s.substr(sz,r.s.length-sz);\n\t}\n\n\tpublic function matchedPos() : { pos : Int, len : Int } {\n\t\tif( r.m == null ) throw \"No string matched\";\n\t\treturn { pos : r.m.index, len : r.m[0].length };\n\t}\n\n\tpublic function matchSub( s : String, pos : Int, len : Int = -1):Bool {\n\t\treturn if (r.global) {\n\t\t\tr.lastIndex = pos;\n\t\t\tr.m = r.exec(len < 0 ? s : s.substr(0, pos + len));\n\t\t\tvar b = r.m != null;\n\t\t\tif (b) {\n\t\t\t\tr.s = s;\n\t\t\t}\n\t\t\tb;\n\t\t} else {\n\t\t\t// TODO: check some ^/$ related corner cases\n\t\t\tvar b = match( len < 0 ? s.substr(pos) : s.substr(pos,len) );\n\t\t\tif (b) {\n\t\t\t\tr.s = s;\n\t\t\t\tr.m.index += pos;\n\t\t\t}\n\t\t\tb;\n\t\t}\n\t}\n\n\tpublic function split( s : String ) : Array<String> {\n\t\t// we can't use directly s.split because it's ignoring the 'g' flag\n\t\tvar d = \"#__delim__#\";\n\t\treturn untyped s.replace(r,d).split(d);\n\t}\n\n\tpublic inline function replace( s : String, by : String ) : String {\n\t\treturn untyped s.replace(r,by);\n\t}\n\n\tpublic function map( s : String, f : EReg -> String ) : String {\n\t\tvar offset = 0;\n\t\tvar buf = new StringBuf();\n\t\tdo {\n\t\t\tif (offset >= s.length)\n\t\t\t\tbreak;\n\t\t\telse if (!matchSub(s, offset)) {\n\t\t\t\tbuf.add(s.substr(offset));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tvar p = matchedPos();\n\t\t\tbuf.add(s.substr(offset, p.pos - offset));\n\t\t\tbuf.add(f(this));\n\t\t\tif (p.len == 0) {\n\t\t\t\tbuf.add(s.substr(p.pos, 1));\n\t\t\t\toffset = p.pos + 1;\n\t\t\t}\n\t\t\telse\n\t\t\t\toffset = p.pos + p.len;\n\t\t} while (r.global);\n\t\tif (!r.global && offset > 0 && offset < s.length)\n\t\t\tbuf.add(s.substr(offset));\n\t\treturn buf.toString();\n\t}\n}\n\n@:native(\"RegExp\")\nprivate extern class HaxeRegExp extends js.RegExp {\n\tvar m:js.RegExp.RegExpMatch;\n\tvar s:String;\n}\n","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:noDoc\nclass HxOverrides {\n\n\tstatic function dateStr( date :Date ) : String {\n\t\tvar m = date.getMonth() + 1;\n\t\tvar d = date.getDate();\n\t\tvar h = date.getHours();\n\t\tvar mi = date.getMinutes();\n\t\tvar s = date.getSeconds();\n\t\treturn date.getFullYear()\n\t\t\t+\"-\"+(if( m < 10 ) \"0\"+m else \"\"+m)\n\t\t\t+\"-\"+(if( d < 10 ) \"0\"+d else \"\"+d)\n\t\t\t+\" \"+(if( h < 10 ) \"0\"+h else \"\"+h)\n\t\t\t+\":\"+(if( mi < 10 ) \"0\"+mi else \"\"+mi)\n\t\t\t+\":\"+(if( s < 10 ) \"0\"+s else \"\"+s);\n\t}\n\n\tstatic function strDate( s : String ) : Date {\n\t\tswitch( s.length ) {\n\t\tcase 8: // hh:mm:ss\n\t\t\tvar k = s.split(\":\");\n\t\t\tvar d : Date = untyped __new__(Date);\n\t\t\tuntyped d[\"setTime\"](0);\n\t\t\tuntyped d[\"setUTCHours\"](k[0]);\n\t\t\tuntyped d[\"setUTCMinutes\"](k[1]);\n\t\t\tuntyped d[\"setUTCSeconds\"](k[2]);\n\t\t\treturn d;\n\t\tcase 10: // YYYY-MM-DD\n\t\t\tvar k = s.split(\"-\");\n\t\t\treturn new Date(cast k[0],cast untyped k[1] - 1,cast k[2],0,0,0);\n\t\tcase 19: // YYYY-MM-DD hh:mm:ss\n\t\t\tvar k = s.split(\" \");\n\t\t\tvar y = k[0].split(\"-\");\n\t\t\tvar t = k[1].split(\":\");\n\t\t\treturn new Date(cast y[0],cast untyped y[1] - 1,cast y[2],cast t[0],cast t[1],cast t[2]);\n\t\tdefault:\n\t\t\tthrow \"Invalid date format : \" + s;\n\t\t}\n\t}\n\n\tstatic function cca( s : String, index : Int ) : Null<Int> {\n\t\tvar x = (cast s).charCodeAt(index);\n\t\tif( x != x ) // fast isNaN\n\t\t\treturn js.Lib.undefined; // isNaN will still return true\n\t\treturn x;\n\t}\n\n\tstatic function substr( s : String, pos : Int, ?len : Int ) : String {\n\t\tif (len == null) {\n\t\t\tlen = s.length;\n\t\t} else if (len < 0) {\n\t\t\tif (pos == 0)\n\t\t\t\tlen = s.length + len;\n\t\t\telse\n\t\t\t\treturn \"\";\n\t\t}\n\n\t\t#if (js_es < 5)\n\t\tif (pos < 0) {\n\t\t\tpos = s.length + pos;\n\t\t\tif (pos < 0)\n\t\t\t\tpos = 0;\n\t\t}\n\t\t#end\n\n\t\treturn (untyped s).substr(pos, len);\n\t}\n\n\tstatic function indexOf<T>( a : Array<T>, obj : T, i : Int) {\n\t\tvar len = a.length;\n\t\tif (i < 0) {\n\t\t\ti += len;\n\t\t\tif (i < 0) i = 0;\n\t\t}\n\t\twhile (i < len)\n\t\t{\n\t\t\tif (untyped __js__(\"a[i] === obj\"))\n\t\t\t\treturn i;\n\t\t\ti++;\n\t\t}\n\t\treturn -1;\n\t}\n\n\tstatic function lastIndexOf<T>( a : Array<T>, obj : T, i : Int) {\n\t\tvar len = a.length;\n\t\tif (i >= len)\n\t\t\ti = len - 1;\n\t\telse if (i < 0)\n\t\t\ti += len;\n\t\twhile (i >= 0)\n\t\t{\n\t\t\tif (untyped __js__(\"a[i] === obj\"))\n\t\t\t\treturn i;\n\t\t\ti--;\n\t\t}\n\t\treturn -1;\n\t}\n\n\tstatic function remove<T>( a : Array<T>, obj : T ) {\n\t\tvar i = a.indexOf(obj);\n\t\tif( i == -1 ) return false;\n\t\ta.splice(i,1);\n\t\treturn true;\n\t}\n\n\tstatic function iter<T>( a : Array<T> ) : Iterator<T> untyped {\n\t\treturn {\n\t\t\tcur : 0,\n\t\t\tarr : a,\n\t\t\thasNext : function() {\n\t\t\t\treturn __this__.cur < __this__.arr.length;\n\t\t\t},\n\t\t\tnext : function() {\n\t\t\t\treturn __this__.arr[__this__.cur++];\n\t\t\t}\n\t\t};\n\t}\n\n\tstatic function __init__() untyped {\n#if (js_es < 5)\n\t\t__feature__('HxOverrides.indexOf', if( Array.prototype.indexOf ) __js__(\"HxOverrides\").indexOf = function(a,o,i) return Array.prototype.indexOf.call(a, o, i));\n\t\t__feature__('HxOverrides.lastIndexOf', if( Array.prototype.lastIndexOf ) __js__(\"HxOverrides\").lastIndexOf = function(a,o,i) return Array.prototype.lastIndexOf.call(a, o, i));\n#end\n\t}\n\n}\n","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n/**\n\tThe `Lambda` class is a collection of methods to support functional\n\tprogramming. It is ideally used with `using Lambda` and then acts as an\n\textension to Iterable types.\n\n\tOn static platforms, working with the Iterable structure might be slower\n\tthan performing the operations directly on known types, such as Array and\n\tList.\n\n\tIf the first argument to any of the methods is null, the result is\n\tunspecified.\n\n\t@see http://haxe.org/manual/std-Lambda.html\n**/\nclass Lambda {\n\n\t/**\n\t\tCreates an Array from Iterable `it`.\n\n\t\tIf `it` is an Array, this function returns a copy of it.\n\t**/\n\tpublic static function array<A>( it : Iterable<A> ) : Array<A> {\n\t\tvar a = new Array<A>();\n\t\tfor(i in it)\n\t\t\ta.push(i);\n\t\treturn a;\n\t}\n\n\t/**\n\t\tCreates a List form Iterable `it`.\n\n\t\tIf `it` is a List, this function returns a copy of it.\n\t**/\n\tpublic static function list<A>( it : Iterable<A> ) : List<A> {\n\t\tvar l = new List<A>();\n\t\tfor(i in it)\n\t\t\tl.add(i);\n\t\treturn l;\n\t}\n\n\t/**\n\t\tCreates a new List by applying function `f` to all elements of `it`.\n\n\t\tThe order of elements is preserved.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function map<A,B>( it : Iterable<A>, f : A -> B ) : List<B> {\n\t\tvar l = new List<B>();\n\t\tfor( x in it )\n\t\t\tl.add(f(x));\n\t\treturn l;\n\t}\n\n\t/**\n\t\tSimilar to map, but also passes the index of each element to `f`.\n\n\t\tThe order of elements is preserved.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function mapi<A,B>( it : Iterable<A>, f : Int -> A -> B ) : List<B> {\n\t\tvar l = new List<B>();\n\t\tvar i = 0;\n\t\tfor( x in it )\n\t\t\tl.add(f(i++,x));\n\t\treturn l;\n\t}\n\n\t/**\n\t\tConcatenate a list of lists.\n\n\t\tThe order of elements is preserved.\n\t**/\n\tpublic static function flatten<A>( it : Iterable<Iterable<A>> ) : List<A> {\n\t\tvar l = new List<A>();\n\t\tfor (e in it)\n\t\t\tfor (x in e)\n\t\t\t\tl.add(x);\n\t\treturn l;\n\t}\n\n\t/**\n\t\tA composition of map and flatten.\n\n\t\tThe order of elements is preserved.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function flatMap<A,B>( it : Iterable<A>, f: A -> Iterable<B> ) : List<B> {\n\t\treturn Lambda.flatten(Lambda.map(it, f));\n\t}\n\n\t/**\n\t\tTells if `it` contains `elt`.\n\n\t\tThis function returns true as soon as an element is found which is equal\n\t\tto `elt` according to the `==` operator.\n\n\t\tIf no such element is found, the result is false.\n\t**/\n\tpublic static function has<A>( it : Iterable<A>, elt : A ) : Bool {\n\t\tfor( x in it )\n\t\t\tif( x == elt )\n\t\t\t\treturn true;\n\t\treturn false;\n\t}\n\n\t/**\n\t\tTells if `it` contains an element for which `f` is true.\n\n\t\tThis function returns true as soon as an element is found for which a\n\t\tcall to `f` returns true.\n\n\t\tIf no such element is found, the result is false.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function exists<A>( it : Iterable<A>, f : A -> Bool ) {\n\t\tfor( x in it )\n\t\t\tif( f(x) )\n\t\t\t\treturn true;\n\t\treturn false;\n\t}\n\n\t/**\n\t\tTells if `f` is true for all elements of `it`.\n\n\t\tThis function returns false as soon as an element is found for which a\n\t\tcall to `f` returns false.\n\n\t\tIf no such element is found, the result is true.\n\n\t\tIn particular, this function always returns true if `it` is empty.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function foreach<A>( it : Iterable<A>, f : A -> Bool ) {\n\t\tfor( x in it )\n\t\t\tif( !f(x) )\n\t\t\t\treturn false;\n\t\treturn true;\n\t}\n\n\t/**\n\t\tCalls `f` on all elements of `it`, in order.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function iter<A>( it : Iterable<A>, f : A -> Void ) {\n\t\tfor( x in it )\n\t\t\tf(x);\n\t}\n\n\t/**\n\t\tReturns a List containing those elements of `it` for which `f` returned\n\t\ttrue.\n\n\t\tIf `it` is empty, the result is the empty List even if `f` is null.\n\n\t\tOtherwise if `f` is null, the result is unspecified.\n\t**/\n\tpublic static function filter<A>( it : Iterable<A>, f : A -> Bool ) {\n\t\tvar l = new List<A>();\n\t\tfor( x in it )\n\t\t\tif( f(x) )\n\t\t\t\tl.add(x);\n\t\treturn l;\n\t}\n\n\t/**\n\t\tFunctional fold on Iterable `it`, using function `f` with start argument\n\t\t`first`.\n\n\t\tIf `it` has no elements, the result is `first`.\n\n\t\tOtherwise the first element of `it` is passed to `f` alongside `first`.\n\t\tThe result of that call is then passed to `f` with the next element of\n\t\t`it`, and so on until `it` has no more elements.\n\n\t\tIf `it` or `f` are null, the result is unspecified.\n\t**/\n\tpublic static function fold<A,B>( it : Iterable<A>, f : A -> B -> B, first : B ) : B {\n\t\tfor( x in it )\n\t\t\tfirst = f(x,first);\n\t\treturn first;\n\t}\n\n\t/**\n\t\tReturns the number of elements in `it` for which `pred` is true, or the\n\t\ttotal number of elements in `it` if `pred` is null.\n\n\t\tThis function traverses all elements.\n\t**/\n\tpublic static function count<A>( it : Iterable<A>, ?pred : A -> Bool ) {\n\t\tvar n = 0;\n\t\tif( pred == null )\n\t\t\tfor( _ in it )\n\t\t\t\tn++;\n\t\telse\n\t\t\tfor( x in it )\n\t\t\t\tif( pred(x) )\n\t\t\t\t\tn++;\n\t\treturn n;\n\t}\n\n\t/**\n\t\tTells if Iterable `it` does not contain any element.\n\t**/\n\tpublic static function empty<T>( it : Iterable<T> ) : Bool {\n\t\treturn !it.iterator().hasNext();\n\t}\n\n\t/**\n\t\tReturns the index of the first element `v` within Iterable `it`.\n\n\t\tThis function uses operator `==` to check for equality.\n\n\t\tIf `v` does not exist in `it`, the result is -1.\n\t**/\n\tpublic static function indexOf<T>( it : Iterable<T>, v : T ) : Int {\n\t\tvar i = 0;\n\t\tfor( v2 in it ) {\n\t\t\tif( v == v2 )\n\t\t\t\treturn i;\n\t\t\ti++;\n\t\t}\n\t\treturn -1;\n\t}\n\n\t/**\n\t\tReturns the first element of `it` for which `f` is true.\n\n\t\tThis function returns as soon as an element is found for which a call to\n\t\t`f` returns true.\n\n\t\tIf no such element is found, the result is null.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function find<T>( it : Iterable<T>, f : T -> Bool ) : Null<T> {\n\t\tfor( v in it ) {\n\t\t\tif(f(v)) return v;\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t\tReturns a new List containing all elements of Iterable `a` followed by\n\t\tall elements of Iterable `b`.\n\n\t\tIf `a` or `b` are null, the result is unspecified.\n\t**/\n\tpublic static function concat<T>( a : Iterable<T>, b : Iterable<T> ) : List<T> {\n\t\tvar l = new List();\n\t\tfor( x in a )\n\t\t\tl.add(x);\n\t\tfor( x in b )\n\t\t\tl.add(x);\n\t\treturn l;\n\t}\n\n}\n","import js.html.Performance;\nimport js.html.DivElement;\nimport js.Browser;\n\n@:expose class Perf {\n\n\tpublic static var MEASUREMENT_INTERVAL:Int = 1000;\n\n\tpublic static var FONT_FAMILY:String = \"Helvetica,Arial\";\n\n\tpublic static var FPS_BG_CLR:String = \"#00FF00\";\n\tpublic static var FPS_WARN_BG_CLR:String = \"#FF8000\";\n\tpublic static var FPS_PROB_BG_CLR:String = \"#FF0000\";\n\n\tpublic static var MS_BG_CLR:String = \"#FFFF00\";\n\tpublic static var MEM_BG_CLR:String = \"#086A87\";\n\tpublic static var INFO_BG_CLR:String = \"#00FFFF\";\n\tpublic static var FPS_TXT_CLR:String = \"#000000\";\n\tpublic static var MS_TXT_CLR:String = \"#000000\";\n\tpublic static var MEM_TXT_CLR:String = \"#FFFFFF\";\n\tpublic static var INFO_TXT_CLR:String = \"#000000\";\n\n\tpublic static var TOP_LEFT:String = \"TL\";\n\tpublic static var TOP_RIGHT:String = \"TR\";\n\tpublic static var BOTTOM_LEFT:String = \"BL\";\n\tpublic static var BOTTOM_RIGHT:String = \"BR\";\n\n\tstatic var DELAY_TIME:Int = 4000;\n\n\tpublic var fps:DivElement;\n\tpublic var ms:DivElement;\n\tpublic var memory:DivElement;\n\tpublic var info:DivElement;\n\n\tpublic var lowFps:Float;\n\tpublic var avgFps:Float;\n\tpublic var currentFps:Float;\n\tpublic var currentMs:Float;\n\tpublic var currentMem:String;\n\n\tvar _time:Float;\n\tvar _startTime:Float;\n\tvar _prevTime:Float;\n\tvar _ticks:Int;\n\tvar _fpsMin:Float;\n\tvar _fpsMax:Float;\n\tvar _memCheck:Bool;\n\tvar _pos:String;\n\tvar _offset:Float;\n\tvar _measureCount:Int;\n\tvar _totalFps:Float;\n\n\tvar _perfObj:Performance;\n\tvar _memoryObj:Memory;\n\tvar _raf:Int;\n\n\tvar RAF:Dynamic;\n\tvar CAF:Dynamic;\n\n\tpublic function new(?pos = \"TR\", ?offset:Float = 0) {\n\t\t_perfObj = Browser.window.performance;\n\t\tif (Reflect.field(_perfObj, \"memory\") != null) _memoryObj = Reflect.field(_perfObj, \"memory\");\n\t\t_memCheck = (_perfObj != null && _memoryObj != null && _memoryObj.totalJSHeapSize > 0);\n\n\t\t_pos = pos;\n\t\t_offset = offset;\n\n\t\t_init();\n\t\t_createFpsDom();\n\t\t_createMsDom();\n\t\tif (_memCheck) _createMemoryDom();\n\n\t\tif (Browser.window.requestAnimationFrame != null) RAF = Browser.window.requestAnimationFrame;\n\t\telse if (untyped __js__(\"window\").mozRequestAnimationFrame != null) RAF = untyped __js__(\"window\").mozRequestAnimationFrame;\n\t\telse if (untyped __js__(\"window\").webkitRequestAnimationFrame != null) RAF = untyped __js__(\"window\").webkitRequestAnimationFrame;\n\t\telse if (untyped __js__(\"window\").msRequestAnimationFrame != null) RAF = untyped __js__(\"window\").msRequestAnimationFrame;\n\n\t\tif (Browser.window.cancelAnimationFrame != null) CAF = Browser.window.cancelAnimationFrame;\n\t\telse if (untyped __js__(\"window\").mozCancelAnimationFrame != null) CAF = untyped __js__(\"window\").mozCancelAnimationFrame;\n\t\telse if (untyped __js__(\"window\").webkitCancelAnimationFrame != null) CAF = untyped __js__(\"window\").webkitCancelAnimationFrame;\n\t\telse if (untyped __js__(\"window\").msCancelAnimationFrame != null) CAF = untyped __js__(\"window\").msCancelAnimationFrame;\n\n\t\tif (RAF != null) _raf = Reflect.callMethod(Browser.window, RAF, [_tick]);\n\t}\n\n\tinline function _init() {\n\t\tcurrentFps = 60;\n\t\tcurrentMs = 0;\n\t\tcurrentMem = \"0\";\n\n\t\tlowFps = 60;\n\t\tavgFps = 60;\n\n\t\t_measureCount = 0;\n\t\t_totalFps = 0;\n\t\t_time = 0;\n\t\t_ticks = 0;\n\t\t_fpsMin = 60;\n\t\t_fpsMax = 60;\n\t\t_startTime = _now();\n\t\t_prevTime = -MEASUREMENT_INTERVAL;\n\t}\n\n\tinline function _now():Float {\n\t\treturn (_perfObj != null && _perfObj.now != null) ? _perfObj.now() : Date.now().getTime();\n\t}\n\n\tfunction _tick(val:Float) {\n\t\tvar time = _now();\n\t\t_ticks++;\n\n\t\tif (_raf != null && time > _prevTime + MEASUREMENT_INTERVAL) {\n\t\t\tcurrentMs = Math.round(time - _startTime);\n\t\t\tms.innerHTML = \"MS: \" + currentMs;\n\n\t\t\tcurrentFps = Math.round((_ticks * 1000) / (time - _prevTime));\n\t\t\tif (currentFps > 0 && val > DELAY_TIME) {\n\t\t\t\t_measureCount++;\n\t\t\t\t_totalFps += currentFps;\n\t\t\t\tlowFps = _fpsMin = Math.min(_fpsMin, currentFps);\n\t\t\t\t_fpsMax = Math.max(_fpsMax, currentFps);\n\t\t\t\tavgFps = Math.round(_totalFps / _measureCount);\n\t\t\t}\n\n\t\t\tfps.innerHTML =  \"FPS: \" + currentFps + \" (\" + _fpsMin + \"-\" + _fpsMax + \")\";\n\n\t\t\tif (currentFps >= 30) fps.style.backgroundColor = FPS_BG_CLR;\n\t\t\telse if (currentFps >= 15) fps.style.backgroundColor = FPS_WARN_BG_CLR;\n\t\t\telse fps.style.backgroundColor = FPS_PROB_BG_CLR;\n\n\t\t\t_prevTime = time;\n\t\t\t_ticks = 0;\n\n\t\t\tif (_memCheck) {\n\t\t\t\tcurrentMem = _getFormattedSize(_memoryObj.usedJSHeapSize, 2);\n\t\t\t\tmemory.innerHTML = \"MEM: \" + currentMem;\n\t\t\t}\n\t\t}\n\t\t_startTime =  time;\n\n\t\tif (_raf != null) _raf = Reflect.callMethod(Browser.window, RAF, [_tick]);\n\t}\n\n\tfunction _createDiv(id:String, ?top:Float = 0):DivElement {\n\t\tvar div:DivElement = Browser.document.createDivElement();\n\t\tdiv.id = id;\n\t\tdiv.className = id;\n\t\tdiv.style.position = \"absolute\";\n\n\t\tswitch (_pos) {\n\t\t\tcase \"TL\":\n\t\t\t\tdiv.style.left = _offset + \"px\";\n\t\t\t\tdiv.style.top = top + \"px\";\n\t\t\tcase \"TR\":\n\t\t\t\tdiv.style.right = _offset + \"px\";\n\t\t\t\tdiv.style.top = top + \"px\";\n\t\t\tcase \"BL\":\n\t\t\t\tdiv.style.left = _offset + \"px\";\n\t\t\t\tdiv.style.bottom = ((_memCheck) ? 48 : 32) - top + \"px\";\n\t\t\tcase \"BR\":\n\t\t\t\tdiv.style.right = _offset + \"px\";\n\t\t\t\tdiv.style.bottom = ((_memCheck) ? 48 : 32) - top + \"px\";\n\t\t}\n\n\t\tdiv.style.width = \"80px\";\n\t\tdiv.style.height = \"12px\";\n\t\tdiv.style.lineHeight = \"12px\";\n\t\tdiv.style.padding = \"2px\";\n\t\tdiv.style.fontFamily = FONT_FAMILY;\n\t\tdiv.style.fontSize = \"9px\";\n\t\tdiv.style.fontWeight = \"bold\";\n\t\tdiv.style.textAlign = \"center\";\n\t\tBrowser.document.body.appendChild(div);\n\t\treturn div;\n\t}\n\n\tfunction _createFpsDom() {\n\t\tfps = _createDiv(\"fps\");\n\t\tfps.style.backgroundColor = FPS_BG_CLR;\n\t\tfps.style.zIndex = \"995\";\n\t\tfps.style.color = FPS_TXT_CLR;\n\t\tfps.innerHTML = \"FPS: 0\";\n\t}\n\n\tfunction _createMsDom() {\n\t\tms = _createDiv(\"ms\", 16);\n\t\tms.style.backgroundColor = MS_BG_CLR;\n\t\tms.style.zIndex = \"996\";\n\t\tms.style.color = MS_TXT_CLR;\n\t\tms.innerHTML = \"MS: 0\";\n\t}\n\n\tfunction _createMemoryDom() {\n\t\tmemory = _createDiv(\"memory\", 32);\n\t\tmemory.style.backgroundColor = MEM_BG_CLR;\n\t\tmemory.style.color = MEM_TXT_CLR;\n\t\tmemory.style.zIndex = \"997\";\n\t\tmemory.innerHTML = \"MEM: 0\";\n\t}\n\n\tfunction _getFormattedSize(bytes:Float, ?frac:Int = 0):String {\n\t\tvar sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\"];\n\t\tif (bytes == 0) return \"0\";\n\t\tvar precision = Math.pow(10, frac);\n\t\tvar i = Math.floor(Math.log(bytes) / Math.log(1024));\n\t\treturn Math.round(bytes * precision / Math.pow(1024, i)) / precision + \" \" + sizes[i];\n\t}\n\n\tpublic function addInfo(val:String) {\n\t\tinfo = _createDiv(\"info\", (_memCheck) ? 48 : 32);\n\t\tinfo.style.backgroundColor = INFO_BG_CLR;\n\t\tinfo.style.color = INFO_TXT_CLR;\n\t\tinfo.style.zIndex = \"998\";\n\t\tinfo.innerHTML = val;\n\t}\n\n\tpublic function clearInfo() {\n\t\tif (info != null) {\n\t\t\tBrowser.document.body.removeChild(info);\n\t\t\tinfo = null;\n\t\t}\n\t}\n\n\tpublic function destroy() {\n\t\t_cancelRAF();\n\t\t_perfObj = null;\n\t\t_memoryObj = null;\n\t\tif (fps != null) {\n\t\t\tBrowser.document.body.removeChild(fps);\n\t\t\tfps = null;\n\t\t}\n\t\tif (ms != null) {\n\t\t\tBrowser.document.body.removeChild(ms);\n\t\t\tms = null;\n\t\t}\n\t\tif (memory != null) {\n\t\t\tBrowser.document.body.removeChild(memory);\n\t\t\tmemory = null;\n\t\t}\n\t\tclearInfo();\n\t\t_init();\n\t}\n\n\tinline function _cancelRAF() {\n\t\tReflect.callMethod(Browser.window, CAF, [_raf]);\n\t\t_raf = null;\n\t}\n}\n\ntypedef Memory = {\n\tvar usedJSHeapSize:Float;\n\tvar totalJSHeapSize:Float;\n\tvar jsHeapSizeLimit:Float;\n}","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:coreApi class Reflect {\n\n\t@:pure\n\tpublic inline static function hasField( o : Dynamic, field : String ) : Bool {\n\t\treturn untyped __js__('Object').prototype.hasOwnProperty.call(o, field);\n\t}\n\n\tpublic static function field( o : Dynamic, field : String ) : Dynamic {\n\t\ttry return untyped o[field] catch( e : Dynamic ) return null;\n\t}\n\n\tpublic inline static function setField( o : Dynamic, field : String, value : Dynamic ) : Void untyped {\n\t\to[field] = value;\n\t}\n\n\tpublic static inline function getProperty( o : Dynamic, field : String ) : Dynamic untyped {\n\t\tvar tmp;\n\t\treturn if( o == null ) __define_feature__(\"Reflect.getProperty\",null) else if( o.__properties__ && (tmp=o.__properties__[\"get_\"+field]) ) o[tmp]() else o[field];\n\t}\n\n\tpublic static inline function setProperty( o : Dynamic, field : String, value : Dynamic ) : Void untyped {\n\t\tvar tmp;\n\t\tif( o.__properties__ && (tmp=o.__properties__[\"set_\"+field]) ) o[tmp](value) else o[field] = __define_feature__(\"Reflect.setProperty\",value);\n\t}\n\n\tpublic inline static function callMethod( o : Dynamic, func : haxe.Constraints.Function, args : Array<Dynamic> ) : Dynamic untyped {\n\t\treturn func.apply(o,args);\n\t}\n\n\tpublic static function fields( o : Dynamic ) : Array<String> {\n\t\tvar a = [];\n\t\tif (o != null) untyped {\n\t\t\tvar hasOwnProperty = __js__('Object').prototype.hasOwnProperty;\n\t\t\t__js__(\"for( var f in o ) {\");\n\t\t\tif( f != \"__id__\" && f != \"hx__closures__\" && hasOwnProperty.call(o, f) ) a.push(f);\n\t\t\t__js__(\"}\");\n\t\t}\n\t\treturn a;\n\t}\n\n\tpublic static function isFunction( f : Dynamic ) : Bool untyped {\n\t\treturn __js__(\"typeof(f)\") == \"function\" && !(js.Boot.isClass(f) || js.Boot.isEnum(f));\n\t}\n\n\tpublic static function compare<T>( a : T, b : T ) : Int {\n\t\treturn ( a == b ) ? 0 : (((cast a) > (cast b)) ? 1 : -1);\n\t}\n\n\tpublic static function compareMethods( f1 : Dynamic, f2 : Dynamic ) : Bool {\n\t\tif( f1 == f2 )\n\t\t\treturn true;\n\t\tif( !isFunction(f1) || !isFunction(f2) )\n\t\t\treturn false;\n\t\treturn f1.scope == f2.scope && f1.method == f2.method && f1.method != null;\n\t}\n\n\tpublic static function isObject( v : Dynamic ) : Bool untyped {\n\t\tif( v == null )\n\t\t\treturn false;\n\t\tvar t = __js__(\"typeof(v)\");\n\t\treturn (t == \"string\" || (t == \"object\" && v.__enum__ == null)) || (t == \"function\" && (js.Boot.isClass(v) || js.Boot.isEnum(v)) != null);\n\t}\n\n\tpublic static function isEnumValue( v : Dynamic ) : Bool {\n\t\treturn v != null && v.__enum__ != null;\n\t}\n\n\tpublic static function deleteField( o : Dynamic, field : String ) : Bool untyped {\n\t\tif( !hasField(o,field) ) return false;\n\t\t__js__(\"delete\")(o[field]);\n\t\treturn true;\n\t}\n\n\tpublic static function copy<T>( o : T ) : T {\n\t\tvar o2 : Dynamic = {};\n\t\tfor( f in Reflect.fields(o) )\n\t\t\tReflect.setField(o2,f,Reflect.field(o,f));\n\t\treturn o2;\n\t}\n\n\t@:overload(function( f : Array<Dynamic> -> Void ) : Dynamic {})\n\tpublic static function makeVarArgs( f : Array<Dynamic> -> Dynamic ) : Dynamic {\n\t\treturn function() {\n\t\t\tvar a = untyped Array.prototype.slice.call(__js__(\"arguments\"));\n\t\t\treturn f(a);\n\t\t};\n\t}\n\n}\n","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport js.Boot;\n\n@:keepInit\n@:coreApi class Std {\n\n\tpublic static inline function is( v : Dynamic, t : Dynamic ) : Bool {\n\t\treturn untyped js.Boot.__instanceof(v,t);\n\t}\n\n\tpublic static inline function instance<T:{},S:T>( value : T, c : Class<S> ) : S {\n\t\treturn untyped __instanceof__(value, c) ? cast value : null;\n\t}\n\n\tpublic static function string( s : Dynamic ) : String {\n\t\treturn untyped js.Boot.__string_rec(s,\"\");\n\t}\n\n\tpublic static inline function int( x : Float ) : Int {\n\t\treturn (cast x) | 0;\n\t}\n\n\tpublic static function parseInt( x : String ) : Null<Int> {\n\t\tvar v = untyped __js__(\"parseInt\")(x, 10);\n\t\t// parse again if hexadecimal\n\t\tif( v == 0 && (x.charCodeAt(1) == 'x'.code || x.charCodeAt(1) == 'X'.code) )\n\t\t\tv = untyped __js__(\"parseInt\")(x);\n\t\tif( untyped __js__(\"isNaN\")(v) )\n\t\t\treturn null;\n\t\treturn cast v;\n\t}\n\n\tpublic static inline function parseFloat( x : String ) : Float {\n\t\treturn untyped __js__(\"parseFloat\")(x);\n\t}\n\n\tpublic static function random( x : Int ) : Int {\n\t\treturn x <= 0 ? 0 : Math.floor(Math.random()*x);\n\t}\n\n\tstatic function __init__() : Void untyped {\n\t\t__feature__(\"js.Boot.getClass\",String.prototype.__class__ = __feature__(\"Type.resolveClass\",$hxClasses[\"String\"] = String,String));\n\t\t__feature__(\"js.Boot.isClass\",String.__name__ = __feature__(\"Type.getClassName\",[\"String\"],true));\n\t\t__feature__(\"Type.resolveClass\",$hxClasses[\"Array\"] = Array);\n\t\t__feature__(\"js.Boot.isClass\",Array.__name__ = __feature__(\"Type.getClassName\",[\"Array\"],true));\n\t\t__feature__(\"Date.*\", {\n\t\t\t__feature__(\"js.Boot.getClass\",__js__('Date').prototype.__class__ = __feature__(\"Type.resolveClass\",$hxClasses[\"Date\"] = __js__('Date'),__js__('Date')));\n\t\t\t__feature__(\"js.Boot.isClass\",__js__('Date').__name__ = [\"Date\"]);\n\t\t});\n\t\t__feature__(\"Int.*\",{\n\t\t\tvar Int = __feature__(\"Type.resolveClass\", $hxClasses[\"Int\"] = { __name__ : [\"Int\"] }, { __name__ : [\"Int\"] });\n\t\t});\n\t\t__feature__(\"Dynamic.*\",{\n\t\t\tvar Dynamic = __feature__(\"Type.resolveClass\", $hxClasses[\"Dynamic\"] = { __name__ : [\"Dynamic\"] }, { __name__ : [\"Dynamic\"] });\n\t\t});\n\t\t__feature__(\"Float.*\",{\n\t\t\tvar Float = __feature__(\"Type.resolveClass\", $hxClasses[\"Float\"] = __js__(\"Number\"), __js__(\"Number\"));\n\t\t\tFloat.__name__ = [\"Float\"];\n\t\t});\n\t\t__feature__(\"Bool.*\",{\n\t\t\tvar Bool = __feature__(\"Type.resolveEnum\",$hxClasses[\"Bool\"] = __js__(\"Boolean\"), __js__(\"Boolean\"));\n\t\t\tBool.__ename__ = [\"Bool\"];\n\t\t});\n\t\t__feature__(\"Class.*\",{\n\t\t\tvar Class = __feature__(\"Type.resolveClass\", $hxClasses[\"Class\"] = { __name__ : [\"Class\"] }, { __name__ : [\"Class\"] });\n\t\t});\n\t\t__feature__(\"Enum.*\",{\n\t\t\tvar Enum = {};\n\t\t});\n\t\t__feature__(\"Void.*\",{\n\t\t\tvar Void = __feature__(\"Type.resolveEnum\", $hxClasses[\"Void\"] = { __ename__ : [\"Void\"] }, { __ename__ : [\"Void\"] });\n\t\t});\n\n#if (js_es < 5)\n\t\t__feature__(\"Array.map\",\n\t\t\tif( Array.prototype.map == null )\n\t\t\t\tArray.prototype.map = function(f) {\n\t\t\t\t\tvar a = [];\n\t\t\t\t\tfor( i in 0...__this__.length )\n\t\t\t\t\t\ta[i] = f(__this__[i]);\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\t\t);\n\t\t__feature__(\"Array.filter\",\n\t\t\tif( Array.prototype.filter == null )\n\t\t\t\tArray.prototype.filter = function(f) {\n\t\t\t\t\tvar a = [];\n\t\t\t\t\tfor( i in 0...__this__.length ) {\n\t\t\t\t\t\tvar e = __this__[i];\n\t\t\t\t\t\tif( f(e) ) a.push(e);\n\t\t\t\t\t}\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\t\t);\n#end\n\t}\n\n}\n","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n/**\n\tA String buffer is an efficient way to build a big string by appending small\n\telements together.\n\n\tIts cross-platform implementation uses String concatenation internally, but\n\tStringBuf may be optimized for different targets.\n\n\tUnlike String, an instance of StringBuf is not immutable in the sense that\n\tit can be passed as argument to functions which modify it by appending more\n\tvalues. However, the internal buffer cannot be modified.\n**/\nclass StringBuf {\n\n\tvar b:String;\n\n\t/**\n\t\tThe length of `this` StringBuf in characters.\n\t**/\n\tpublic var length(get,never) : Int;\n\n\t/**\n\t\tCreates a new StringBuf instance.\n\n\t\tThis may involve initialization of the internal buffer.\n\t**/\n\tpublic inline function new() {\n\t\tb = \"\";\n\t}\n\n\tinline function get_length() : Int {\n\t\treturn b.length;\n\t}\n\n\t/**\n\t\tAppends the representation of `x` to `this` StringBuf.\n\n\t\tThe exact representation of `x` may vary per platform. To get more\n\t\tconsistent behavior, this function should be called with\n\t\tStd.string(x).\n\n\t\tIf `x` is null, the String \"null\" is appended.\n\t**/\n\tpublic inline function add<T>( x : T ) : Void {\n\t\tb += x;\n\t}\n\n\t/**\n\t\tAppends the character identified by `c` to `this` StringBuf.\n\n\t\tIf `c` is negative or has another invalid value, the result is\n\t\tunspecified.\n\t**/\n\tpublic inline function addChar( c : Int ) : Void {\n\t\tb += String.fromCharCode(c);\n\t}\n\n\t/**\n\t\tAppends a substring of `s` to `this` StringBuf.\n\n\t\tThis function expects `pos` and `len` to describe a valid substring of\n\t\t`s`, or else the result is unspecified. To get more robust behavior,\n\t\t`this.add(s.substr(pos,len))` can be used instead.\n\n\t\tIf `s` or `pos` are null, the result is unspecified.\n\n\t\tIf `len` is omitted or null, the substring ranges from `pos` to the end\n\t\tof `s`.\n\t**/\n\tpublic inline function addSub( s : String, pos : Int, ?len : Int) : Void {\n\t\tb += (len == null ? s.substr(pos) : s.substr(pos, len));\n\t}\n\n\t/**\n\t\tReturns the content of `this` StringBuf as String.\n\n\t\tThe buffer is not emptied by this operation.\n\t**/\n\tpublic inline function toString() : String {\n\t\treturn b;\n\t}\n\n}\n","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n/**\n\tThis class provides advanced methods on Strings. It is ideally used with\n\t`using StringTools` and then acts as an [extension](http://haxe.org/manual/lf-static-extension.html)\n\tto the `String` class.\n\n\tIf the first argument to any of the methods is null, the result is\n\tunspecified.\n**/\n#if cpp\nusing cpp.NativeString;\n#end\nclass StringTools {\n\t/**\n\t\tEncode an URL by using the standard format.\n\t**/\n\t#if (!java && !cpp && !lua) inline #end public static function urlEncode( s : String ) : String {\n\t\t#if flash\n\t\t\treturn untyped __global__[\"encodeURIComponent\"](s);\n\t\t#elseif neko\n\t\t\treturn untyped new String(_urlEncode(s.__s));\n\t\t#elseif js\n\t\t\treturn untyped encodeURIComponent(s);\n\t\t#elseif cpp\n\t\t\treturn untyped s.__URLEncode();\n\t\t#elseif java\n\t\t\treturn postProcessUrlEncode(java.net.URLEncoder.encode(s, \"UTF-8\"));\n\t\t#elseif cs\n\t\t\treturn untyped cs.system.Uri.EscapeDataString(s);\n\t\t#elseif python\n\t\t\treturn python.lib.urllib.Parse.quote(s, \"\");\n\t\t#elseif hl\n\t\t\tvar len = 0;\n\t\t\tvar b = @:privateAccess s.bytes.urlEncode(len);\n\t\t\treturn @:privateAccess String.__alloc__(b,len);\n\t\t#elseif lua\n\t\t\ts = lua.NativeStringTools.gsub(s, \"\\n\", \"\\r\\n\");\n\t\t\ts = lua.NativeStringTools.gsub(s, \"([^%w %-%_%.%~])\", function (c) {\n\t\t\t\treturn lua.NativeStringTools.format(\"%%%02X\", lua.NativeStringTools.byte(c) + '');\n\t\t\t});\n\t\t\ts = lua.NativeStringTools.gsub(s, \" \", \"+\");\n\t\t\treturn s;\n\t\t#else\n\t\t\treturn null;\n\t\t#end\n\t}\n\n#if java\n\tprivate static function postProcessUrlEncode( s : String ) : String {\n\t\tvar ret = new StringBuf();\n\t\tvar i = 0,\n\t\t    len = s.length;\n\t\twhile (i < len) {\n\t\t\tswitch(_charAt(s, i++)) {\n\t\t\tcase '+'.code:\n\t\t\t\tret.add('%20');\n\t\t\tcase '%'.code if (i <= len - 2):\n\t\t\t\tvar c1 = _charAt(s, i++),\n\t\t\t\t    c2 = _charAt(s, i++);\n\t\t\t\tswitch[c1, c2] {\n\t\t\t\tcase ['2'.code, '1'.code]:\n\t\t\t\t\tret.addChar('!'.code);\n\t\t\t\tcase ['2'.code, '7'.code]:\n\t\t\t\t\tret.addChar('\\''.code);\n\t\t\t\tcase ['2'.code, '8'.code]:\n\t\t\t\t\tret.addChar('('.code);\n\t\t\t\tcase ['2'.code, '9'.code]:\n\t\t\t\t\tret.addChar(')'.code);\n\t\t\t\tcase ['7'.code, 'E'.code]:\n\t\t\t\t\tret.addChar('-'.code);\n\t\t\t\tcase _:\n\t\t\t\t\tret.addChar('%'.code);\n\t\t\t\t\tret.addChar(cast c1);\n\t\t\t\t\tret.addChar(cast c2);\n\t\t\t\t}\n\t\t\tcase chr:\n\t\t\t\tret.addChar(cast chr);\n\t\t\t}\n\t\t}\n\t\treturn ret.toString();\n\t}\n#end\n\n\t/**\n\t\tDecode an URL using the standard format.\n\t**/\n\t#if (!java && !cpp && !lua) inline #end public static function urlDecode( s : String ) : String {\n\t\t#if flash\n\t\t\treturn untyped __global__[\"decodeURIComponent\"](s.split(\"+\").join(\" \"));\n\t\t#elseif neko\n\t\t\treturn untyped new String(_urlDecode(s.__s));\n\t\t#elseif js\n\t\t\treturn untyped decodeURIComponent(s.split(\"+\").join(\" \"));\n\t\t#elseif cpp\n\t\t\treturn untyped s.__URLDecode();\n\t\t#elseif java\n\t\t\ttry\n\t\t\t\treturn untyped __java__(\"java.net.URLDecoder.decode(s, \\\"UTF-8\\\")\")\n\t\t\tcatch (e:Dynamic) throw e;\n\t\t#elseif cs\n\t\t\treturn untyped cs.system.Uri.UnescapeDataString(s);\n\t\t#elseif python\n\t\t\treturn python.lib.urllib.Parse.unquote(s);\n\t\t#elseif hl\n\t\t\tvar len = 0;\n\t\t\tvar b = @:privateAccess s.bytes.urlDecode(len);\n\t\t\treturn @:privateAccess String.__alloc__(b,len);\n\t\t#elseif lua\n\t\t\ts = lua.NativeStringTools.gsub (s, \"+\", \" \");\n\t\t\ts = lua.NativeStringTools.gsub (s, \"%%(%x%x)\",\n\t\t\t\tfunction(h) {return lua.NativeStringTools.char(lua.Lua.tonumber(h,16));});\n\t\t\ts = lua.NativeStringTools.gsub (s, \"\\r\\n\", \"\\n\");\n\t\t\treturn s;\n\t\t#else\n\t\t\treturn null;\n\t\t#end\n\t}\n\n\t/**\n\t\tEscapes HTML special characters of the string `s`.\n\n\t\tThe following replacements are made:\n\n\t\t- `&` becomes `&amp`;\n\t\t- `<` becomes `&lt`;\n\t\t- `>` becomes `&gt`;\n\n\t\tIf `quotes` is true, the following characters are also replaced:\n\n\t\t- `\"` becomes `&quot`;\n\t\t- `'` becomes `&#039`;\n\t**/\n\tpublic static function htmlEscape( s : String, ?quotes : Bool ) : String {\n\t\ts = s.split(\"&\").join(\"&amp;\").split(\"<\").join(\"&lt;\").split(\">\").join(\"&gt;\");\n\t\treturn quotes ? s.split('\"').join(\"&quot;\").split(\"'\").join(\"&#039;\") : s;\n\t}\n\n\t/**\n\t\tUnescapes HTML special characters of the string `s`.\n\n\t\tThis is the inverse operation to htmlEscape, i.e. the following always\n\t\tholds: `htmlUnescape(htmlEscape(s)) == s`\n\n\t\tThe replacements follow:\n\n\t\t- `&amp;` becomes `&`\n\t\t- `&lt;` becomes `<`\n\t\t- `&gt;` becomes `>`\n\t\t- `&quot;` becomes `\"`\n\t\t- `&#039;` becomes `'`\n\t**/\n\tpublic static function htmlUnescape( s : String ) : String {\n\t\treturn s.split(\"&gt;\").join(\">\").split(\"&lt;\").join(\"<\").split(\"&quot;\").join('\"').split(\"&#039;\").join(\"'\").split(\"&amp;\").join(\"&\");\n\t}\n\n\t/**\n\t\tTells if the string `s` starts with the string `start`.\n\n\t\tIf `start` is `null`, the result is unspecified.\n\n\t\tIf `start` is the empty String `\"\"`, the result is true.\n\t**/\n\tpublic static #if (cs || java) inline #end function startsWith( s : String, start : String ) : Bool {\n\t\t#if java\n\t\treturn untyped s.startsWith(start);\n\t\t#elseif cs\n\t\treturn untyped s.StartsWith(start);\n\t\t#elseif cpp\n\t\tif (s.length<start.length)\n\t\t\treturn false;\n\t\tvar p0 = s.c_str();\n\t\tvar p1 = start.c_str();\n\t\tfor(i in 0...start.length)\n\t\t\tif ( p0.at(i) != p1.at(i) )\n\t\t\t\treturn false;\n\t\treturn true;\n\t\t#elseif hl\n\t\treturn @:privateAccess (s.length >= start.length && s.bytes.compare(0,start.bytes,0,start.length<<1) == 0);\n\t\t#else\n\t\treturn( s.length >= start.length && s.substr(0, start.length) == start );\n\t\t#end\n\t}\n\n\t/**\n\t\tTells if the string `s` ends with the string `end`.\n\n\t\tIf `end` is `null`, the result is unspecified.\n\n\t\tIf `end` is the empty String `\"\"`, the result is true.\n\t**/\n\tpublic static #if (cs || java) inline #end function endsWith( s : String, end : String ) : Bool {\n\t\t#if java\n\t\treturn untyped s.endsWith(end);\n\t\t#elseif cs\n\t\treturn untyped s.EndsWith(end);\n\t\t#elseif cpp\n\t\tif (s.length<end.length)\n\t\t\treturn false;\n\t\tvar p0 = s.c_str().add( s.length-end.length );\n\t\tvar p1 = end.c_str();\n\t\tfor(i in 0...end.length)\n\t\t\tif ( p0.at(i) != p1.at(i) )\n\t\t\t\treturn false;\n\t\treturn true;\n\t\t#elseif hl\n\t\tvar elen = end.length;\n\t\tvar slen = s.length;\n\t\treturn @:privateAccess (slen >= elen && s.bytes.compare((slen - elen) << 1, end.bytes, 0, elen << 1) == 0);\n\t\t#else\n\t\tvar elen = end.length;\n\t\tvar slen = s.length;\n\t\treturn( slen >= elen && s.substr(slen - elen, elen) == end );\n\t\t#end\n\t}\n\n\t/**\n\t\tTells if the character in the string `s` at position `pos` is a space.\n\n\t\tA character is considered to be a space character if its character code\n\t\tis 9,10,11,12,13 or 32.\n\n\t\tIf `s` is the empty String `\"\"`, or if pos is not a valid position within\n\t\t`s`, the result is false.\n\t**/\n\tpublic static function isSpace( s : String, pos : Int ) : Bool {\n\t\t#if (python || lua)\n\t\tif (s.length == 0 || pos < 0 || pos >= s.length) return false;\n\t\t#end\n\t\tvar c = s.charCodeAt( pos );\n\t\treturn (c > 8 && c < 14) || c == 32;\n\t}\n\n\t/**\n\t\tRemoves leading space characters of `s`.\n\n\t\tThis function internally calls `isSpace()` to decide which characters to\n\t\tremove.\n\n\t\tIf `s` is the empty String `\"\"` or consists only of space characters, the\n\t\tresult is the empty String `\"\"`.\n\t**/\n\tpublic #if cs inline #end static function ltrim( s : String ) : String {\n\t\t#if cs\n\t\treturn untyped s.TrimStart();\n\t\t#else\n\t\tvar l = s.length;\n\t\tvar r = 0;\n\t\twhile( r < l && isSpace(s,r) ){\n\t\t\tr++;\n\t\t}\n\t\tif( r > 0 )\n\t\t\treturn s.substr(r, l-r);\n\t\telse\n\t\t\treturn s;\n\t\t#end\n\t}\n\n\t/**\n\t\tRemoves trailing space characters of `s`.\n\n\t\tThis function internally calls `isSpace()` to decide which characters to\n\t\tremove.\n\n\t\tIf `s` is the empty String `\"\"` or consists only of space characters, the\n\t\tresult is the empty String `\"\"`.\n\t**/\n\tpublic #if cs inline #end static function rtrim( s : String ) : String {\n\t\t#if cs\n\t\treturn untyped s.TrimEnd();\n\t\t#else\n\t\tvar l = s.length;\n\t\tvar r = 0;\n\t\twhile( r < l && isSpace(s,l-r-1) ){\n\t\t\tr++;\n\t\t}\n\t\tif( r > 0 ){\n\t\t\treturn s.substr(0, l-r);\n\t\t}else{\n\t\t\treturn s;\n\t\t}\n\t\t#end\n\t}\n\n\t/**\n\t\tRemoves leading and trailing space characters of `s`.\n\n\t\tThis is a convenience function for `ltrim(rtrim(s))`.\n\t**/\n\tpublic #if (cs || java) inline #end static function trim( s : String ) : String {\n\t\t#if cs\n\t\treturn untyped s.Trim();\n\t\t#elseif java\n\t\treturn untyped s.trim();\n\t\t#else\n\t\treturn ltrim(rtrim(s));\n\t\t#end\n\t}\n\n\t/**\n\t\tConcatenates `c` to `s` until `s.length` is at least `l`.\n\n\t\tIf `c` is the empty String `\"\"` or if `l` does not exceed `s.length`,\n\t\t`s` is returned unchanged.\n\n\t\tIf `c.length` is 1, the resulting String length is exactly `l`.\n\n\t\tOtherwise the length may exceed `l`.\n\n\t\tIf `c` is null, the result is unspecified.\n\t**/\n\tpublic static function lpad( s : String, c : String, l : Int ) : String {\n\t\tif (c.length <= 0)\n\t\t\treturn s;\n\n\t\twhile (s.length < l) {\n\t\t\ts = c + s;\n\t\t}\n\t\treturn s;\n\t}\n\n\t/**\n\t\tAppends `c` to `s` until `s.length` is at least `l`.\n\n\t\tIf `c` is the empty String `\"\"` or if `l` does not exceed `s.length`,\n\t\t`s` is returned unchanged.\n\n\t\tIf `c.length` is 1, the resulting String length is exactly `l`.\n\n\t\tOtherwise the length may exceed `l`.\n\n\t\tIf `c` is null, the result is unspecified.\n\t**/\n\tpublic static function rpad( s : String, c : String, l : Int ) : String {\n\t\tif (c.length <= 0)\n\t\t\treturn s;\n\n\t\twhile (s.length < l) {\n\t\t\ts = s + c;\n\t\t}\n\t\treturn s;\n\t}\n\n\t/**\n\t\tReplace all occurences of the String `sub` in the String `s` by the\n\t\tString `by`.\n\n\t\tIf `sub` is the empty String `\"\"`, `by` is inserted after each character\n\t\tof `s`. If `by` is also the empty String `\"\"`, `s` remains unchanged.\n\n\t\tThis is a convenience function for `s.split(sub).join(by)`.\n\n\t\tIf `sub` or `by` are null, the result is unspecified.\n\t**/\n\tpublic static function replace( s : String, sub : String, by : String ) : String {\n\t\t#if java\n\t\tif (sub.length == 0)\n\t\t\treturn s.split(sub).join(by);\n\t\telse\n\t\t\treturn untyped s.replace(sub, by);\n\t\t#elseif cs\n\t\tif (sub.length == 0)\n\t\t\treturn s.split(sub).join(by);\n\t\telse\n\t\t\treturn untyped s.Replace(sub, by);\n\t\t#else\n\t\treturn s.split(sub).join(by);\n\t\t#end\n\t}\n\n\t/**\n\t\tEncodes `n` into a hexadecimal representation.\n\n\t\tIf `digits` is specified, the resulting String is padded with \"0\" until\n\t\tits `length` equals `digits`.\n\t**/\n\tpublic static function hex( n : Int, ?digits : Int ) {\n\t\t#if flash\n\t\t\tvar n : UInt = n;\n\t\t\tvar s : String = untyped n.toString(16);\n\t\t\ts = s.toUpperCase();\n\t\t#else\n\t\t\tvar s = \"\";\n\t\t\tvar hexChars = \"0123456789ABCDEF\";\n\t\t\tdo {\n\t\t\t\ts = hexChars.charAt(n&15) + s;\n\t\t\t\tn >>>= 4;\n\t\t\t} while( n > 0 );\n\t\t#end\n\t\t#if python\n\t\tif (digits != null && s.length < digits) {\n\t\t\tvar diff = digits - s.length;\n\t\t\tfor (_ in 0...diff) {\n\t\t\t\ts = \"0\" + s;\n\t\t\t}\n\t\t}\n\t\t#else\n\t\tif( digits != null )\n\t\t\twhile( s.length < digits )\n\t\t\t\ts = \"0\"+s;\n\t\t#end\n\t\treturn s;\n\t}\n\n\t/**\n\t\tReturns the character code at position `index` of String `s`, or an\n\t\tend-of-file indicator at if `position` equals `s.length`.\n\n\t\tThis method is faster than `String.charCodeAt()` on some platforms, but\n\t\tthe result is unspecified if `index` is negative or greater than\n\t\t`s.length`.\n\n\t\tEnd of file status can be checked by calling `StringTools.isEof()` with\n\t\tthe returned value as argument.\n\n\t\tThis operation is not guaranteed to work if `s` contains the `\\0`\n\t\tcharacter.\n\t**/\n\tpublic static inline function fastCodeAt( s : String, index : Int ) : Int {\n\t\t#if neko\n\t\treturn untyped __dollar__sget(s.__s, index);\n\t\t#elseif cpp\n\t\treturn untyped s.cca(index);\n\t\t#elseif flash\n\t\treturn untyped s.cca(index);\n\t\t#elseif java\n\t\treturn ( index < s.length ) ? cast(_charAt(s, index), Int) : -1;\n\t\t#elseif cs\n\t\treturn ( cast(index, UInt) < s.length ) ? cast(s[index], Int) : -1;\n\t\t#elseif js\n\t\treturn (untyped s).charCodeAt(index);\n\t\t#elseif python\n\t\treturn if (index >= s.length) -1 else python.internal.UBuiltins.ord(python.Syntax.arrayAccess(s, index));\n\t\t#elseif hl\n\t\treturn @:privateAccess s.bytes.getUI16(index << 1);\n\t\t#elseif lua\n\t\treturn lua.NativeStringTools.byte(s,index+1);\n\t\t#else\n\t\treturn untyped s.cca(index);\n\t\t#end\n\t}\n\n\t/*\n\t\tTells if `c` represents the end-of-file (EOF) character.\n\t*/\n\t@:noUsing public static inline function isEof( c : Int ) : Bool {\n\t\t#if (flash || cpp || hl)\n\t\treturn c == 0;\n\t\t#elseif js\n\t\treturn c != c; // fast NaN\n\t\t#elseif (neko || lua)\n\t\treturn c == null;\n\t\t#elseif cs\n\t\treturn c == -1;\n\t\t#elseif java\n\t\treturn c == -1;\n\t\t#elseif python\n\t\treturn c == -1;\n\t\t#else\n\t\treturn false;\n\t\t#end\n\t}\n\n\t/**\n\t\tReturns a String that can be used as a single command line argument\n\t\ton Unix.\n\t\tThe input will be quoted, or escaped if necessary.\n\t*/\n\tpublic static function quoteUnixArg(argument:String):String {\n\t\t// Based on cpython's shlex.quote().\n\t\t// https://hg.python.org/cpython/file/a3f076d4f54f/Lib/shlex.py#l278\n\n\t\tif (argument == \"\")\n\t\t\treturn \"''\";\n\n\t\tif (!~/[^a-zA-Z0-9_@%+=:,.\\/-]/.match(argument))\n\t\t\treturn argument;\n\n\t\t// use single quotes, and put single quotes into double quotes\n\t\t// the string $'b is then quoted as '$'\"'\"'b'\n\t\treturn \"'\" + replace(argument, \"'\", \"'\\\"'\\\"'\") + \"'\";\n\t}\n\n\t/**\n\t\tCharacter codes of the characters that will be escaped by `quoteWinArg(_, true)`.\n\t*/\n\tpublic static var winMetaCharacters = [\" \".code, \"(\".code, \")\".code, \"%\".code, \"!\".code, \"^\".code, \"\\\"\".code, \"<\".code, \">\".code, \"&\".code, \"|\".code, \"\\n\".code, \"\\r\".code];\n\n\t/**\n\t\tReturns a String that can be used as a single command line argument\n\t\ton Windows.\n\t\tThe input will be quoted, or escaped if necessary, such that the output\n\t\twill be parsed as a single argument using the rule specified in\n\t\thttp://msdn.microsoft.com/en-us/library/ms880421\n\n\t\tExamples:\n\t\t```\n\t\tquoteWinArg(\"abc\") == \"abc\";\n\t\tquoteWinArg(\"ab c\") == '\"ab c\"';\n\t\t```\n\t*/\n\tpublic static function quoteWinArg(argument:String, escapeMetaCharacters:Bool):String {\n\t\t// If there is no space, tab, back-slash, or double-quotes, and it is not an empty string.\n\t\tif (!~/^[^ \\t\\\\\"]+$/.match(argument)) {\n\n\t\t\t// Based on cpython's subprocess.list2cmdline().\n\t\t\t// https://hg.python.org/cpython/file/50741316dd3a/Lib/subprocess.py#l620\n\n\t\t\tvar result = new StringBuf();\n\t\t\tvar needquote = argument.indexOf(\" \") != -1 || argument.indexOf(\"\\t\") != -1 || argument == \"\";\n\n\t\t\tif (needquote)\n\t\t\t\tresult.add('\"');\n\n\t\t\tvar bs_buf = new StringBuf();\n\t\t\tfor (i in 0...argument.length) {\n\t\t\t\tswitch (argument.charCodeAt(i)) {\n\t\t\t\t\tcase \"\\\\\".code:\n\t\t\t\t\t\t// Don't know if we need to double yet.\n\t\t\t\t\t\tbs_buf.add(\"\\\\\");\n\t\t\t\t\tcase '\"'.code:\n\t\t\t\t\t\t// Double backslashes.\n\t\t\t\t\t\tvar bs = bs_buf.toString();\n\t\t\t\t\t\tresult.add(bs);\n\t\t\t\t\t\tresult.add(bs);\n\t\t\t\t\t\tbs_buf = new StringBuf();\n\t\t\t\t\t\tresult.add('\\\\\"');\n\t\t\t\t\tcase c:\n\t\t\t\t\t\t// Normal char\n\t\t\t\t\t\tif (bs_buf.length > 0) {\n\t\t\t\t\t\t\tresult.add(bs_buf.toString());\n\t\t\t\t\t\t\tbs_buf = new StringBuf();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresult.addChar(c);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Add remaining backslashes, if any.\n\t\t\tresult.add(bs_buf.toString());\n\n\t\t\tif (needquote) {\n\t\t\t\tresult.add(bs_buf.toString());\n\t\t\t\tresult.add('\"');\n\t\t\t}\n\n\t\t\targument = result.toString();\n\t\t}\n\n\t\tif (escapeMetaCharacters) {\n\t\t\tvar result = new StringBuf();\n\t\t\tfor (i in 0...argument.length) {\n\t\t\t\tvar c = argument.charCodeAt(i);\n\t\t\t\tif (winMetaCharacters.indexOf(c) >= 0) {\n\t\t\t\t\tresult.addChar(\"^\".code);\n\t\t\t\t}\n\t\t\t\tresult.addChar(c);\n\t\t\t}\n\t\t\treturn result.toString();\n\t\t} else {\n\t\t\treturn argument;\n\t\t}\n\t}\n\n\t#if java\n\tprivate static inline function _charAt(str:String, idx:Int):java.StdTypes.Char16 return untyped str._charAt(idx);\n\t#end\n\n\t#if neko\n\tprivate static var _urlEncode = neko.Lib.load(\"std\",\"url_encode\",1);\n\tprivate static var _urlDecode = neko.Lib.load(\"std\",\"url_decode\",1);\n\t#end\n\n}\n","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\nenum ValueType {\n\tTNull;\n\tTInt;\n\tTFloat;\n\tTBool;\n\tTObject;\n\tTFunction;\n\tTClass( c : Class<Dynamic> );\n\tTEnum( e : Enum<Dynamic> );\n\tTUnknown;\n}\n\n@:coreApi class Type {\n\n\tpublic static inline function getClass<T>( o : T ) : Class<T> {\n\t\treturn if (o == null) null else @:privateAccess js.Boot.getClass(o);\n\t}\n\n\tpublic static function getEnum( o : EnumValue ) : Enum<Dynamic> untyped {\n\t\tif( o == null )\n\t\t\treturn null;\n\t\treturn o.__enum__;\n\t}\n\n\tpublic static function getSuperClass( c : Class<Dynamic> ) : Class<Dynamic> untyped {\n\t\treturn c.__super__;\n\t}\n\n\n\tpublic static function getClassName( c : Class<Dynamic> ) : String {\n\t\tvar a : Array<String> = untyped c.__name__;\n\t\tif (a == null)\n\t\t\treturn null;\n\t\treturn a.join(\".\");\n\t}\n\n\tpublic static function getEnumName( e : Enum<Dynamic> ) : String {\n\t\tvar a : Array<String> = untyped e.__ename__;\n\t\treturn a.join(\".\");\n\t}\n\n\tpublic static function resolveClass( name : String ) : Class<Dynamic> untyped {\n\t\tvar cl : Class<Dynamic> = $hxClasses[name];\n\t\t// ensure that this is a class\n\t\tif( cl == null || !js.Boot.isClass(cl) )\n\t\t\treturn null;\n\t\treturn cl;\n\t}\n\n\tpublic static function resolveEnum( name : String ) : Enum<Dynamic> untyped {\n\t\tvar e : Dynamic = $hxClasses[name];\n\t\t// ensure that this is an enum\n\t\tif( e == null || !js.Boot.isEnum(e) )\n\t\t\treturn null;\n\t\treturn e;\n\t}\n\n\tpublic static function createInstance<T>( cl : Class<T>, args : Array<Dynamic> ) : T untyped {\n\t\tswitch( args.length ) {\n\t\tcase 0:\n\t\t\treturn __new__(cl);\n\t\tcase 1:\n\t\t\treturn __new__(cl,args[0]);\n\t\tcase 2:\n\t\t\treturn __new__(cl,args[0],args[1]);\n\t\tcase 3:\n\t\t\treturn __new__(cl,args[0],args[1],args[2]);\n\t\tcase 4:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3]);\n\t\tcase 5:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4]);\n\t\tcase 6:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5]);\n\t\tcase 7:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5],args[6]);\n\t\tcase 8:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7]);\n\t\tcase 9:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7],args[8]);\n\t\tcase 10:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7],args[8],args[9]);\n\t\tcase 11:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7],args[8],args[9],args[10]);\n\t\tcase 12:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7],args[8],args[9],args[10],args[11]);\n\t\tcase 13:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7],args[8],args[9],args[10],args[11],args[12]);\n\t\tcase 14:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7],args[8],args[9],args[10],args[11],args[12],args[13]);\n\t\tdefault:\n\t\t\tthrow \"Too many arguments\";\n\t\t}\n\t}\n\n\tpublic static function createEmptyInstance<T>( cl : Class<T> ) : T untyped {\n\t\t__js__(\"function empty() {}; empty.prototype = cl.prototype\");\n\t\treturn __js__(\"new empty()\");\n\t}\n\n\tpublic static function createEnum<T>( e : Enum<T>, constr : String, ?params : Array<Dynamic> ) : T {\n\t\tvar f:Dynamic = Reflect.field(e,constr);\n\t\tif( f == null ) throw \"No such constructor \"+constr;\n\t\tif( Reflect.isFunction(f) ) {\n\t\t\tif( params == null ) throw \"Constructor \"+constr+\" need parameters\";\n\t\t\treturn Reflect.callMethod(e,f,params);\n\t\t}\n\t\tif( params != null && params.length != 0 )\n\t\t\tthrow \"Constructor \"+constr+\" does not need parameters\";\n\t\treturn f;\n\t}\n\n\tpublic static function createEnumIndex<T>( e : Enum<T>, index : Int, ?params : Array<Dynamic> ) : T {\n\t\tvar c : String = (untyped e.__constructs__)[index];\n\t\tif( c == null ) throw index+\" is not a valid enum constructor index\";\n\t\treturn createEnum(e,c,params);\n\t}\n\n\tpublic static function getInstanceFields( c : Class<Dynamic> ) : Array<String> {\n\t\tvar a = [];\n\t\tuntyped __js__(\"for(var i in c.prototype) a.push(i)\");\n\t\ta.remove(\"__class__\");\n\t\ta.remove(\"__properties__\");\n\t\treturn a;\n\t}\n\n\tpublic static function getClassFields( c : Class<Dynamic> ) : Array<String> {\n\t\tvar a = Reflect.fields(c);\n\t\ta.remove(\"__name__\");\n\t\ta.remove(\"__interfaces__\");\n\t\ta.remove(\"__properties__\");\n\t\ta.remove(\"__super__\");\n\t\ta.remove(\"__meta__\");\n\t\ta.remove(\"prototype\");\n\t\treturn a;\n\t}\n\n\tpublic static inline function getEnumConstructs( e : Enum<Dynamic> ) : Array<String> {\n\t\treturn ((cast e).__constructs__ : Array<String>).copy();\n\t}\n\n\tpublic static function typeof( v : Dynamic ) : ValueType untyped {\n\t\tswitch( __js__(\"typeof\")(v) ) {\n\t\tcase \"boolean\": return TBool;\n\t\tcase \"string\": return TClass(String);\n\t\tcase \"number\":\n\t\t\t// this should handle all cases : NaN, +/-Inf and Floats outside range\n\t\t\tif( Math.ceil(v) == v%2147483648.0 )\n\t\t\t\treturn TInt;\n\t\t\treturn TFloat;\n\t\tcase \"object\":\n\t\t\tif( v == null )\n\t\t\t\treturn TNull;\n\t\t\tvar e = v.__enum__;\n\t\t\tif( e != null )\n\t\t\t\treturn TEnum(e);\n\t\t\tvar c = js.Boot.getClass(v);\n\t\t\tif( c != null )\n\t\t\t\treturn TClass(c);\n\t\t\treturn TObject;\n\t\tcase \"function\":\n\t\t\tif( js.Boot.isClass(v) || js.Boot.isEnum(v) )\n\t\t\t\treturn TObject;\n\t\t\treturn TFunction;\n\t\tcase \"undefined\":\n\t\t\treturn TNull;\n\t\tdefault:\n\t\t\treturn TUnknown;\n\t\t}\n\t}\n\n\tpublic static function enumEq<T>( a : T, b : T ) : Bool untyped {\n\t\tif( a == b )\n\t\t\treturn true;\n\t\ttry {\n\t\t\tif( a[0] != b[0] )\n\t\t\t\treturn false;\n\t\t\tfor( i in 2...a.length )\n\t\t\t\tif( !enumEq(a[i],b[i]) )\n\t\t\t\t\treturn false;\n\t\t\tvar e = a.__enum__;\n\t\t\tif( e != b.__enum__ || e == null )\n\t\t\t\treturn false;\n\t\t} catch( e : Dynamic ) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic inline static function enumConstructor( e : EnumValue ) : String {\n\t\treturn untyped e[0];\n\t}\n\n\tpublic inline static function enumParameters( e : EnumValue ) : Array<Dynamic> {\n\t\treturn untyped e.slice(2);\n\t}\n\n\tpublic inline static function enumIndex( e : EnumValue ) : Int {\n\t\treturn untyped e[1];\n\t}\n\n\tpublic inline static function allEnums<T>( e : Enum<T> ) : Array<T> {\n\t\treturn untyped __define_feature__(\"Type.allEnums\", e.__empty_constructs__);\n\t}\n\n}\n\n","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n#if ((flash || flash9doc || cs || hl) && !doc_gen)\n/**\n\tThe unsigned `Int` type is only defined for Flash and C#. It's currently\n\thandled the same as a normal Int.\n\n\t@see http://haxe.org/manual/types-basic-types.html\n**/\n@:coreType\n@:notNull\n@:runtimeValue\n@:analyzer(no_const_propagation)\nabstract UInt to Int from Int\n{\n\t@:commutative @:op(A+B) private static function addI(lhs:UInt, rhs:Int):UInt;\n\t@:commutative @:op(A+B) private static function addF(lhs:UInt, rhs:Float):Float;\n\t@:op(A+B) private static function add(lhs:UInt, rhs:UInt):UInt;\n\n\t@:commutative @:op(A*B) private static function mulI(lhs:UInt, rhs:Int):UInt;\n\t@:commutative @:op(A*B) private static function mulF(lhs:UInt, rhs:Float):Float;\n\t@:op(A*B) private static function mul(lhs:UInt, rhs:UInt):UInt;\n\n\t@:op(A%B) private static function modI(lhs:UInt, rhs:Int):UInt;\n\t@:op(A%B) private static function modF(lhs:UInt, rhs:Float):Float;\n\t@:op(A%B) private static function mod(lhs:UInt, rhs:UInt):UInt;\n\n\t@:op(A-B) private static function subI(lhs:UInt, rhs:Int):UInt;\n\t@:op(A-B) private static function subF(lhs:UInt, rhs:Float):Float;\n\t@:op(A-B) private static function sub(lhs:UInt, rhs:UInt):UInt;\n\n\t@:op(A/B) private static function divI(lhs:UInt, rhs:Int):Float;\n\t@:op(A/B) private static function divF(lhs:UInt, rhs:Float):Float;\n\t@:op(A/B) private static function div(lhs:UInt, rhs:UInt):Float;\n\n\t@:commutative @:op(A|B) private static function orI(lhs:UInt, rhs:Int):UInt;\n\t@:op(A|B) private static function or(lhs:UInt, rhs:UInt):UInt;\n\n\t@:commutative @:op(A^B) private static function xorI(lhs:UInt, rhs:Int):UInt;\n\t@:op(A^B) private static function xor(lhs:UInt, rhs:UInt):UInt;\n\n\t@:commutative @:op(A&B) private static function andI(lhs:UInt, rhs:Int):UInt;\n\t@:op(A&B) private static function and(lhs:UInt, rhs:UInt):UInt;\n\n\t@:op(A<<B) private static function shl(lhs:UInt, rhs:Int):UInt;\n\t@:op(A>>B) private static inline function shr(lhs:UInt, rhs:Int):UInt return lhs >>> rhs;\n\t@:op(A>>>B) private static function ushr(lhs:UInt, rhs:Int):UInt;\n\n\t@:op(A>B) private static function gt(lhs:UInt, rhs:UInt):Bool;\n\t@:op(A>=B) private static function gte(lhs:UInt, rhs:UInt):Bool;\n\t@:op(A<B) private static function lt(lhs:UInt, rhs:UInt):Bool;\n\t@:op(A<=B) private static function lte(lhs:UInt, rhs:UInt):Bool;\n\n\t@:op(A>B) private static function gtf(lhs:UInt, rhs:Float):Bool;\n\t@:op(A>B) private static function gtf2(lhs:Float, rhs:UInt):Bool;\n\t@:op(A>=B) private static function gtef(lhs:UInt, rhs:Float):Bool;\n\t@:op(A>=B) private static function gtef2(lhs:Float, rhs:UInt):Bool;\n\t@:op(A<B) private static function ltf(lhs:UInt, rhs:Float):Bool;\n\t@:op(A<B) private static function ltf2(lhs:Float, rhs:UInt):Bool;\n\t@:op(A<=B) private static function ltef(lhs:UInt, rhs:Float):Bool;\n\t@:op(A<=B) private static function ltef2(lhs:Float, rhs:UInt):Bool;\n\n\t@:op(~A) private static function bneg(t:UInt):UInt;\n\n\t@:commutative @:op(A == B) private static function equalsInt<T:Int>(a:UInt, b:T):Bool;\n\t@:commutative @:op(A != B) private static function notEqualsInt<T:Int>(a:UInt, b:T):Bool;\n\t@:commutative @:op(A == B) private static function equalsFloat<T:Float>(a:UInt, b:T):Bool;\n\t@:commutative @:op(A != B) private static function notEqualsFloat<T:Float>(a:UInt, b:T):Bool;\n\n\t@:op(++A) private function prefixIncrement():UInt;\n\t@:op(A++) private function postfixIncrement():UInt;\n\t@:op(--A) private function prefixDecrement():UInt;\n\t@:op(A--) private function postfixDecrement():UInt;\n}\n#else\n/**\n\tThe unsigned `Int` type is only defined for Flash and C#.\n\tSimulate it for other platforms.\n\n\t@see http://haxe.org/manual/types-basic-types.html\n**/\nabstract UInt(Int) from Int to Int {\n\n\t@:op(A + B) private static inline function add(a:UInt, b:UInt):UInt {\n\t\treturn a.toInt() + b.toInt();\n\t}\n\n\t@:op(A / B) private static inline function div(a:UInt, b:UInt):Float {\n\t\treturn a.toFloat() / b.toFloat();\n\t}\n\n\t@:op(A * B) private static inline function mul(a:UInt, b:UInt):UInt {\n\t\treturn a.toInt() * b.toInt();\n\t}\n\n\t@:op(A - B) private static inline function sub(a:UInt, b:UInt):UInt {\n\t\treturn a.toInt() - b.toInt();\n\t}\n\n\t@:op(A > B) private static #if !js inline #end function gt(a:UInt, b:UInt):Bool {\n\t\tvar aNeg = a.toInt() < 0;\n\t\tvar bNeg = b.toInt() < 0;\n\t\treturn\n\t\t\tif( aNeg != bNeg ) aNeg;\n\t\t\telse a.toInt() > b.toInt();\n\t}\n\n\t@:op(A >= B) private static #if !js inline #end function gte(a:UInt, b:UInt):Bool {\n\t\tvar aNeg = a.toInt() < 0;\n\t\tvar bNeg = b.toInt() < 0;\n\t\treturn\n\t\t\tif( aNeg != bNeg ) aNeg;\n\t\t\telse a.toInt() >= b.toInt();\n\t}\n\n\t@:op(A < B) private static inline function lt(a:UInt, b:UInt):Bool {\n\t\treturn gt(b, a);\n\t}\n\n\t@:op(A <= B) private static inline function lte(a:UInt, b:UInt):Bool {\n\t\treturn gte(b, a);\n\t}\n\n\t@:op(A & B) private static inline function and(a:UInt, b:UInt):UInt {\n\t\treturn a.toInt() & b.toInt();\n\t}\n\n\t@:op(A | B) private static inline function or(a:UInt, b:UInt):UInt {\n\t\treturn a.toInt() | b.toInt();\n\t}\n\n\t@:op(A ^ B) private static inline function xor(a:UInt, b:UInt):UInt {\n\t\treturn a.toInt() ^ b.toInt();\n\t}\n\n\t@:op(A << B) private static inline function shl(a:UInt, b:Int):UInt {\n\t\treturn a.toInt() << b;\n\t}\n\n\t@:op(A >> B) private static inline function shr(a:UInt, b:Int):UInt {\n\t\treturn a.toInt() >>> b;\n\t}\n\n\t@:op(A >>> B) private static inline function ushr(a:UInt, b:Int):UInt {\n\t\treturn a.toInt() >>> b;\n\t}\n\n\t@:op(A % B) private static inline function mod(a:UInt, b:UInt):UInt {\n\t\treturn Std.int( a.toFloat() % b.toFloat() );\n\t}\n\n\t@:commutative @:op(A + B) private static inline function addWithFloat(a:UInt, b:Float):Float {\n\t\treturn a.toFloat() + b;\n\t}\n\n\t@:commutative @:op(A * B) private static inline function mulWithFloat(a:UInt, b:Float):Float {\n\t\treturn a.toFloat() * b;\n\t}\n\n\t@:op(A / B) private static inline function divFloat(a:UInt, b:Float):Float {\n\t\treturn a.toFloat() / b;\n\t}\n\n\t@:op(A / B) private static inline function floatDiv(a:Float, b:UInt):Float {\n\t\treturn a / b.toFloat();\n\t}\n\n\t@:op(A - B) private static inline function subFloat(a:UInt, b:Float):Float {\n\t\treturn a.toFloat() - b;\n\t}\n\n\t@:op(A - B) private static inline function floatSub(a:Float, b:UInt):Float {\n\t\treturn a - b.toFloat();\n\t}\n\n\t@:op(A > B) private static inline function gtFloat(a:UInt, b:Float):Bool {\n\t\treturn a.toFloat() > b;\n\t}\n\n\t@:commutative @:op(A == B) private static inline function equalsInt<T:Int>(a:UInt, b:T):Bool {\n\t\treturn a.toInt() == b;\n\t}\n\n\t@:commutative @:op(A != B) private static inline function notEqualsInt<T:Int>(a:UInt, b:T):Bool {\n\t\treturn a.toInt() != b;\n\t}\n\n\t@:commutative @:op(A == B) private static inline function equalsFloat<T:Float>(a:UInt, b:T):Bool {\n\t\treturn a.toFloat() == b;\n\t}\n\n\t@:commutative @:op(A != B) private static inline function notEqualsFloat<T:Float>(a:UInt, b:T):Bool {\n\t\treturn a.toFloat() != b;\n\t}\n\n\t@:op(A >= B) private static inline function gteFloat(a:UInt, b:Float):Bool {\n\t\treturn a.toFloat() >= b;\n\t}\n\n\n\t@:op(A > B) private static inline function floatGt(a:Float, b:UInt):Bool {\n\t\treturn a > b.toFloat();\n\t}\n\n\t@:op(A >= B) private static inline function floatGte(a:Float, b:UInt):Bool {\n\t\treturn a >= b.toFloat();\n\t}\n\n\t@:op(A < B) private static inline function ltFloat(a:UInt, b:Float):Bool {\n\t\treturn a.toFloat() < b;\n\t}\n\n\t@:op(A <= B) private static inline function lteFloat(a:UInt, b:Float):Bool {\n\t\treturn a.toFloat() <= b;\n\t}\n\n\t@:op(A < B) private static inline function floatLt(a:Float, b:UInt):Bool {\n\t\treturn a < b.toFloat();\n\t}\n\n\t@:op(A <= B) private static inline function floatLte(a:Float, b:UInt):Bool {\n\t\treturn a <= b.toFloat();\n\t}\n\n\t@:op(A % B) private static inline function modFloat(a:UInt, b:Float):Float {\n\t\treturn a.toFloat() % b;\n\t}\n\n\t@:op(A % B) private static inline function floatMod(a:Float, b:UInt):Float {\n\t\treturn a % b.toFloat();\n\t}\n\n\t@:op(~A) private inline function negBits():UInt {\n\t\treturn ~this;\n\t}\n\n\t@:op(++A) private inline function prefixIncrement():UInt {\n\t\treturn ++this;\n\t}\n\n\t@:op(A++) private inline function postfixIncrement():UInt {\n\t\treturn this++;\n\t}\n\n\t@:op(--A) private inline function prefixDecrement():UInt {\n\t\treturn --this;\n\t}\n\n\t@:op(A--) private inline function postfixDecrement():UInt {\n\t\treturn this--;\n\t}\n\n\t// TODO: radix is just defined to deal with doc_gen issues\n\tprivate inline function toString(?radix:Int):String {\n\t\treturn Std.string(toFloat());\n\t}\n\n\tprivate inline function toInt():Int {\n\t\treturn this;\n\t}\n\n\t@:to private #if (!js || analyzer) inline #end function toFloat():Float {\n\t\tvar int = toInt();\n\t\tif (int < 0) {\n\t\t\treturn 4294967296.0 + int;\n\t\t}\n\t\telse {\n\t\t\t// + 0.0 here to make sure we promote to Float on some platforms\n\t\t\t// In particular, PHP was having issues when comparing to Int in the == op.\n\t\t\treturn int + 0.0;\n\t\t}\n\t}\n}\n#end\n","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n/**\n\tXml node types.\n\n\t@see http://haxe.org/manual/std-Xml.html\n**/\n@:enum abstract XmlType(Int) {\n\t/**\n\t\tRepresents an XML element type.\n\t**/\n\tvar Element = 0;\n\t/**\n\t\tRepresents XML parsed character data type.\n\t**/\n\tvar PCData = 1;\n\t/**\n\t\tRepresents XML character data type.\n\t**/\n\tvar CData = 2;\n\t/**\n\t\tRepresents an XML comment type.\n\t**/\n\tvar Comment = 3;\n\t/**\n\t\tRepresents an XML doctype element type.\n\t**/\n\tvar DocType = 4;\n\t/**\n\t \tRepresents an XML processing instruction type.\n\t**/\n\tvar ProcessingInstruction = 5;\n\t/**\n\t\tRepresents an XML document type.\n\t**/\n\tvar Document = 6;\n}\n\n/**\n\tCrossplatform Xml API.\n\n\t@see http://haxe.org/manual/std-Xml.html\n**/\nclass Xml {\n\t/**\n\t\tXML element type.\n\t**/\n\tstatic public var Element(default,never) = XmlType.Element;\n\t/**\n\t\tXML parsed character data type.\n\t**/\n\tstatic public var PCData(default,never) = XmlType.PCData;\n\t/**\n\t\tXML character data type.\n\t**/\n\tstatic public var CData(default,never) = XmlType.CData;\n\t/**\n\t\tXML comment type.\n\t**/\n\tstatic public var Comment(default,never) = XmlType.Comment;\n\t/**\n\t\tXML doctype element type.\n\t**/\n\tstatic public var DocType(default,never) = XmlType.DocType;\n\t/**\n\t \tXML processing instruction type.\n\t**/\n\tstatic public var ProcessingInstruction(default,never) = XmlType.ProcessingInstruction;\n\t/**\n\t\tXML document type.\n\t**/\n\tstatic public var Document(default,never) = XmlType.Document;\n\n\t/**\n\t\tParses the String into an Xml document.\n\t**/\n\tstatic public function parse( str : String ) : Xml {\n\t\treturn haxe.xml.Parser.parse(str);\n\t}\n\n\t/**\n\t\tReturns the type of the Xml Node. This should be used before\n\t\taccessing other functions since some might raise an exception\n\t\tif the node type is not correct.\n\t**/\n\tpublic var nodeType(default, null) : XmlType;\n\n\t/**\n\t\tReturns the node name of an Element.\n\t**/\n\t@:isVar public var nodeName(get, set) : String;\n\n\t/**\n\t\tReturns the node value. Only works if the Xml node is not an Element or a Document.\n\t**/\n\t@:isVar public var nodeValue(get, set) : String;\n\n\t/**\n\t\tReturns the parent object in the Xml hierarchy.\n\t\tThe parent can be `null`, an Element or a Document.\n\t**/\n\tpublic var parent(default, null) : Xml;\n\n\tvar children:Array<Xml>;\n\tvar attributeMap:Map<String, String>;\n\n\t#if !cppia inline #end function get_nodeName() {\n\t\tif (nodeType != Element) {\n\t\t\tthrow 'Bad node type, expected Element but found $nodeType';\n\t\t}\n\t\treturn nodeName;\n\t}\n\n\t#if !cppia inline #end function set_nodeName(v) {\n\t\tif (nodeType != Element) {\n\t\t\tthrow 'Bad node type, expected Element but found $nodeType';\n\t\t}\n\t\treturn this.nodeName = v;\n\t}\n\n\t#if !cppia inline #end function get_nodeValue() {\n\t\tif (nodeType == Document || nodeType == Element) {\n\t\t\tthrow 'Bad node type, unexpected $nodeType';\n\t\t}\n\t\treturn nodeValue;\n\t}\n\n\t#if !cppia inline #end function set_nodeValue(v) {\n\t\tif (nodeType == Document || nodeType == Element) {\n\t\t\tthrow 'Bad node type, unexpected $nodeType';\n\t\t}\n\t\treturn this.nodeValue = v;\n\t}\n\n\t/**\n\t\tCreates a node of the given type.\n\t**/\n\tstatic public function createElement( name : String ) : Xml {\n\t\tvar xml = new Xml(Element);\n\t\txml.nodeName = name;\n\t\treturn xml;\n\t}\n\n\t/**\n\t\tCreates a node of the given type.\n\t**/\n\tstatic public function createPCData( data : String ) : Xml {\n\t\tvar xml = new Xml(PCData);\n\t\txml.nodeValue = data;\n\t\treturn xml;\n\t}\n\n\t/**\n\t\tCreates a node of the given type.\n\t**/\n\tstatic public function createCData( data : String ) : Xml {\n\t\tvar xml = new Xml(CData);\n\t\txml.nodeValue = data;\n\t\treturn xml;\n\t}\n\n\t/**\n\t\tCreates a node of the given type.\n\t**/\n\tstatic public function createComment( data : String ) : Xml {\n\t\tvar xml = new Xml(Comment);\n\t\txml.nodeValue = data;\n\t\treturn xml;\n\t}\n\n\t/**\n\t\tCreates a node of the given type.\n\t**/\n\tstatic public function createDocType( data : String ) : Xml {\n\t\tvar xml = new Xml(DocType);\n\t\txml.nodeValue = data;\n\t\treturn xml;\n\t}\n\n\t/**\n\t\tCreates a node of the given type.\n\t**/\n\tstatic public function createProcessingInstruction( data : String ) : Xml {\n\t\tvar xml = new Xml(ProcessingInstruction);\n\t\txml.nodeValue = data;\n\t\treturn xml;\n\t}\n\n\t/**\n\t\tCreates a node of the given type.\n\t**/\n\tstatic public function createDocument() : Xml {\n\t\treturn new Xml(Document);\n\t}\n\n\t/**\n\t\tGet the given attribute of an Element node. Returns `null` if not found.\n\t\tAttributes are case-sensitive.\n\t**/\n\tpublic function get( att : String ) : String {\n\t\tif (nodeType != Element) {\n\t\t\tthrow 'Bad node type, expected Element but found $nodeType';\n\t\t}\n\t\treturn attributeMap[att];\n\t}\n\n\t/**\n\t\tSet the given attribute value for an Element node.\n\t\tAttributes are case-sensitive.\n\t**/\n\tpublic function set( att : String, value : String ) : Void {\n\t\tif (nodeType != Element) {\n\t\t\tthrow 'Bad node type, expected Element but found $nodeType';\n\t\t}\n\t\tattributeMap.set(att, value);\n\t}\n\n\t/**\n\t\tRemoves an attribute for an Element node.\n\t\tAttributes are case-sensitive.\n\t**/\n\tpublic function remove( att : String ) : Void {\n\t\tif (nodeType != Element) {\n\t\t\tthrow 'Bad node type, expected Element but found $nodeType';\n\t\t}\n\t\tattributeMap.remove(att);\n\t}\n\n\t/**\n\t\tTells if the Element node has a given attribute.\n\t\tAttributes are case-sensitive.\n\t**/\n\tpublic function exists( att : String ) : Bool {\n\t\tif (nodeType != Element) {\n\t\t\tthrow 'Bad node type, expected Element but found $nodeType';\n\t\t}\n\t\treturn attributeMap.exists(att);\n\t}\n\n\t/**\n\t\tReturns an `Iterator` on all the attribute names.\n\t**/\n\tpublic function attributes() : Iterator<String> {\n\t\tif (nodeType != Element) {\n\t\t\tthrow 'Bad node type, expected Element but found $nodeType';\n\t\t}\n\t\treturn attributeMap.keys();\n\t}\n\n\t/**\n\t\tReturns an iterator of all child nodes.\n\t\tOnly works if the current node is an Element or a Document.\n\t**/\n\tpublic #if !cppia inline #end function iterator() : Iterator<Xml> {\n\t\tensureElementType();\n\t\treturn children.iterator();\n\t}\n\n\t/**\n\t\tReturns an iterator of all child nodes which are Elements.\n\t\tOnly works if the current node is an Element or a Document.\n\t**/\n\tpublic function elements() : Iterator<Xml> {\n\t\tensureElementType();\n\t\tvar ret = [for (child in children) if (child.nodeType == Element) child];\n\t\treturn ret.iterator();\n\t}\n\n\t/**\n\t\tReturns an iterator of all child nodes which are Elements with the given nodeName.\n\t\tOnly works if the current node is an Element or a Document.\n\t**/\n\tpublic function elementsNamed( name : String ) : Iterator<Xml> {\n\t\tensureElementType();\n\t\tvar ret = [for (child in children) if (child.nodeType == Element && child.nodeName == name) child];\n\t\treturn ret.iterator();\n\t}\n\n\t/**\n\t\tReturns the first child node.\n\t**/\n\tpublic #if !cppia inline #end function firstChild() : Xml {\n\t\tensureElementType();\n\t\treturn children[0];\n\t}\n\n\t/**\n\t\tReturns the first child node which is an Element.\n\t**/\n\tpublic function firstElement() : Xml {\n\t\tensureElementType();\n\t\tfor (child in children) {\n\t\t\tif (child.nodeType == Element) {\n\t\t\t\treturn child;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t\tAdds a child node to the Document or Element.\n\t\tA child node can only be inside one given parent node, which is indicated by the `parent` property.\n\t\tIf the child is already inside this Document or Element, it will be moved to the last position among the Document or Element's children.\n\t\tIf the child node was previously inside a different node, it will be moved to this Document or Element.\n\t**/\n\tpublic function addChild( x : Xml ) : Void {\n\t\tensureElementType();\n\t\tif (x.parent != null) {\n\t\t\tx.parent.removeChild(x);\n\t\t}\n\t\tchildren.push(x);\n\t\tx.parent = this;\n\t}\n\n\t/**\n\t\tRemoves a child from the Document or Element.\n\t\tReturns true if the child was successfuly removed.\n\t**/\n\tpublic function removeChild( x : Xml ) : Bool {\n\t\tensureElementType();\n\t\tif (children.remove(x)) {\n\t\t\tx.parent = null;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t\tInserts a child at the given position among the other childs.\n\t\tA child node can only be inside one given parent node, which is indicated by the [parent] property.\n\t\tIf the child is already inside this Document or Element, it will be moved to the new position among the Document or Element's children.\n\t\tIf the child node was previously inside a different node, it will be moved to this Document or Element.\n\t**/\n\tpublic function insertChild( x : Xml, pos : Int ) : Void {\n\t\tensureElementType();\n\t\tif (x.parent != null) {\n\t\t\tx.parent.children.remove(x);\n\t\t}\n\t\tchildren.insert(pos, x);\n\t\tx.parent = this;\n\t}\n\n\t/**\n\t\tReturns a String representation of the Xml node.\n\t**/\n\tpublic #if !cppia inline #end function toString() : String {\n\t\treturn haxe.xml.Printer.print(this);\n\t}\n\n\tfunction new(nodeType:XmlType) {\n\t\tthis.nodeType = nodeType;\n\t\tchildren = [];\n\t\tattributeMap = new Map();\n\t}\n\n\tinline function ensureElementType() {\n\t\tif (nodeType != Document && nodeType != Element) {\n\t\t\tthrow 'Bad node type, expected Element or Document but found $nodeType';\n\t\t}\n\t}\n}\n","package com.isartdigital.perle;\n\nimport com.isartdigital.perle.game.GameManager;\nimport com.isartdigital.perle.game.sprites.Building;\nimport com.isartdigital.perle.game.sprites.Ground;\nimport com.isartdigital.perle.ui.GraphicLoader;\nimport com.isartdigital.perle.ui.UIManager;\nimport com.isartdigital.utils.Config;\nimport com.isartdigital.utils.Debug;\nimport com.isartdigital.utils.events.EventType;\nimport com.isartdigital.utils.events.LoadEventType;\nimport com.isartdigital.utils.game.factory.MovieClipAnimFactory;\nimport com.isartdigital.utils.game.GameStage;\nimport com.isartdigital.utils.game.GameStageScale;\nimport com.isartdigital.utils.game.StateGraphic;\nimport com.isartdigital.utils.loader.GameLoader;\nimport com.isartdigital.utils.system.DeviceCapabilities;\nimport eventemitter3.EventEmitter;\nimport haxe.Timer;\nimport js.Browser;\nimport pixi.core.display.Container;\nimport pixi.core.renderers.Detector;\nimport pixi.core.renderers.webgl.WebGLRenderer;\nimport pixi.interaction.EventTarget;\nimport pixi.loaders.Loader;\n\n/**\n * Classe d'initialisation et lancement du jeu\n * @author Ambroise RABIER\n */\n\nclass Main extends EventEmitter\n{\n\tprivate static inline var FPS:UInt = 16; // Math.floor(1000/60)\n\t\n\tprivate static var configPath:String = \"config.json\";\t\n\tprivate static var instance: Main;\n\t\n\tpublic var renderer:WebGLRenderer;\n\tpublic var stage:Container;\n\t\n\tprivate var frames (default, null):Int = 0;\n\tprivate var pathClass(default, null):Map<String, String> = new Map<String, String>();\n\t\n\tprivate static function main ():Void {\n\t\tMain.getInstance();\n\t}\n\n\t/**\n\t * Retourne l'instance unique de la classe, et la cre si elle n'existait pas au pralable\n\t * @return instance unique\n\t */\n\tpublic static function getInstance (): Main {\n\t\tif (instance == null) instance = new Main();\n\t\treturn instance;\n\t}\n\t\n\t/**\n\t * cration du jeu et lancement du chargement du fichier de configuration\n\t */\n\tprivate function new () {\n\t\t\n\t\tsuper();\n\t\t\n\t\tforceImport();\n\t\t\n\t\tvar lOptions:RenderingOptions = {};\n\t\tlOptions.antialias = true;\n\t\t//lOptions.autoResize = true;\n\t\tlOptions.backgroundColor = 0x999999;\n\t\t//lOptions.resolution = 1;\n\t\t//lOptions.transparent = false;\n\t\t//lOptions.preserveDrawingBuffer (pour dataToURL)\n\t\t\n\t\tDeviceCapabilities.scaleViewport();\n\t\t\n\t\trenderer = Detector.autoDetectRenderer(DeviceCapabilities.width, DeviceCapabilities.height,lOptions);\n\t\t\n\t\t//renderer.roundPixels = true;\n\t\t\n\t\tBrowser.document.body.appendChild(renderer.view);\n\n\t\tstage = new Container();\n\t\t\n\t\tvar lConfig:Loader = new Loader();\n\t\tconfigPath += \"?\" + Date.now().getTime();\n\t\tlConfig.add(configPath);\n\t\tlConfig.once(LoadEventType.COMPLETE, preloadAssets);\n\t\t\n\t\tlConfig.load();\n\n\t}\n\t\n\t/**\n\t * charge les assets graphiques du preloader principal\n\t */\n\tprivate function preloadAssets(pLoader:Loader):Void {\n\t\t\n\t\t// initialise les paramtres de configuration\n\t\tConfig.init(Reflect.field(pLoader.resources,configPath).data);\n\t\t\n\t\t// Active le mode debug\n\t\tif (Config.debug) Debug.getInstance().init();\n\t\t// dfini l'alpha des Boxes de collision\n\t\tif (Config.debug && Config.data.boxAlpha != null) StateGraphic.boxAlpha = Config.data.boxAlpha;\n\t\t// dfini l'alpha des anims\n\t\tif (Config.debug && Config.data.animAlpha != null) StateGraphic.animAlpha = Config.data.animAlpha;\n\t\t\n\t\t// dfini le mode de redimensionnement du Jeu\n\t\tGameStage.getInstance().scaleMode = GameStageScale.SHOW_ALL; // todo : bug si je prends ple code de mathieu ci-dessous !\n\t\t/*if (DeviceCapabilities.system == DeviceCapabilities.SYSTEM_DESKTOP) {\n\t\t\tGameStage.getInstance().scaleMode = GameStageScale.NO_SCALE;\n\t\t\tuntyped DeviceCapabilities.textureRatio = 0.5;\n\t\t\tuntyped DeviceCapabilities.textureType = DeviceCapabilities.TEXTURE_LD;\n\t\t} else {\n\t\t\tGameStage.getInstance().scaleMode = GameStageScale.SHOW_ALL;\n\t\t\tDeviceCapabilities.init(1, 0.75, 0.5);\n\t\t}*/\n\t\t\n\t\t// initialise le GameStage et dfini la taille de la safeZone\n\t\tGameStage.getInstance().init(render,2048, 1366, true); // false => viter le 0,0 au centre.\n\t\t\n\t\t// affiche le bouton FullScreen quand c'est ncessaire\n\t\tDeviceCapabilities.displayFullScreenButton();\n\t\t\n\t\t// Ajoute le GameStage au stage\n\t\tstage.addChild(GameStage.getInstance());\n\t\t\n\t\t// ajoute Main en tant qu'couteur des venements de redimensionnement\n\t\tBrowser.window.addEventListener(EventType.RESIZE, resize);\n\t\tresize();\n\t\t\n\t\t// lance le chargement des assets graphiques du preloader\n\t\t/*var lLoader:GameLoader = new GameLoader(); // #reopen\n\t\tlLoader.once(LoadEventType.COMPLETE, loadAssets);\n\t\tlLoader.load();*/\n\t\tloadAssets(); // raccourci\n\t}\t\n\t\n\t/**\n\t * lance le chargement principal\n\t */\n\tprivate function loadAssets (/*pLoader:GameLoader*/): Void {\n\t\tvar lLoader:GameLoader = new GameLoader();\n\t\t\t\t\n\t\tlLoader.addTxtFile(\"boxes.json\");\n\t\tlLoader.addSoundFile(\"sounds.json\");\n\t\t\n\t\tlLoader.addAssetFile(\"assets.json\");\n\t\t//lLoader.addAssetFile(DeviceCapabilities.textureType+\"/placeholder/library.json\");\n\t\t\n\t\tlLoader.addFontFile(\"fonts.css\");\n\t\t\n\t\tlLoader.on(LoadEventType.PROGRESS, onLoadProgress);\n\t\tlLoader.once(LoadEventType.COMPLETE, onLoadComplete);\n\n\t\t// affiche l'cran de prchargement\n\t\t//UIManager.getInstance().openScreen(GraphicLoader.getInstance()); // #reopen\n\t\t\n\t\t//Browser.window.requestAnimationFrame(gameLoop);\n\t\tTimer.delay(gameLoop, FPS);\n\t\t\n\t\tlLoader.load();\n\t\t\n\t}\n\t\n\t/**\n\t * transmet les paramtres de chargement au prchargeur graphique\n\t * @param\tpEvent evenement de chargement\n\t */\n\tprivate function onLoadProgress (pLoader:GameLoader): Void {\n\t\t//GraphicLoader.getInstance().update(pLoader.progress/100); // #reopen\n\t}\n\t\n\t/**\n\t * initialisation du jeu\n\t * @param\tpEvent evenement de chargement\n\t */\n\tprivate function onLoadComplete (pLoader:GameLoader): Void {\n\t\tpLoader.off(LoadEventType.PROGRESS, onLoadProgress);\n\t\t// transmet  MovieClipAnimFactory la description des planches de Sprites utilises par les anim MovieClip des instances de StateGraphic\n\t\tMovieClipAnimFactory.addTextures(GameLoader.getContent(\"assets.json\")); // todo : passer en flump\n\t\t// transmet au StateGraphic la description des boxes de collision utilises par les instances de StateGraphic\n\t\t//StateGraphic.addBoxes(GameLoader.getContent(\"boxes.json\"));\n\t\t\n\t\t\n\t\t// Ouvre la TitleClard\n\t\t//UIManager.getInstance().openScreen(TitleCard.getInstance()); // #reopen\n\t\t\n\t\tGameManager.getInstance().start();\n\t}\n\t\n\t/**\n\t * game loop\n\t */\n\tprivate function gameLoop(/*pID:Float*/):Void {\n\t\t//Browser.window.requestAnimationFrame(gameLoop);\n\t\tTimer.delay(gameLoop, FPS);\n\t\t\n\t\trender();\t\t\n\t\temit(EventType.GAME_LOOP);\n\t\t\n\t}\n\t\n\t/**\n\t * Ecouteur du redimensionnement\n\t * @param\tpEvent evenement de redimensionnement\n\t */\n\tpublic function resize (pEvent:EventTarget = null): Void {\n\t\trenderer.resize(DeviceCapabilities.width, DeviceCapabilities.height);\n\t\tGameStage.getInstance().resize();\n\t}\n\t\n\t/**\n\t * Return the full path for a given ClassName (\"com.isart.bla.bla.Ground\" for \"Ground\")\n\t */\n\tpublic function getPath(pClassName:String):String {\n\t\tif (pathClass[pClassName] != null)\n\t\t\treturn pathClass[pClassName];\n\t\telse\n\t\t\tthrow \"NoPath Found for Class: \" + pClassName;\n\t}\n\t\n\t/**\n\t * ForceImport of Class, and make them usable for getPath method,\n\t * doesn't support two time the same ClassName whit different path !\n\t * (like flump.Point and pixi.Point)\n\t */\n\tprivate function forceImport() {\n\t\tvar arrayClass:Array<Class<Dynamic>> = [\n\t\t\tGround,\n\t\t\tBuilding\n\t\t];\n\t\tvar lClassName:String;\n\t\tvar lClassNameNoPath:String;\n\t\t\n\t\tfor (pClass in arrayClass) {\n\t\t\tlClassName = Type.getClassName(pClass);\n\t\t\tlClassNameNoPath = lClassName.substring(lClassName.lastIndexOf(\".\") + 1);\n\t\t\tif (pathClass[lClassNameNoPath] != null)\n\t\t\t\tthrow (\"Conflict in pathClass whit \" + lClassName);\n\t\t\t\n\t\t\tpathClass[lClassNameNoPath] = lClassName;\n\t\t}\n\t}\n\t\n\t/**\n\t * fait le rendu de l'cran\n\t */\n\tprivate function render (): Void {\n\t\tif (DeviceCapabilities.system == DeviceCapabilities.SYSTEM_DESKTOP)\n\t\t\trenderer.render(stage);\n\t\telse {\n\t\t\tif (frames++ % 2 == 0) renderer.render(stage); // dissocie rendu du calcul.\n\t\t\telse GameStage.getInstance().updateTransform();\n\t\t}\n\t}\n\t\t\n\t/**\n\t * dtruit l'instance unique et met sa rfrence interne  null\n\t */\n\tpublic function destroy (): Void {\n\t\tBrowser.window.removeEventListener(EventType.RESIZE, resize);\n\t\tinstance = null;\n\t}\n\t\n}","package com.isartdigital.perle.game;\r\nimport com.isartdigital.perle.game.managers.CameraManager;\r\nimport com.isartdigital.perle.game.managers.ClippingManager;\r\nimport com.isartdigital.perle.game.managers.MouseManager;\r\nimport com.isartdigital.perle.game.managers.PoolingManager;\r\nimport com.isartdigital.perle.game.managers.SaveManager;\r\n\r\n\r\nimport com.isartdigital.perle.game.managers.SaveManager.Save;\r\nimport com.isartdigital.perle.game.sprites.Building;\r\nimport com.isartdigital.perle.game.sprites.Tile;\r\nimport com.isartdigital.perle.game.virtual.VCell;\r\nimport com.isartdigital.perle.ui.CheatPanel;\r\nimport com.isartdigital.perle.ui.UIManager;\r\nimport com.isartdigital.utils.events.EventType;\r\nimport com.isartdigital.utils.game.GameStage;\r\nimport pixi.interaction.EventTarget;\r\n\r\n/**\r\n * Manager (Singleton) en charge de grer le droulement d'une partie\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass GameManager {\r\n\tprivate static var instance: GameManager;\r\n\t\r\n\tpublic static function getInstance (): GameManager {\r\n\t\tif (instance == null) instance = new GameManager();\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\tprivate function new() {\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function start (): Void {\r\n\t\tUIManager.getInstance().startGame();\t\r\n\t\tPoolingManager.init();\r\n\t\tCameraManager.setTarget(GameStage.getInstance().getGameContainer());\r\n\t\t//GameStage.getInstance().getGameContainer().addChild(Template.getInstance());\r\n\t\tTile.initClass();\r\n\t\tloadSave();\r\n\t\tCameraManager.centerCamera();\r\n\t\tClippingManager.update();\r\n\t\t\r\n\t\t//Template.getInstance().start();\t\r\n\t\tCheatPanel.getInstance().ingame();\r\n\t\tMain.getInstance().on(EventType.GAME_LOOP, gameLoop);\r\n\t}\r\n\t\r\n\t/**\r\n\t * boucle de jeu (rpte  la cadence du jeu en fps)\r\n\t */\r\n\tpublic function gameLoop (pEvent:EventTarget): Void {\r\n\t\t// le renderer possde une proprit plugins qui contient une proprit interaction de type InteractionManager\r\n\t\t// les instances d'InteractionManager fournissent un certain nombre d'informations comme les coordonnes globales de la souris\r\n\t\t// IMPORTANT :  cast(Main.getInstance().renderer.plugins.interaction, InteractionManager).mouse.global) coordonnes de la souris en global\r\n\t\t//if (DeviceCapabilities.system == DeviceCapabilities.SYSTEM_DESKTOP) trace (CollisionManager.hitTestPoint(Template.getInstance().hitBox, cast(Main.getInstance().renderer.plugins.interaction, InteractionManager).mouse.global));\r\n\t\r\n\t\t// todo : doublon mousePos X,y\r\n\t\t\r\n\t\tMouseManager.getInstance().gameLoop();\r\n\t\tBuilding.gameLoop();\r\n\t}\r\n\t\r\n\tprivate function loadSave():Void {\r\n\t\tvar lSave:Save = SaveManager.load();\r\n\t\tif (lSave != null)\r\n\t\t\tVCell.buildFromSave(lSave);\r\n\t\telse {\r\n\t\t\tVCell.buildInitial();\r\n\t\t\tSaveManager.save();\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * dtruit l'instance unique et met sa rfrence interne  null\r\n\t */\r\n\tpublic function destroy (): Void {\r\n\t\tMouseManager.getInstance().destroy();\r\n\t\tMain.getInstance().off(EventType.GAME_LOOP,gameLoop);\r\n\t\tinstance = null;\r\n\t}\r\n\r\n}","package com.isartdigital.perle.game.iso;\r\nimport com.isartdigital.perle.game.sprites.Tile;\r\nimport com.isartdigital.utils.game.BoxType;\r\nimport com.isartdigital.utils.game.CollisionManager;\r\nimport com.isartdigital.utils.game.StateGraphic;\r\nimport js.Lib;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.display.DisplayObject;\r\nimport pixi.core.math.Point;\r\nimport pixi.core.math.shapes.Rectangle;\r\n\r\n/**\r\n * Manager Iso\r\n * @author Mathieu Anthoine\r\n */\r\nclass IsoManager\r\n{\t\r\n\t\r\n\tprivate static var halfWidth:Float;\r\n\tprivate static var halfHeight:Float;\r\n\t\r\n\t/**\r\n\t * Initialisation du Manager Iso\r\n\t * @param\tpTileWidth largeur des tuiles\r\n\t * @param\tpTileHeight hauteur des tuiles\r\n\t */\r\n\tpublic static function init (pTileWidth:UInt, pTileHeight:UInt): Void {\r\n\t\thalfWidth = pTileWidth / 2;\r\n\t\thalfHeight = pTileHeight / 2;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Conversion du modle  la vue Isomtrique\r\n\t * @param\tpPoint colonne et ligne dans le modle\r\n\t * @return point en x, y dans la vue\r\n\t */\r\n\tpublic static function modelToIsoView(pPoint:Point):Point {\r\n\t\treturn new Point (\r\n\t\t\t(pPoint.x - pPoint.y)*halfWidth,\r\n\t\t\t(pPoint.x + pPoint.y)*halfHeight\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Conversion de la vue Isomtrique au modle\r\n\t * @param\tpPoint coordonnes dans la vue\r\n\t * @return colonne et ligne dans le modle (valeurs non arrondies)\r\n\t */\r\n\tpublic static function isoViewToModel(pPoint:Point):Point {\r\n\t\treturn new Point (\r\n\t\t\t(pPoint.y/halfHeight+pPoint.x/halfWidth)/2,\r\n\t\t\t(pPoint.y/halfHeight-pPoint.x/halfWidth)/2\r\n\t\t);\r\n\t}\r\n\t\r\n\t/**\r\n\t * dtermine si l'objet A est devant l'objet B\r\n\t * @param\tpA Objet \"IZsortable\" A\r\n\t * @param\tpB Objet \"IZsortable\" B\r\n\t * @return pA, pB ou null si les objets ne se superposent pas\r\n\t */\r\n\tpublic static function isInFrontOf (pA:DisplayObject, pB:DisplayObject):DisplayObject {\r\n\t\t\r\n\t\tif ((Std.is(pA, StateGraphic) && untyped pA.boxType == BoxType.NONE) || (Std.is(pB, StateGraphic) && untyped pB.boxType == BoxType.NONE)) {\r\n\t\t\tthrow \"IsoManager.isFrontOf :: la proprit boxType des StateGraphic ne doit pas tre dfinie  NONE\";\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t\r\n\t\tif (!CollisionManager.hitTestObject(pA, pB)) return null;\r\n\t\t\r\n\t\tif (!Std.is(pA, IZSortable) || !Std.is(pB, IZSortable)) throw \"Les objets passs en paramtre doivent implmenter IZSortable\";\r\n\t\t\r\n\t\tvar lA:IZSortable = cast (pA, IZSortable);\r\n\t\tvar lB:IZSortable = cast (pB, IZSortable);\r\n\t\t\r\n\t\tif (lA.rowMax < lB.rowMin) return pB; \r\n\t\telse if (lB.rowMax < lA.rowMin) return pA;\r\n\t\t\r\n\t\tif (lA.colMax < lB.colMin) return pB; \r\n\t\telse if (lB.colMax < lA.colMin) return pA;\r\n\t\t\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Z-sorting des objets transmis  la mthode\r\n\t * @param\tpTiles tableau des DisplayObject  trier en Z\r\n\t * @return\ttableau tri en Z\r\n\t */\r\n\tpublic static function sortTiles (pTiles:Array<DisplayObject>):Array<DisplayObject> {\r\n\r\n\t\tvar lNumTiles:Int=pTiles.length;\r\n\t\tvar lTile:IZSortable;\r\n\t\t\r\n\t\tfor (i in 0...lNumTiles) {\r\n\t\t\tlTile = cast(pTiles[i], IZSortable);\r\n\t\t\tlTile.behind = [];\r\n\t\t\tlTile.inFront = [];\r\n\t\t}\r\n\r\n\t\tvar lA:IZSortable;\r\n\t\tvar lB:IZSortable;\r\n\t\tvar lFrontTile:DisplayObject;\r\n\t\t\r\n\t\tfor (i in 0...lNumTiles) {\r\n\t\t\tlA = cast(pTiles[i],IZSortable);\r\n\t\t\tfor (j in (i + 1)...lNumTiles) {\r\n\t\t\t\tlB = cast(pTiles[j], IZSortable);\r\n\t\t\t\tlFrontTile = isInFrontOf(pTiles[i],pTiles[j]);\r\n\t\t\t\tif (lFrontTile!=null) {\r\n\t\t\t\t\tif (lA == cast(lFrontTile,IZSortable)) {\r\n\t\t\t\t\t\tlA.behind.push(lB);\r\n\t\t\t\t\t\tlB.inFront.push(lA);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlB.behind.push(lA);\r\n\t\t\t\t\t\tlA.inFront.push(lB);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar lToDraw:Array<IZSortable> = [];\r\n\r\n\t\tfor (i in 0...lNumTiles) {\r\n\t\t\tlTile = cast(pTiles[i], IZSortable);\r\n\t\t\tif (lTile.behind.length == 0) lToDraw.push(lTile);\r\n\t\t}\r\n\r\n\t\tvar lTilesDrawn:Array<DisplayObject> = [];\r\n\t\tvar lFrontTile:IZSortable;\r\n\t\t\r\n\t\twhile (lToDraw.length > 0) {\r\n\t\t\tlTile = lToDraw.pop();\r\n\t\t\tlTilesDrawn.push(cast(lTile,DisplayObject));\r\n\t\t\t\r\n\t\t\tfor (j in 0...lTile.inFront.length) {\r\n\t\t\t\tlFrontTile = lTile.inFront[j];\r\n\t\t\t\tlFrontTile.behind.remove(lTile);\r\n\t\t\t\tif (lFrontTile.behind.length == 0) lToDraw.push(lFrontTile);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (pTiles.length != lTilesDrawn.length)\r\n\t\t\tthrow(\"Probable error whit colMax/colMin/rowMax/rowMin assignment !\");\r\n\t\t\t\r\n\t\treturn lTilesDrawn;\r\n\t};\r\n\t\r\n\t\r\n}","package com.isartdigital.perle.game.managers;\r\nimport com.isartdigital.perle.game.managers.ClippingManager.EasyRectangle;\r\nimport com.isartdigital.perle.game.sprites.Ground;\r\nimport com.isartdigital.perle.game.sprites.Tile;\r\nimport com.isartdigital.perle.game.iso.IsoManager;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.math.Point;\r\n\r\n/**\r\n * ...\r\n * @author ambroise\r\n */\r\nclass CameraManager \r\n{\r\n\t/**\r\n\t * cheat usefull if you don't want clipping to be updated when Camera move.\r\n\t */\r\n\tprivate static var cheat_no_clipping(default, never):Bool = false;\r\n\t\r\n\t/**\r\n\t * Will be GameStage.getInstance().getGameContainer()\r\n\t */\r\n\tprivate static var target:Container;\r\n\t\r\n\t/**\r\n\t * variable used to know when a clipping update is needed\r\n\t */\r\n\tprivate static var xDistMoved:Float;\r\n\t\r\n\t/**\r\n\t * variable used to know when a clipping update is needed\r\n\t */\r\n\tprivate static var yDistMoved:Float;\r\n\t\r\n\t/**\r\n\t * Center the Camera on the center of the Ground tiles.\r\n\t * (a better method than \r\n\t * GameStage.getInstance().getGameContainer().y -= Ground.container.height / 2)\r\n\t */\r\n\tpublic static function centerCamera():Void {\r\n\t\tvar groundCenter:Point = IsoManager.modelToIsoView(new Point(\r\n\t\t\tGround.COL_X_LENGTH,\r\n\t\t\tGround.ROW_Y_LENGTH\r\n\t\t));\r\n\t\t\r\n\t\ttarget.y -= groundCenter.y /2;\r\n\t\ttarget.x -= groundCenter.x /2;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Add pSpeed to move the Camera,\r\n\t * @param\tpSpeed\r\n\t */\r\n\tpublic static function move(pSpeed:Point):Void {\r\n\t\ttarget.x += pSpeed.x;\r\n\t\ttarget.y += pSpeed.y;\r\n\t\tcheckClippingNeed(pSpeed);\r\n\t}\r\n\t\r\n\t// todo : function moveTo\r\n\t\r\n\t/**\r\n\t * Get the center of the screen (renderer) and return the local point in target (gameContainer).\r\n\t * @return\r\n\t */\r\n\tpublic static function getCameraCenter():Point {\r\n\t\treturn target.toLocal(new Point(\r\n\t\t\tMain.getInstance().renderer.width/2,\r\n\t\t\tMain.getInstance().renderer.height/2\r\n\t\t));\r\n\t}\r\n\t\r\n\t/**\r\n\t * return the local Rectangle of the Camera in target (gameContainer)\r\n\t * I choose an EasyRectangle instead of pixi.Rectangle\r\n\t * @return\r\n\t */\r\n\tpublic static function getCameraRect():EasyRectangle {\r\n\t\treturn {\r\n\t\t\ttopLeft: target.toLocal(new Point(0, 0)),\r\n\t\t\tbottomRight: target.toLocal(new Point(\r\n\t\t\t\tMain.getInstance().renderer.width,\r\n\t\t\t\tMain.getInstance().renderer.height\r\n\t\t\t))\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * Set the target, (gameContainer)\r\n\t * @param\tpContainer\r\n\t */\r\n\tpublic static function setTarget(pContainer:Container):Void {\r\n\t\ttarget = pContainer;\r\n\t\treset();\r\n\t}\r\n\t\r\n\tprivate static function reset():Void {\r\n\t\txDistMoved = 0;\r\n\t\tyDistMoved = 0;\r\n\t}\r\n\t\r\n\tprivate static function checkClippingNeed(pSpeed:Point):Void {\r\n\t\tif (cheat_no_clipping)\r\n\t\t\treturn;\r\n\t\t\r\n\t\tvar doUpdate:Bool = false;\r\n\t\t\r\n\t\txDistMoved += pSpeed.x;\r\n\t\tyDistMoved += pSpeed.y;\r\n\t\tif (Math.abs(xDistMoved) > Tile.TILE_WIDTH) {\r\n\t\t\txDistMoved = 0;\r\n\t\t\tdoUpdate = true;\r\n\t\t}\r\n\t\tif (Math.abs(yDistMoved) > Tile.TILE_HEIGHT) {\r\n\t\t\tyDistMoved = 0;\r\n\t\t\tdoUpdate = true;\r\n\t\t}\r\n\t\t\t\r\n\t\tif (doUpdate)\r\n\t\t\tClippingManager.update();\r\n\t}\r\n\t\r\n\tpublic function new() {\r\n\t\t\r\n\t}\r\n\t\r\n}","package com.isartdigital.perle.game.managers;\r\nimport com.isartdigital.perle.game.sprites.Building;\r\nimport com.isartdigital.perle.game.sprites.Tile;\r\nimport com.isartdigital.perle.game.virtual.VCell;\r\nimport pixi.core.math.Point;\r\n\r\n/**\r\n * An easier pixi.Rectangle\r\n */\r\ntypedef EasyRectangle = {\r\n\tvar topLeft:Point;\r\n\tvar bottomRight:Point;\r\n}\r\n\r\n/**\r\n * Cells inside this Reactangle will be activated or desactivated.\r\n */\r\ntypedef MapClippingRect = {\r\n\tvar left:Int;\r\n\tvar right:Int;\r\n\tvar top:Int;\r\n\tvar bottom:Int;\r\n}\r\n\r\ntypedef CommonSide = {\r\n\tvar left:Bool;\r\n\tvar right:Bool;\r\n\tvar top:Bool;\r\n\tvar bottom:Bool;\r\n}\r\n\r\n/**\r\n * ...\r\n * @author ambroise\r\n */\r\nclass ClippingManager \r\n{\r\n\t/**\r\n\t * usefull to understand how large the clipping is.\r\n\t */\r\n\tprivate static var cheat_do_clipping_start_only(default, never):Bool = false;\r\n\t\r\n\t/**\r\n\t * Should be high enough to not see any clipping on side.\r\n\t */ // todo : optimize for building, whitout building problem use 2 as value\r\n\tprivate static inline var CLIPPING_MARGIN_V:Int = 12;\r\n\t\r\n\t/**\r\n\t * Should be high enough to not see any clipping on side.\r\n\t */ // todo : optimize for building, whitout building problem use 10 as value\r\n\tprivate static inline var CLIPPING_MARGIN_H:Int = 18;\r\n\t\r\n\tprivate static var cameraMapRect:EasyRectangle;\r\n\tprivate static var currentCameraClipRect:MapClippingRect;\r\n\tprivate static var precedentCameraClipRect:MapClippingRect;\r\n\tprivate static var commonCameraClipRect:MapClippingRect;\r\n\t\r\n\tpublic function new() {\r\n\t\t\r\n\t}\r\n\t\r\n\t// avoir colonne entre sortie et agir que sur celle-ci, que qd mvt camera !\r\n\tpublic static function update():Void {\r\n\t\tsetCameraMapClipRect();\r\n\t\t\r\n\t\tcurrentCameraClipRect = {\r\n\t\t\tleft:cast(cameraMapRect.topLeft.x - CLIPPING_MARGIN_H, Int),\r\n\t\t\tright:cast(cameraMapRect.bottomRight.x + CLIPPING_MARGIN_H, Int),\r\n\t\t\ttop:cast(cameraMapRect.topLeft.y - CLIPPING_MARGIN_V, Int),\r\n\t\t\tbottom:cast(cameraMapRect.bottomRight.y + CLIPPING_MARGIN_V, Int)\r\n\t\t};\r\n\t\t\r\n\t\tif (precedentCameraClipRect == null)\r\n\t\t\tactivateCells(currentCameraClipRect);\r\n\t\telse {\r\n\t\t\tcommonCameraClipRect = getCommonArea(\r\n\t\t\t\tcurrentCameraClipRect, \r\n\t\t\t\tprecedentCameraClipRect\r\n\t\t\t);\r\n\t\t\tif (!cheat_do_clipping_start_only) {\r\n\t\t\t\toptimizedClipping(desactivateCells, precedentCameraClipRect, commonCameraClipRect);\r\n\t\t\t\toptimizedClipping(activateCells, currentCameraClipRect, commonCameraClipRect);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tBuilding.sortBuildings();\r\n\t\t\r\n\t\tprecedentCameraClipRect = currentCameraClipRect;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Activate Cells in pClippingRect area\r\n\t * @param\tpClippingRect\r\n\t */\r\n\tprivate static function activateCells(pClippingRect:MapClippingRect):Void {\r\n\t\t//trace(pClippingRect); usefull to see the optimized clipping\r\n\t\tfor (lClassArray in VCell.list) {\r\n\t\t\tfor (x in pClippingRect.left...pClippingRect.right) {\r\n\t\t\t\tfor (y in pClippingRect.top...pClippingRect.bottom) {\r\n\t\t\t\t\tif (lClassArray[x] != null &&\r\n\t\t\t\t\t\tlClassArray[x][y] != null &&\r\n\t\t\t\t\t\t!lClassArray[x][y].active)\r\n\t\t\t\t\t\tlClassArray[x][y].activate();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Desactivate Cells in pClippingRect area\r\n\t * @param\tpClippingRect\r\n\t */\r\n\tprivate static function desactivateCells(pClippingRect:MapClippingRect):Void {\r\n\t\tfor (lClassArray in VCell.list) {\r\n\t\t\tfor (x in pClippingRect.left...pClippingRect.right) {\r\n\t\t\t\tfor (y in pClippingRect.top...pClippingRect.bottom) {\r\n\t\t\t\t\tif (lClassArray[x] != null &&\r\n\t\t\t\t\t\tlClassArray[x][y] != null &&\r\n\t\t\t\t\t\tlClassArray[x][y].active)\r\n\t\t\t\t\t\tlClassArray[x][y].desactivate();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Compare two ClippingRect, and determine the difference between these two.\r\n\t * two rectangle (or only one) merge from this, and we can iterate trhough them to activate or desactivate\r\n\t * (i like to do a drawing)\r\n\t * @param\tpClippingRect\r\n\t * @param\tpClippingRectIgnore\r\n\t */\r\n\tprivate static function optimizedClipping(pFunction:MapClippingRect->Void ,pClipRect:MapClippingRect, pClipRectIgnore:MapClippingRect):Void {\r\n\t\tvar commonSides:CommonSide = getCommonSides(pClipRect, pClipRectIgnore);\r\n\t\t\r\n\t\t// unless zoomIn or zoomOut, only two or one pFunction would be called\r\n\t\tif (commonSides.top && !commonSides.bottom)\r\n\t\t\tpFunction({\r\n\t\t\t\tleft: pClipRect.left,\r\n\t\t\t\tright: pClipRect.right,\r\n\t\t\t\ttop: pClipRectIgnore.bottom,\r\n\t\t\t\tbottom: pClipRect.bottom\r\n\t\t\t});\r\n\t\tif (commonSides.bottom && !commonSides.top)\r\n\t\t\tpFunction({\r\n\t\t\t\tleft: pClipRect.left,\r\n\t\t\t\tright: pClipRect.right,\r\n\t\t\t\ttop: pClipRect.top,\r\n\t\t\t\tbottom: pClipRectIgnore.top\r\n\t\t\t});\r\n\t\tif (commonSides.left && !commonSides.right)\r\n\t\t\tpFunction({\r\n\t\t\t\tleft: pClipRectIgnore.right,\r\n\t\t\t\tright: pClipRect.right,\r\n\t\t\t\ttop: pClipRect.top,\r\n\t\t\t\tbottom: pClipRect.bottom\r\n\t\t\t});\r\n\t\tif (commonSides.right && !commonSides.left)\r\n\t\t\tpFunction({\r\n\t\t\t\tleft: pClipRect.left,\r\n\t\t\t\tright: pClipRectIgnore.left,\r\n\t\t\t\ttop: pClipRect.top,\r\n\t\t\t\tbottom: pClipRect.bottom\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * pClipRectIgnore is smaller and fully inside pClipRect,\r\n\t * we want to know which side do they have in common\r\n\t * @param\tpClipRect\r\n\t * @param\tpClipRectIgnore\r\n\t * @return\r\n\t */\r\n\tprivate static function getCommonSides(pClipRect:MapClippingRect, pClipRectIgnore:MapClippingRect):CommonSide {\r\n\t\treturn {\r\n\t\t\ttop: pClipRect.top == pClipRectIgnore.top,\r\n\t\t\tbottom: pClipRect.bottom == pClipRectIgnore.bottom,\r\n\t\t\tleft: pClipRect.left == pClipRectIgnore.left,\r\n\t\t\tright: pClipRect.right == pClipRectIgnore.right\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * return a MapClippingRect that is the common between two MapClippingRect,\r\n\t * it is the area that has cells that don't need to be activate or desactivate\r\n\t * @param\tp1ClipRect\r\n\t * @param\tp2ClipRect\r\n\t * @return\r\n\t */\r\n\tprivate static function getCommonArea(p1ClipRect:MapClippingRect, p2ClipRect:MapClippingRect):MapClippingRect {\r\n\t\treturn {\r\n\t\t\tleft:p1ClipRect.left > p2ClipRect.left ? p1ClipRect.left : p2ClipRect.left,\r\n\t\t\tright:p1ClipRect.right < p2ClipRect.right ? p1ClipRect.right : p2ClipRect.right,\r\n\t\t\ttop:p1ClipRect.top > p2ClipRect.top ? p1ClipRect.top : p2ClipRect.top,\r\n\t\t\tbottom:p1ClipRect.bottom < p2ClipRect.bottom ? p1ClipRect.bottom : p2ClipRect.bottom\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * Return the position of a Tile in the ClippingMapArray\r\n\t * Used by VCell at new\r\n\t * Actually anything between cells is not supported !!!\r\n\t * @param\tpPoint\r\n\t * @return\r\n\t */\r\n\tpublic static function posToClippingMap(pPoint:Point):Point {\r\n\t\tif (Math.round(pPoint.x) != pPoint.x ||\r\n\t\t\tMath.round(pPoint.y) != pPoint.y)\r\n\t\t\tthrow (\"Position x,y est un chiffre  virgule, n'est pas une Tile ? pas support pr l'instant !\");\r\n\t\t\r\n\t\treturn new Point (\r\n\t\t\tcast(pPoint.x / (Tile.TILE_HEIGHT/4), Int),\r\n\t\t\tcast(pPoint.y / (Tile.TILE_WIDTH/4), Int)\r\n\t\t);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Set the current Camera Clipping Rectangle\r\n\t */\r\n\tprivate static function setCameraMapClipRect():Void {\r\n\t\tvar lCameraRect:EasyRectangle = CameraManager.getCameraRect();\r\n\t\t\r\n\t\tlCameraRect.topLeft.x = customFloor(lCameraRect.topLeft.x, Tile.TILE_WIDTH);\r\n\t\tlCameraRect.topLeft.y = customFloor(lCameraRect.topLeft.y, Tile.TILE_HEIGHT);\r\n\t\tlCameraRect.bottomRight.x = customCeil(lCameraRect.bottomRight.x, Tile.TILE_WIDTH);\r\n\t\tlCameraRect.bottomRight.y = customCeil(lCameraRect.bottomRight.y, Tile.TILE_HEIGHT);\r\n\t\t\r\n\t\tcameraMapRect = {\r\n\t\t\ttopLeft: posToClippingMap(lCameraRect.topLeft),\r\n\t\t\tbottomRight: posToClippingMap(lCameraRect.bottomRight)\r\n\t\t};\r\n\t}\r\n\t\r\n\tprivate static function customFloor(pNumber:Float, pFloorFactor:Int = 1):Int {\r\n\t\treturn pFloorFactor * Math.floor(pNumber / pFloorFactor);\r\n\t}\r\n\t\r\n\tprivate static function customCeil(pNumber:Float, pCeilFactor:Int = 1):Int {\r\n\t\treturn pCeilFactor * Math.ceil(pNumber / pCeilFactor);\r\n\t}\r\n}","package com.isartdigital.perle.game.managers;\r\nimport com.isartdigital.perle.game.managers.CameraManager;\r\nimport com.isartdigital.perle.game.sprites.Building;\r\nimport com.isartdigital.perle.game.sprites.Ground;\r\nimport com.isartdigital.utils.events.MouseEventType;\r\nimport com.isartdigital.utils.events.TouchEventType;\r\nimport com.isartdigital.utils.game.GameStage;\r\nimport com.isartdigital.perle.game.iso.IsoManager;\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\nimport js.Browser;\r\nimport js.html.TouchEvent;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.math.Point;\r\nimport pixi.interaction.InteractionManager;\r\n\r\n\t\r\n/**\r\n * Class used to get mouse or touch global position\r\n * and to move the camera.\r\n * @author ambroise\r\n */\r\nclass MouseManager {\r\n\tprivate static var instance: MouseManager;\r\n\t\r\n\t// todo, move new Point into init, because if MouseManager get destroyed...\r\n\t\r\n\t/**\r\n\t * Return the global mouse position when gameLoop is running.\r\n\t */\r\n\tpublic var position(default, null):Point = new Point(0, 0);\r\n\t\r\n\t/**\r\n\t * Return the local mouse position of the gameContainer when gameLoop is running.\r\n\t */\r\n\tpublic var positionInGame(default, null):Point = new Point(0, 0);\r\n\t\r\n\t/**\r\n\t * True if (DeviceCapabilities.system == DeviceCapabilities.SYSTEM_DESKTOP)\r\n\t */\r\n\tpublic var desktop(default, null):Bool = false;\r\n\tpublic var touchGlobalPos(default, null):Point = new Point(0, 0);\r\n\t\r\n\tprivate var mouseTouchDown:Bool = false;\r\n\tprivate var precedentMousePos:Point = new Point();\r\n\tprivate var precedentFrame:Bool = false;\r\n\t\r\n\t/**\r\n\t * Needed for Touch, or you will be teleported one the same point\r\n\t * on screen when you start touch.\r\n\t */\r\n\tprivate var oneFrameHack:Bool = false;\r\n\t\r\n\tpublic static function getInstance (): MouseManager {\r\n\t\tif (instance == null) instance = new MouseManager();\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tprivate function new() {\r\n\t\tinit(); // todo, get out of new\r\n\t}\r\n\t\r\n\tpublic function getLocalMouseMapPos():Point {\r\n\t\treturn IsoManager.isoViewToModel(\r\n\t\t\tgetLocalPos(Ground.container)\r\n\t\t);\r\n\t}\r\n\t\r\n\t/**\r\n\t * todo : remove ?\r\n\t * @param\tpContainer:whit a toLocal() method\r\n\t * @return local mouse position\r\n\t */\r\n\tprivate function getLocalPos(pContainer:Container):Point {\r\n\t\treturn pContainer.toLocal(position);\r\n\t}\r\n\t\r\n\tprivate function init():Void {\r\n\t\tdesktop = DeviceCapabilities.system == DeviceCapabilities.SYSTEM_DESKTOP;\r\n\t\t\r\n\t\tif (desktop) {\r\n\t\t\tBrowser.window.addEventListener(MouseEventType.MOUSE_UP, onMouseTouchUp);\r\n\t\t\tBrowser.window.addEventListener(MouseEventType.MOUSE_DOWN, onMouseDown);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tBrowser.window.addEventListener(TouchEventType.TOUCH_END, onMouseTouchUp);\r\n\t\t\tBrowser.window.addEventListener(TouchEventType.TOUCH_START, onTouchDown);\r\n\t\t\tBrowser.window.addEventListener(TouchEventType.TOUCH_MOVE, onTouchMove);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function gameLoop():Void {\r\n\t\tif (desktop)\r\n\t\t\tposition = getMouseGlobalPos();\r\n\t\telse\r\n\t\t\tposition = touchGlobalPos;\r\n\t\t\r\n\t\tpositionInGame = getLocalPos(GameStage.getInstance().getGameContainer());\r\n\r\n\t\tif (mouseTouchDown && !Building.hasCurrentBuilding())\r\n\t\t\tmoveGameContainer(positionInGame);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Permit to move the Map whit the Mouse or Touch, won't move is someone is building.\r\n\t * @param\tpMouseLocalPos\r\n\t */\r\n\tprivate function moveGameContainer(pMouseLocalPos:Point):Void {\r\n\t\tif (oneFrameHack)\r\n\t\t\toneFrameHack = false;\r\n\t\telse {\r\n\t\t\tvar lSoustract:Point = soustractPoint(pMouseLocalPos, precedentMousePos);\r\n\t\t\tif (lSoustract.x != 0 || lSoustract.y != 0)\r\n\t\t\t\tCameraManager.move(lSoustract);\r\n\t\t}\r\n\t\t\r\n\t\tprecedentMousePos.copy(getLocalPos(GameStage.getInstance().getGameContainer()));\r\n\t}\r\n\t\r\n\t// todo : n'agit pas si sur HUD\r\n\t/*if (!Std.is(pEvent.target, Hud))\r\n\treturn; ?*/\r\n\tprivate function onMouseDown():Void {\r\n\t\tmouseTouchDown = true;\r\n\t\tprecedentMousePos.copy(positionInGame);\r\n\t}\r\n\t\r\n\tprivate function onTouchDown(pEvent:TouchEvent):Void {\r\n\t\t// don't rely only en TouchEvent.MOVE to get globalPos !\r\n\t\ttouchGlobalPos.set(pEvent.touches[0].pageX, pEvent.touches[0].pageY);\r\n\t\tmouseTouchDown = true;\r\n\t\tprecedentMousePos.copy(positionInGame);\r\n\t\toneFrameHack = true;\r\n\t}\r\n\t\r\n\tprivate function onMouseTouchUp (): Void {\r\n\t\tmouseTouchDown = false;\r\n\t}\r\n\t\r\n\t// could be a instance method and used like \"myPoint.soustract(anotherPoint);\"\r\n\t// that would avoid making a new Point !\t\r\n\tprivate function soustractPoint(pPoint1:Point, pPoint2:Point):Point {\r\n\t\treturn new Point(pPoint1.x - pPoint2.x, pPoint1.y - pPoint2.y);\r\n\t}\r\n\t\r\n\tprivate function getMouseGlobalPos():Point {\r\n\t\treturn cast(Main.getInstance().renderer.plugins.interaction, InteractionManager).mouse.global;\r\n\t}\r\n\t\r\n\tprivate function onTouchMove(pEvent:TouchEvent):Void {\r\n\t\ttouchGlobalPos.set(pEvent.touches[0].pageX, pEvent.touches[0].pageY);\r\n\t}\r\n\t\r\n\t// todo : make it work whit pause !\r\n\t// todo whit positionInGame too !\r\n\t/*public function get_position():Point {\r\n\t * \tif ((Hud || GameManager).pause)\r\n\t * \t\treturn getMouseGlobalPos();\r\n\t * \telse\r\n\t\t\treturn position;\r\n\t}*/\r\n\t\r\n\tpublic function destroy (): Void {\r\n\t\tBrowser.window.removeEventListener(MouseEventType.MOUSE_UP, onMouseTouchUp);\r\n\t\tBrowser.window.removeEventListener(MouseEventType.MOUSE_DOWN, onMouseDown);\r\n\t\t\r\n\t\tBrowser.window.removeEventListener(TouchEventType.TOUCH_END, onMouseTouchUp);\r\n\t\tBrowser.window.removeEventListener(TouchEventType.TOUCH_START, onTouchDown);\r\n\t\tBrowser.window.removeEventListener(TouchEventType.TOUCH_MOVE, onTouchMove);\r\n\t\t\r\n\t\tinstance = null;\r\n\t}\r\n\r\n}","package com.isartdigital.perle.game.managers;\r\n\r\n/**\r\n * ...\r\n * @author ambroise\r\n */\r\nclass PoolingManager {\r\n\r\n\t/**\r\n\t * The pool will be fileld whit these instance at game start.\r\n\t * Aucune raison de mettre un JSON, seul un codeur va modifi ces valeurs\r\n\t * de toute faon.\r\n\t */\r\n\tprivate static var INSTANCE_TO_SPAWN(default, never):Map<String, UInt> = [\r\n\t\t\"House\" => 2,\r\n\t\t\"Trees\" => 5,\r\n\t\t\"Factory\" => 1,\r\n\t\t\"Villa\" => 2,\r\n\t\t\"Ground\" => 400,\r\n\t\t\"Road_h\" => 1,\r\n\t\t\"Road_c\" => 1,\r\n\t\t\"Road_br\" => 1,\r\n\t\t\"Road_tl\" => 1,\r\n\t\t\"Road_v\" => 1,\r\n\t];\r\n\t// todo : remplir\r\n\tprivate static var ASSETNAME_TO_CLASS(default, never):Map<String, String> = [\r\n\t\t\"House\" => \"Building\",\r\n\t\t\"Trees\" => \"Building\",\r\n\t\t\"Factory\" => \"Building\",\r\n\t\t\"Villa\" => \"Building\",\r\n\t\t\"Ground\" => \"Ground\",\r\n\t\t\"Road_h\" => \"Ground\",\r\n\t\t\"Road_c\" => \"Ground\",\r\n\t\t\"Road_br\" => \"Ground\",\r\n\t\t\"Road_tl\" => \"Ground\",\r\n\t\t\"Road_v\" => \"Ground\"\r\n\t];\r\n\tprivate static var poolList:Map<String, Array<PoolingObject>> = new Map<String, Array<PoolingObject>>();\r\n\r\n\tpublic function new() {\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic static function init():Void {\r\n\t\tfor (lAssetName in INSTANCE_TO_SPAWN.keys()) {\r\n\t\t\tfor (i in 0...INSTANCE_TO_SPAWN[lAssetName]) {\r\n\t\t\t\tcreateToPool(lAssetName);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Return a instance from pool, or create it.\r\n\t * @param\tlAssetName\r\n\t * @return\r\n\t */\r\n\tpublic static function getFromPool(lAssetName:String):Dynamic {\r\n\t\t//trace(\"get \" + lAssetName + \" \" + poolList[lAssetName].length);\r\n\t\tif (poolList[lAssetName] == null) {\r\n\t\t\ttrace(\"missing \" + lAssetName+\" in poolArray\");\r\n\t\t\tpoolList[lAssetName] = new Array<PoolingObject>();\r\n\t\t}\r\n\t\t\r\n\t\treturn poolList[lAssetName].length == 0 ? \r\n\t\t\t   createInstance(lAssetName) :\r\n\t\t\t   poolList[lAssetName].shift() ;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Add to pool an instance that is not needed anymore.\r\n\t * @param\tpInstance\r\n\t * @param\tlAssetName\r\n\t */\r\n\tpublic static function addToPool(pInstance:Dynamic, lAssetName:String):Void {\r\n\t\tif (poolList[lAssetName] == null)\r\n\t\t\tthrow(lAssetName + \" doesn't exist in pool !\");\r\n\t\t\r\n\t\tpoolList[lAssetName].push(pInstance);\r\n\t\t\r\n\t\t//trace(\"add \" + lAssetName + \" \" + poolList[lAssetName].length);\r\n\t}\r\n\t\r\n\t/**\r\n\t * private createToPool at start.\r\n\t * @param\tlAssetName\r\n\t */\r\n\tprivate static function createToPool(lAssetName:String):Void {\r\n\t\tif (poolList[lAssetName] == null)\r\n\t\t\tpoolList[lAssetName] = new Array<PoolingObject>();\r\n\t\t\t\r\n\t\tpoolList[lAssetName].push(createInstance(lAssetName));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Create an instance from choosen ClassName (whitout path)\r\n\t * (look getPath method in Main)\r\n\t * @param\tlAssetName\r\n\t * @return\r\n\t */\r\n\tprivate static function createInstance(lAssetName:String):Dynamic {\r\n\t\tvar lClassName:String = ASSETNAME_TO_CLASS[lAssetName];\r\n\t\tif (lClassName == null)\r\n\t\t\tthrow (\"Class for assetName : -- \"+lClassName+\" -- wasn't found ! Check ASSETNAME_TO_CLASS\");\r\n\t\t\r\n\t\treturn Type.createInstance(Type.resolveClass(\r\n\t\t\tMain.getInstance().getPath(lClassName)\r\n\t\t), [lAssetName]);\r\n\t}\r\n\t\r\n\tpublic static function destroy():Void {\r\n\t\tfor (lAssetName in poolList.keys()) {\r\n\t\t\tfor (i in 0...poolList[lAssetName].length) {\r\n\t\t\t\tpoolList[lAssetName][i].destroy();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpoolList = null;\r\n\t}\r\n\t\r\n\t\r\n\t\r\n}","package com.isartdigital.perle.game.managers;\r\nimport com.isartdigital.perle.game.sprites.Building;\r\nimport com.isartdigital.perle.game.sprites.Ground;\r\nimport com.isartdigital.perle.game.virtual.VCell;\r\nimport haxe.Json;\r\nimport js.Browser;\r\n\r\ntypedef TileDescription = {\r\n\tvar className:String;\r\n\tvar assetName:String;\r\n\tvar mapX:Int;\r\n\tvar mapY:Int;\r\n}\r\n\r\ntypedef Save = {\r\n\tvar COL_X_LENGTH:Int;\r\n\tvar ROW_Y_LENGTH:Int;\r\n\tvar ground:Array<TileDescription>;\r\n\tvar building:Array<TileDescription>;\r\n}\r\n\r\n/**\r\n * ...\r\n * @author ambroise\r\n */\r\nclass SaveManager {\r\n\tprivate static inline var SAVE_NAME:String = \"com_isartdigital_myBuilderName\";\r\n\tpublic static var currentSave(default, null):Save;\r\n\t\r\n\t/**\r\n\t * Save the buildings and grounds in a Json in local storage.\r\n\t * Use virtualCell to make the save.\r\n\t */\r\n\tpublic static function save():Void {\r\n\t\tvar buildingSave:Array<TileDescription> = [];\r\n\t\tvar groundSave:Array<TileDescription> = [];\r\n\t\tvar buildingLength:UInt = Building.list.length;\r\n\t\t\r\n\t\t// DeepCopy for tileDesc ?\r\n\t\tfor (lClassName in VCell.list.keys()) {\r\n\t\t\tfor (x in VCell.list[lClassName].keys()) {\r\n\t\t\t\tfor (y in VCell.list[lClassName][x].keys()) {\r\n\t\t\t\t\tif (lClassName == \"Building\")\r\n\t\t\t\t\t\tbuildingSave.push(VCell.list[lClassName][x][y].tileDesc);\r\n\t\t\t\t\tif (lClassName == \"Ground\")\r\n\t\t\t\t\t\tgroundSave.push(VCell.list[lClassName][x][y].tileDesc);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tcurrentSave = {\r\n\t\t\tground:groundSave,\r\n\t\t\tbuilding:buildingSave,\r\n\t\t\tCOL_X_LENGTH: Ground.COL_X_LENGTH,\r\n\t\t\tROW_Y_LENGTH: Ground.ROW_Y_LENGTH\r\n\t\t};\r\n\t\t\r\n\t\tBrowser.getLocalStorage().setItem(\r\n\t\t\tSAVE_NAME,\r\n\t\t\tJson.stringify(currentSave)\r\n\t\t);\r\n\t}\r\n\t\r\n\t/**\r\n\t * UNUSED !\r\n\t * Remove the Save from localStorage\r\n\t */\r\n\tpublic static function destroy():Void {\r\n\t\tBrowser.getLocalStorage().setItem(\r\n\t\t\tSAVE_NAME,\r\n\t\t\tJson.stringify(null)\r\n\t\t);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Return currentSave, load if null.\r\n\t * @return\r\n\t */\r\n\tpublic static function load():Save {\r\n\t\t//destroy(); // here if save reset needed\r\n\t\tif (currentSave == null) {\r\n\t\t\tcurrentSave = Json.parse(\r\n\t\t\t\tBrowser.getLocalStorage().getItem(SAVE_NAME)\r\n\t\t\t);\r\n\t\t\tif (currentSave != null) {\r\n\t\t\t\tif (currentSave.COL_X_LENGTH != Ground.COL_X_LENGTH ||\r\n\t\t\t\t\tcurrentSave.ROW_Y_LENGTH != Ground.ROW_Y_LENGTH)\r\n\t\t\t\t\tthrow(\"DIFFERENT VALUE Ground.COL_X_LENGTH or Ground.ROW_Y_LENGTH !! (use destroy())\");\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn currentSave;\r\n\t}\r\n}","package com.isartdigital.utils.game;\r\n\r\nimport com.isartdigital.utils.events.EventType;\r\nimport pixi.core.display.Container;\r\n\r\n/**\r\n * Classe de base des objets interactifs dans le jeu\r\n * Met  jour automatiquement ses donnes internes de position et transformation\r\n * \r\n * @author Mathieu ANTHOINE\r\n */\r\nclass GameObject extends Container\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t// Force la mise  jour de la matrices de transformation des lments constituant le GameObject\r\n\t\ton(EventType.ADDED, updateTransform);\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * nettoie et dtruit l'instance\r\n\t */\r\n\toverride public function destroy (): Void {\r\n\t\toff(EventType.ADDED, updateTransform);\r\n\t\tsuper.destroy(true);\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.game;\r\nimport pixi.core.display.Container;\r\n\r\n/**\r\n * Implmentation de base d'une Machine  tat\r\n * expose de faon publique sa mthode doAction qui peut faire rfrence  diffrentes mthodes prvues (doActionVoid, doActionNormal) ou spcifiques dfinies par ses classes filles\r\n * Par convention le changement de rfrence de doAction se fait via des mthodes setMode (setModeVoid, setModeAction) qui peuvent aussi contenir des paramtres d'initialisation\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass StateMachine extends GameObject implements IStateMachine \r\n{\r\n\t\r\n\t/**\r\n\t * mthode appele  chaque gameLoop. Elle peut faire rfrence  diffrentes mthodes au cours du temps\r\n\t */\r\n\tpublic var doAction:Void->Void;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\tsetModeVoid();\t\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * applique le mode \"ne fait rien\"\r\n\t */\r\n\tprivate function setModeVoid (): Void {\r\n\t\tdoAction = doActionVoid;\r\n\t}\r\n\t\r\n\t/**\r\n\t * fonction vide destine  maintenir la rfrence de doAction sans rien faire\r\n\t */\r\n\tprivate function doActionVoid (): Void {}\r\n\r\n\t\r\n\t/**\r\n\t * applique le mode normal (mode par defaut)\r\n\t */\r\n\tprivate function setModeNormal(): Void {\r\n\t\tdoAction = doActionNormal;\r\n\t}\r\n\t\r\n\t/**\r\n\t * fonction destine  appliquer un comportement par defaut\r\n\t */\r\n\tprivate function doActionNormal (): Void {}\r\n\t\r\n\t/**\r\n\t * Activation\r\n\t */\r\n\tpublic function start (): Void {\r\n\t\tsetModeNormal();\r\n\t}\r\n\t\r\n\t/**\r\n\t * nettoie et dtruit l'instance\r\n\t */\r\n\toverride public function destroy (): Void {\r\n\t\tsetModeVoid();\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\t\r\n}","package com.isartdigital.utils.game;\r\n\r\nimport com.isartdigital.utils.game.factory.AnimFactory;\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\nimport haxe.Json;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.graphics.Graphics;\r\nimport pixi.core.math.Point;\r\nimport pixi.core.math.shapes.Circle;\r\nimport pixi.core.math.shapes.Ellipse;\r\nimport pixi.core.math.shapes.Rectangle;\r\n\r\n/**\r\n * Classe de base des objets interactifs ayant plusieurs tats graphiques\r\n * Gre la reprsentation graphique (anim) et les conteneurs utiles au gamePlay (box) qui peuvent tre de simples boites de collision ou beaucoup plus\r\n * suivant l'implmentation faite par le dveloppeur dans les classes filles\r\n * @author Mathieu ANTHOINE\r\n * @version 0.12.0\r\n */\r\nclass StateGraphic extends StateMachine\r\n{\r\n\r\n\t/**\r\n\t * Fabrique d'anim\r\n\t */\r\n\tprivate var factory:AnimFactory;\r\n\t \r\n\t/**\r\n\t * anim de l'tat courant\r\n\t */\r\n\tprivate var anim:Container;\r\n\t\r\n\t/**\r\n\t * box de l'tat courant\r\n\t */\r\n\tprivate var box:Container;\r\n\t\r\n\t/**\r\n\t * suffixe du nom d'export des symboles Anims\r\n\t */\r\n\tprivate var ANIM_SUFFIX (default,null):String = \"\";\r\n\t\r\n\t/**\r\n\t * suffixe du nom d'export des symboles Box\r\n\t */\r\n\tprivate var BOX_SUFFIX (default,null):String = \"box\";\t\r\n\t\r\n\t/**\r\n\t * etat par dfaut\r\n\t */\r\n\tprivate var DEFAULT_STATE (default, null): String = \"\";\r\n\t\r\n\t/**\r\n\t * Nom de l'asset (sert  identifier les textures  utiliser)\r\n\t * Prend le nom de la classe Fille par dfaut\r\n\t */\r\n\tprivate var assetName:String;\r\n\t\r\n\t/**\r\n\t * tat en cours\r\n\t */\r\n\tprivate var state:String;\r\n\t\r\n\t/**\r\n\t * Type de box de collision\r\n\t * Si boxType est gal  BoxType.NONE, aucune collision ne se fait, il n'est pas ncessaire d'avoir une boite de collision dfinie\r\n\t * Si boxType est gal  BoxType.SIMPLE, seul un symbole sert de Box pour tous les tats, son nom d'export etant assetName+\"_\"+BOX_SUFFIX\r\n\t * Si boxType est gal  BoxType.MULTIPLE, chaque state correspond  une boite de collision, chaque state va cherche la boite assetName+\"_\"+ANIM_SUFFIX+\"_\"+BOX_SUFFIX\r\n\t * Si boxType est gal  BoxType.SELF, hitBox retourne le MovieClip anim\r\n\t */\r\n\tprivate var boxType:BoxType=BoxType.NONE;\r\n\t\r\n\t/**\r\n\t * niveau d'alpha des anim\r\n\t */\r\n\tpublic static var animAlpha:Float = 1;\r\n\t\r\n\t/**\r\n\t * niveau d'alpha des Boxes\r\n\t */\r\n\tpublic static var boxAlpha:Float = 0;\r\n\t\r\n\t/**\r\n\t * cache des boxes de tous les StateGraphic\r\n\t */\r\n\tprivate static var boxesCache:Map<String,Map<String,Dynamic>>;\r\n\t\r\n\t/**\r\n\t * l'anim est-elle termine ?\r\n\t */\r\n\tpublic var isAnimEnd (default, null):Bool;\r\n\t\r\n\tprivate function setAnimEnd ():Void {\r\n\t\tisAnimEnd = true;\r\n\t}\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\t\r\n\t/**\r\n\t * dfini l'tat courant du StateGraphic\r\n\t * @param\tpState nom de l'tat (run, walk...)\r\n\t * @param\tpLoop l'anim boucle (isAnimEnd sera toujours false) ou pas\r\n\t * @param\tpAutoPlay lance l'anim automatiquement\r\n\t * @param\tpStart lance l'anim  cette frame\r\n\t */\r\n\tprivate function setState (pState:String, ?pLoop:Bool = false, ?pAutoPlay:Bool=true, ?pStart:UInt = 0): Void {\r\n\t\t\r\n\t\tvar lClassName:String = Type.getClassName(Type.getClass(this));\r\n\t\t\r\n\t\tif (factory == null) throw lClassName+\" :: proprit factory non dfinie\";\r\n\t\t\r\n\t\tif (state == pState) {\r\n\t\t\tif (anim!=null) setBehavior (pLoop,pAutoPlay,pStart);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (assetName == null) assetName = lClassName.split(\".\").pop();\r\n\t\t\r\n\t\tstate = pState;\r\n\t\t\r\n\t\tanim = factory.getAnim();\r\n\t\t\r\n\t\tif (anim == null) {\t\t\t\r\n\t\t\tif (boxType == BoxType.SELF) {\r\n\t\t\t\tif (box !=null) removeChild(box);\r\n\t\t\t\tbox = null;\r\n\t\t\t}\r\n\t\t\tanim = factory.create(getID(state));\r\n\t\t\tanim.scale.set(1 /DeviceCapabilities.textureRatio , 1 / DeviceCapabilities.textureRatio);\r\n\t\t\tif (animAlpha < 1) anim.alpha = animAlpha;\r\n\t\t\taddChild(anim);\r\n\t\t} else {\r\n\t\t\tfactory.update(getID(state));\r\n\t\t}\r\n\r\n\t\tisAnimEnd = false;\r\n\t\t\r\n\t\tsetBehavior(pLoop, pAutoPlay, pStart);\r\n\t\t\r\n\t\tif (box == null) {\r\n\t\t\tif (boxType == BoxType.SELF) {\r\n\t\t\t\tbox = anim;\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\tbox = new Container();\r\n\t\t\t\tif (boxType != BoxType.NONE) createBox();\r\n\t\t\t}\r\n\t\t\taddChild(box);\r\n\t\t} else if (boxType == BoxType.MULTIPLE) {\r\n\t\t\tremoveChild(box);\r\n\t\t\tbox = new Container();\r\n\t\t\tcreateBox();\r\n\t\t\taddChild(box);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\tprivate function setBehavior (?pLoop:Bool = false, ?pAutoPlay:Bool=true, ?pStart:UInt = 0):Void {\r\n\t\tuntyped anim.loop = pLoop;\r\n\t\tfactory.setFrame(pAutoPlay, pStart);\r\n\t}\r\n\t\r\n\t/**\r\n\t * retourne l'identifiant complet de l'animation\r\n\t * @param\tpState etat de l'anim\r\n\t * @return identifiant\r\n\t */\r\n\tprivate function getID(pState:String): String {\r\n\t\tif (pState == DEFAULT_STATE) return assetName+ANIM_SUFFIX;\r\n\t\treturn assetName+\"_\" + pState+ANIM_SUFFIX;\r\n\t}\r\n\t\r\n\t/**\r\n\t * cre la ou les box de collision de l'tat\r\n\t */\r\n\tprivate function createBox ():Void {\r\n\t\tvar lBoxes:Map<String,Dynamic> = getBox((boxType == BoxType.MULTIPLE ? state+ \"_\": \"\" )  + BOX_SUFFIX);\r\n\t\tvar lChild:Graphics;\r\n\t\t\r\n\t\tfor (lBox in lBoxes.keys()) {\r\n\t\t\tlChild = new Graphics();\r\n\t\t\tlChild.beginFill(0xFF2222);\r\n\t\t\tif (Std.is(lBoxes[lBox], Rectangle)) {\r\n\t\t\t\tlChild.drawRect(lBoxes[lBox].x, lBoxes[lBox].y, lBoxes[lBox].width, lBoxes[lBox].height);\r\n\t\t\t}\r\n\t\t\telse if (Std.is(lBoxes[lBox], Ellipse)) {\r\n\t\t\t\tlChild.drawEllipse(lBoxes[lBox].x, lBoxes[lBox].y, lBoxes[lBox].width, lBoxes[lBox].height);\r\n\t\t\t}\r\n\t\t\telse if (Std.is(lBoxes[lBox], Circle)) {\r\n\t\t\t\tlChild.drawCircle(lBoxes[lBox].x,lBoxes[lBox].y,lBoxes[lBox].radius);\r\n\t\t\t}\r\n\t\t\telse if (Std.is(lBoxes[lBox], Point)) {\r\n\t\t\t\tlChild.drawCircle(0, 0, 10);\r\n\t\t\t}\r\n\t\t\tlChild.endFill();\r\n\t\t\t\r\n\t\t\tlChild.name = lBox;\r\n\t\t\tif (Std.is(lBoxes[lBox], Point)) lChild.position.set(lBoxes[lBox].x, lBoxes[lBox].y);\r\n\t\t\telse lChild.hitArea = lBoxes[lBox];\r\n\t\t\t \r\n\t\t\tbox.addChild(lChild);\r\n\t\t}\r\n\t\tif (boxAlpha == 0) box.renderable = false;\r\n\t\telse box.alpha= boxAlpha;\r\n\t}\t\t\r\n\t\r\n\t/**\r\n\t * Crer toutes les Boxes\r\n\t * @param\tpJson Nom du fichier contenant la description des boxes\r\n\t */\r\n\tstatic public function addBoxes (pJson:Json): Void {\r\n\t\t\r\n\t\tif (boxesCache == null) boxesCache = new Map<String,Map<String,Dynamic>>();\r\n\t\t\r\n\t\tvar lItem;\r\n\t\tvar lObj;\r\n\t\t\r\n\t\tfor (lName in Reflect.fields(pJson)) {\r\n\t\t\tlItem = Reflect.field(pJson, lName);\r\n\t\t\tboxesCache[lName] = new Map<String,Dynamic>();\t\t\t\r\n\t\t\t\r\n\t\t\tfor (lObjName in Reflect.fields(lItem)) {\r\n\t\t\t\tlObj = Reflect.field(lItem, lObjName);\r\n\t\t\t\t\r\n\t\t\t\tif (lObj.type == \"Rectangle\") boxesCache[lName][lObjName] = new Rectangle(lObj.x, lObj.y, lObj.width, lObj.height);\r\n\t\t\t\telse if (lObj.type == \"Ellipse\") boxesCache[lName][lObjName] = new Ellipse(lObj.x, lObj.y, lObj.width/2, lObj.height/2);\r\n\t\t\t\telse if (lObj.type == \"Circle\") boxesCache[lName][lObjName] = new Circle(lObj.x, lObj.y, lObj.radius);\r\n\t\t\t\telse if (lObj.type == \"Point\") boxesCache[lName][lObjName] = new Point(lObj.x, lObj.y);\r\n\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Cherche dans le cache gnral des boxes, celle correspondant au state demand\r\n\t * @param\tpState State de l'instance\r\n\t * @return\tla box correspondante\r\n\t * @return\r\n\t */\r\n\tpublic function getBox (pState:String):Map<String,Dynamic> {\r\n\t\treturn boxesCache[assetName+\"_\" +pState];\r\n\t}\t\t\r\n\t\r\n\t/**\r\n\t * met en pause l'anim\r\n\t */\r\n\tpublic function pause ():Void {\r\n\t\tif (anim != null) untyped anim.stop();\r\n\t}\r\n\t\r\n\t/**\r\n\t * relance l'anim\r\n\t */\r\n\tpublic function resume ():Void {\r\n\t\tif (anim != null) untyped anim.play();\r\n\t}\r\n\t\r\n\t/**\r\n\t * retourne la zone de hit de l'objet\r\n\t */\r\n\tpublic var hitBox (get, null):Container;\r\n\t \r\n\tprivate function get_hitBox (): Container {\r\n\t\treturn box;\r\n\t\t// Si on veut cibler une box plus prcise: return box.getChildByName(\"nom d'instance du MovieClip de type Rectangle ou Circle dans Flash IDE\");\r\n\t}\r\n\r\n\t/**\r\n\t * retourne un tableau de points de collision dont les coordonnes sont exprimes dans le systeme global\r\n\t */\r\n\tpublic var hitPoints (get, null): Array<Point>;\r\n\t \r\n\tprivate function get_hitPoints (): Array<Point> {\r\n\t\treturn null;\r\n\t\t// liste de Points : return [box.toGlobal(box.getChildByName(\"nom d'instance du MovieClip de type Point dans Flash IDE\").position,box.toGlobal(box.getChildByName(\"nom d'instance du MovieClip de type Point dans Flash IDE\").position];\r\n\t}\r\n\t\r\n\t/**\r\n\t * nettoyage et suppression de l'instance\r\n\t */\r\n\toverride public function destroy (): Void {\r\n\t\tif (untyped anim.stop!=null) untyped anim.stop();\r\n\t\tremoveChild(anim);\r\n\t\tanim.destroy();\t\t\r\n\t\tif (box != anim) {\r\n\t\t\tremoveChild(box);\r\n\t\t\tbox.destroy();\r\n\t\t\tbox = null;\r\n\t\t}\r\n\t\tanim = null;\r\n\t\t\r\n\t\tsuper.destroy();\r\n\t}\r\n\t\r\n}","package com.isartdigital.perle.game.sprites;\r\n\r\nimport com.isartdigital.perle.game.managers.PoolingManager;\r\nimport com.isartdigital.perle.game.virtual.VCell;\r\nimport com.isartdigital.utils.game.BoxType;\r\nimport com.isartdigital.utils.game.factory.MovieClipAnimFactory;\r\nimport com.isartdigital.perle.game.iso.IsoManager;\r\nimport com.isartdigital.utils.game.StateGraphic;\r\nimport pixi.core.math.Point;\r\n\r\n/**\r\n * ...\r\n * @author ambroise\r\n */\r\nclass Tile extends StateGraphic\r\n{ \r\n\tpublic static inline var TILE_WIDTH:Float = 200;\r\n\tpublic static inline var TILE_HEIGHT:Float = 100;\r\n\t\r\n\t/**\r\n\t * Reference usable to destroy VCell an so by the same way from Save\r\n\t * Still, the best choice would be to destroy VCell first and then just update Clipping\r\n\t * Unused for now (you can't destroy buidings for now, the only way is to destroy Save !)\r\n\t */\r\n\tprivate var linkedVirtualCell:VCell;\r\n\t\r\n\tpublic static function initClass():Void {\r\n\t\tIsoManager.init(TILE_WIDTH, TILE_HEIGHT);\r\n\t\tGround.initClass();\r\n\t\tBuilding.initClass();\r\n\t}\r\n\t\r\n\tprivate function positionTile(pGridX:Int, pGridY:Int):Void {\r\n\t\tposition = IsoManager.modelToIsoView(new Point(pGridX, pGridY));\r\n\t}\r\n\t\r\n\tpublic function new(?pAssetName:String) {\r\n\t\tsuper();\r\n\t\tif (pAssetName != null)\r\n\t\t\tassetName = pAssetName;\r\n\t}\r\n\t\r\n\tpublic function linkVirtualCell(lVCell:VCell):Void {\r\n\t\tlinkedVirtualCell = lVCell;\r\n\t}\r\n\t\r\n\tpublic function init():Void {\r\n\t\tif (factory == null)\r\n\t\t\tfactory = new MovieClipAnimFactory();\r\n\t\tboxType = BoxType.SELF;\r\n\t\tsetState(DEFAULT_STATE);\r\n\t}\r\n\t\r\n\tpublic function getAssetName():String {\r\n\t\treturn assetName;\r\n\t}\r\n\t\r\n\t// implement recycle ? pas ncessaire ! pr l'instant, bah poolingo non plus..\r\n\tpublic function recycle():Void {\r\n\t\tlinkedVirtualCell = null;\r\n\t\tsetModeVoid();\r\n\t\tparent.removeChild(this);\r\n\t\t// => Type.getClassName(Type.getClass(this)) ? (if you want className)\r\n\t\tPoolingManager.addToPool(this, assetName);\r\n\t}\r\n\t\r\n\t/**\r\n\t * If you want to remove the tile (from save) you need to destroy the VCell\r\n\t */\r\n\toverride public function destroy():Void {\r\n\t\tlinkedVirtualCell.removeLink();\r\n\t\tlinkedVirtualCell = null;\r\n\t\tsetModeVoid();\r\n\t\tparent.removeChild(this);\r\n\t}\r\n}","package com.isartdigital.perle.game.sprites;\r\n\r\nimport com.isartdigital.perle.game.managers.MouseManager;\r\nimport com.isartdigital.perle.game.managers.PoolingObject;\r\nimport com.isartdigital.perle.game.managers.SaveManager;\r\nimport com.isartdigital.perle.game.managers.PoolingManager;\r\nimport com.isartdigital.perle.game.managers.SaveManager.TileDescription;\r\nimport com.isartdigital.perle.game.virtual.VBuilding;\r\nimport com.isartdigital.utils.events.MouseEventType;\r\nimport com.isartdigital.utils.events.TouchEventType;\r\nimport com.isartdigital.utils.game.GameStage;\r\nimport com.isartdigital.perle.game.iso.IsoManager;\r\nimport com.isartdigital.perle.game.iso.IZSortable;\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\nimport js.Browser;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.math.Point;\r\nimport pixi.filters.color.ColorMatrixFilter;\r\n\r\ntypedef SizeOnMap = {\r\n\tvar width:Int;\r\n\tvar height:Int;\r\n}\r\n\r\n/**\r\n * ...\r\n * @author ambroise\r\n */\r\nclass Building extends Tile implements IZSortable implements PoolingObject\r\n{\r\n\tpublic static var ASSETNAME_TO_MAPSIZE(default, never):Map<String, SizeOnMap> = [\r\n\t\t\"Factory\" => {width:5, height:3},\r\n\t\t\"House\" => {width:2, height:2},\r\n\t\t\"Trees\" => {width:1, height:1},\r\n\t\t\"Villa\" => {width:3, height:3},\r\n\t];\r\n\tprivate static inline var FILTER_OPACITY:Float = 0.5;\r\n\t\r\n\tpublic static var list:Array<Building>;\r\n\t\r\n\tpublic var colMin:Int;\r\n\tpublic var colMax:Int;\r\n\tpublic var rowMin:Int;\r\n\tpublic var rowMax:Int;\r\n\tpublic var behind:Array<IZSortable>;\r\n\tpublic var inFront:Array<IZSortable>;\r\n\r\n\tprivate static var currentSelectedBuilding:Building;\r\n\tprivate static var container:Container;\r\n\tprivate static var colorMatrix:ColorMatrixFilter;\r\n\t\r\n\t/**\r\n\t * Hack, ignore first unwanted click on building HUD button\r\n\t * the building won't spawn beside the button\r\n\t */\r\n\tprivate static var firstClickSuck:Bool;\r\n\t\r\n\tprivate var precedentBesMapPos:Point = new Point(0, 0);\r\n\t\r\n\t/**\r\n\t * Initialisation of Building class, should be called after Ground class initialisation.\r\n\t */\r\n\tpublic static function initClass():Void {\r\n\t\tcontainer = new Container();\r\n\t\tcolorMatrix = new ColorMatrixFilter();\r\n\t\tcolorMatrix.desaturate(false);\r\n\t\tcontainer.position = Ground.container.position;\r\n\t\tGameStage.getInstance().getGameContainer().addChild(container);\r\n\t\tlist = new Array<Building>();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Z-Sorting of Building container.\r\n\t */\r\n\tpublic static function sortBuildings():Void {\r\n\t\tcontainer.children = IsoManager.sortTiles(container.children);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Return true if user is making a new build.\r\n\t * @return\r\n\t */\r\n\tpublic static function hasCurrentBuilding():Bool {\r\n\t\treturn currentSelectedBuilding != null;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Create a Building Tile, addchild it and start it.\r\n\t * @param\tpTileDesc\r\n\t * @return\r\n\t */\r\n\tpublic static function createBuilding(pTileDesc:TileDescription):Building {\r\n\t\tvar lBuilding:Building = PoolingManager.getFromPool(pTileDesc.assetName);\r\n\t\t\r\n\t\tlBuilding.positionTile(\r\n\t\t\tpTileDesc.mapX, \r\n\t\t\tpTileDesc.mapY\r\n\t\t);\r\n\t\tlBuilding.setMapColRow(\r\n\t\t\tnew Point(pTileDesc.mapX, pTileDesc.mapY),\r\n\t\t\tASSETNAME_TO_MAPSIZE[pTileDesc.assetName]\r\n\t\t);\r\n\t\tlist.push(lBuilding);\r\n\t\tlBuilding.init();\r\n\t\tcontainer.addChild(lBuilding);\r\n\t\tlBuilding.start();\r\n\t\treturn lBuilding;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Create a Phantom Building\r\n\t * @param\tpAssetName\r\n\t */\r\n\tpublic static function onClickHudBuilding(pAssetName:String):Void {\r\n\t\tif (currentSelectedBuilding == null)\r\n\t\t\tcreatePhantom(pAssetName);\r\n\t\telse if (currentSelectedBuilding.assetName != pAssetName) {\r\n\t\t\tremovePhantom();\r\n\t\t\tcreatePhantom(pAssetName);\r\n\t\t}\r\n\t\telse if (currentSelectedBuilding.assetName == pAssetName)\r\n\t\t\tremovePhantom();\r\n\t}\r\n\t\r\n\tpublic static function gameLoop():Void {\r\n\t\tif (currentSelectedBuilding != null)\r\n\t\t\tcurrentSelectedBuilding.doAction();\r\n\t}\r\n\t\r\n\tprivate static function createPhantom(pAssetName:String):Void {\r\n\t\tfirstClickSuck = true;\r\n\t\tcurrentSelectedBuilding = PoolingManager.getFromPool(pAssetName);\r\n\t\tcurrentSelectedBuilding.position = MouseManager.getInstance().positionInGame;\r\n\t\tcontainer.addChild(currentSelectedBuilding);\r\n\t\tcurrentSelectedBuilding.init();\r\n\t\tcurrentSelectedBuilding.setModePhantom();\r\n\t}\r\n\t\r\n\tprivate static function removePhantom():Void {\r\n\t\tcurrentSelectedBuilding.recycle();\r\n\t\tcurrentSelectedBuilding = null;\r\n\t}\r\n\t\r\n\tpublic function new(?pAssetName:String) {\r\n\t\tsuper(pAssetName);\r\n\t}\r\n\t\r\n\t// todo : renommer je crois qu'il les nomment diffremment\r\n\tpublic function setModePhantom():Void {\r\n\t\taddPhantomFilter();\r\n\t\tdoAction = doActionPhantom;\r\n\t\taddBuildListeners();\r\n\t\tsetState(DEFAULT_STATE); // <-- pas intuitif ! todo sr que ncessaire ?\r\n\t}\r\n\t\r\n\t/**\r\n\t * Move the ground center of the building on the mouse pointer.\r\n\t */\r\n\tprivate function doActionPhantom():Void {\r\n\t\tvar buildingGroundCenter:Point = getBuildingGroundCenter();\r\n\t\tvar perfectMouseFollow:Point = new Point(\r\n\t\t\tMouseManager.getInstance().positionInGame.x + x - buildingGroundCenter.x,\r\n\t\t\tMouseManager.getInstance().positionInGame.y + y - buildingGroundCenter.y\r\n\t\t);\r\n\t\tvar bestMapPos:Point = getRoundMapPos(perfectMouseFollow);\r\n\t\t\r\n\t\tposition = IsoManager.modelToIsoView(bestMapPos);\r\n\t\t\r\n\t\t// optimization to make less call to canBuilHere();\r\n\t\tif (precedentBesMapPos.x != bestMapPos.x ||\r\n\t\t\tprecedentBesMapPos.y != bestMapPos.y) {\r\n\t\t\t\r\n\t\t\tif (canBuildHere())\r\n\t\t\t\tremoveDesaturateFilter();\r\n\t\t\telse\r\n\t\t\t\taddDesaturateFilter();\r\n\t\t}\r\n\t\t\r\n\t\tprecedentBesMapPos.copy(bestMapPos);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Get the center of the building from the map view (center on Ground)\r\n\t * @return\r\n\t */\r\n\tprivate function getBuildingGroundCenter():Point {\r\n\t\tvar mapPos:Point = getRoundMapPos(position);\r\n\t\t\r\n\t\treturn IsoManager.modelToIsoView(new Point(\r\n\t\t\tmapPos.x + ASSETNAME_TO_MAPSIZE[assetName].width / 2,\r\n\t\t\tmapPos.y + ASSETNAME_TO_MAPSIZE[assetName].height / 2\r\n\t\t));\r\n\t}\r\n\t\r\n\tprivate function onMouseTouchClick():Void {\r\n\t\tif (firstClickSuck) {\r\n\t\t\tfirstClickSuck = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t// todo : confirm build ?\r\n\t\tif (canBuildHere())\r\n\t\t\tnewBuild();\r\n\t\telse\r\n\t\t\tdisplayCantBuild(); // todo hud method ?\r\n\t}\r\n\t\r\n\t/**\r\n\t * Verify that you can build on the specified space.\r\n\t * @param\tpRect\r\n\t */\r\n\tprivate function canBuildHere():Bool {\r\n\t\tsetMapColRow(getRoundMapPos(position), ASSETNAME_TO_MAPSIZE[assetName]);\r\n\t\treturn buildingOnGround() && buildingCollideOther();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Verify that the building in fully on Ground before building it.\r\n\t * @return\r\n\t */\r\n\tprivate function buildingOnGround():Bool {\r\n\t\t//trace(untyped rowMin); // -1\r\n\t\t//trace(rowMin < 0); // false\r\n\t\t// thx Haxe !\r\n\t\t// (UInt suck)\r\n\t\t\r\n\t\t// todo : factoriser\r\n\t\tif (colMin < 0 || rowMin < 0 ||\r\n\t\t\tcolMax >= Ground.COL_X_LENGTH ||\r\n\t\t\trowMax >= Ground.ROW_Y_LENGTH)\r\n\t\t\treturn false;\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\t/**\r\n\t * verify that the building doesn't collapse another one.\r\n\t * Use the TileDescription in Save instead of only instantiated (visible) buildings.\r\n\t * @return\r\n\t */\r\n\tprivate function buildingCollideOther():Bool {\r\n\t\tfor (i in 0... SaveManager.currentSave.building.length) {\r\n\t\t\tif (collisionRectDesc(SaveManager.currentSave.building[i]))\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\t/**\r\n\t * UNUSED\r\n\t * return true if collision between instanciated buildings.\r\n\t * use colMin, colMax, rowMin, rowMax\r\n\t * @param\trect2:Building\r\n\t */\r\n\tprivate function collisionRect(rect2:Building):Bool {\r\n\t\treturn (colMin < rect2.colMax+1 &&\r\n\t\t\t\tcolMax+1 > rect2.colMin &&\r\n\t\t\t\trowMin < rect2.rowMax+1 &&\r\n\t\t\t\trowMax+1 > rect2.rowMin);\r\n\t};\r\n\t\r\n\t/**\r\n\t * Test collision between instance and a TileDescription from Save\r\n\t * Permit that uninstanciated (unshow) building still make collision !\r\n\t */\r\n\tprivate function collisionRectDesc(pDesc:TileDescription):Bool {\r\n\t\treturn (colMin < pDesc.mapX + ASSETNAME_TO_MAPSIZE[pDesc.assetName].width &&\r\n\t\t\t\tcolMax+1 > pDesc.mapX &&\r\n\t\t\t\trowMin < pDesc.mapY + ASSETNAME_TO_MAPSIZE[pDesc.assetName].height &&\r\n\t\t\t\trowMax+1 > pDesc.mapY);\r\n\t}\r\n\t\r\n\t/**\r\n\t * User has added a new Building,\r\n\t * Add a new VBuilding, update clipping and save.\r\n\t * // pas de court-circuitage de VCell, pas non plus de cration invers (Building puis VCell)\r\n\t */\r\n\tprivate function newBuild():Void {\r\n\t\t// todo :\r\n\t\t// Type.getClassName ? but path whit it ?\r\n\t\t// what do you do if the path change between version and not in save ?\r\n\t\tvar tileDesc:TileDescription = {\r\n\t\t\tclassName:\"Building\",\r\n\t\t\tassetName:assetName,\r\n\t\t\tmapX:colMin,\r\n\t\t\tmapY:rowMin\r\n\t\t};\r\n\t\tvar vBuilding:VBuilding = new VBuilding(tileDesc);\r\n\t\tvBuilding.activate(); // or won't show until clipping ! \"ClippingManager.update();\" useless here\r\n\t\tvBuilding = null;\r\n\t\t\r\n\t\tremovePhantom();\r\n\t\tSaveManager.save();\r\n\t}\r\n\t\r\n\tprivate function setMapColRow(pMapPos:Point, pMapSize:SizeOnMap):Void {\r\n\t\tcolMax = cast(pMapPos.x + pMapSize.width-1, UInt); // (0 en haut, 10  droite)\r\n\t\tcolMin = cast(pMapPos.x, UInt);\r\n\t\trowMax = cast(pMapPos.y + pMapSize.height-1, UInt); // (0 en haut, 10  gauche)\r\n\t\trowMin = cast(pMapPos.y, UInt);\r\n\t} \r\n\t\r\n\t/**\r\n\t * Get the rounded position in map view\r\n\t * Prefer using floor position when you can.\r\n\t * @param\tpPos\r\n\t * @return\r\n\t */\r\n\tprivate function getRoundMapPos(pPos:Point):Point {\r\n\t\tvar lPoint:Point = IsoManager.isoViewToModel(pPos);\r\n\t\tlPoint.x = Math.round(lPoint.x);\r\n\t\tlPoint.y = Math.round(lPoint.y);\r\n\t\treturn lPoint;\r\n\t}\r\n\t\r\n\t/**\r\n\t * todo : HUD method\r\n\t */\r\n\tprivate function displayCantBuild():Void {\r\n\t\ttrace(\"Can't Build Here !\");\r\n\t}\r\n\t\r\n\t/**\r\n\t * Reduce alpha\r\n\t */\r\n\tprivate function addPhantomFilter():Void {\r\n\t\talpha = FILTER_OPACITY;\r\n\t}\r\n\t\r\n\tprivate function removePhantomFilter():Void {\r\n\t\talpha = 1.0;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Building become grey !\r\n\t */\r\n\tprivate function addDesaturateFilter():Void {\r\n\t\tif (filters == null)\r\n\t\t\tfilters = [colorMatrix];\r\n\t}\r\n\t\r\n\tprivate function removeDesaturateFilter():Void {\r\n\t\tfilters = null;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Listen to click or touch_end to build the building\r\n\t */\r\n\tprivate function addBuildListeners():Void {\r\n\t\tif (DeviceCapabilities.system == DeviceCapabilities.SYSTEM_DESKTOP)\r\n\t\t\tBrowser.window.addEventListener(MouseEventType.CLICK, onMouseTouchClick);\r\n\t\telse\r\n\t\t\tBrowser.window.addEventListener(TouchEventType.TOUCH_END, onMouseTouchClick);\r\n\t}\r\n\t\r\n\tprivate function removeBuildListeners():Void {\r\n\t\tBrowser.window.removeEventListener(MouseEventType.CLICK, onMouseTouchClick);\r\n\t\tBrowser.window.removeEventListener(TouchEventType.TOUCH_END, onMouseTouchClick);\r\n\t}\r\n\t\r\n\toverride public function recycle():Void {\r\n\t\tif (list.indexOf(this) != -1)\r\n\t\t\tlist.splice(list.indexOf(this), 1);\r\n\t\t\r\n\t\tremovePhantomFilter();\r\n\t\tremoveDesaturateFilter();\r\n\t\tremoveBuildListeners();\r\n\t\tsuper.recycle();\r\n\t}\r\n\t\r\n\toverride public function destroy():Void {\r\n\t\t// todo : verify all destroy methods\r\n\t\tif (list.indexOf(this) != -1)\r\n\t\t\tlist.splice(list.indexOf(this), 1);\r\n\t\tremoveBuildListeners();\r\n\t\tsuper.destroy();\r\n\t}\r\n\t\r\n\tpublic static function destroyStatic():Void {\r\n\t\tcontainer.parent.removeChild(container);\r\n\t\tcurrentSelectedBuilding.destroy();\r\n\t\tcurrentSelectedBuilding = null;\r\n\t\tcontainer = null;\r\n\t\tfor (i in 0...list.length)\r\n\t\t\tlist[i].destroy();\r\n\t\tlist = null;\r\n\t}\r\n}","package com.isartdigital.perle.game.sprites;\r\nimport com.isartdigital.perle.game.managers.MouseManager;\r\nimport com.isartdigital.perle.game.managers.SaveManager;\r\nimport com.isartdigital.perle.game.managers.PoolingManager;\r\nimport com.isartdigital.perle.game.managers.PoolingObject;\r\nimport com.isartdigital.perle.game.managers.SaveManager.TileDescription;\r\nimport com.isartdigital.utils.events.MouseEventType;\r\nimport com.isartdigital.utils.game.GameStage;\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\nimport js.Browser;\r\nimport js.html.MouseEvent;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.math.Point;\r\nimport pixi.filters.color.ColorMatrixFilter;\r\n\r\n/**\r\n * \r\n * @author ambroise\r\n */\r\nclass Ground extends Tile implements PoolingObject \r\n{\r\n\t/**\r\n\t * Ground Map in X length (DONT LOAD SAVE WHIT DIFFERENT VALUE)\r\n\t */\r\n\tpublic static inline var COL_X_LENGTH:Int = 20;\r\n\t\r\n\t/**\r\n\t * Ground Map in Y length (DONT LOAD SAVE WHIT DIFFERENT VALUE)\r\n\t */\r\n\tpublic static inline var ROW_Y_LENGTH:Int = 40;\r\n\t\r\n\t/**\r\n\t * Used onMouseOver\r\n\t */\r\n\tprivate static inline var FILTER_BRIGHTNESS:Float = 1.3;\r\n\t\r\n\tpublic static var container(default, null):Container;\r\n\tpublic static var mapArray:Array<Array<Ground>> = [for (x in 0...COL_X_LENGTH) []];\r\n\t\r\n\tpublic var mapX:Int;\r\n\tpublic var mapY:Int;\r\n\t\r\n\tprivate static var previousCell:Ground;\r\n\tprivate static var colorMatrix:ColorMatrixFilter;\r\n\t\r\n\t\r\n\tpublic static function initClass():Void {\r\n\t\tcontainer = new Container();\r\n\t\tcolorMatrix = new ColorMatrixFilter();\r\n\t\tcolorMatrix.brightness(FILTER_BRIGHTNESS, false);\r\n\t\tGameStage.getInstance().getGameContainer().addChild(container);\r\n\t\t\r\n\t\tif (DeviceCapabilities.system == DeviceCapabilities.SYSTEM_DESKTOP)\r\n\t\t\tBrowser.window.addEventListener(MouseEventType.MOUSE_MOVE, Ground.hoverGround);\r\n\t}\r\n\t\r\n\tpublic static function hoverGround(pEvent:MouseEvent) {\r\n\t\tlightCell(MouseManager.getInstance().getLocalMouseMapPos());\r\n\t}\r\n\t\r\n\t/**\r\n\t * Create a Ground Tile, addChild and start it.\r\n\t * @param\tpTileDesc\r\n\t * @return\r\n\t */\r\n\tpublic static function createGround(pTileDesc:TileDescription):Ground {\r\n\t\tvar lGround:Ground = PoolingManager.getFromPool(pTileDesc.assetName);\r\n\t\tmapArray[pTileDesc.mapX][pTileDesc.mapY] = lGround;\r\n\t\tlGround.positionTile(\r\n\t\t\tpTileDesc.mapX, \r\n\t\t\tpTileDesc.mapY\r\n\t\t);\r\n\t\tlGround.init();\r\n\t\tcontainer.addChild(lGround);\r\n\t\tlGround.start();\r\n\t\treturn lGround;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Apply the filter to the ground, and remvoe filter from precedent ground.\r\n\t * @param\tpPoint\r\n\t */\r\n\tprivate static function lightCell(pPoint:Point):Void {\r\n\t\tvar lGround:Ground;\r\n\t\t\r\n\t\tif (mapArray[Math.floor(pPoint.x)] == null) {\r\n\t\t\tif (previousCell != null)\r\n\t\t\t\tpreviousCell.removeFilterCell();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlGround = mapArray[Math.floor(pPoint.x)][Math.floor(pPoint.y)];\r\n\t\t\r\n\t\t// lCell exist\r\n\t\tif (lGround != null) {\r\n\t\t\t\r\n\t\t\t// previousCell exist and is the same as lCell --> return\r\n\t\t\tif (previousCell != null &&\r\n\t\t\t\t(lGround.x == previousCell.x && lGround.y == previousCell.y))\r\n\t\t\t\treturn;\r\n\t\t\t\t\r\n\t\t\t// different lCell, but previousCell exist --> removeFilter()\r\n\t\t\tif (previousCell != null)\r\n\t\t\t\tpreviousCell.removeFilterCell();\r\n\t\t\t\t\r\n\t\t\tlGround.addFilterCell();\r\n\t\t\tpreviousCell = lGround;\r\n\t\t} else if (lGround == null && previousCell != null){\r\n\t\t\tpreviousCell.removeFilterCell();\r\n\t\t}\r\n\t} \r\n\t\r\n\tpublic function new(?pAssetName:String) {\r\n\t\tsuper(pAssetName);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Enlight Cell when mouseOver\r\n\t */\r\n\tprivate function addFilterCell():Void {\r\n\t\tif (filters == null)\r\n\t\t\tfilters = [colorMatrix];\r\n\t}\r\n\t\r\n\tprivate function removeFilterCell():Void {\r\n\t\tfilters = null;\r\n\t}\r\n\t\r\n\toverride function positionTile(pGridX:Int, pGridY:Int):Void {\r\n\t\tsuper.positionTile(pGridX, pGridY);\r\n\t\tmapX = pGridX;\r\n\t\tmapY = pGridY;\r\n\t}\r\n\t\r\n\toverride public function recycle():Void {\r\n\t\tmapArray[mapX][mapY] = null;\r\n\t\tsuper.recycle();\r\n\t}\r\n\t\r\n\toverride public function destroy():Void {\r\n\t\tmapArray[mapX][mapY] = null;\r\n\t\tsuper.destroy();\r\n\t}\r\n\t\r\n\t// todo: destroyStatic ? jamais appel pr l'instant :o !\r\n\tpublic static function destroyStatic():Void {\r\n\t\tBrowser.window.removeEventListener(MouseEventType.MOUSE_MOVE, Ground.hoverGround);\r\n\t\tpreviousCell = null;\r\n\t\tmapArray = null;\r\n\t\tcolorMatrix = null;\r\n\t}\r\n\t\r\n}","package com.isartdigital.perle.game.virtual;\r\nimport com.isartdigital.perle.game.managers.ClippingManager;\r\nimport com.isartdigital.perle.game.managers.SaveManager;\r\nimport com.isartdigital.perle.game.managers.ClippingManager.EasyRectangle;\r\nimport com.isartdigital.perle.game.managers.SaveManager.Save;\r\nimport com.isartdigital.perle.game.managers.SaveManager.TileDescription;\r\nimport com.isartdigital.perle.game.sprites.Ground;\r\nimport com.isartdigital.perle.game.iso.IsoManager;\r\nimport pixi.core.math.Point;\r\n\r\n/**\r\n * This is a VirtualCell\r\n * correspond to a tile ingame, and is stored in a clippingArray\r\n * (Should be abstract ?\r\n * Mlange du virtuel avec les cases du clipping dangereux ?\r\n * Crer une ClippingCell en plus de VCell ?)\r\n * @author ambroise\r\n */\r\nclass VCell {\r\n\t/**\r\n\t * temporary ! the best way to add road in my mind would be the same way as for buildings...\r\n\t * todo dplacer ds VGround, supprimer plutt et ajouter cela ds l'diteur hud ou cheat\r\n\t */ \r\n\tprivate static var ROAD_MAP:Array<Array<String>> = [\r\n\t\t[\"\",\"\",\"\",\"\",\"Road_br\",\"Road_tl\",\"\",\"\"],\r\n\t\t[\"\",\"\",\"\",\"Road_br\",\"Road_tl\",\"\",\"\",\"\"],\r\n\t\t[\"Road_v\",\"Road_v\",\"Road_v\",\"Road_c\",\"\",\"\",\"\",\"\"],\r\n\t\t[\"\",\"\",\"\",\"Road_h\",\"\",\"\",\"\",\"\"],\r\n\t\t[\"Road_v\",\"Road_v\",\"Road_v\",\"Road_tl\",\"\",\"\",\"\",\"\"],\r\n\t\t[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"],\r\n\t\t[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"],\r\n\t\t[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"],\r\n\t\t[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"],\r\n\t\t[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"],\r\n\t\t[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"],\r\n\t\t[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"]\r\n\t];\r\n\t\r\n\tpublic static var list:Map<String, Map<Int, Map<Int, VCell>>> = new Map<String, Map<Int, Map<Int, VCell>>>();\r\n\t\r\n\tpublic var tileDesc:TileDescription;\r\n\t/**\r\n\t * active is true if the instance represented by VCell should be visible on screen\r\n\t */\r\n\tpublic var active(default, null):Bool = false;\r\n\t\r\n\t/**\r\n\t * position x,y in Ground.container;\r\n\t */\r\n\tprivate var position:Point;\r\n\t/**\r\n\t * instance linked to VCell when active\r\n\t */\r\n\tprivate var myInstance:Dynamic;\r\n\t\r\n\t\r\n\t// ! todo : faire une save qui sert d'initial, et un code pour diter le monde inGame ?\r\n\t/**\r\n\t * todo :\r\n\t * Temp : build the game whitout Save, a default Save will be used as initial later.\r\n\t */\r\n\tpublic static function buildInitial():Void {\r\n\t\tfor (x in 0...Ground.COL_X_LENGTH) {\t\r\n\t\t\tfor (y in 0...Ground.ROW_Y_LENGTH) {\r\n\t\t\t\t// todo : supprimer les road d'ici ...\r\n\t\t\t\tvar tempRoadAssetName:String = (ROAD_MAP[x] != null && ROAD_MAP[x][y] != null && ROAD_MAP[x][y] != \"\") ? ROAD_MAP[x][y] :\"Ground\";\r\n\t\t\t\t\r\n\t\t\t\tvar tileDesc:TileDescription = {\r\n\t\t\t\t\tclassName:\"Ground\",\r\n\t\t\t\t\tassetName: tempRoadAssetName,\r\n\t\t\t\t\tmapX:x,\r\n\t\t\t\t\tmapY:y\r\n\t\t\t\t};\r\n\t\t\t\tnew VGround(tileDesc);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic static function buildFromSave(pSave:Save):Void {\r\n\t\tvar lLength:UInt = pSave.ground.length;\r\n\t\t\r\n\t\tfor (i in 0...lLength)\r\n\t\t\tnew VGround(pSave.ground[i]);\r\n\t\t\t\r\n\t\tlLength = pSave.building.length;\r\n\t\tfor (i in 0...lLength)\r\n\t\t\tnew VBuilding(pSave.building[i]);\r\n\t}\r\n\t\r\n\t\r\n\tpublic function new(pDescription:TileDescription) {\r\n\t\ttileDesc = pDescription;\r\n\t\tposition = IsoManager.modelToIsoView(new Point(tileDesc.mapX, tileDesc.mapY));\r\n\t\taddToList();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Should not be used, because the only one creating and destroying Buildings\r\n\t * should be VCell (but just in case someone destroy() a Building while forgetting\r\n\t * the VCell)\r\n\t */\r\n\tpublic function removeLink():Void {\r\n\t\tmyInstance = null;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Cell is visible and content will be displayed !\r\n\t */\r\n\tpublic function activate():Void {\r\n\t\tif (active)\r\n\t\t\tthrow(\"VCell is already active !\");\r\n\t\tactive = true;\r\n\t\t\r\n\t\t// look override in VClass !\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Cell is not visible, content will be wiped out !\r\n\t */\r\n\tpublic function desactivate():Void {\r\n\t\tif (!active)\r\n\t\t\tthrow(\"VCell is already unactive !\");\r\n\t\t\t\r\n\t\tactive = false;\r\n\t\tmyInstance.recycle();\r\n\t\tmyInstance = null;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Determine the position of the Cell in the Array and add it.\r\n\t * The 2d array itself is paralell to the camera (not isoView)\r\n\t * @param\tisBuilding\r\n\t */\r\n\tprivate function addToList():Void {\r\n\t\tvar clippingMapPos:Point = ClippingManager.posToClippingMap(position);\r\n\t\tvar xRow:Int = cast(clippingMapPos.x, Int);\r\n\t\tvar yCol:Int = cast(clippingMapPos.y, Int);\r\n\t\t\r\n\t\tif (list[tileDesc.className] == null)\r\n\t\t\tlist[tileDesc.className] = new Map<Int, Map<Int, VCell>>();\r\n\t\tif (list[tileDesc.className][xRow] == null)\r\n\t\t\tlist[tileDesc.className][xRow] = new Map<Int, VCell>();\r\n\t\t\t\r\n\t\tlist[tileDesc.className][xRow][yCol] = this;\r\n\t}\r\n\t\r\n\tprivate function linkVirtual():Void {\r\n\t\tmyInstance.linkVirtualCell(this);\r\n\t}\r\n}","package com.isartdigital.perle.game.virtual;\r\nimport com.isartdigital.perle.game.managers.SaveManager;\r\nimport com.isartdigital.perle.game.managers.SaveManager.TileDescription;\r\nimport com.isartdigital.perle.game.sprites.Building;\r\n\r\n/**\r\n * Will contains every action that the building do whitout being displayed at screen (like giving money)\r\n * Will be used for save\r\n * Will be used for Clipping\r\n * @author ambroise\r\n */\r\nclass VBuilding extends VCell{\r\n\t\r\n\tpublic function new(pDescription:TileDescription) {\r\n\t\tsuper(pDescription);\r\n\t}\r\n\t\r\n\toverride public function activate():Void {\r\n\t\tsuper.activate();\r\n\t\tmyInstance = Building.createBuilding(tileDesc);\r\n\t\tlinkVirtual();\r\n\t}\t\r\n}","package com.isartdigital.perle.game.virtual;\r\nimport com.isartdigital.perle.game.managers.SaveManager;\r\n\r\nimport com.isartdigital.perle.game.managers.SaveManager.TileDescription;\r\nimport com.isartdigital.perle.game.sprites.Ground;\r\n\r\n/**\r\n * Will be used for save\r\n * Will be used for Clipping\r\n * @author ambroise\r\n */\r\nclass VGround extends VCell {\r\n\t\r\n\tpublic function new(pDescription:TileDescription) {\r\n\t\tsuper(pDescription);\r\n\t}\r\n\t\r\n\toverride public function activate():Void {\r\n\t\tsuper.activate();\r\n\t\tmyInstance = Ground.createGround(tileDesc);\r\n\t\tlinkVirtual();\r\n\t}\r\n}","package com.isartdigital.perle.ui;\r\nimport com.isartdigital.utils.Config;\r\nimport dat.gui.GUI;\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\n\r\n\t\r\n/**\r\n * Classe permettant de manipuler des parametres du projet au runtime\r\n * Si la proprit Config.debug et  false ou que la proprit Config.data.cheat est  false, aucun code n'est execut.\r\n * Il n'est pas ncessaire de retirer ou commenter le code du CheatPanel dans la version \"release\" du jeu\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass CheatPanel \r\n{\r\n\t\r\n\t/**\r\n\t * instance unique de la classe CheatPanel\r\n\t */\r\n\tprivate static var instance: CheatPanel;\r\n\t\r\n\t/**\r\n\t * instance de dat.GUI compose par le CheatPanel\r\n\t */\r\n\tprivate var gui:GUI;\r\n\t\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la cre si elle n'existait pas au pralable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): CheatPanel {\r\n\t\tif (instance == null) instance = new CheatPanel();\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * constructeur priv pour viter qu'une instance soit cre directement\r\n\t */\r\n\tprivate function new() \r\n\t{\r\n\t\tinit();\r\n\t}\r\n\t\r\n\tprivate function init():Void {\r\n\t\tif (Config.debug && Config.data.cheat && !DeviceCapabilities.isCocoonJS) gui = new GUI();\r\n\t}\r\n\t\r\n\t// exemple de mthode configurant le panneau de cheat suivant le contexte\r\n\tpublic function ingame (): Void {\r\n\t\t// ATTENTION: toujours intgrer cette ligne dans chacune de vos mthodes pour ignorer le reste du code si le CheatPanel doit tre dsactiv\r\n\t\tif (gui == null) return;\r\n\t\t\r\n\t\t\r\n\t\t//gui.add(Template.getInstance(), \"x\", -1000, 1000).listen();\r\n\t\t//gui.add(Template.getInstance(), \"y\", -500, 500).listen();\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * vide le CheatPanel\r\n\t */\r\n\tpublic function clear ():Void {\r\n\t\tif (gui == null) return;\r\n\t\tgui.destroy();\r\n\t\tinit();\r\n\t}\t\r\n\t\r\n\t/**\r\n\t * dtruit l'instance unique et met sa rfrence interne  null\r\n\t */\r\n\tpublic function destroy (): Void {\r\n\t\tinstance = null;\r\n\t}\r\n\r\n}","package com.isartdigital.utils.ui;\r\n\r\nimport com.isartdigital.utils.events.EventType;\r\nimport com.isartdigital.utils.events.MouseEventType;\r\nimport com.isartdigital.utils.events.TouchEventType;\r\nimport com.isartdigital.utils.game.GameObject;\r\nimport com.isartdigital.utils.game.GameStage;\r\nimport com.isartdigital.utils.ui.UIPositionable;\r\nimport com.isartdigital.utils.ui.smart.UIBuilder;\r\nimport pixi.core.sprites.Sprite;\r\nimport pixi.core.textures.Texture;\r\nimport pixi.interaction.EventTarget;\r\n\r\n/**\r\n * Base de tous les conteneurs d'interface\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass UIComponent extends GameObject\r\n{\r\n\r\n\tprivate var positionables:Array<UIPositionable> = [];\r\n\t\r\n\tprivate var isOpened:Bool;\r\n\t\r\n\tprivate var modalZone:Sprite;\r\n\t\r\n\tprivate var componentName:String;\r\n\t\r\n\tpublic var modalImage(default, set):String=\"assets/alpha_bg.png\";\r\n\t\r\n\tprivate function set_modalImage(pImage:String):String {\r\n\t\tmodalImage = pImage;\r\n\r\n\t\tif (modalZone != null) {\r\n\t\t\tmodalZone.texture = Texture.fromImage(modalImage);\r\n\t\t}\r\n\t\treturn modalImage;\r\n\t}\r\n\t\r\n\tpublic function new(pID:String=null) \r\n\t{\r\n\t\tsuper();\r\n\t\tif (pID == null) {\r\n\t\t\tcomponentName = Type.getClassName(Type.getClass(this));\r\n\t\t\tcomponentName = componentName.substring(componentName.lastIndexOf(\".\") + 1);\r\n\t\t} else componentName = pID;\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * permet de construire l'UIComponent  partir de l'UIBuilder\r\n\t */\r\n\tpublic function build (pFrame:Int=0) : Void {\r\n\t\tvar lItems:Array<UIPositionable> = UIBuilder.build(componentName,pFrame);\r\n\t\t\r\n\t\tfor (lItem in lItems) {\r\n\t\t\taddChild(lItem.item);\r\n\t\t\tif (lItem.align != \"\") positionables.push(lItem);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function open (): Void {\r\n\t\tif (isOpened) return;\r\n\t\tisOpened = true;\r\n\t\tset_modal(modal);\r\n\t\tGameStage.getInstance().on(EventType.RESIZE, onResize);\r\n\t\tonResize();\r\n\t}\r\n\t\r\n\tpublic var modal (default, set):Bool=true;\r\n\t\r\n\tprivate function set_modal (pModal:Bool):Bool {\r\n\t\tmodal = pModal;\r\n\t\t\r\n\t\tif (modal) {\r\n\t\t\tif (modalZone == null) {\r\n\t\t\t\tmodalZone = new Sprite(Texture.fromImage(Config.url(modalImage)));\r\n\t\t\t\tmodalZone.interactive = true;\r\n\t\t\t\tmodalZone.on(MouseEventType.CLICK, stopPropagation);\r\n\t\t\t\tmodalZone.on(TouchEventType.TAP, stopPropagation);\r\n\t\t\t\tpositionables.unshift({ item:modalZone, align:UIPosition.FIT_SCREEN, offsetX:0, offsetY:0});\r\n\t\t\t}\r\n\t\t\tif (parent != null) parent.addChildAt(modalZone, parent.getChildIndex(this));\r\n\t\t} else {\t\r\n\t\t\tif (modalZone != null) {\r\n\t\t\t\tif (modalZone.parent != null) modalZone.parent.removeChild(modalZone);\r\n\t\t\t\tmodalZone.off(MouseEventType.CLICK, stopPropagation);\r\n\t\t\t\tmodalZone.off(TouchEventType.TAP, stopPropagation);\r\n\t\t\t\tmodalZone = null;\r\n\t\t\t\tif (positionables[0].item == modalZone) positionables.shift();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn modal;\r\n\t}\r\n\t\r\n\tprivate function stopPropagation (pEvent:EventTarget): Void {}\r\n\t\r\n\tpublic function close ():Void {\r\n\t\tif (!isOpened) return;\r\n\t\tisOpened = false;\r\n\t\tmodal = false;\r\n\t\tdestroy();\r\n\t}\r\n\t\r\n\t/**\r\n\t * dclenche le positionnement des objets\r\n\t * @param pEvent\r\n\t */\r\n\tprivate function onResize (pEvent:EventTarget = null): Void {\r\n\t\tfor (lObj in positionables) {\r\n\t\t\tif (lObj.update) {\r\n\t\t\t\tif (lObj.align==UIPosition.TOP || lObj.align==UIPosition.TOP_LEFT || lObj.align==UIPosition.TOP_RIGHT) {\r\n\t\t\t\t\tlObj.offsetY = parent.y + lObj.item.y;\r\n\t\t\t\t} else if (lObj.align==UIPosition.BOTTOM || lObj.align==UIPosition.BOTTOM_LEFT || lObj.align==UIPosition.BOTTOM_RIGHT) {\t\r\n\t\t\t\t\tlObj.offsetY = GameStage.getInstance().safeZone.height - parent.y - lObj.item.y;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (lObj.align==UIPosition.LEFT || lObj.align==UIPosition.TOP_LEFT || lObj.align==UIPosition.BOTTOM_LEFT) {\r\n\t\t\t\t\tlObj.offsetX = parent.x + lObj.item.x;\r\n\t\t\t\t} else if (lObj.align==UIPosition.RIGHT || lObj.align==UIPosition.TOP_RIGHT || lObj.align==UIPosition.BOTTOM_RIGHT) {\t\r\n\t\t\t\t\tlObj.offsetX = GameStage.getInstance().safeZone.width - parent.x - lObj.item.x;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlObj.update = false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tUIPosition.setPosition(lObj.item, lObj.align, lObj.offsetX, lObj.offsetY);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * nettoie l'instance\r\n\t */\r\n\toverride public function destroy (): Void {\r\n\t\tclose();\r\n\t\tGameStage.getInstance().off(EventType.RESIZE, onResize);\r\n\t\tsuper.destroy();\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.ui;\r\n\r\n\r\n/**\r\n * Classe de base des Ecrans\r\n * Tous les crans d'interface hritent de cette classe\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass Screen extends UIComponent \r\n{\r\n\t\r\n\tpublic function new(pID:String=null) \r\n\t{\r\n\t\tsuper(pID);\r\n\t\tmodalImage = \"assets/black_bg.png\";\r\n\t\t\r\n\t}\r\n\t\r\n}","package com.isartdigital.perle.ui;\n\nimport com.isartdigital.utils.Config;\nimport com.isartdigital.utils.ui.Screen;\nimport pixi.core.sprites.Sprite;\nimport pixi.core.textures.Texture;\n\n/**\n * Preloader Graphique principal\n * @author Mathieu ANTHOINE\n */\nclass GraphicLoader extends Screen \n{\n\t\n\t/**\n\t * instance unique de la classe GraphicLoader\n\t */\n\tprivate static var instance: GraphicLoader;\n\n\tprivate var loaderBar:Sprite;\n\n\tpublic function new() \n\t{\n\t\tsuper();\n\t\tvar lBg:Sprite = new Sprite(Texture.fromImage(Config.url(Config.assetsPath+\"preload_bg.png\")));\n\t\tlBg.anchor.set(0.5, 0.5);\n\t\taddChild(lBg);\n\t\t\n\t\tloaderBar = new Sprite (Texture.fromImage(Config.url(Config.assetsPath+\"preload.png\")));\n\t\tloaderBar.anchor.y = 0.5;\n\t\tloaderBar.x = -loaderBar.width / 2;\n\t\taddChild(loaderBar);\n\t\tloaderBar.scale.x = 0;\n\t}\n\t\n\t/**\n\t * Retourne l'instance unique de la classe, et la cre si elle n'existait pas au pralable\n\t * @return instance unique\n\t */\n\tpublic static function getInstance (): GraphicLoader {\n\t\tif (instance == null) instance = new GraphicLoader();\n\t\treturn instance;\n\t}\n\t\n\t/**\n\t * mise  jour de la barre de chargement\n\t * @param\tpProgress\n\t */\n\tpublic function update (pProgress:Float): Void {\n\t\tloaderBar.scale.x = pProgress;\n\t}\n\t\n\t/**\n\t * dtruit l'instance unique et met sa rfrence interne  null\n\t */\n\toverride public function destroy (): Void {\n\t\tinstance = null;\n\t\tsuper.destroy();\n\t}\n\n}","package com.isartdigital.perle.ui;\r\n\r\nimport com.isartdigital.utils.game.factory.MovieClipAnimFactory;\r\nimport com.isartdigital.utils.game.StateGraphic;\r\n\r\n/**\r\n * ...\r\n * @author ambroise\r\n */\r\nclass UIElement extends StateGraphic{\r\n\r\n\tpublic function new(pAssetName:String) {\r\n\t\tsuper();\r\n\t\tfactory = new MovieClipAnimFactory();\r\n\t\tassetName = pAssetName;\r\n\t\tsetState(DEFAULT_STATE);\r\n\t}\r\n}","package com.isartdigital.perle.ui;\n\nimport com.isartdigital.perle.ui.hud.Hud;\nimport com.isartdigital.utils.game.GameStage;\nimport com.isartdigital.utils.ui.Popin;\nimport com.isartdigital.utils.ui.Screen;\nimport pixi.core.display.Container;\n\n/**\n * Manager (Singleton) en charge de grer les crans d'interface\n * @author Mathieu ANTHOINE\n */\nclass UIManager \n{\n\t\n\t/**\n\t * instance unique de la classe UIManager\n\t */\n\tprivate static var instance: UIManager;\n\t\n\t\n\t/**\n\t * tableau des popins ouverts\n\t */\n\tprivate var popins:Array<Popin>;\n\n\tpublic function new() \n\t{\n\t\tpopins = [];\n\t}\n\t\n\t/**\n\t * Retourne l'instance unique de la classe, et la cre si elle n'existait pas au pralable\n\t * @return instance unique\n\t */\n\tpublic static function getInstance (): UIManager {\n\t\tif (instance == null) instance = new UIManager();\n\t\treturn instance;\n\t}\n\t\n\t/**\n\t * Ajoute un cran dans le conteneur de Screens en s'assurant qu'il n'y en a pas d'autres\n\t * @param\tpScreen Screen  ouvrir\n\t */\n\tpublic function openScreen (pScreen: Screen): Void {\n\t\tcloseScreens();\n\t\tGameStage.getInstance().getScreensContainer().addChild(pScreen);\n\t\tpScreen.open();\n\t}\n\t\n\t/**\n\t * Supprime les crans dans le conteneur de Screens\n\t */\n\tpublic function closeScreens (): Void {\n\t\tvar lContainer:Container = GameStage.getInstance().getScreensContainer();\n\t\twhile (lContainer.children.length > 0) {\n\t\t\tvar lCurrent:Screen = cast(lContainer.getChildAt(lContainer.children.length - 1), Screen);\n\t\t\tlCurrent.interactive = false;\n\t\t\tlContainer.removeChild(lCurrent);\n\t\t\tlCurrent.close();\n\t\t}\n\t}\n\t\n\t/**\n\t * Ajoute un popin dans le conteneur de Popin\n\t * @param\tpPopin Popin  ouvrir\n\t */\n\tpublic function openPopin (pPopin: Popin): Void {\n\t\tpopins.push(pPopin);\n\t\tGameStage.getInstance().getPopinsContainer().addChild(pPopin);\n\t\tpPopin.open();\n\t}\n\t\n\t/**\n\t * Supprime le popin dans le conteneur de Screens\n\t */\n\tpublic function closeCurrentPopin (): Void {\n\t\tif (popins.length == 0) return;\n\t\tvar lCurrent:Popin = popins.pop();\n\t\tlCurrent.interactive = false;\n\t\tGameStage.getInstance().getPopinsContainer().removeChild(lCurrent);\n\t\tlCurrent.close();\n\t\t\n\t}\n\t\n\t/**\n\t * Ajoute le hud dans le conteneur de Hud\n\t */\n\tpublic function openHud (): Void {\n\t\tGameStage.getInstance().getHudContainer().addChild(Hud.getInstance());\n\t\tHud.getInstance().open();\n\t}\n\t\n\t/**\n\t * Retire le hud du conteneur de Hud\n\t */\n\tpublic function closeHud (): Void {\n\t\tGameStage.getInstance().getHudContainer().removeChild(Hud.getInstance());\n\t\tHud.getInstance().close();\n\t}\n\t\n\t/**\n\t * met l'interface en mode jeu\n\t */\n\t public function startGame (): Void {\n\t\tcloseScreens();\n\t\topenHud();\n\t}\n\t\n\t/**\n\t * dtruit l'instance unique et met sa rfrence interne  null\n\t */\n\tpublic function destroy (): Void {\n\t\tinstance = null;\n\t}\n\n}","package com.isartdigital.utils.ui;\r\nimport com.isartdigital.utils.events.MouseEventType;\r\nimport com.isartdigital.utils.events.TouchEventType;\r\nimport com.isartdigital.utils.game.BoxType;\r\nimport com.isartdigital.utils.game.StateGraphic;\r\nimport pixi.core.text.Text;\r\nimport pixi.interaction.EventTarget;\r\n\r\n/**\r\n * Classe de base des boutons\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass Button extends StateGraphic\r\n{\r\n\t\r\n\tprivate static inline var UP:Int = 0;\r\n\tprivate static inline var OVER:Int = 1;\r\n\tprivate static inline var DOWN:Int = 2;\r\n\t\r\n\tprivate var txt:Text;\r\n\t\r\n\tprivate var upStyle:TextStyle;\r\n\tprivate var overStyle:TextStyle;\r\n\tprivate var downStyle:TextStyle;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\t\r\n\t\tsuper();\r\n\t\tboxType = BoxType.SELF;\r\n\t\tinteractive = true;\r\n\t\tbuttonMode = true;\r\n\t\t\r\n\t\ton(MouseEventType.MOUSE_OVER, _mouseOver);\r\n\t\ton(MouseEventType.MOUSE_DOWN, _mouseDown);\r\n\t\ton(MouseEventType.CLICK, _click);\r\n\t\ton(MouseEventType.MOUSE_OUT, _mouseOut);\r\n\t\ton(MouseEventType.MOUSE_UP_OUTSIDE, _mouseOut);\r\n\t\t\r\n\t\ton(TouchEventType.TOUCH_START, _mouseDown);\r\n\t\ton(TouchEventType.TAP, _click);\r\n\t\ton(TouchEventType.TOUCH_END, _mouseOut);\r\n\t\ton(TouchEventType.TOUCH_END_OUTSIDE, _mouseOut);\r\n\r\n\t\tcreateText();\r\n\t\t\r\n\t\tstart();\r\n\t\t\r\n\t}\r\n\t\r\n\tprivate function createText ():Void {\r\n\t\tupStyle={ font: \"80px Arial\", fill: \"#000000\", align:\"center\"};\r\n\t\toverStyle={ font: \"80px Arial\", fill: \"#AAAAAA\", align:\"center\"};\r\n\t\tdownStyle = { font: \"80px Arial\", fill: \"#FFFFFF\", align:\"center\" };\r\n\t\ttxt = new Text(\"\",upStyle);\r\n\t\ttxt.anchor.set(0.5, 0.5);\r\n\t}\r\n\t\r\n\tpublic function setText(pText:String):Void {\r\n\t\ttxt.text=pText;\r\n\t}\r\n\t\r\n\toverride private function setModeNormal ():Void {\r\n\t\tsetState(DEFAULT_STATE);\t\t\r\n\t\tuntyped anim.gotoAndStop(UP);\r\n\t\taddChild(txt);\r\n\t\tsuper.setModeNormal();\r\n\t}\r\n\t\r\n\tprivate function _mouseVoid ():Void {}\r\n\r\n\tprivate function _click (pEvent:EventTarget): Void {\r\n\t\tuntyped anim.gotoAndStop(UP);\r\n\t\ttxt.style=upStyle;\r\n\t}\t\r\n\t\r\n\tprivate function _mouseDown (pEvent:EventTarget): Void {\r\n\t\tuntyped anim.gotoAndStop(DOWN);\r\n\t\ttxt.style=downStyle;\r\n\t}\r\n\t\r\n\tprivate function _mouseOver (pEvent:EventTarget): Void {\r\n\t\tuntyped anim.gotoAndStop(OVER);\r\n\t\ttxt.style=overStyle;\r\n\t}\r\n\t\r\n\tprivate function _mouseOut (pEvent:EventTarget): Void {\r\n\t\tuntyped anim.gotoAndStop(UP);\r\n\t\ttxt.style=upStyle;\r\n\t}\r\n\t\r\n\toverride public function destroy ():Void {\r\n\t\toff(MouseEventType.MOUSE_OVER, _mouseOver);\r\n\t\toff(MouseEventType.MOUSE_DOWN, _mouseDown);\r\n\t\toff(MouseEventType.CLICK, _click);\r\n\t\toff(MouseEventType.MOUSE_OUT, _mouseOut);\r\n\t\toff(MouseEventType.MOUSE_UP_OUTSIDE, _mouseOut);\r\n\t\t\r\n\t\toff(TouchEventType.TOUCH_START, _mouseDown);\r\n\t\toff(TouchEventType.TAP, _click);\r\n\t\toff(TouchEventType.TOUCH_END, _mouseOut);\r\n\t\toff(TouchEventType.TOUCH_END_OUTSIDE, _mouseOut);\r\n\t\t\r\n\t\tsuper.destroy();\r\n\t}\r\n}","package com.isartdigital.perle.ui.hud;\r\nimport com.isartdigital.perle.game.sprites.Building;\r\nimport com.isartdigital.utils.game.factory.MovieClipAnimFactory;\r\nimport com.isartdigital.utils.ui.Button;\r\nimport pixi.interaction.EventTarget;\r\n\r\n/**\r\n * ...\r\n * @author ambroise\r\n */\r\nclass ButtonBuild extends Button{\r\n\r\n\t\r\n\t\r\n\tpublic function new(?pAssetName:String) {\r\n\t\tfactory = new MovieClipAnimFactory();\r\n\t\t// assetName before because the super() does start.\r\n\t\tif (pAssetName != null)\r\n\t\t\tassetName = pAssetName;\t\r\n\t\tsuper();\r\n\t}\r\n\t\r\n\t// _mouseDown better then _click for drag and drop on smartphone\r\n\toverride function _mouseDown(pEvent:EventTarget):Void {\r\n\t\tsuper._mouseDown(pEvent);\r\n\t\tBuilding.onClickHudBuilding(assetName.substring(assetName.indexOf(\"Button\"),- 1));\r\n\t}\r\n\t\r\n}","package com.isartdigital.perle.ui.hud;\r\n\r\nimport com.isartdigital.perle.ui.UIElement;\r\nimport com.isartdigital.perle.ui.hud.ButtonBuild;\r\nimport com.isartdigital.utils.ui.Screen;\r\nimport com.isartdigital.utils.ui.UIPosition;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.math.Point;\r\n\r\n/**\r\n * Classe en charge de grer les informations du Hud\r\n * @author Ambroise RABIER\r\n */\r\nclass Hud extends Screen \r\n{\r\n\tprivate static inline var MARGIN_RIGHT:Int = 10;\r\n\t// todo ? display:flex ?\r\n\tprivate var BUTTONS_NAMES(default, null):Array<String> = [\r\n\t\t\"FactoryButton\",\r\n\t\t\"HouseButton\",\r\n\t\t\"TreesButton\",\r\n\t\t\"VillaButton\"\r\n\t];\r\n\tprivate var BUTTON_START_POINT(default, null):Point = new Point(-340, -80);\r\n\t\r\n\tprivate static var instance: Hud;\r\n\t\r\n\t/*private var hudTopLeft:Sprite;\r\n\tprivate var hudBottomLeft:Container;*/\r\n\tprivate var hudBottom:Container;\r\n\tprivate var buildingBackground:UIElement;\r\n\tprivate var buttonMap:Map<String, ButtonBuild> = new Map<String, ButtonBuild>();\r\n\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la cre si elle n'existait pas au pralable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): Hud {\r\n\t\tif (instance == null) instance = new Hud();\r\n\t\treturn instance;\r\n\t}\t\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\tmodal = false;\r\n\t\t\r\n\t\thudBottom = new Container();\r\n\t\tbuildingBackground = new UIElement(\"Hud\");\r\n\t\thudBottom.addChild(buildingBackground);\r\n\t\t\r\n\t\tcreateButtons(hudBottom, BUTTONS_NAMES, BUTTON_START_POINT, MARGIN_RIGHT);\r\n\t\t\r\n\t\taddChild(hudBottom);\r\n\t\tpositionables.push({\r\n\t\t\titem:hudBottom,\r\n\t\t\t// added UIPosition.BOTTOM_CENTER\r\n\t\t\talign:UIPosition.BOTTOM_CENTER,\r\n\t\t\toffsetX:0,\r\n\t\t\toffsetY:50\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Create and set position of the buttons inside hudBottom\r\n\t */\r\n\tprivate function createButtons(pContainer:Container, pNames:Array<String>, pStartPos:Point, pMargin:Int):Void {\r\n\t\tfor (i in 0...pNames.length) {\r\n\t\t\tbuttonMap[pNames[i]] = new ButtonBuild(pNames[i]);\r\n\t\t\tif (pNames[i] == pNames[0]) {\r\n\t\t\t\tbuttonMap[pNames[i]].y += pStartPos.y;\r\n\t\t\t\tbuttonMap[pNames[i]].x += pStartPos.x;\r\n\t\t\t} else {\r\n\t\t\t\tbuttonMap[pNames[i]].y = buttonMap[pNames[0]].y;\r\n\t\t\t\tbuttonMap[pNames[i]].x = buttonMap[pNames[i-1]].x + buttonMap[pNames[i-1]].width + pMargin;\r\n\t\t\t}\r\n\t\t\tpContainer.addChild(buttonMap[pNames[i]]);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * dtruit l'instance unique et met sa rfrence interne  null\r\n\t */\r\n\toverride public function destroy (): Void {\r\n\t\tinstance = null;\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n}","package com.isartdigital.utils ;\r\nimport haxe.Json;\r\nimport js.Browser;\r\nimport js.html.Storage;\r\n\r\n/**\r\n * Classe utilitaire contenant les donnes de configuration du jeu\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass Config \r\n{\r\n\t\r\n\t/**\r\n\t * nom du jeu\r\n\t */\r\n\tpublic static var gameName (get,never):String;\r\n\t\r\n\t/**\r\n\t * version de l'application\r\n\t */\r\n\tpublic static var version (get,never):String;\r\n\t\r\n\t/**\r\n\t * langue courante\r\n\t */\r\n\tpublic static var language (get,never): String;\r\n\t\r\n\t/**\r\n\t * langues disponibles\r\n\t */\r\n\tpublic static var languages (get,never): Array<String>;\r\n\t\r\n\t/**\r\n\t * dfini si le jeu est en mode \"debug\" ou pas (si prvu dans le code du jeu)\r\n\t */\r\n\tpublic static var debug (get, never): Bool;\r\n\t\r\n\t/**\r\n\t * dfini si il faut afficher les fps ou non\r\n\t */\r\n\tpublic static var fps (get,never): Bool;\r\n\r\n\t/**\r\n\t * dfini si il faut afficher le qrcode ou non\r\n\t */\r\n\tpublic static var qrcode (get, never): Bool;\t\r\n\t\r\n\t/** \r\n\t * chemin du dossier de langues\r\n\t */\r\n\tpublic static var langPath (get, never): String;\r\n\t\r\n\t/** \r\n\t * chemin du dossier des fichiers textes\r\n\t */\r\n\tpublic static var txtsPath (get, never): String;\r\n\t\r\n\t/** \r\n\t * chemin du dossier d'assets graphiques\r\n\t */\r\n\tpublic static var assetsPath (get, never): String;\r\n\t\r\n\t/** \r\n\t * chemin du dossier de sons\r\n\t */\r\n\tpublic static var soundsPath (get, never): String;\r\n\r\n\t/** \r\n\t * chemin du dossier des polices de caractres\r\n\t */\r\n\tpublic static var fontsPath (get, never): String;\t\r\n\t\r\n\t/*\r\n\t * utiliser le cache du navigateur ou non\r\n\t */\r\n\tpublic static var cache(default, null):Bool = true;\r\n\t\r\n\t/**\r\n\t * conteneur des donnes de configuration\r\n\t */\r\n\tpublic static var data (get, never):Dynamic;\r\n\tprivate static var _data:Dynamic={};\r\n\t\r\n\tpublic static function init(pConfig:Json): Void {\t\t\r\n\t\tfor (i in Reflect.fields(pConfig)) Reflect.setField(_data, i, Reflect.field(pConfig, i));\t\r\n\t\t\r\n\t\tif (_data.version == null || _data.version==\"\") _data.version = \"0.0.0\";\r\n\t\tif (_data.gameName == null) _data.gameName = \"\";\r\n\t\t\r\n\t\tvar lStorage:Storage = Browser.getLocalStorage();\r\n\t\t\r\n\t\tvar lVersion:String = lStorage.getItem(gameName)==null ? null : Json.parse(lStorage.getItem(gameName)).version;\r\n\t\tif (lVersion != null) cache = version == lVersion;\r\n\t\tlStorage.setItem(gameName, Json.stringify({version:version}));\r\n\t\t\t\t\r\n\t\tif (_data.language == null || _data.language==\"\") _data.language = Browser.window.navigator.language.substr(0, 2);\r\n\t\tif (_data.languages==\"\" || _data.languages == []) _data.languages.push(_data.language);\r\n\t\tif (_data.debug == null || _data.debug==\"\") _data.debug = false;\r\n\t\tif (_data.fps == null || _data.fps==\"\") _data.fps = false;\r\n\t\tif (_data.qrcode == null || _data.qrcode==\"\") _data.qrcode = false;\r\n\r\n\t\tif (_data.langPath == null) _data.langPath = \"\";\r\n\t\tif (_data.txtsPath == null) _data.txtsPath = \"\";\r\n\t\tif (_data.assetsPath == null) _data.assetsPath = \"\";\r\n\t\tif (_data.fontsPath == null) _data.fontsPath = \"\";\r\n\t\tif (_data.soundsPath == null) _data.soundsPath = \"\";\r\n\t\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Retourne l'url complte (chemin+version)\r\n\t * @return url complte\r\n\t */\r\n\tpublic static function url (pPath:String):String {\r\n\t\treturn pPath + \"?\" + version;\r\n\t}\r\n\t\r\n\tprivate static function get_data ():Dynamic {\r\n\t\treturn _data;\r\n\t}\r\n\r\n\tprivate static function get_gameName ():String {\r\n\t\treturn _data.gameName;\r\n\t}\t\r\n\t\r\n\tprivate static function get_version ():String {\r\n\t\treturn _data.version;\r\n\t}\r\n\t\r\n\tprivate static function get_language ():String {\r\n\t\treturn data.language;\r\n\t}\r\n\t\r\n\tprivate static function get_languages ():Array<String> {\r\n\t\treturn data.languages;\r\n\t}\r\n\t\r\n\tprivate static function get_debug ():Bool {\r\n\t\treturn data.debug;\r\n\t}\r\n\t\r\n\tprivate static function get_fps ():Bool {\r\n\t\treturn data.fps;\r\n\t}\r\n\t\r\n\tprivate static function get_qrcode ():Bool {\r\n\t\treturn data.qrcode;\r\n\t}\r\n\t\r\n\tprivate static function get_langPath ():String {\r\n\t\treturn _data.langPath;\r\n\t}\r\n\r\n\tprivate static function get_txtsPath ():String {\r\n\t\treturn _data.txtsPath;\r\n\t}\t\r\n\t\r\n\tprivate static function get_assetsPath ():String {\r\n\t\treturn _data.assetsPath;\r\n\t}\r\n\t\r\n\tprivate static function get_fontsPath ():String {\r\n\t\treturn _data.fontsPath;\r\n\t}\r\n\t\r\n\tprivate static function get_soundsPath ():String {\r\n\t\treturn _data.soundsPath;\r\n\t}\r\n\r\n}","package com.isartdigital.utils;\r\n\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\nimport js.Browser;\r\nimport js.html.Image;\r\n\r\n\r\n/**\r\n * Classe de Debug\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass Debug\r\n{\r\n\r\n\t/**\r\n\t * instance unique de la classe Main\r\n\t */\r\n\tprivate static var instance: Debug;\t\r\n\t\r\n\tpublic var fps:Perf;\r\n\tprivate static inline var QR_SIZE:Float = 0.35;\r\n\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la cre si elle n'existait pas au pralable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): Debug {\r\n\t\tif (instance == null) instance = new Debug();\r\n\t\treturn instance;\r\n\t}\t\r\n\t\r\n\tprivate function new() {}\r\n\t\r\n\t/**\r\n\t * initialisation du dbogueur\r\n\t * @param\tpGameDispatcher\r\n\t */\r\n\tpublic function init():Void \r\n\t{\r\n\t\tif (Config.fps) fps = new Perf(\"TL\");\r\n\t\t\r\n\t\tif (Config.qrcode && !DeviceCapabilities.isCocoonJS) \r\n\t\t{\r\n\t\t\tvar lQr:Image = new Image();\r\n\t\t\tlQr.style.position = 'absolute';\r\n\t\t\tlQr.style.right = '0px';\r\n\t\t\tlQr.style.bottom = '0px';\r\n\t\t\tvar lSize:Int = Std.int(QR_SIZE * DeviceCapabilities.getSizeFactor());\r\n\t\t\tlQr.src = 'https://chart.googleapis.com/chart?chs='+lSize+'x'+lSize+'&cht=qr&chl=' + Browser.location.href + '&choe=UTF-8';\r\n\t\t\tBrowser.document.body.appendChild(lQr);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic static function error (pArg:Dynamic): Void {\r\n\t\tBrowser.console.error(pArg);\r\n\t}\r\n\t\r\n\tpublic static function warn (pArg:Dynamic): Void {\r\n\t\tBrowser.console.warn (pArg);\r\n\t}\r\n\r\n\tpublic static function table (pArg:Dynamic): Void {\r\n\t\tBrowser.console.table (pArg);\r\n\t}\r\n\r\n\tpublic static function info (pArg:Dynamic): Void {\r\n\t\tBrowser.console.info (pArg);\r\n\t}\r\n\t\r\n\tpublic function destroy (): Void {}\r\n\r\n}","package com.isartdigital.utils.game;\r\n\r\nimport pixi.core.display.Container;\r\nimport pixi.core.display.DisplayObject;\r\nimport pixi.core.graphics.Graphics;\r\nimport pixi.core.graphics.GraphicsData;\r\nimport pixi.core.math.Point;\r\nimport pixi.core.math.shapes.Rectangle;\r\nimport pixi.core.sprites.Sprite;\r\n\r\n/**\r\n * Classe utilitaire permettant de tester diverses collisions entre boites, formes et points\r\n * @author Mathieu ANTHOINE\r\n * @version 0.9.0\r\n */\r\nclass CollisionManager \r\n{\r\n\r\n\tprivate function new() {}\r\n\t\t\r\n\t/**\r\n\t * test la collision entre les boites englobantes de deux DisplayObject\r\n\t * @param\tpObjectA objet  tester\r\n\t * @param\tpObjectB objet  tester\r\n\t * @return rsultat du test de collision\r\n\t */\r\n\tpublic static function hitTestObject(pObjectA:DisplayObject, pObjectB:DisplayObject):Bool {\r\n\t\t\r\n\t\treturn getIntersection(pObjectA.getBounds(), pObjectB.getBounds());\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * test la collision entre l'objet et un point (prend en compte la hitArea si elle est dfinie). Lgre adaptation de la mthode hitTest de la classe InteractionManager\r\n\t * @param\tpObject objet  tester\r\n\t * @param\tpPoint point exprim en coordonnes globales\r\n\t * @return\trsultat du test de collision\r\n\t */\r\n\tpublic static function hitTestPoint (pItem:DisplayObject, pGlobalPoint:Point):Bool {\r\n\r\n\t\tvar lPoint:Point=pItem.toLocal(pGlobalPoint);\r\n\t\tvar x:Float = lPoint.x;\r\n\t\tvar y:Float = lPoint.y;\r\n\t\t\r\n\t\tif (pItem.hitArea != null && pItem.hitArea.contains != null) {\r\n\t\t\treturn pItem.hitArea.contains(x, y);\t\t\r\n\t\t}\r\n\t\telse if (Std.is(pItem, Sprite)) {\t\r\n\t\t\t\r\n\t\t\tvar lSprite:Sprite = cast(pItem, Sprite);\r\n\t\t\t\r\n\t\t\tvar lWidth:Float = lSprite.texture.frame.width;\r\n\t\t\tvar lHeight:Float = lSprite.texture.frame.height;\r\n\t\t\tvar lX1:Float = -lWidth * lSprite.anchor.x;\r\n\t\t\tvar lY1:Float;\r\n\t \r\n\t\t\tif (x > lX1 && x < lX1 + lWidth)\r\n\t\t\t{\r\n\t\t\t\tlY1 = -lHeight * lSprite.anchor.y;\r\n\t\t\t\tif (y > lY1 && y < lY1 + lHeight) return true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (Std.is(pItem, Graphics)) {\r\n\t\t\tvar lGraphicsData:Array<GraphicsData> = untyped pItem.graphicsData;\t\t\r\n\t\t\tfor (i in 0...lGraphicsData.length) {\r\n\t\t\t\tvar lData = lGraphicsData[i];\r\n\t\t\t\t // only deal with fills..\r\n\t\t\t\tif (! untyped lData.fill) continue;\t\t\t\r\n\t\t\t\tif(lData.shape!=null && lData.shape.contains(x, y)) return true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (Std.is (pItem, Container)) {\r\n\t\t\tvar lContainer:Container = cast(pItem, Container);\r\n\t\t\tvar lLength:Int = lContainer.children.length;\r\n\t\t\tfor (i in 0...lLength) {\r\n\t\t\t\tif (hitTestPoint(lContainer.children[i], pGlobalPoint)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tpHitBoxA boite englobante principale\r\n\t * @param\tpHitBoxB boite englobante principale\r\n\t * @param\tpPointsA liste de points de collision\r\n\t * @param\tpPointsB liste de points de collision\r\n\t * @return  rsultat de la collision\r\n\t */\r\n\tpublic static function hasCollision (pHitBoxA:DisplayObject, pHitBoxB:DisplayObject, pPointsA:Array<Point> = null, pPointsB:Array<Point> = null): Bool {\r\n\t\tif (pHitBoxA == null || pHitBoxB == null) return false;\r\n\t\t\r\n\t\t// test des boites de collision principale\r\n\t\tif (!hitTestObject(pHitBoxA,pHitBoxB)) return false;\r\n\t\t\r\n\t\t// si il n'y a pas de boites de collision plus prcises on valide\r\n\t\tif (pPointsA == null && pPointsB == null) return true;\t\t\t\r\n\t\t\r\n\t\t// test points vers la forme de la boite principale \r\n\t\tif (pPointsA!=null) return testPoints(pPointsA, pHitBoxB);\r\n\t\tif (pPointsB!=null) return testPoints(pPointsB, pHitBoxA);\r\n\t\t\r\n\t\treturn false;\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * teste l'intersection des boites englobantes\r\n\t * @param\tpRectA rectangle  tester\r\n\t * @param\tpRectB rectangle  tester\r\n\t * @return rsultat de l'intersection\r\n\t */\r\n\tprivate static function getIntersection (pRectA:Rectangle, pRectB:Rectangle): Bool {\r\n\t\treturn !(pRectB.x > (pRectA.x + pRectA.width) || (pRectB.x + pRectB.width) < pRectA.x || pRectB.y > (pRectA.y + pRectA.height) || (pRectB.y + pRectB.height) < pRectA.y);\r\n\t}\r\n\t\r\n\t/**\r\n\t * \r\n\t * @param\tpHitPoints liste de points de collision (dont le repre est dj converti en global)\r\n\t * @param\tpHitBox boite englobante\r\n\t * @return  rsultat de la collision\r\n\t */\r\n\tprivate static function testPoints (pHitPoints:Array<Point>, pHitBox:DisplayObject): Bool {\r\n\t\tvar lLength:Int = pHitPoints.length;\r\n\t\tfor (i in 0...lLength) {\r\n\t\t\tif (hitTestPoint(pHitBox,pHitPoints[i])) return true;\r\n\t\t}\r\n\t\t\t\r\n\t\treturn false;\r\n\t\t\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.game;\r\n\r\nimport com.isartdigital.utils.events.EventType;\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.math.shapes.Rectangle;\r\n\r\n/**\r\n * Classe en charge de mettre en place la structure graphique du jeu (conteneurs divers)\r\n * et la gestion du redimensionnement de la zone de jeu en fonction du contexte\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass GameStage extends Container\r\n{\r\n\t\r\n\t/**\r\n\t * instance unique de la classe GameStage\r\n\t */\r\n\tprivate static var instance: GameStage;\r\n\r\n\tprivate var _alignMode: GameStageAlign = GameStageAlign.CENTER;\t\r\n\r\n\tprivate var _scaleMode: GameStageScale = GameStageScale.SHOW_ALL;\r\n\t\r\n\tprivate var _safeZone:Rectangle= new Rectangle(0,0,SAFE_ZONE_WIDTH,SAFE_ZONE_HEIGHT);\r\n\r\n\t/**\r\n\t * callback de render\r\n\t */\r\n\tprivate var _render:Void->Void;\t\r\n\t\r\n\t/**\r\n\t * largeur minimum pour le contenu visible par dfaut\r\n\t */\r\n\tprivate static inline var SAFE_ZONE_WIDTH: Int = 2048;\r\n\r\n\t/**\r\n\t * hauteur minimum pour le contenu visible par dfaut\r\n\t */\r\n\tprivate static inline var SAFE_ZONE_HEIGHT: Int = 1366;\r\n\t\t\r\n\t/**\r\n\t * conteneur des pop-in\r\n\t */\r\n\tprivate var popinsContainer:Container;\r\n\t\r\n\t/**\r\n\t * conteneur du Hud\r\n\t */\r\n\tprivate var hudContainer:Container;\r\n\t\r\n\t/**\r\n\t * conteneur des crans d'interface\r\n\t */\r\n\tprivate var screensContainer:Container;\r\n\t\r\n\t/**\r\n\t * conteneur du jeu\r\n\t */\r\n\tprivate var gameContainer:Container;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t\t\t\r\n\t\tgameContainer = new Container();\t\t\r\n\t\taddChild(gameContainer);\r\n\t\t\r\n\t\tscreensContainer = new Container();\r\n\t\taddChild(screensContainer);\r\n\t\t\r\n\t\thudContainer = new Container();\r\n\t\taddChild(hudContainer);\r\n\t\t\r\n\t\tpopinsContainer = new Container();\r\n\t\taddChild(popinsContainer);\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * Initialisation de la zone de jeu\r\n\t * @param   pRender Callback qui fait le rendu pour mettre  jour le systme de coordonnes avant de reconstruire d'ventuels lments\r\n\t * @param\tpSafeZoneWidth largeur de la safeZone\r\n\t * @param\tpSafeZoneHeight hauteur de la safeZone\r\n\t * @param\tcenterGameContainer centrer ou pas le conteneur des lements InGame\r\n\t * @param\tcenterScreensContainer centrer ou pas le conteneur des Ecrans\r\n\t * @param\tcenterPopinContainer centrer ou pas le conteneur des Popins\r\n\t * @param\tcenterHudContainer centrer ou pas le conteneur\r\n\t */\r\n\tpublic function init (pRender:Void->Void, ?pSafeZoneWidth:UInt = SAFE_ZONE_WIDTH, ?pSafeZoneHeight:UInt = SAFE_ZONE_WIDTH, ?pCenterGameContainer:Bool = false, ?pCenterScreensContainer:Bool = true, ?pCenterPopinContainer:Bool = true, ?pCenterHudContainer:Bool = false):Void {\r\n\t\t\r\n\t\t_safeZone = new Rectangle (0, 0, pSafeZoneWidth, pSafeZoneHeight);\r\n\t\t\r\n\t\tif (pCenterGameContainer) {\r\n\t\t\tgameContainer.x = safeZone.width / 2;\r\n\t\t\tgameContainer.y = safeZone.height / 2;\r\n\t\t}\r\n\t\t\r\n\t\tif (pCenterScreensContainer) {\r\n\t\t\tscreensContainer.x = safeZone.width / 2;\r\n\t\t\tscreensContainer.y = safeZone.height / 2;\r\n\t\t}\r\n\t\t\r\n\t\tif (pCenterPopinContainer) {\r\n\t\t\tpopinsContainer.x = safeZone.width / 2;\r\n\t\t\tpopinsContainer.y = safeZone.height / 2;\r\n\t\t}\r\n\t\t\r\n\t\tif (pCenterHudContainer) {\r\n\t\t\thudContainer.x = safeZone.width / 2;\r\n\t\t\thudContainer.y = safeZone.height / 2;\r\n\t\t}\r\n\t\t\r\n\t\t_render = pRender;\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la cre si elle n'existait pas au pralable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): GameStage {\r\n\t\tif (instance == null) instance = new GameStage();\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Redimensionne la scne du jeu en fonction de la taille disponible pour l'affichage\r\n\t */\r\n\tpublic function resize (): Void {\r\n\t\t\r\n\t\tvar lWidth:UInt = DeviceCapabilities.width;\r\n\t\tvar lHeight:UInt = DeviceCapabilities.height;\r\n\t\t\t\t\r\n\t\tvar lRatio:Float = Math.round(10000 * Math.min( lWidth / safeZone.width, lHeight / safeZone.height)) / 10000;\r\n\t\t\r\n\t\tif (scaleMode == GameStageScale.SHOW_ALL) scale.set(lRatio, lRatio);\r\n\t\telse scale.set (DeviceCapabilities.textureRatio, DeviceCapabilities.textureRatio);\r\n\t\t\r\n\t\tif (alignMode == GameStageAlign.LEFT || alignMode == GameStageAlign.TOP_LEFT || alignMode == GameStageAlign.BOTTOM_LEFT) x = 0;\r\n\t\telse if (alignMode == GameStageAlign.RIGHT || alignMode == GameStageAlign.TOP_RIGHT || alignMode == GameStageAlign.BOTTOM_RIGHT) x = lWidth - safeZone.width * scale.x;\r\n\t\telse x = (lWidth - safeZone.width * scale.x) / 2;\r\n\t\t\r\n\t\tif (alignMode == GameStageAlign.TOP || alignMode == GameStageAlign.TOP_LEFT || alignMode == GameStageAlign.TOP_RIGHT) y = 0;\r\n\t\telse if (alignMode == GameStageAlign.BOTTOM || alignMode == GameStageAlign.BOTTOM_LEFT || alignMode == GameStageAlign.BOTTOM_RIGHT) y = lHeight - safeZone.height * scale.y;\r\n\t\telse y = (lHeight - safeZone.height * scale.y) / 2;\r\n\t\t\r\n\t\t\r\n\t\trender();\r\n\t\t\r\n\t\temit (EventType.RESIZE, { width:lWidth, height:lHeight } );\r\n\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * fait le rendu de l'cran\r\n\t */\r\n\tpublic function render (): Void {\r\n\t\tif (_render!=null) _render();\r\n\t}\t\r\n\t\r\n\t/*\r\n\t * style d'alignement au sein de l'cran\r\n\t */\r\n\tpublic var alignMode (get, set) : GameStageAlign;\r\n\t\r\n\tprivate function get_alignMode( ) { \r\n\t\treturn _alignMode;\r\n\t}\r\n\t\r\n\tprivate function set_alignMode(pAlign:GameStageAlign) {\r\n\t\t_alignMode = pAlign;\r\n\t\tresize();\r\n\t\treturn _alignMode;\r\n\t}\r\n\r\n\t/*\r\n\t * style de redimensionnement au sein de l'cran\r\n\t */\r\n\tpublic var scaleMode (get, set) : GameStageScale;\r\n\t\r\n\tprivate function get_scaleMode( ) { \r\n\t\treturn _scaleMode;\r\n\t}\r\n\t\r\n\tprivate function set_scaleMode(pScale:GameStageScale) {\r\n\t\t_scaleMode = pScale;\r\n\t\tresize();\r\n\t\treturn _scaleMode;\r\n\t}\t\r\n\t\r\n\t/**\r\n\t * Rectangle dlimitant le contenu minimum visible\r\n\t */\r\n\tpublic var safeZone (get, never):Rectangle;\r\n\t\r\n\tprivate function get_safeZone () {\r\n\t\treturn _safeZone;\r\n\t}\r\n\r\n\t/**\r\n\t * accs en lecture au conteneur de jeu\r\n\t * @return gameContainer\r\n\t */\r\n\tpublic function getGameContainer (): Container {\r\n\t\treturn gameContainer;\r\n\t}\r\n\t\r\n\t/**\r\n\t * accs en lecture au conteneur d'crans\r\n\t * @return screensContainer\r\n\t */\r\n\tpublic function getScreensContainer (): Container {\r\n\t\treturn screensContainer;\r\n\t}\r\n\t\r\n\t/**\r\n\t * accs en lecture au conteneur de hud\r\n\t * @return hudContainer\r\n\t */\r\n\tpublic function getHudContainer (): Container {\r\n\t\treturn hudContainer;\r\n\t}\r\n\t\r\n\t/**\r\n\t * accs en lecture au conteneur de PopIn\r\n\t * @return popinContainer\r\n\t */\r\n\tpublic function getPopinsContainer (): Container {\r\n\t\treturn popinsContainer;\r\n\t}\r\n\t\t\t\t\r\n\t/**\r\n\t * dtruit l'instance unique et met sa rfrence interne  null\r\n\t */\r\n\toverride public function destroy (): Void {\r\n\t\tinstance = null;\r\n\t\tsuper.destroy(true);\r\n\t}\r\n\r\n}","package com.isartdigital.utils.game.factory;\r\n\r\nimport pixi.core.display.Container;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu Anthoine\r\n */\r\nclass AnimFactory\r\n{\r\n\r\n\tprivate var anim:Container;\r\n\t\r\n\tprivate function new() \r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function getAnim ():Container {\r\n\t\treturn anim;\r\n\t}\r\n\t\r\n\tpublic function create (pID:String):Container {\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tpublic function update (pId:String):Void {\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function setFrame (?pAutoPlay:Bool=true, ?pStart:UInt = 0): Void {\r\n\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.game.factory;\r\n\r\nimport pixi.core.display.Container;\r\nimport pixi.flump.Movie;\r\n\r\n\t\r\n/**\r\n * ...\r\n * @author Mathieu Anthoine\r\n */\r\nclass FlumpMovieAnimFactory extends AnimFactory \r\n{\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\t\r\n\toverride public function getAnim ():Container {\r\n\t\tif (anim !=null) {\r\n\t\t\tanim.parent.removeChild(anim);\r\n\t\t\tanim.destroy();\r\n\t\t\tanim = null;\r\n\t\t}\r\n\t\treturn super.getAnim();\r\n\t}\r\n\t\r\n\toverride public function create (pID:String):Container {\r\n\t\tanim = new Movie(pID);\r\n\t\treturn anim;\r\n\t}\r\n\t\r\n\toverride public function setFrame (?pAutoPlay:Bool=true, ?pStart:UInt = 0): Void {\r\n\t\tvar lAnim:Movie = cast(anim, Movie);\r\n\t\t\r\n\t\tif (lAnim.totalFrames > 1) {\r\n\t\t\tif (pAutoPlay) lAnim.gotoAndPlay(pStart);\r\n\t\t\telse lAnim.gotoAndStop(pStart);\r\n\t\t}\r\n\t\telse if (!pAutoPlay) lAnim.stop();\r\n\t}\r\n\r\n}","package com.isartdigital.utils.game.factory;\r\n\r\nimport pixi.core.display.Container;\r\nimport pixi.flump.Sprite;\r\n\r\n\t\r\n/**\r\n * ...\r\n * @author Mathieu Anthoine\r\n */\r\nclass FlumpSpriteAnimFactory extends AnimFactory \r\n{\r\n\t\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\t\r\n\toverride public function getAnim ():Container {\r\n\t\tif (anim !=null) {\r\n\t\t\tanim.parent.removeChild(anim);\r\n\t\t\tanim.destroy();\r\n\t\t\tanim = null;\r\n\t\t}\r\n\t\treturn super.getAnim();\r\n\t}\r\n\t\r\n\toverride public function create (pID:String):Container {\r\n\t\tanim = new Sprite(pID);\r\n\t\treturn anim;\r\n\t}\r\n\t\r\n\toverride public function setFrame (?pAutoPlay:Bool=true, ?pStart:UInt = 0): Void {\r\n\t}\r\n\r\n}","package com.isartdigital.utils.game.factory;\r\nimport haxe.Json;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.math.Point;\r\nimport pixi.core.textures.Texture;\r\nimport pixi.extras.MovieClip;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu Anthoine\r\n */\r\nclass MovieClipAnimFactory extends AnimFactory\r\n{\r\n\r\n\t/**\r\n\t * longueur de la numrotation des textures\r\n\t */\r\n\tpublic static var textureDigits (default, set) :UInt = 4;\r\n\t\r\n\tprivate static function set_textureDigits (pDigits:UInt) : UInt {\r\n\t\tdigits = \"\";\r\n\t\tfor (i in 0...pDigits) digits += \"0\";\r\n\t\treturn textureDigits = pDigits;\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * dfinition des textures (nombre d'images)\r\n\t */\r\n\tprivate static var texturesDefinition:Map<String,Int>;\r\n\t\r\n\t/**\r\n\t * dfinition des ancres des textures\r\n\t */\r\n\tprivate static var texturesAnchor:Map<String,Point>;\r\n\t\r\n\t/**\r\n\t * cache des textures de tous les StateGraphic\r\n\t */\r\n\tprivate static var texturesCache:Map<String,Array<Texture>>;\r\n\t\r\n\t/**\r\n\t * nombre de zro  ajouter pour construire un nom de frame\r\n\t */\r\n\tprivate static var digits:String;\t\r\n\t\r\n\t/**\r\n\t * Analyse et cre les dfinitions de textures\r\n\t * @param\tpJson objet contenant la description des assets\r\n\t */\r\n\tstatic public function addTextures (pJson:Json): Void {\r\n\t\t\r\n\t\tvar lFrames:Dynamic = Reflect.field(pJson, \"frames\");\r\n\t\t\r\n\t\tif (texturesDefinition == null) texturesDefinition = new Map<String,Int>();\r\n\t\tif (texturesAnchor == null) texturesAnchor = new Map<String,Point>();\r\n\t\tif (texturesCache == null) texturesCache = new Map<String,Array<Texture>>();\r\n\t\tif (digits == null) textureDigits = textureDigits;\r\n\t\t\r\n\t\tvar lID:String;\r\n\t\tvar lNum:Int;\r\n\t\t\r\n\t\tfor (lName in Reflect.fields(lFrames)) {\r\n\t\t\t\r\n\t\t\tlID = lName.split(\".\")[0];\r\n\t\t\tlNum = Std.parseInt(lID.substr(-1*textureDigits));\r\n\t\t\tif (lNum != null) lID = lID.substr(0, lID.length - textureDigits);\r\n\t\t\t\r\n\t\t\tif (texturesDefinition[lID] == null) texturesDefinition[lID] = lNum == null ? 1 : lNum;\r\n\t\t\telse if (lNum > texturesDefinition[lID]) texturesDefinition[lID] = lNum;\r\n\t\t\t\r\n\t\t\tif (texturesAnchor[lID] == null) texturesAnchor[lID] = Reflect.field(lFrames, lName).pivot;\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Vide le cache de textures correspondant  la description passe en paramtres\r\n\t * @param\tpJson objet contenant la description des assets\r\n\t */\r\n\tstatic public function clearTextures (pJson:Json): Void {\r\n\t\t\r\n\t\tvar lFrames:Dynamic = Reflect.field(pJson, \"frames\");\r\n\t\t\r\n\t\tif (texturesDefinition == null) return;\r\n\t\t\r\n\t\tvar lID:String;\r\n\t\tvar lNum:Int;\r\n\t\t\r\n\t\tfor (lID in Reflect.fields(lFrames)) {\r\n\t\t\t\r\n\t\t\tlID = lID.split(\".\")[0];\r\n\t\t\tlNum = Std.parseInt(lID.substr(-1*textureDigits));\r\n\t\t\tif (lNum != null) lID = lID.substr(0, lID.length - textureDigits);\r\n\t\t\t\r\n\t\t\ttexturesDefinition[lID] = null;\r\n\t\t\ttexturesAnchor[lID] = null;\r\n\t\t\ttexturesCache[lID] = null;\r\n\t\t}\r\n\t}\t\r\n\t\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t\r\n\t}\r\n\t\r\n\toverride public function create (pID:String):Container {\r\n\t\tanim = new MovieClip(getTextures(pID));\r\n\t\tcast (anim,MovieClip).anchor = texturesAnchor[pID];\r\n\t\treturn anim;\r\n\t}\r\n\t\r\n\toverride public function update (pID:String):Void {\r\n\t\tvar lAnim:MovieClip = cast(anim, MovieClip);\r\n\t\tlAnim.textures = getTextures(pID);\r\n\t\tlAnim.anchor = texturesAnchor[pID];\r\n\t}\r\n\t\r\n\toverride public function setFrame (?pAutoPlay:Bool=true, ?pStart:UInt = 0): Void {\r\n\t\tvar lAnim:MovieClip = cast(anim, MovieClip);\t\t\r\n\t\tlAnim.gotoAndStop(pStart);\r\n\t\tif (pAutoPlay) lAnim.play();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Cherche dans le cache gnral de textures le tableau de textures correspondant au state et le retourne.\r\n\t * Si le tableau de texture n'xiste pas, il le cre et le stocke dans le cache\r\n\t * @param\tpID ID complet de l'anim\r\n\t * @return\tle tableau de texture correspondant au state de l'instance\r\n\t */\r\n\tprivate function getTextures(pID:String):Array<Texture> {\r\n\t\t\r\n\t\tif (texturesCache[pID] == null) {\r\n\t\t\tvar lFrames:UInt = texturesDefinition[pID];\r\n\t\t\tif (lFrames == 1) texturesCache[pID] =[Texture.fromFrame(pID+\".png\")];\r\n\t\t\telse {\r\n\t\t\t\ttexturesCache[pID] = new Array<Texture>();\r\n\t\t\t\tfor (i in 1...lFrames+1) texturesCache[pID].push(Texture.fromFrame(pID+(digits + i).substr(-1*textureDigits) + \".png\"));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\treturn texturesCache[pID];\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.loader;\r\nimport com.isartdigital.utils.events.LoadEventType;\r\nimport com.isartdigital.utils.sounds.SoundDef;\r\nimport com.isartdigital.utils.sounds.SoundManager;\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\nimport haxe.Json;\r\nimport howler.Howl;\r\nimport howler.Howler;\r\nimport js.html.XMLSerializer;\r\nimport pixi.flump.Parser;\r\nimport pixi.loaders.Loader;\r\nimport pixi.loaders.Resource;\r\nimport pixi.loaders.ResourceLoader;\r\nimport webfont.WebFontLoader;\r\n\r\n/**\r\n * Classe de chargement\r\n * Cette classe permet de grer des chargements par lot aussi bien de fichiers textes que de ressources graphiques ou du son\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass GameLoader extends Loader\r\n{\r\n\r\n\t/**\r\n\t * liste des fichiers sons  charger\r\n\t */\r\n\tprivate var soundsList:Array<String>;\r\n\t\r\n\tprivate var soundsSpecs:Map<String,HowlOptions>;\r\n\t\r\n\t/**\r\n\t * liste des fichiers chargs\r\n\t */\r\n\tprivate static var txtLoaded:Map<String,Dynamic> = new Map<String,Dynamic>();\r\n\t\r\n\t/**\r\n\t* retourne le contenu charg pour le chemin de fichier pass en paramtre\r\n\t* @param\tpFile chemin du fichier\r\n\t* @return\tressource (JSon ou Xml)\r\n\t*/\r\n\tpublic static function getContent (pFile:String):Dynamic {\r\n\t\treturn txtLoaded[Config.txtsPath+pFile];\r\n\t}\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsoundsList = [];\r\n\t\tsoundsSpecs = new Map();\r\n\t\tsuper();\r\n\t\tonce(LoadEventType.COMPLETE, onComplete);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* ajoute un fichier de type texte  la liste de chargement (JSon ou Xml)\r\n\t* @param\tpUrl chaine de caractres spcifiant le chemin vers le fichier\r\n\t*/\r\n\tpublic function addTxtFile (pUrl:String):Void {\r\n\t\tvar lUrl:String = Config.txtsPath + pUrl;\r\n\t\tadd(Config.url(lUrl));\r\n\t}\t\r\n\t\r\n\t/**\r\n\t* ajoute un fichier d'assets  la liste de chargement\r\n\t* @param\tpUrl chaine de caractre spcifiant le nom du fichier\r\n\t*/\r\n\tpublic function addAssetFile (pUrl:String):Void {\t\r\n\t\tvar lUrl:String = Config.assetsPath + pUrl;\r\n\t\tadd(Config.url(lUrl));\t\t\r\n\t}\r\n\r\n\t/**\r\n\t* ajoute une liste de sons  la liste de chargement\r\n\t* @param\tpUrl chaine de caractre spcifiant le nom du fichier\r\n\t*/\r\n\tpublic function addSoundFile (pUrl:String):Void {\t\r\n\t\tvar lUrl:String = Config.soundsPath + pUrl;\r\n\t\tsoundsList.push(lUrl);\r\n\t\tadd(Config.url(lUrl));\r\n\t}\t\r\n\t\r\n\t/**\r\n\t* ajoute un fichier css de polices de caractre\r\n\t* @param\tpUrl chaine de caractre spcifiant le nom du fichier\r\n\t*/\r\n\tpublic function addFontFile (pUrl:String):Void {\r\n\t\tif (DeviceCapabilities.isCocoonJS) return;\r\n\t\tvar lUrl:String = Config.fontsPath + pUrl;\r\n\t\tadd(Config.url(lUrl));\t\t\r\n\t}\r\n\t\r\n\tprivate function parseData (pResource:Resource, pNext:Void->Void): Void {\r\n\t\t\r\n\t\ttrace (pResource.url + \" loaded\");\r\n\t\t\r\n\t\tvar lUrl:String = pResource.url.split(\"?\")[0];\r\n\t\t\r\n\t\tif (lUrl.indexOf(\".css\") > 0) {\r\n\t\t\t\r\n\t\t\tvar lData:Array<String> = pResource.data.split(\";\");\r\n\t\t\tvar lFamilies:Array<String> = [];\r\n\t\t\tvar lReg:EReg = ~/font-family:\\s?(.*)/; \r\n\t\t\t\r\n\t\t\tfor (i in 0...lData.length) {\r\n\t\t\t\tif (lReg.match(lData[i])) lFamilies.push(lReg.matched(1));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar lWebFontConfig = {\r\n\t\t\t\tcustom: {\r\n\t\t\t\t\tfamilies: lFamilies,\r\n\t\t\t\t\turls: [Config.fontsPath+\"fonts.css\"],\r\n\t\t\t\t},\r\n\r\n\t\t\t\tactive: pNext\r\n\t\t\t};\r\n\t\t   \r\n\t\t\tWebFontLoader.load(lWebFontConfig);\t\t\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (pResource.isJson) {\r\n\t\t\t\r\n\t\t\ttxtLoaded[lUrl] = pResource.data;\r\n\t\t\t\r\n\t\t\tif(lUrl.substr(-12,12)==\"library.json\" && Reflect.hasField(pResource.data,\"md5\") && Reflect.hasField(pResource.data,\"movies\") && Reflect.hasField(pResource.data,\"textureGroups\") && Reflect.hasField(pResource.data,\"frameRate\")) {\r\n\t\t\t\tParser.parse(1,Config.cache)(pResource, pNext);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (soundsList.length>0) { \r\n\t\t\t\r\n\t\t\t\tvar lData:SoundDef;\r\n\t\t\t\t\r\n\t\t\t\tfor (i in 0...soundsList.length) {\r\n\t\t\t\t\tif (lUrl == soundsList[i]) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsoundsList.splice(i, 1);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlData = pResource.data;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (DeviceCapabilities.isCocoonJS) {\r\n\t\t\t\t\t\t\tif (lData.extensions.indexOf(\"ogg\") == -1) throw \"CocoonJs needs ogg sounds. No sound will be played in the application.\";\r\n\t\t\t\t\t\t\telse lData.extensions = [\"ogg\"];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tfor (j in 0...lData.extensions.length) {\r\n\t\t\t\t\t\t\tif (Howler.codecs(lData.extensions[j])) {\r\n\t\t\t\t\t\t\t\taddSounds(lData.fxs,false,lData.extensions,lData.extensions[i]);\r\n\t\t\t\t\t\t\t\taddSounds(lData.musics,true,lData.extensions,lData.extensions[i]);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t} else if (pResource.isXml) txtLoaded[lUrl] = Xml.parse(new XMLSerializer().serializeToString(pResource.data));\r\n\t\t\r\n\t\tpNext();\r\n\t}\r\n\t\r\n\tprivate function manageCache (pResource:Resource, pNext:Void->Void): Void {\r\n\t\tif  (pResource.name != pResource.url) pResource.url = Config.url(pResource.url);\r\n\t\tpNext();\r\n\t}\r\n\t\r\n\tprivate function addSounds (pList:Dynamic, pLoop:Bool, pExtensions:Array<String>, pCodec:String): Void {\t\r\n\t\tvar lUrl:String;\r\n\t\tfor (lID in Reflect.fields(pList)) {\r\n\t\t\tlUrl = Config.url(Config.soundsPath + lID + \".\" + pCodec);\r\n\t\t\tsoundsSpecs.set(lID, {src:[lUrl],volume:Reflect.field(pList, lID) / 100, loop:pLoop} );\r\n\t\t\tadd(lUrl);\r\n\t\t}\r\n\t}\r\n\r\n\toverride public function load (?cb:Void -> Void):ResourceLoader {\r\n\t\tbefore(manageCache);\r\n\t\tafter(parseData);\r\n\t\treturn super.load();\r\n\t}\r\n\t\r\n\tprivate function onComplete ():Void {\r\n\t\tfor (lID in soundsSpecs.keys()) {\r\n\t\t\tSoundManager.addSound(lID, new Howl (soundsSpecs[lID]));\r\n\t\t}\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.sounds;\r\n\r\nimport howler.Howl;\r\n\r\n\t\r\n/**\r\n * Manager centralis de Sons Howler\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass SoundManager\r\n{\r\n\t/**\r\n\t * liste de tous les sons du jeu\r\n\t */\r\n\tprivate static var list (default,null):Map<String,Howl>;\r\n\t\r\n\tprivate function new() {\r\n\t}\r\n\t\r\n\t/**\r\n\t * ajoute un son  la liste\r\n\t * @param\tpName identifiant du son\r\n\t * @param\tpSound son\r\n\t */\r\n\tpublic static function addSound (pName:String,pSound:Howl):Void {\r\n\t\tif (list == null) list = new Map<String,Howl>();\r\n\t\tlist[pName] = pSound;\r\n\t}\r\n\t\r\n\t/**\r\n\t * retourne une rfrence vers le son par l'intermdiaire de son identifiant\r\n\t * @param\tpName identifiant du son\r\n\t * @return le son\r\n\t */\r\n\tpublic static function getSound(pName:String): Howl {\r\n\t\treturn list[pName];\r\n\t}\r\n\r\n}","package com.isartdigital.utils.system;\r\n\r\nimport com.isartdigital.utils.game.GameStage;\r\nimport js.Browser;\r\nimport js.html.Element;\r\nimport js.html.Event;\r\nimport js.html.Image;\r\nimport pixi.core.display.DisplayObject;\r\nimport pixi.core.math.Point;\r\nimport pixi.core.math.shapes.Rectangle;\r\n\t\r\n/**\r\n * Classe Utilitaire donnant accs  des proprits du priphrique cible\r\n * Tous les priphriques ne se comportant pas comme on l'attend, DeviceCapabilities permet de\r\n * masquer les comportement diffrents et prsenter une facade unique au reste du code\r\n * @version 0.4.0\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass DeviceCapabilities \r\n{\t\t\r\n\r\n\tpublic static inline var SYSTEM_ANDROID: String = \"Android\";\r\n\tpublic static inline var SYSTEM_IOS: String = \"iOS\";\r\n\tpublic static inline var SYSTEM_BLACKBERRY: String = \"BlackBerry\";\r\n\tpublic static inline var SYSTEM_BB_PLAYBOOK: String = \"BlackBerry PlayBook\";\r\n\tpublic static inline var SYSTEM_WINDOWS_MOBILE: String = \"IEMobile\";\r\n\tpublic static inline var SYSTEM_DESKTOP: String = \"Desktop\";\t\r\n\t\r\n\tprivate static var fullScreenButton:Image;\r\n\tprivate static inline var ICON_SIZE:Float = 0.11;\r\n\r\n\tpublic static inline var TEXTURE_NO_SCALE: String = \"\";\r\n\tpublic static inline var TEXTURE_HD: String = \"hd\";\r\n\tpublic static inline var TEXTURE_MD: String = \"md\";\r\n\tpublic static inline var TEXTURE_LD: String = \"ld\";\t\r\n\t\r\n\tprivate static var texturesRatios: Map<String,Float> = [\"hd\"=>1,\"md\"=>0.5,\"ld\"=>0.25];\r\n\t\r\n\tpublic static var textureRatio (default,null):Float = 1;\r\n\tpublic static var textureType (default,null):String = TEXTURE_NO_SCALE;\t\r\n\t\r\n\tprivate static var screenRatio:Float = 1;\r\n\t\r\n\t/**\r\n\t  * hauteur du Canvas (change avec l'orientation)\r\n\t  */\r\n\tpublic static var height (get, never) : UInt;\r\n\t\r\n\tprivate static function get_height () {\r\n\t\treturn Browser.window.innerHeight;\r\n\t}\r\n\t\r\n\t/**\r\n\t  * largeur du Canvas (change avec l'orientation)\r\n\t  */\r\n\tpublic static var width (get, never) : UInt;\r\n\t\r\n\tprivate static function get_width () {\r\n\t\treturn Browser.window.innerWidth;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Systme d'exploitation du Device\r\n\t */\r\n\tpublic static var system (get, never) : String;\r\n\t\r\n\tprivate static function get_system( ) {\r\n\t\tif ( ~/IEMobile/i.match(Browser.navigator.userAgent)) return SYSTEM_WINDOWS_MOBILE;\t\r\n\t\telse if ( ~/iPhone|iPad|iPod/i.match(Browser.navigator.userAgent)) return SYSTEM_IOS;\r\n\t\telse if ( ~/BlackBerry/i.match(Browser.navigator.userAgent)) return SYSTEM_BLACKBERRY;\r\n\t\telse if ( ~/PlayBook/i.match(Browser.navigator.userAgent)) return SYSTEM_BB_PLAYBOOK;\r\n\t\telse if ( ~/Android/i.match(Browser.navigator.userAgent)) return SYSTEM_ANDROID;\r\n\t\telse return SYSTEM_DESKTOP;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Est-ce que le jeu est encapsul dans CocoonJs\r\n\t */\r\n\tpublic static var isCocoonJS (get, never) : Bool;\r\n\t\r\n\tprivate static function get_isCocoonJS () {\r\n\t\treturn untyped Browser.navigator.isCocoonJS;\r\n\t}\r\n\t\r\n\t/**\r\n\t * affiche le bouton de fullscreen\r\n\t */\r\n\tpublic static function displayFullScreenButton ():Void {\r\n\t\tif (isCocoonJS) return;\r\n\t\t\r\n\t\tif (!~/(iPad|iPhone|iPod)/g.match(Browser.navigator.userAgent) && !~/MSIE/i.match(Browser.navigator.userAgent) /*&& !(Browser.window.location.hash = !!Browser.window.MSInputMethodContext)*/) {\r\n\r\n\t\t\tBrowser.document.onfullscreenchange = onChangeFullScreen;\r\n\t\t\tuntyped Browser.document.onwebkitfullscreenchange = onChangeFullScreen;\r\n\t\t\tuntyped Browser.document.onmozfullscreenchange = onChangeFullScreen;\r\n\t\t\tuntyped Browser.document.onmsfullscreenchange = onChangeFullScreen;\r\n\t\t\t//Browser.document.addEventListener(\"MSFullscreenChange\", onChangeFullScreen );\r\n\t\t\t\r\n\t\t\tfullScreenButton = new Image();\r\n\t\t\tfullScreenButton.style.position = 'absolute';\r\n\t\t\tfullScreenButton.style.right = '0px';\r\n\t\t\tfullScreenButton.style.top = '0px';\r\n\t\t\tfullScreenButton.style.cursor = \"pointer\";\r\n\t\t\tfullScreenButton.width = Std.int(getSizeFactor()*ICON_SIZE);\r\n\t\t\tfullScreenButton.height = Std.int(getSizeFactor()*ICON_SIZE);\r\n\t\t\tfullScreenButton.onclick = enterFullscreen;\r\n\t\t\tfullScreenButton.src = Config.assetsPath+\"fullscreen.png\";\r\n\t\t\t\r\n\t\t\tBrowser.document.body.appendChild(fullScreenButton);\r\n\r\n\t\t}\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * entre dans le mode fullscreen\r\n\t * @param\tpEvent\r\n\t */\r\n\tprivate static function enterFullscreen(pEvent:Event):Void {\r\n\t\tvar lDocElm:Element = Browser.document.documentElement;\r\n\t\tif (lDocElm.requestFullscreen!=null) lDocElm.requestFullscreen();\r\n\t\telse if (untyped lDocElm.mozRequestFullScreen!=null) untyped lDocElm.mozRequestFullScreen();\r\n\t\telse if (untyped lDocElm.webkitRequestFullScreen!=null) untyped lDocElm.webkitRequestFullScreen();\r\n\t\telse if (untyped lDocElm.msRequestFullscreen!=null) untyped lDocElm.msRequestFullscreen();\r\n\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * sort du mode fullscreen\r\n\t */\r\n\tprivate static function exitFullscreen():Void {\r\n\t\tif (Browser.document.exitFullscreen!=null) Browser.document.exitFullscreen();\r\n\t\telse if (untyped Browser.document.mozCancelFullScreen!=null) untyped Browser.document.mozCancelFullScreen();\r\n\t\telse if (untyped Browser.document.webkitCancelFullScreen!=null) untyped Browser.document.webkitCancelFullScreen();\r\n\t\telse if (untyped Browser.document.msExitFullscreen) untyped Browser.document.msExitFullscreen();\r\n\t}\r\n\r\n\t/**\r\n\t * callback appele sur changement d'tat fullscreen\r\n\t * @param\tpEvent\r\n\t */\r\n\tprivate static function onChangeFullScreen (pEvent:Event):Void {\r\n\t\tif (untyped Browser.document.fullScreen || untyped Browser.document.mozFullScreen || untyped Browser.document.webkitIsFullScreen || untyped Browser.document.msFullscreenElement) {\r\n\t\t\tfullScreenButton.style.display = 'none';\r\n\t\t} else {\r\n\t\t\tfullScreenButton.style.display = 'block';\r\n\t\t}\r\n\t\tpEvent.preventDefault();\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * Calcul la dimension idale du bouton en fonction du device\r\n\t * @return fullscreen ideal size\r\n\t */\r\n\tpublic static function getSizeFactor ():Float {\r\n\t\tvar lSize:Float=Math.floor(Math.min(width,height));\r\n\t\tif (system == SYSTEM_DESKTOP) lSize /= 3;\r\n\r\n\t\treturn lSize;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * retourne un objet Rectangle correspondant aux dimensions de l'cran dans le repre du DisplayObject pass en paramtre\r\n\t * @param pTarget repre cible\r\n\t * @return objet Rectangle\r\n\t */\r\n\tpublic static function getScreenRect(pTarget:DisplayObject):Rectangle {\r\n\r\n\t\tvar lTopLeft:Point = new Point (0, 0);\r\n\t\tvar lBottomRight:Point = new Point (width, height);\r\n\t\t\r\n\t\tlTopLeft = pTarget.toLocal(lTopLeft);\r\n\t\tlBottomRight = pTarget.toLocal(lBottomRight);\r\n\t\t\r\n\t\treturn new Rectangle(lTopLeft.x, lTopLeft.y, lBottomRight.x - lTopLeft.x, lBottomRight.y - lTopLeft.y);\r\n\t}\r\n\r\n\t/**\r\n\t * Calibre le viewport pour que le Browser affiche la rsolution reelle du Device\r\n\t */\r\n\tpublic static function scaleViewport (): Void {\r\n\t\t\r\n\t\t//TODO: COCOONJS\r\n\t\tif (system == SYSTEM_WINDOWS_MOBILE) return;\r\n\t\t\r\n\t\tscreenRatio = Browser.window.devicePixelRatio;\r\n\t\tif (!isCocoonJS) Browser.document.write('<meta name=\"viewport\" content=\"initial-scale=' + Math.round(100 / screenRatio) / 100 + ', user-scalable=no, minimal-ui\">');\t\t\t\t\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Dfini les ratios de texture\r\n\t * @param\tpHd ratio texture pour HD\r\n\t * @param\tpMd ratio texture pour MD\r\n\t * @param\tpLd ratio texture pour LD\r\n\t */\r\n\tpublic static function init(?pHd:Float = 1, ?pMd:Float = 0.5, ?pLd:Float = 0.25):Void {\r\n\r\n\t\ttexturesRatios[TEXTURE_HD]=pHd;\r\n\t\ttexturesRatios[TEXTURE_MD]=pMd;\r\n\t\ttexturesRatios[TEXTURE_LD]=pLd;\r\n\t\t\r\n\t\tif (Config.data.texture != null && Config.data.texture!=\"\") textureType = Config.data.texture;\r\n\t\telse {\r\n\t\t\tvar lBW:Float = Math.max (Browser.window.screen.width, Browser.window.screen.height);\r\n\t\t\tvar lBH:Float = Math.min (Browser.window.screen.width, Browser.window.screen.height);\r\n\t\t\tvar lW:Float = Math.max (GameStage.getInstance().safeZone.width,GameStage.getInstance().safeZone.height);\r\n\t\t\tvar lH:Float = Math.min (GameStage.getInstance().safeZone.width,GameStage.getInstance().safeZone.height);\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tvar lRatio:Float = Math.min(lBW * screenRatio / lW, lBH * screenRatio / lH);\r\n\t\t\t\r\n\t\t\tif (lRatio <= pLd) textureType = TEXTURE_LD;\r\n\t\t\telse if (lRatio <= pMd) textureType = TEXTURE_MD;\r\n\t\t\telse textureType = TEXTURE_HD;\r\n\t\t}\r\n\t\ttextureRatio = texturesRatios[textureType];\r\n\t\t\r\n\t}\r\n\r\n}","package com.isartdigital.utils.ui;\r\n\r\n/**\r\n * Classe de base des PopIn\r\n * Toutes les popin d'interface hritent de cette classe\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass Popin extends UIComponent\r\n{\r\n\r\n\tpublic function new(pID:String=null) \r\n\t{\r\n\t\tsuper(pID);\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.ui;\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\nimport pixi.core.display.DisplayObject;\r\nimport pixi.core.math.Point;\r\nimport pixi.core.math.shapes.Rectangle;\r\n\r\n/**\r\n * Classe utilitaire permettant de grer le repositionnement des lements d'interface dans l'cran\r\n * @author Mathieu ANTHOINE\r\n */\r\n\r\nclass UIPosition \r\n{\r\n\tpublic static inline var LEFT:String=\"left\";\r\n\tpublic static inline var RIGHT:String=\"right\";\r\n\tpublic static inline var TOP:String=\"top\";\r\n\tpublic static inline var BOTTOM:String=\"bottom\";\r\n\tpublic static inline var TOP_LEFT:String=\"topLeft\";\r\n\tpublic static inline var TOP_RIGHT:String=\"topRight\";\r\n\tpublic static inline var BOTTOM_LEFT:String=\"bottomLeft\";\r\n\tpublic static inline var BOTTOM_RIGHT:String=\"bottomRight\";\r\n\tpublic static inline var BOTTOM_CENTER:String=\"bottomCenter\";\r\n\t\r\n\tpublic static inline var FIT_WIDTH:String=\"fitWidth\";\r\n\tpublic static inline var FIT_HEIGHT:String=\"fitHeight\";\r\n\tpublic static inline var FIT_SCREEN:String = \"fitScreen\";\r\n\t\r\n\tprivate function new() {}\r\n\t\r\n\t/**\r\n\t* \r\n\t* @param\tpTarget DisplayObject  positionner\r\n\t* @param\tpPosition type de positionnement\r\n\t* @param\tpOffsetX dcalage en X (positif si c'est vers l'interieur de la zone de jeu sinon en ngatif)\r\n\t* @param\tpOffsetY dcalage en Y (positif si c'est vers l'interieur de la zone de jeu sinon en ngatif)\r\n\t*/\r\n\tstatic public function setPosition (pTarget:DisplayObject, pPosition:String, pOffsetX:Float = 0, pOffsetY:Float = 0): Void {\r\n\t\t\t\t\r\n\t\tvar lScreen:Rectangle = DeviceCapabilities.getScreenRect(pTarget.parent);\r\n\t\t\r\n\t\tvar lTopLeft:Point = new Point (lScreen.x, lScreen.y);\r\n\t\tvar lBottomRight:Point = new Point (lScreen.x+lScreen.width,lScreen.y+lScreen.height);\r\n\t\t/*\r\n\t\tswitch pPosition {\r\n\t\t\tcase TOP    : case TOP_LEFT    : case TOP_RIGHT    : lTopLeft.y + pOffsetY;\r\n\t\t\tcase BOTTOM : case BOTTOM_LEFT : case BOTTOM_RIGHT : case BOTTOM_CENTER : pTarget.y = lBottomRight.y - pOffsetY;\r\n\t\t\tcase LEFT   : case TOP_LEFT    : case BOTTOM_LEFT  : pTarget.x = lTopLeft.x + pOffsetX;\r\n\t\t\tcase RIGHT  : case TOP_RIGHT   : case BOTTOM_RIGHT : pTarget.x = lBottomRight.x - pOffsetX;\r\n\t\t\tcase BOTTOM_CENTER :lBottomRight.x - lScreen.width / 2 - pOffsetX;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\tswitch pPosition {\r\n\t\t\tcase TOP    : case TOP_LEFT    : case TOP_RIGHT    :\r\n\t\t\t\tlTopLeft.y + pOffsetY;\r\n\t\t\tcase BOTTOM : case BOTTOM_LEFT : case BOTTOM_RIGHT : case BOTTOM_CENTER : \r\n\t\t\t\tpTarget.y = lBottomRight.y - pOffsetY;\r\n\t\t\tcase LEFT   : case TOP_LEFT    : case BOTTOM_LEFT  :\r\n\t\t\t\tpTarget.x = lTopLeft.x + pOffsetX;\r\n\t\t\tcase RIGHT  : case TOP_RIGHT   : case BOTTOM_RIGHT :\r\n\t\t\t\tpTarget.x = lBottomRight.x - pOffsetX;\r\n\t\t\tcase BOTTOM_CENTER :\r\n\t\t\t\tlBottomRight.x - lScreen.width / 2 - pOffsetX;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\tif (pPosition == TOP || pPosition == TOP_LEFT || pPosition == TOP_RIGHT) pTarget.y = lTopLeft.y + pOffsetY;\r\n\t\tif (pPosition == BOTTOM || pPosition == BOTTOM_LEFT || pPosition == BOTTOM_RIGHT || pPosition == BOTTOM_CENTER) pTarget.y = lBottomRight.y - pOffsetY;\r\n\t\tif (pPosition == LEFT || pPosition == TOP_LEFT || pPosition == BOTTOM_LEFT) pTarget.x = lTopLeft.x + pOffsetX;\r\n\t\tif (pPosition == RIGHT || pPosition == TOP_RIGHT || pPosition == BOTTOM_RIGHT) pTarget.x = lBottomRight.x - pOffsetX;\r\n\t\tif (pPosition == BOTTOM_CENTER) pTarget.x = lBottomRight.x - lScreen.width / 2 - pOffsetX;\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tif ([TOP, TOP_LEFT, TOP_RIGHT].indexOf(pPosition) != -1) pTarget.y = lTopLeft.y + pOffsetY;\r\n\t\tif ([BOTTOM, BOTTOM_LEFT, BOTTOM_RIGHT, BOTTOM_CENTER].indexOf(pPosition) != -1) pTarget.y = lBottomRight.y - pOffsetY;\r\n\t\tif ([LEFT, TOP_LEFT, BOTTOM_LEFT].indexOf(pPosition) != -1) pTarget.x = lTopLeft.x + pOffsetX;\r\n\t\tif ([RIGHT, TOP_RIGHT, BOTTOM_RIGHT].indexOf(pPosition) != -1) pTarget.x = lBottomRight.x - pOffsetX;\r\n\t\tif (pPosition == BOTTOM_CENTER) pTarget.x = lBottomRight.x - lScreen.width / 2 - pOffsetX;\r\n\t\t*/\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tif ([TOP, TOP_LEFT, TOP_RIGHT].indexOf(pPosition) != -1) \r\n\t\t\tpTarget.y = lTopLeft.y + pOffsetY;\r\n\t\tif ([BOTTOM, BOTTOM_LEFT, BOTTOM_RIGHT, BOTTOM_CENTER].indexOf(pPosition) != -1) \r\n\t\t\tpTarget.y = lBottomRight.y - pOffsetY;\r\n\t\tif ([LEFT, TOP_LEFT, BOTTOM_LEFT].indexOf(pPosition) != -1) \r\n\t\t\tpTarget.x = lTopLeft.x + pOffsetX;\r\n\t\tif ([RIGHT, TOP_RIGHT, BOTTOM_RIGHT].indexOf(pPosition) != -1) \r\n\t\t\tpTarget.x = lBottomRight.x - pOffsetX;\r\n\t\tif (pPosition == BOTTOM_CENTER) \r\n\t\t\tpTarget.x = lBottomRight.x - lScreen.width / 2 - pOffsetX;\r\n\t\t\r\n\t\t\r\n\t\tif (pPosition == FIT_WIDTH || pPosition == FIT_SCREEN) {\r\n\t\t\tpTarget.x = lTopLeft.x;\r\n\t\t\tuntyped pTarget.width = lBottomRight.x - lTopLeft.x;\r\n\t\t}\r\n\t\tif (pPosition == FIT_HEIGHT || pPosition == FIT_SCREEN) {\r\n\t\t\tpTarget.y = lTopLeft.y;\r\n\t\t\tuntyped pTarget.height = lBottomRight.y - lTopLeft.y;\r\n\t\t}\r\n\r\n\t\t\r\n\t}\r\n\t\r\n}\r\n","package com.isartdigital.utils.ui.smart;\r\n\r\nimport com.isartdigital.utils.ui.UIComponent;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu Anthoine\r\n */\r\nclass SmartComponent extends UIComponent\r\n{\r\n\r\n\tpublic function new(pID:String=null) \r\n\t{\r\n\t\tsuper(pID);\r\n\t\tbuild();\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.ui.smart;\r\nimport com.isartdigital.utils.events.MouseEventType;\r\nimport com.isartdigital.utils.events.TouchEventType;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.display.DisplayObject;\r\nimport pixi.interaction.EventTarget;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu Anthoine\r\n */\r\nclass SmartButton extends SmartComponent\r\n{\r\n\r\n\tprivate var box:DisplayObject;\r\n\t\r\n\tpublic function new(pID:String=null) \r\n\t{\r\n\t\tsuper(pID);\r\n\t\tmodal = false;\r\n\t\tinteractive = true;\r\n\t\tbuttonMode = true;\r\n\t\t\r\n\t\ton(MouseEventType.MOUSE_OVER, _mouseOver);\r\n\t\ton(MouseEventType.MOUSE_DOWN, _mouseDown);\r\n\t\ton(MouseEventType.CLICK, _click);\r\n\t\ton(MouseEventType.MOUSE_OUT, _mouseOut);\r\n\t\ton(MouseEventType.MOUSE_UP_OUTSIDE, _mouseOut);\r\n\t\t\r\n\t\ton(TouchEventType.TOUCH_START, _mouseDown);\r\n\t\ton(TouchEventType.TAP, _click);\r\n\t\ton(TouchEventType.TOUCH_END, _mouseOut);\r\n\t\ton(TouchEventType.TOUCH_END_OUTSIDE, _mouseOut);\r\n\t\t\r\n\t}\r\n\t\r\n\toverride public function build(pFrame:Int = 0):Void \r\n\t{\r\n\t\tsuper.build(3);\t\t\r\n\t\thitArea = getBounds().clone();\r\n\t\t_mouseOut();\r\n\t}\r\n\t\r\n\tprivate function clear(): Void {\r\n\t\twhile (children.length > 0) removeChildAt(0);\r\n\t}\r\n\t\r\n\tprivate function _click (pEvent:EventTarget=null): Void {\r\n\t\t_mouseOut();\r\n\t}\t\r\n\t\r\n\tprivate function _mouseDown (pEvent:EventTarget=null): Void {\r\n\t\tclear();\r\n\t\tsuper.build(2);\r\n\t}\r\n\t\r\n\tprivate function _mouseOver (pEvent:EventTarget=null): Void {\r\n\t\tclear();\r\n\t\tsuper.build(1);\r\n\t}\r\n\t\r\n\tprivate function _mouseOut (pEvent:EventTarget=null): Void {\r\n\t\tclear();\r\n\t\tsuper.build();\r\n\t}\r\n\t\r\n\toverride public function destroy ():Void {\r\n\t\toff(MouseEventType.MOUSE_OVER, _mouseOver);\r\n\t\toff(MouseEventType.MOUSE_DOWN, _mouseDown);\r\n\t\toff(MouseEventType.CLICK, _click);\r\n\t\toff(MouseEventType.MOUSE_OUT, _mouseOut);\r\n\t\toff(MouseEventType.MOUSE_UP_OUTSIDE, _mouseOut);\r\n\t\t\r\n\t\toff(TouchEventType.TOUCH_START, _mouseDown);\r\n\t\toff(TouchEventType.TAP, _click);\r\n\t\toff(TouchEventType.TOUCH_END, _mouseOut);\r\n\t\toff(TouchEventType.TOUCH_END_OUTSIDE, _mouseOut);\r\n\r\n\t\tsuper.destroy();\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.ui.smart;\r\n\r\nimport pixi.core.display.Container;\r\nimport pixi.core.graphics.Graphics;\r\nimport pixi.core.math.Point;\r\nimport pixi.core.text.Text;\r\nimport pixi.core.text.Text.TextStyle;\r\n\r\ntypedef UITextStyle = {\r\n\tvar x: Float;\r\n\tvar y: Float;\r\n\tvar width: Float;\r\n\tvar height: Float;\r\n\tvar align: String;\r\n\tvar font: String;\r\n\tvar color: String;\r\n\tvar text:String;\r\n\tvar wordWrap:Int;\r\n\tvar verticalAlign:String;\r\n}\r\n\r\n/**\r\n * ...\r\n * @author Mathieu Anthoine\r\n */\r\nclass TextSprite extends Container\r\n{\r\n\r\n\t/**\r\n\t * assigner la mthode de parsing des textes pour localiser comme traiter des flags personnaliss\r\n\t */\r\n\tpublic static var parseText:String->String;\r\n\t\r\n\tpublic function new(pData:UITextStyle) {\r\n\t\tsuper();\r\n\t\t\r\n\t\tvar lStyle:TextStyle = {\r\n\t\t\tfont: StringTools.replace(pData.font,\"*\",\"\"),\r\n\t\t\tfill: pData.color,\r\n\t\t\talign: pData.align,\r\n\t\t\twordWrap: pData.wordWrap == 1,\r\n\t\t\twordWrapWidth: pData.width\r\n\t\t}\t\r\n\t\t\r\n\t\tvar lTxt:Text = new Text(parseText(StringTools.replace(pData.text,\"</BR>\",\"\\r\")), lStyle);\r\n\t\tif (pData.align == \"center\") lTxt.anchor.x = 0.5;\r\n\t\telse if (pData.align == \"right\") lTxt.anchor.x = 1;\r\n\t\t\r\n\t\tif (pData.verticalAlign == \"top\") lTxt.anchor.y = 0;\r\n\t\tif (pData.verticalAlign == \"bottom\") lTxt.anchor.y = 1;\r\n\t\telse lTxt.anchor.y = 0.5;\r\n\t\t\r\n\t\t\r\n\t\tif (Config.debug) {\r\n\t\t\tvar lGraph:Graphics = new Graphics();\r\n\t\t\tlGraph.beginFill(0xFFFF00);\r\n\t\t\tlGraph.drawRect(pData.x, pData.y, pData.width, pData.height);\r\n\t\t\tlGraph.endFill();\r\n\t\t\tlGraph.alpha = 0.5;\r\n\t\t\taddChild(lGraph);\r\n\t\t}\r\n\t\t\r\n\t\taddChild(lTxt);\t\t\r\n\t\t\r\n\t}\r\n\t\r\n\tprivate static function defaultParseText (pTxt:String):String {\r\n\t\treturn pTxt;\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.ui.smart;\r\n\r\nimport com.isartdigital.utils.loader.GameLoader;\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\nimport com.isartdigital.utils.ui.UIPosition;\r\nimport com.isartdigital.utils.ui.smart.SmartButton;\r\nimport com.isartdigital.utils.ui.smart.SmartButton;\r\nimport com.isartdigital.utils.ui.smart.SmartComponent;\r\nimport com.isartdigital.utils.ui.smart.TextSprite;\r\nimport com.isartdigital.utils.ui.smart.UIMovie;\r\nimport com.isartdigital.utils.ui.smart.UISprite;\r\nimport flump.filters.AnimateTintFilter;\r\nimport flump.json.FlumpJSON;\r\nimport flump.library.Keyframe;\r\nimport flump.library.Layer;\r\nimport flump.library.MovieSymbol;\r\nimport flump.library.SpriteSymbol;\r\nimport haxe.Json;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.math.Point;\r\nimport pixi.flump.Movie;\r\nimport pixi.flump.Resource;\r\nimport pixi.flump.Sprite;\r\n\r\n/**\r\n * Construit un SmartComponent depuis un Movie Flump\r\n * @author Mathieu Anthoine\r\n */\r\nclass UIBuilder\r\n{\r\n\t\r\n\tprivate function new() {}\t\r\n\t\r\n\t/**\r\n\t * Cre les lments composant un UIComponent ou SmartComponent\r\n\t * @param\tpId assetName de l'cran\r\n\t */\r\n\tpublic static function build (pId:String,pFrame:Int=0) : Array<UIPositionable> {\r\n\t\t\r\n\t\tvar lMovie:MovieSymbol=untyped Resource.getResourceForMovie(pId).library.movies.h[pId];\r\n\t\t\r\n\t\tvar lObj:Container;\r\n\t\tvar lUIPos:Array<UIPositionable> = [];\r\n\t\tvar lLayer:Layer;\r\n\t\tvar lKeyFrame:Keyframe;\r\n\t\t\r\n\t\tfor (i in 0...lMovie.layers.length) {\r\n\t\t\tlObj = null;\r\n\t\t\tlLayer = lMovie.layers[i];\r\n\t\t\t\r\n\t\t\tlKeyFrame = lLayer.getKeyframeForFrame(pFrame);\r\n\t\t\t\r\n\t\t\tif (lKeyFrame == null) continue;\t\t\r\n\t\t\t\r\n\t\t\tif (lKeyFrame.symbol.data != null && lKeyFrame.symbol.data.className != null) lObj=Type.createInstance(Type.resolveClass(lKeyFrame.symbol.data.className), []);\r\n\t\t\telse if (lKeyFrame.symbol.baseClass == \"Flipbook\") lObj = new Movie(lKeyFrame.symbolId);\r\n\t\t\telse if (lKeyFrame.symbol.baseClass == \"TextSprite\") lObj = new TextSprite(lKeyFrame.symbol.data);\r\n\t\t\telse if (Std.is (lKeyFrame.symbol, SpriteSymbol)) lObj = new UISprite(lKeyFrame.symbolId);\r\n\t\t\telse if (lKeyFrame.symbol.baseClass == \"flash.display.SimpleButton\") lObj = new SmartButton(lKeyFrame.symbolId);\r\n\t\t\telse {\r\n\t\t\t\tvar lChild:MovieSymbol=untyped Resource.getResourceForMovie(lKeyFrame.symbolId).library.movies.h[lKeyFrame.symbolId];\r\n\t\t\t\tvar lChildLayer:Layer;\r\n\t\t\t\tfor (lChildLayer in lChild.layers) {\r\n\t\t\t\t\tif (lChildLayer.keyframes.length > 1) {\r\n\t\t\t\t\t\tlObj = new UIMovie(lKeyFrame.symbolId);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (lObj == null) {\r\n\t\t\t\t\tlObj = new SmartComponent(lKeyFrame.symbolId);\r\n\t\t\t\t\tcast(lObj,SmartComponent).modal = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlObj.name = lLayer.name;\r\n\t\t\t\r\n\t\t\tlObj.position= new Point(lKeyFrame.location.x/DeviceCapabilities.textureRatio,lKeyFrame.location.y/DeviceCapabilities.textureRatio);\r\n\t\t\tlObj.scale= new Point(lKeyFrame.scale.x,lKeyFrame.scale.y);\r\n\t\t\tlObj.skew = new Point(lKeyFrame.skew.x, lKeyFrame.skew.y);\r\n\t\t\t\r\n\t\t\tif (lKeyFrame.tintMultiplier!=null &&  lKeyFrame.tintMultiplier!= 0) lObj.filters= [new AnimateTintFilter(lKeyFrame.tintColor, lKeyFrame.tintMultiplier)];\r\n\t\t\t\r\n\t\t\tvar lUIPosition:String = \"\";\r\n\t\t\tif (lKeyFrame.data != null) {\r\n\t\t\t\tif (Reflect.hasField(lKeyFrame.data,\"UIPosition_\"+DeviceCapabilities.system)) lUIPosition = Reflect.field(lKeyFrame.data,\"UIPosition_\"+DeviceCapabilities.system);\r\n\t\t\t\telse if (lKeyFrame.data.UIPosition != null) lUIPosition = lKeyFrame.data.UIPosition;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlUIPos.push(getUIPositionable(lObj,lUIPosition));\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t\treturn lUIPos;\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * retourne un UIPositionable correctement construit\r\n\t * @param\tpObj Item d'interface\r\n\t * @param\tpPosition ancrage \"UIPosition\"\r\n\t * @return un UIPositionable\r\n\t */\r\n\tprivate static function getUIPositionable (pObj:Container,pPosition:String):UIPositionable {\r\n\t\t\r\n\t\tvar lOffset:Point = new Point (0, 0);\r\n\t\t\r\n\t\tif (pPosition == UIPosition.TOP || pPosition == UIPosition.TOP_LEFT || pPosition == UIPosition.TOP_RIGHT ||\r\n\t\t\tpPosition == UIPosition.BOTTOM || pPosition == UIPosition.BOTTOM_LEFT || pPosition == UIPosition.BOTTOM_RIGHT) lOffset.y = pObj.y;\r\n\t\tif (pPosition == UIPosition.LEFT || pPosition == UIPosition.TOP_LEFT || pPosition == UIPosition.BOTTOM_LEFT ||\r\n\t\t\tpPosition == UIPosition.RIGHT || pPosition == UIPosition.TOP_RIGHT || pPosition == UIPosition.BOTTOM_RIGHT) lOffset.x = pObj.x;\t\t\r\n\t\t\t\t\r\n\t\treturn {item:pObj, align:pPosition, offsetX:lOffset.x, offsetY:lOffset.y, update:true};\r\n\t}\r\n\t\r\n}\r\n\r\n","package com.isartdigital.utils.ui.smart;\r\n\r\nimport com.isartdigital.utils.game.StateGraphic;\r\nimport com.isartdigital.utils.game.factory.FlumpMovieAnimFactory;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu Anthoine\r\n */\r\nclass UIMovie extends StateGraphic\r\n{\r\n\r\n\tpublic function new(pAssetName:String) \r\n\t{\r\n\t\tsuper();\r\n\t\tassetName = pAssetName;\r\n\t\tfactory = new FlumpMovieAnimFactory();\r\n\t\tsetState(DEFAULT_STATE,true);\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.ui.smart;\r\n\r\nimport com.isartdigital.utils.game.factory.FlumpSpriteAnimFactory;\r\nimport com.isartdigital.utils.game.StateGraphic;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu Anthoine\r\n */\r\nclass UISprite extends StateGraphic\r\n{\r\n\r\n\tpublic function new(pAssetName:String) \r\n\t{\r\n\t\tsuper();\r\n\t\tassetName = pAssetName;\r\n\t\tfactory = new FlumpSpriteAnimFactory();\r\n\t\tsetState(DEFAULT_STATE);\r\n\t}\r\n\t\r\n}","package flump;\r\n\r\nimport flump.library.Keyframe;\r\n\r\n\r\nclass DisplayObjectKey {\r\n\r\n\tpublic var symbolId:String;\r\n\r\n\r\n\tpublic function new(symbolId:String){\r\n\t\tthis.symbolId = symbolId;\r\n\t}\r\n\r\n}","package flump;\r\n\r\nimport flump.DisplayObjectKey;\r\nimport flump.IFlumpMovie;\r\nimport flump.library.Keyframe;\r\nimport flump.library.Label;\r\nimport flump.library.Layer;\r\nimport flump.library.MovieSymbol;\r\nusing Std;\r\n\r\n\r\nclass MoviePlayer{\r\n\r\n\tprivate var symbol:MovieSymbol;\r\n\tprivate var movie:IFlumpMovie;\r\n\r\n\tprivate var elapsed:Float = 0.0; // Total time that has elapsed\r\n\tprivate var previousElapsed:Float = 0.0;\r\n\tprivate var advanced:Float = 0.0; // Time advanced since the last frame\r\n\t\r\n\t/** previous render \"position\" value ; -1 means no previous render */\r\n\tvar prevPosition\t\t\t\t\t\t\t: Float\t\t\t\t\t\t\t\t\t= -1;\r\n\t\r\n\tpublic var independantTimeline:Bool = true;\r\n\tpublic var independantControl:Bool = true;\r\n\r\n\tprivate var state:String;\r\n\tprivate var STATE_PLAYING:String = \"playing\";\r\n\tprivate var STATE_LOOPING:String = \"looping\";\r\n\tprivate var STATE_STOPPED:String = \"stopped\";\r\n\t\t\r\n\tprivate var currentChildrenKey = new Map<Layer, DisplayObjectKey>();\r\n\tprivate var createdChildren = new Map<DisplayObjectKey, Bool>();\r\n\tprivate var childPlayers = new Map<DisplayObjectKey, MoviePlayer>();\r\n\r\n\tprivate var labelsToFire = new Array<Label>();\r\n\tprivate var changed:Int = 0;\r\n\t//private var labelsToIgnore = new ObjectMap<Label, Label>();\r\n\tprivate var dirty:Bool = false;\r\n\tprivate var fullyGenerated:Bool = false;\r\n\r\n\tprivate var resolution:Float;\r\n\r\n\r\n\tpublic function new(symbol:MovieSymbol, movie:IFlumpMovie, resolution:Float){\r\n\t\tthis.symbol = symbol;\r\n\t\tthis.movie = movie;\r\n\t\tthis.resolution = resolution;\r\n\r\n\t\tfor(layer in symbol.layers){\r\n\t\t\tmovie.createLayer(layer);\r\n\t\t}\r\n\r\n\t\tstate = STATE_LOOPING;\r\n\t\tadvanceTime(0);\r\n\t\tfor (layer in symbol.layers) movie.setMask(layer);\r\n\t}\r\n\r\n\tpublic var labels(get, null):Iterator<Label>;\r\n\tpublic function get_labels():Iterator<Label>{\r\n\t\treturn symbol.labels.iterator();\r\n\t}\r\n\r\n\r\n\tpublic function getDisplayKey(layerId:String, keyframeIndex:UInt = 0):DisplayObjectKey{\r\n\t\tvar layer = symbol.getLayer(layerId);\r\n\t\tif(layer == null) throw(\"Layer \" + layerId + \" does not exist.\");\r\n\t\tvar keyframe = layer.getKeyframeForFrame(keyframeIndex);\r\n\t\tif(keyframe == null) throw(\"Keyframe does not exist at index \" + keyframeIndex);\r\n\t\tcreateChildIfNessessary(keyframe);\r\n\t\treturn keyframe.displayKey;\r\n\t}\r\n\r\n\r\n\tprivate function reset(){\r\n\t\telapsed = 0;\r\n\t\tpreviousElapsed = 0;\r\n\t\tprevPosition = -1;\r\n\t}\r\n\t\r\n\tprivate var position(get, null):Float = 0.0;\r\n\tpublic function get_position():Float{\r\n\t\treturn (elapsed % symbol.duration + symbol.duration) % symbol.duration;\r\n\t}\r\n\r\n\r\n\tpublic var totalFrames (get, null) :UInt;\r\n\tprivate function get_totalFrames(){\r\n\t\treturn symbol.totalFrames;\r\n\t}\r\n\r\n\r\n\tpublic function play(){\r\n\t\tsetState(STATE_PLAYING);\r\n\t\treturn this;\r\n\t}\r\n\r\n\r\n\tpublic function loop(){\r\n\t\tsetState(STATE_LOOPING);\r\n\t\treturn this;\r\n\t}\r\n\r\n\r\n\tpublic function stop(){\r\n\t\tsetState(STATE_STOPPED);\r\n\t\treturn this;\r\n\t}\r\n\r\n\r\n\tpublic function goToLabel(label:String){\r\n\t\tif(!labelExists(label)) throw(\"Symbol \" + symbol.name + \" does not have label \" + label + \".\" );\r\n\t\tcurrentFrame = getLabelFrame(label);\r\n\t\tfireHitFrames(getLabelFrame(label));\r\n\t\t//ignoreCurrentLabels();\r\n\t\treturn this;\r\n\t}\r\n\r\n\r\n\tpublic function goToFrame(frame:Int){\r\n\t\tcurrentFrame = frame;\r\n\t\tfireHitFrames(frame);\r\n\t\treturn this;\r\n\t}\r\n\r\n\r\n\tprivate function fireHitFrames(frame:Int){\r\n\t\tchanged++;\r\n\t\tvar current = changed;\r\n\t\tvar time = frame * symbol.library.frameTime;\r\n\r\n\t\tfor(layer in symbol.layers){\r\n\t\t\tfor(kf in layer.keyframes){\r\n\t\t\t\tif(current != changed) return;\r\n\t\t\t\tif(kf.label != null){\r\n\t\t\t\t\tif(kf.timeInside(time)) movie.labelHit(kf.label);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tpublic function goToPosition(time:Float){\r\n\t\telapsed = time;\r\n\t\tpreviousElapsed = time;\r\n\t\tclearLabels();\r\n\t\t//ignoreCurrentLabels();\r\n\t\t//fireLabels();\r\n\t\treturn this;\r\n\t}\r\n\r\n\r\n\tpublic var playing(get, null):Bool;\r\n\tprivate function get_playing(){\r\n\t\treturn state == STATE_PLAYING;\r\n\t}\r\n\r\n\r\n\tpublic var looping(get, null):Bool;\r\n\tprivate function get_looping(){\r\n\t\treturn state == STATE_LOOPING;\r\n\t}\r\n\r\n\r\n\tpublic var stopped(get, null):Bool;\r\n\tprivate function get_stopped(){\r\n\t\treturn state == STATE_STOPPED;\r\n\t}\r\n\r\n\r\n\tpublic function getLabelFrame(label:String):UInt{\r\n\t\tif(!labelExists(label)) throw(\"Symbol \" + symbol.name + \" does not have label \" + label + \".\" );\r\n\t\treturn symbol.labels.get(label).keyframe.index;\r\n\t}\r\n\t\r\n\t/*\r\n\tprivate function ignoreCurrentLabels(){\r\n\t\tfor(layer in symbol.layers){\r\n\t\t\tvar kf = layer.getKeyframeForFrame(currentFrame);\r\n\t\t\tif(kf != null){\r\n\t\t\t\tif(kf.label != null){\r\n\t\t\t\t\tlabelsToIgnore.set(kf.label, kf.label);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t*/\r\n\r\n\r\n\tpublic var currentFrame(get, set):Int;\r\n\tprivate function get_currentFrame():Int{\r\n\t\treturn Std.int(position / symbol.library.frameTime);\r\n\t}\r\n\tprivate function set_currentFrame(value:Int):Int{\r\n\t\tgoToPosition( symbol.library.frameTime * value);\r\n\t\treturn value;\r\n\t}\r\n\r\n\r\n\tpublic function labelExists(label:String):Bool{\r\n\t\treturn symbol.labels.exists(label);\r\n\t}\r\n\r\n\r\n\tpublic function advanceTime(ms:Float):Void{\r\n\t\tif(state != STATE_STOPPED){\r\n\t\t\telapsed += ms;\r\n\t\t\twhile(elapsed < 0){\r\n\t\t\t\telapsed += symbol.duration;\r\n\t\t\t\tpreviousElapsed += symbol.duration;\r\n\t\t\t}\r\n\t\t}\r\n\t\tadvanced += ms;\r\n\r\n\t\tif(state != STATE_STOPPED) fireLabels();\r\n\t\trender();\r\n\t}\r\n\r\n\r\n\tprivate function clearLabels(){\r\n\t\twhile(labelsToFire.length > 0) labelsToFire.pop();\r\n\t}\r\n\r\n\r\n\tprivate function fireLabels(){\r\n\t\tif(symbol.firstLabel == null) return;\r\n\t\tif(previousElapsed > elapsed) return;\r\n\t\t\r\n\t\t\r\n\t\tvar label:Label = previousElapsed <= elapsed\r\n\t\t\t? symbol.firstLabel\r\n\t\t\t: symbol.lastLabel;\r\n\t\t\r\n\t\tvar checking = true;\r\n\t\twhile(checking){\r\n\t\t\tif(label.keyframe.time > previousElapsed%symbol.duration){\r\n\t\t\t\tchecking = false;\r\n\t\t\t\t//trace(label.keyframe.index);\r\n\t\t\t\t//label = label.prev;\r\n\t\t\t}else if(label.next.keyframe.index <= label.keyframe.index){\r\n\t\t\t\tchecking = false;\r\n\t\t\t\tlabel = label.next;\r\n\t\t\t}else{\r\n\t\t\t\tlabel = label.next;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar firstChecked = label;\r\n\r\n\t\twhile(label != null){\r\n\t\t\tvar checkFrom = previousElapsed % symbol.duration;\r\n\t\t\tvar checkTo = elapsed % symbol.duration;\r\n\t\t\tif(label.keyframe.insideRangeStart(checkFrom, checkTo) && state != STATE_STOPPED){\r\n\t\t\t\tlabelsToFire.push(label);\r\n\t\t\t}\r\n\r\n\t\t\tlabel = label.next;\r\n\t\t\tif(label == firstChecked) label = null;\r\n\t\t}\r\n\r\n\t\twhile(labelsToFire.length > 0){\r\n\t\t\tvar label = labelsToFire.shift();\r\n\t\t\tmovie.labelPassed(label);\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\tfor(key in labelsToIgnore.keys()){\r\n\t\t\tvar label = labelsToIgnore.get(key);\r\n\t\t\tlabelsToIgnore.remove(key);\r\n\t\t\ttrace(\"Label fire: \" + label.name);\r\n\t\t\tmovie.labelHit(label);\r\n\t\t}\r\n\t\t*/\r\n\t}\r\n\r\n\r\n\r\n\tprivate function render():Void{\r\n\t\tvar lIsUpdate\t: Bool\t\t= true;\r\n\t\tvar next\t\t: Keyframe\t= null;\r\n\t\tvar interped\t: Float\t\t= -1;\r\n\t\tvar lColor\t\t:Int\t\t= -1;// AnimateTint\r\n\t\t\r\n\t\tif(state == STATE_PLAYING){\r\n\t\t\tif(position < 0){\r\n\t\t\t\telapsed = 0;\r\n\t\t\t\tstop();\r\n\t\t\t\tmovie.onAnimationComplete();\r\n\t\t\t}else if(position >= symbol.duration - symbol.library.frameTime){\r\n\t\t\t\telapsed = symbol.duration - symbol.library.frameTime;\r\n\t\t\t\tstop();\r\n\t\t\t\tmovie.onAnimationComplete();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// there's no setter for \"position\", is there ? also, \"position\" calculation provides only positive values, from \"elapsed\" modulo\r\n\t\t//while(position < 0) position += symbol.duration;\r\n\t\t\r\n\t\tif ( position != prevPosition && ( prevPosition < 0 || totalFrames > 1)) prevPosition = position;\r\n\t\telse lIsUpdate = false;\r\n\t\t\r\n\t\tfor (layer in symbol.layers){\r\n\t\t\tvar keyframe\t: Keyframe\t= layer.getKeyframeForTime(position);\r\n\r\n\t\t\tif(keyframe.isEmpty == true){\r\n\t\t\t\tremoveChildIfNessessary(keyframe);\r\n\t\t\t}else if(keyframe.isEmpty == false){\r\n\t\t\t\tif ( lIsUpdate){\r\n\t\t\t\t\tinterped\t= getInterpolation( keyframe, position);\r\n\t\t\t\t\tnext\t\t= keyframe.next;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif( next.isEmpty) next = keyframe;// NASTY! FIX THIS!!\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (keyframe.tintColor != next.tintColor) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar lPrevColor:Int = keyframe.tintColor;\r\n\t\t\t\t\t\tvar lNextColor:Int = next.tintColor;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar lPrevR:Int = (lPrevColor >> 16) & 0xFF;\r\n\t\t\t\t\t\tvar lPrevG:Int = (lPrevColor >> 8) & 0xFF;\r\n\t\t\t\t\t\tvar lPrevB:Int = lPrevColor & 0xFF;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar lNextR:Int = (lNextColor >> 16) & 0xFF;\r\n\t\t\t\t\t\tvar lNextG:Int = (lNextColor >> 8) & 0xFF;\r\n\t\t\t\t\t\tvar lNextB:Int = lNextColor & 0xFF;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlColor = Math.round(lPrevR + (lNextR - lPrevR) * interped) << 16 | Math.round(lPrevG + (lNextG - lPrevG) * interped) << 8 | Math.round(lPrevB + (lNextB - lPrevB) * interped);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} else lColor = keyframe.tintColor;\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t\tif(currentChildrenKey.get(layer) != keyframe.displayKey){\r\n\t\t\t\t\t\tcreateChildIfNessessary(keyframe);\r\n\t\t\t\t\t\tremoveChildIfNessessary(keyframe);\r\n\t\t\t\t\t\taddChildIfNessessary(keyframe);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(keyframe.symbol.is(MovieSymbol)){\r\n\t\t\t\t\tvar childMovie = movie.getChildPlayer(keyframe);\r\n\r\n\t\t\t\t\tif(childMovie.independantTimeline){\r\n\t\t\t\t\t\tchildMovie.advanceTime(advanced);\r\n\t\t\t\t\t\tchildMovie.render();\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tchildMovie.elapsed = position;\r\n\t\t\t\t\t\tchildMovie.render();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif ( lIsUpdate){\r\n\t\t\t\t\tmovie.renderFrame(\r\n\t\t\t\t\t\tkeyframe,\r\n\t\t\t\t\t\t(keyframe.location.x + (next.location.x - keyframe.location.x) * interped),\r\n\t\t\t\t\t\t(keyframe.location.y + (next.location.y - keyframe.location.y) * interped),\r\n\t\t\t\t\t\t(keyframe.scale.x + (next.scale.x - keyframe.scale.x) * interped),\r\n\t\t\t\t\t\t(keyframe.scale.y + (next.scale.y - keyframe.scale.y) * interped),\r\n\t\t\t\t\t\tkeyframe.skew.x + (next.skew.x - keyframe.skew.x) * interped,\r\n\t\t\t\t\t\tkeyframe.skew.y + (next.skew.y - keyframe.skew.y) * interped,\r\n\t\t\t\t\t\tkeyframe.alpha + (next.alpha - keyframe.alpha) * interped,\r\n\t\t\t\t\t\tkeyframe.tintMultiplier + (next.tintMultiplier - keyframe.tintMultiplier) * interped,\r\n\t\t\t\t\t\tlColor\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tadvanced = 0;\r\n\t\tpreviousElapsed = elapsed;\r\n\t}\r\n\r\n\r\n\tprivate function createChildIfNessessary(keyframe:Keyframe){\r\n\t\tif(keyframe.isEmpty) return;\r\n\t\tif(createdChildren.exists(keyframe.displayKey) == false){\r\n\t\t\tmovie.createFlumpChild(keyframe.displayKey);\r\n\t\t\tcreatedChildren[keyframe.displayKey] = true;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tprivate function removeChildIfNessessary(keyframe:Keyframe){\r\n\t\tif(currentChildrenKey.exists(keyframe.layer)){\r\n\t\t\tmovie.removeFlumpChild(keyframe.layer, keyframe.displayKey);\r\n\t\t\tcurrentChildrenKey.remove(keyframe.layer);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tprivate function addChildIfNessessary(keyframe:Keyframe){\r\n\t\tif(keyframe.isEmpty) return;\r\n\t\tcurrentChildrenKey[keyframe.layer] = keyframe.displayKey;\r\n\t\tmovie.addFlumpChild(keyframe.layer, keyframe.displayKey);\r\n\t}\r\n\r\n\r\n\t\r\n\t//////////////////////////////////////////////////////////////\r\n\t//\r\n\t//  Utilities\r\n\t//\r\n\t//////////////////////////////////////////////////////////////\r\n\r\n\tprivate function setState(state:String){\r\n\t\tthis.state = state;\r\n\r\n\t\tfor(layer in symbol.layers){\r\n\t\t\tvar keyframe = layer.getKeyframeForTime(position);\r\n\t\t\tcreateChildIfNessessary(keyframe);\r\n\r\n\t\t\tif(keyframe.symbol.is(MovieSymbol)){\r\n\t\t\t\tvar childMovie = movie.getChildPlayer(keyframe);\r\n\t\t\t\tif(childMovie.independantControl == false){\r\n\t\t\t\t\tchildMovie.setState(state);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tadvanceTime(0);\r\n\t}\r\n\r\n\r\n\tprivate function timeForLabel(label:String):Float{\r\n\t\treturn symbol.labels[label].keyframe.time;\r\n\t}\r\n\r\n\r\n\tprivate function getInterpolation(keyframe:Keyframe, time:Float){\r\n\t\tif(keyframe.tweened == false) return 0.0;\r\n\t\t\r\n\t\tvar interped = (time - keyframe.time) / keyframe.duration;\r\n\t\tvar ease:Float = keyframe.ease;\r\n\t\tif (ease != 0) {\r\n\t\t\tvar t :Float;\r\n\t\t\tif (ease < 0) {\r\n\t\t\t\t// Ease in\r\n\t\t\t\tvar inv:Float = 1 - interped;\r\n\t\t\t\tt = 1 - inv * inv;\r\n\t\t\t\tease = -ease;\r\n\t\t\t} else {\r\n\t\t\t\t// Ease out\r\n\t\t\t\tt = interped * interped;\r\n\t\t\t}\r\n\t\t\tinterped = ease * t + (1 - ease) * interped;\r\n\t\t}\r\n\t\treturn interped;\r\n\t}\r\n\r\n\r\n}\r\n\r\n","package flump.filters;\r\nimport pixi.core.renderers.webgl.filters.AbstractFilter;\r\n\r\nprivate typedef Uniform = {\r\n\tvar type:String;\r\n\tvar value:Dynamic;\r\n}\r\n\r\nprivate typedef AnimateTint = {\r\n\tvar multiplier: Uniform;\r\n\tvar color : Uniform;\r\n}\r\n\r\nprivate typedef V3 = {\r\n\tvar x:Float;\r\n\tvar y:Float;\r\n\tvar z:Float;\r\n}\r\n\r\n/**\r\n * Filter that reproduce the behaviour of Tint in Adobe Flash/Animate\r\n * @author Mathieu Anthoine\r\n */\r\nclass AnimateTintFilter extends AbstractFilter\r\n{\r\n\r\n\tpublic var multiplier (default,null):Float;\r\n\tpublic var color (default, null):UInt;\r\n\t\r\n\tprivate var uniforms:AnimateTint;\r\n\t\r\n\tpublic function new(pColor:UInt,pMultiplier:Float=1) \r\n\t{\r\n\t\tcolor = pColor;\r\n\t\tmultiplier = pMultiplier;\r\n\t\tuniforms = {color: {type: \"v3\", value: hex2v3(color)}, multiplier: {type: \"1f\", value: multiplier}};\r\n\t\tsuper(null,getFragmentSrc(), uniforms);\r\n\r\n\t}\r\n\t\r\n\tprivate function getFragmentSrc ():String {\r\n\t\tvar lSrc:String = \"\";\r\n\t\tlSrc += \"precision mediump float;varying vec2 vTextureCoord;uniform sampler2D uSampler;uniform vec3 color;uniform float multiplier;\";\r\n\t\tlSrc += \"void main () { gl_FragColor = texture2D(uSampler, vTextureCoord);\";\r\n\t\tlSrc += \"gl_FragColor.r = (color.r*multiplier+gl_FragColor.r*(1.0-multiplier)) * gl_FragColor.a;\";\r\n\t\tlSrc += \"gl_FragColor.g = (color.g*multiplier+gl_FragColor.g*(1.0-multiplier)) * gl_FragColor.a;\";\r\n\t\tlSrc += \"gl_FragColor.b = (color.b*multiplier+gl_FragColor.b*(1.0-multiplier)) * gl_FragColor.a;\";\r\n\t\tlSrc += \"}\";\r\n\t\treturn lSrc;\r\n\t}\r\n\t\r\n\tprivate function hex2v3(pColor:UInt):V3 {\r\n\t\treturn {x:(pColor >> 16 & 0xFF) / 255,y:(pColor >> 8 & 0xFF) / 255,z: (pColor & 0xFF) / 255};\r\n\t}\r\n\t\r\n\tpublic function update(pColor:UInt, pMultiplier:Float = 1) : Void {\r\n\t\tuniforms.color.value = hex2v3(color=pColor);\r\n\t\tuniforms.multiplier.value = multiplier= pMultiplier;\r\n\t}\r\n\t\r\n}","package flump.json;\r\n\r\ntypedef FlumpJSON = {\r\n\tvar md5:String;\r\n\tvar movies:Array<MovieSpec>;\r\n\tvar textureGroups:Array<TextureGroupSpec>;\r\n\tvar frameRate: UInt;\r\n}\r\n\r\n\r\nabstract FlumpPointSpec(Array<Float>){\r\n\r\n\tpublic var x(get, never):Float;\r\n\tpublic var y(get, never):Float;\r\n\r\n\tinline public function get_x():Float{\r\n\t\treturn this[0];\r\n\t}\r\n\r\n\tinline public function get_y():Float{\r\n\t\treturn this[1];\r\n\t}\r\n}\r\n\r\n\r\nabstract FlumpRectSpec(Array<Float>){\r\n\r\n\tpublic var x(get, never):Float;\r\n\tpublic var y(get, never):Float;\r\n\tpublic var width(get, never):Float;\r\n\tpublic var height(get, never):Float;\r\n\r\n\tinline public function get_x():Float{\r\n\t\treturn this[0];\r\n\t}\r\n\r\n\tinline public function get_y():Float{\r\n\t\treturn this[1];\r\n\t}\r\n\r\n\tinline public function get_width():Float{\r\n\t\treturn this[2];\r\n\t}\r\n\r\n\tinline public function get_height():Float{\r\n\t\treturn this[3];\r\n\t}\r\n}\r\n\r\ntypedef MovieSpec = {\r\n\tvar layers:Array<LayerSpec>;\r\n\tvar id:ReferenceSpec;\r\n\t@:optional var baseClass:String;\r\n\t@:optional var data:Dynamic;\r\n}\r\n\r\ntypedef ReferenceSpec = String;\r\n\r\ntypedef KeyframeSpec = {\r\n\tvar pivot:FlumpPointSpec;\r\n\tvar duration:UInt;\r\n\tvar loc:FlumpPointSpec;\r\n\tvar index:UInt;\r\n\tvar ref:ReferenceSpec;\r\n\tvar scale:FlumpPointSpec;\r\n\tvar skew:FlumpPointSpec;\r\n\tvar ease:Float;\r\n\tvar tweened:Bool;\r\n\tvar label:String;\r\n\tvar alpha:Float;\r\n\t@:optional var tint:Array<Dynamic>;\r\n\t@:optional var data:Dynamic;\r\n}\r\n\r\n\r\ntypedef TextureSpec = {\r\n\tvar symbol:ReferenceSpec;\r\n\tvar rect:FlumpRectSpec;\r\n\tvar origin:FlumpPointSpec;\r\n\t@:optional var baseClass:String;\r\n\t@:optional var data:Dynamic;\r\n}\r\n\r\n\r\ntypedef TextureGroupSpec = {\r\n\tvar atlases:Array<AtlasSpec>;\r\n\tvar scaleFactor:UInt;\r\n}\r\n\r\n\r\ntypedef AtlasSpec = {\r\n\tvar file:String;\r\n\tvar textures:Array<TextureSpec>;\r\n}\r\n\r\n\r\ntypedef LayerSpec = {\r\n\tvar name:String;\r\n\tvar keyframes:Array<KeyframeSpec>;\r\n\t@:optional var mask:String;\r\n}\r\n\r\n\r\n\r\n","package flump.library;\r\n\r\nimport flump.DisplayObjectKey;\r\nimport flump.json.FlumpJSON;\r\nimport flump.library.Label;\r\nusing Lambda;\r\n\r\n\r\nclass FlumpLibrary{\r\n\r\n\tpublic var movies = new Map<String, MovieSymbol>();\r\n\tpublic var sprites = new Map<String, SpriteSymbol>();\r\n\tpublic var atlases = new Array<AtlasSpec>();\r\n\tpublic var framerate:Float;\r\n\tpublic var frameTime:Float;\r\n\tpublic var md5:String;\r\n\tpublic var resolution:Float;\r\n\r\n\r\n\tfunction new(resolution:Float){\r\n\t\tthis.resolution = resolution;\r\n\t}\r\n\r\n\r\n\tpublic static function create(flumpData:Dynamic, resolution:Float):FlumpLibrary{\r\n\t\tvar lib:FlumpJSON = cast flumpData;\r\n\t\t\r\n\t\tvar spriteSymbols = new Map<String, SpriteSymbol>();\r\n\t\tvar movieSymbols = new Map<String, MovieSymbol>();\r\n\r\n\t\tvar flumpLibrary = new FlumpLibrary(resolution);\r\n\t\tflumpLibrary.sprites = spriteSymbols;\r\n\t\tflumpLibrary.movies = movieSymbols;\r\n\t\tflumpLibrary.framerate = lib.frameRate;\r\n\t\tflumpLibrary.frameTime = 1000/flumpLibrary.framerate;\t\t\r\n\t\tflumpLibrary.md5 = lib.md5;\r\n\r\n\t\tvar atlasSpecs = new Array<flump.json.FlumpJSON.AtlasSpec>();\r\n\t\tvar textureGroup = null;\r\n\r\n\t\t// Find best suited resolution from available textures\r\n\t\tfor(tg in lib.textureGroups){\r\n\t\t\tif(tg.scaleFactor >= resolution && textureGroup == null) textureGroup = tg;\r\n\t\t}\r\n\t\tif(textureGroup == null) textureGroup =  lib.textureGroups[lib.textureGroups.length-1];\r\n\r\n\r\n\t\tfor(atlas in textureGroup.atlases){\r\n\t\t\tflumpLibrary.atlases.push(atlas);\r\n\t\t\tatlasSpecs.push(atlas);\r\n\t\t}\r\n\r\n\r\n\t\tfor(spec in atlasSpecs){\t\t\t\r\n\t\t\tfor(textureSpec in spec.textures){\r\n\t\t\t\tvar frame = new Rectangle(textureSpec.rect.x, textureSpec.rect.y, textureSpec.rect.width, textureSpec.rect.height);\r\n\t\t\t\tvar origin = new Point(textureSpec.origin.x, textureSpec.origin.y);\r\n\t\t\t\r\n\t\t\t\tvar symbol = new SpriteSymbol();\r\n\t\t\t\tsymbol.name = textureSpec.symbol;\r\n\t\t\t\tsymbol.data = textureSpec.data;\r\n\t\t\t\tsymbol.baseClass = textureSpec.baseClass;\t\t\t\t\r\n\t\t\t\tsymbol.origin = origin;\r\n\t\t\t\tsymbol.texture = textureSpec.symbol;\r\n\t\t\t\tspriteSymbols[symbol.name] = symbol;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar pendingSymbolAttachments = new Map<Keyframe, String>();\r\n\t\tfor(movieSpec in lib.movies){\r\n\t\t\tvar symbol = new MovieSymbol();\r\n\t\t\tsymbol.name = movieSpec.id;\r\n\t\t\tsymbol.data = movieSpec.data;\r\n\t\t\tsymbol.baseClass = movieSpec.baseClass;\r\n\t\t\tsymbol.library = flumpLibrary;\r\n\t\t\tfor(layerSpec in movieSpec.layers){\r\n\t\t\t\tvar layer = new Layer(layerSpec.name);\r\n\t\t\t\tlayer.movie = symbol;\r\n\t\t\t\tlayer.mask = layerSpec.mask;\r\n\t\t\t\tvar layerDuration:Float = 0;\r\n\t\t\t\tvar previousKeyframe:Keyframe = null;\r\n\t\t\t\tfor(keyframeSpec in layerSpec.keyframes){\r\n\t\t\t\t\tvar keyframe = new Keyframe();\r\n\t\t\t\t\tkeyframe.prev = previousKeyframe;\r\n\t\t\t\t\tif(previousKeyframe != null) previousKeyframe.next = keyframe;\r\n\t\t\t\t\tkeyframe.layer = layer;\r\n\t\t\t\t\tkeyframe.numFrames = keyframeSpec.duration;\r\n\t\t\t\t\tkeyframe.duration = keyframeSpec.duration * flumpLibrary.frameTime;\r\n\t\t\t\t\tkeyframe.index = keyframeSpec.index;\r\n\r\n\t\t\t\t\tvar time = keyframe.index * flumpLibrary.frameTime;\r\n\t\t\t\t\ttime *= 10;\r\n\t\t\t\t\ttime = Math.floor(time);\r\n\t\t\t\t\ttime /= 10;\r\n\t\t\t\t\tkeyframe.time = time;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(keyframeSpec.ref == null){\r\n\t\t\t\t\t\tkeyframe.isEmpty = true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tkeyframe.isEmpty = false;\r\n\t\t\t\t\t\tkeyframe.symbolId = keyframeSpec.ref;\r\n\t\t\t\t\t\tkeyframe.pivot = keyframeSpec.pivot == null ? new Point(0,0) : new Point( keyframeSpec.pivot.x * resolution, keyframeSpec.pivot.y * resolution);\r\n\t\t\t\t\t\tkeyframe.location = keyframeSpec.loc == null ? new Point(0,0) : new Point( keyframeSpec.loc.x * resolution, keyframeSpec.loc.y * resolution);\r\n\t\t\t\t\t\tkeyframe.tweened = keyframeSpec.tweened == false ? false : true;\r\n\t\t\t\t\t\tkeyframe.symbol = null;\r\n\t\t\t\t\t\tkeyframe.scale = keyframeSpec.scale == null ? new Point(1,1) : new Point(keyframeSpec.scale.x, keyframeSpec.scale.y);\r\n\t\t\t\t\t\tkeyframe.skew = keyframeSpec.skew == null ? new Point(0,0) : new Point(keyframeSpec.skew.x, keyframeSpec.skew.y);\r\n\t\t\t\t\t\tkeyframe.alpha = keyframeSpec.alpha == null ? 1 : keyframeSpec.alpha;\r\n\t\t\t\t\t\tkeyframe.tintMultiplier = keyframeSpec.tint == null ? 0 : keyframeSpec.tint[0];\r\n\t\t\t\t\t\tkeyframe.tintColor = keyframeSpec.tint == null ? 0 : Std.parseInt(StringTools.replace(cast(keyframeSpec.tint[1], String), \"#\", \"0x\"));\r\n\t\t\t\t\t\tkeyframe.data = keyframeSpec.data;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tkeyframe.ease = keyframeSpec.ease == null ? 0 : keyframeSpec.ease;\t\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(layer.keyframes.length == 0) layer.firstKeyframe = keyframe;\r\n\r\n\t\t\t\t\tif(keyframeSpec.label != null){\r\n\t\t\t\t\t\tkeyframe.label = new Label();\r\n\t\t\t\t\t\tkeyframe.label.keyframe = keyframe;\r\n\t\t\t\t\t\tkeyframe.label.name = keyframeSpec.label;\r\n\t\t\t\t\t\tsymbol.labels.set(keyframe.label.name, keyframe.label);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(keyframe.time + keyframe.duration > layer.duration){\r\n\t\t\t\t\t\tlayerDuration = keyframe.time + keyframe.duration;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tpendingSymbolAttachments[keyframe] = keyframeSpec.ref;\r\n\t\t\t\t\tlayer.keyframes.push(keyframe);\r\n\t\t\t\t\tpreviousKeyframe = keyframe;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlayer.lastKeyframe = layer.keyframes[layer.keyframes.length - 1];\r\n\t\t\t\tlayer.keyframes[0].prev = layer.lastKeyframe;\r\n\t\t\t\tlayer.lastKeyframe.next = layer.keyframes[0];\r\n\t\t\t\tsymbol.layers.push(layer);\r\n\r\n\t\t\t\tvar allAreEmpty = layer.keyframes.foreach(function(keyframe) return keyframe.isEmpty);\r\n\r\n\t\t\t\tif(allAreEmpty){\r\n\t\t\t\t\t\r\n\t\t\t\t}else{\r\n\t\t\t\t\tfor(keyframe in layer.keyframes){\r\n\t\t\t\t\t\tvar hasNonEmptySibling = layer.keyframes.exists(function(checkedKeyframe) return checkedKeyframe.isEmpty == false && checkedKeyframe != keyframe);\r\n\t\t\t\t\t\tif(hasNonEmptySibling){\r\n\t\t\t\t\t\t\tvar checked = keyframe.prev;\r\n\t\t\t\t\t\t\twhile(checked.isEmpty) checked = checked.prev;\r\n\t\t\t\t\t\t\tkeyframe.prevNonEmptyKeyframe = checked;\r\n\r\n\t\t\t\t\t\t\tchecked = keyframe.next;\r\n\t\t\t\t\t\t\twhile(checked.isEmpty) checked = checked.next;\r\n\t\t\t\t\t\t\tkeyframe.nextNonEmptyKeyframe = checked;\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tkeyframe.prevNonEmptyKeyframe = keyframe;\r\n\t\t\t\t\t\t\tkeyframe.nextNonEmptyKeyframe = keyframe;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Set up diplay keys\r\n\t\t\t\t\tvar firstNonEmpty = layer.keyframes.find(function(checkedKeyframe) return checkedKeyframe.isEmpty == false);\r\n\t\t\t\t\tif(firstNonEmpty != null) firstNonEmpty.displayKey = new DisplayObjectKey(firstNonEmpty.symbolId);\r\n\t\t\t\t\tvar checked = firstNonEmpty.nextNonEmptyKeyframe;\r\n\t\t\t\t\twhile(checked != firstNonEmpty){\r\n\t\t\t\t\t\tif(checked.symbolId == checked.prevNonEmptyKeyframe.symbolId) checked.displayKey = checked.prevNonEmptyKeyframe.displayKey;\r\n\t\t\t\t\t\telse checked.displayKey = new DisplayObjectKey(checked.symbolId);\r\n\t\t\t\t\t\tchecked = checked.nextNonEmptyKeyframe;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\r\n\t\t\t}\r\n\r\n\t\t\tfunction getHighestFrameNumber(layer:Layer, accum:UInt){\r\n\t\t\t\tvar layerLength = layer.lastKeyframe.index + layer.lastKeyframe.numFrames;\r\n\t\t\t\treturn layerLength > accum\r\n\t\t\t\t\t? layerLength\r\n\t\t\t\t\t: accum;\r\n\t\t\t}\r\n\r\n\t\t\tsymbol.totalFrames = symbol.layers.fold( getHighestFrameNumber, 0 );\r\n\t\t\tsymbol.duration = symbol.totalFrames * flumpLibrary.frameTime;\r\n\r\n\t\t\tvar labels = new Array<Label>();\r\n\t\t\tfor(layer in symbol.layers){\r\n\t\t\t\tfor(keyframe in layer.keyframes){\r\n\t\t\t\t\tif(keyframe.label != null){\r\n\t\t\t\t\t\tlabels.push(keyframe.label);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\thaxe.ds.ArraySort.sort(labels, sortLabel);\r\n\t\t\tfor(i in 0...labels.length){\r\n\t\t\t\tvar nextIndex = i+1;\r\n\t\t\t\tif(nextIndex >= labels.length) nextIndex = 0;\r\n\r\n\t\t\t\tvar label = labels[i];\r\n\t\t\t\tvar nextLabel = labels[nextIndex];\r\n\t\t\t\tlabel.next = nextLabel;\r\n\t\t\t\tnextLabel.prev = label;\r\n\t\t\t}\r\n\t\t\tsymbol.firstLabel = labels[0];\r\n\t\t\tsymbol.lastLabel = labels[labels.length-1];\r\n\t\t\t\r\n\t\t\tmovieSymbols[symbol.name] = symbol;\t\t\t\r\n\t\t}\r\n\r\n\t\tfor(keyframe in pendingSymbolAttachments.keys()){\r\n\t\t\tvar symbolId = pendingSymbolAttachments[keyframe];\r\n\t\t\tkeyframe.symbol = spriteSymbols[symbolId] != null ? spriteSymbols[symbolId] : movieSymbols[symbolId];\r\n\t\t}\r\n\r\n\t\treturn flumpLibrary;\r\n\t}\r\n\r\n\r\n\tprivate static function sortLabel(a:Label, b:Label):Int{\r\n\t\tif(a.keyframe.index < b.keyframe.index) return -1;\r\n\t\telse if(a.keyframe.index > b.keyframe.index) return 1;\r\n\t\treturn 0;\r\n\t}\r\n\r\n\r\n\r\n}","package flump.library;\r\n\r\n\r\nclass Keyframe{\r\n\r\n\tpublic var layer:Layer;\r\n\tpublic var symbolId:String;\r\n\tpublic var pivot:Point;\r\n\t\r\n\tpublic var location:Point;\r\n\tpublic var tweened:Bool;\r\n\r\n\tpublic var index:UInt;\r\n\tpublic var numFrames:UInt;\r\n\r\n\tpublic var time:Float;\r\n\tpublic var duration:Float;\r\n\t\r\n\tpublic var symbol:Symbol;\r\n\tpublic var scale:Point;\r\n\tpublic var skew:Point;\r\n\tpublic var ease:Float;\r\n\tpublic var label:Label;\r\n\tpublic var isEmpty:Bool;\r\n\tpublic var alpha:Float;\r\n\tpublic var data:Dynamic;\r\n\tpublic var tintMultiplier:Float;\r\n\tpublic var tintColor:UInt;\r\n\tpublic var next:Keyframe;\r\n\tpublic var prev:Keyframe;\r\n\tpublic var nextNonEmptyKeyframe:Keyframe;\r\n\tpublic var prevNonEmptyKeyframe:Keyframe;\r\n\tpublic var displayKey:DisplayObjectKey;\r\n\r\n\tpublic function new(){}\r\n\r\n\t// Does the time fall inside of the the keyframe frames\r\n\tpublic function timeInside(time:Float):Bool{\r\n\t\treturn (this.time <= time) && (this.time + duration) > time;\r\n\t}\r\n\r\n\t// Does the range fit inside of the keyframe frames\r\n\tpublic function rangeInside(from:Float, to:Float):Bool{\r\n\t\treturn timeInside(from) && timeInside(to);\r\n\t}\r\n\r\n\t// Does the range intersect with the keyframe frames\r\n\tpublic function rangeIntersect(from:Float, to:Float):Bool{\r\n\t\treturn timeInside(from) || timeInside(to);\r\n\t}\r\n\r\n\t// Does the start of the keyframe frames fall inside the range. (Checks for a range that wraps around)\r\n\tpublic function insideRangeStart(from:Float, to:Float):Bool{\r\n\t\t//if(from > to && to == time) return true;\r\n\t\treturn from <= to \r\n\t\t\t? time > from && time <= to\r\n\t\t\t: time > from || time <= to;\r\n\t}\r\n\r\n\t// Does the end of the keyframe frames fall inside the range. (Checks for a range that wraps around, and assuming backward playback);\r\n\tpublic function insideRangeEnd(from:Float, to:Float):Bool{\r\n\t\tif(from == to && to == time + duration) return true;\r\n\t\treturn from > to\r\n\t\t\t? to <= time + duration && from > time + duration\r\n\t\t\t: to <= time + duration || from > time + duration;\r\n\t}\r\n\r\n}\r\n\r\n","package flump.library;\r\n\r\nclass Label{\r\n\r\n\tpublic var name:String;\r\n\tpublic var keyframe:Keyframe;\r\n\tpublic var next:Label;\r\n\tpublic var prev:Label;\r\n\r\n\tpublic static var LABEL_ENTER:String = \"labelEnter\";\r\n\tpublic static var LABEL_EXIT:String = \"labelExit\";\r\n\tpublic static var LABEL_UPDATE:String = \"labelUpdate\";\r\n\r\n\tpublic function new(){}\r\n\r\n}","package flump.library;\r\nimport flump.filters.AnimateTintFilter;\r\n\r\nclass Layer{\r\n\r\n\tpublic var keyframes = new Array<Keyframe>();\r\n\tpublic var duration:Float;\r\n\tpublic var name:String;\r\n\tpublic var movie:MovieSymbol;\r\n\tpublic var numFrames:UInt;\r\n\tpublic var mask:String;\r\n\tpublic var firstKeyframe:Keyframe;\r\n\tpublic var lastKeyframe:Keyframe;\r\n\tpublic var refAnimatedTint:AnimateTintFilter;\r\n\r\n\tpublic function new(name:String){\r\n\t\tthis.name = name;\r\n\t}\r\n\r\n\r\n\tpublic function getKeyframeForFrame(index:UInt):Keyframe{\r\n\t\tfor(keyframe in keyframes){\r\n\t\t\tif(keyframe.index <= index && keyframe.index + keyframe.numFrames > index){\r\n\t\t\t\treturn keyframe;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\r\n\tpublic function getKeyframeForTime(time:Float){\r\n\t\tvar keyframe = lastKeyframe;\r\n\t\twhile(keyframe.time > time % movie.duration) keyframe = keyframe.prev;\r\n\t\treturn keyframe;\r\n\t}\r\n\r\n}","package flump.library;\r\n\r\n\r\nclass Symbol{\r\n\r\n\tpublic var name:String;\r\n\tpublic var data:Dynamic;\r\n\tpublic var baseClass:String;\r\n\t\r\n\tpublic function new(){}\r\n\r\n}","package flump.library;\r\n\r\nimport flump.library.FlumpLibrary;\r\n\r\n\r\nclass MovieSymbol extends Symbol{\r\n\r\n\tpublic var layers = new Array<Layer>();\r\n\tpublic var labels = new Map<String, Label>();\r\n\tpublic var library:FlumpLibrary;\r\n\r\n\tpublic var duration:Float;\r\n\tpublic var totalFrames:UInt;\r\n\tpublic var firstLabel:Label;\r\n\tpublic var lastLabel:Label;\r\n\r\n\r\n\tpublic function new(){\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic function getLayer(name:String):Layer{\r\n\t\tfor(layer in layers) if(layer.name == name) return layer;\r\n\t\treturn null;\r\n\t}\r\n\r\n\r\n\tpublic function debug(){\r\n\t\tvar largestLayerChars = Lambda.fold(layers, function(layer, result) return layer.name.length > result ? layer.name.length : result, 0);\r\n\r\n\t\tfunction repeat(character, amount){\r\n\t\t\tvar output = \"\";\r\n\t\t\twhile(amount > 0){\r\n\t\t\t\toutput += character;\r\n\t\t\t\tamount--;\r\n\t\t\t}\r\n\t\t\treturn output;\r\n\t\t}\r\n\r\n\t\t//\r\n\t\tvar output = \"asdfsadf\\n\";\r\n\r\n\t\toutput += repeat(\" \", largestLayerChars);\t\r\n\t\toutput += \"   \";\r\n\t\tfor(i in 0...totalFrames){\r\n\t\t\tif(i%5 == 0) output += i;\r\n\t\t\telse{\r\n\t\t\t\tif(i % 6 != 0 || i < 10) output += \" \";\r\n\t\t\t}\r\n\t\t}\r\n\t\toutput += \"\\n\";\r\n\r\n\t\toutput += repeat(\" \", largestLayerChars);\t\r\n\t\toutput += \"   \";\r\n\t\tfor(i in 0...totalFrames){\r\n\t\t\tif(i%5 == 0) output += \"\";\r\n\t\t\telse output += \" \";\r\n\t\t}\r\n\t\toutput += \"\\n\";\r\n\r\n\r\n\t\tfor(i in 0...layers.length){\r\n\t\t\tvar layer = layers[i];\r\n\r\n\t\t\toutput += layer.name + repeat(\" \", largestLayerChars-layer.name.length); \r\n\t\t\toutput += \" : \";\r\n\t\t\tfor(keyframe in layer.keyframes){\r\n\t\t\t\tif(keyframe.symbolId != null){\r\n\t\t\t\t\toutput += \"\";\r\n\t\t\t\t\tif(keyframe.tweened) output += repeat(\"\", keyframe.numFrames-1);\r\n\t\t\t\t\telse output += repeat(\"\", keyframe.numFrames-1) ;\r\n\t\t\t\t}else{\r\n\t\t\t\t\toutput += \"\";\r\n\t\t\t\t\toutput += repeat(\"\", keyframe.numFrames-1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\toutput += '\\n';\r\n\t\t}\r\n\r\n\t\treturn output;\r\n\r\n\t}\r\n\r\n}","package flump.library;\r\n\r\nclass Point{\r\n\r\n\tpublic var x:Float;\r\n\tpublic var y:Float;\r\n\r\n\r\n\tpublic function new(x:Float, y:Float){\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n}","package flump.library;\r\n\r\nclass Rectangle{\r\n\r\n\tpublic var x:Float;\r\n\tpublic var y:Float;\r\n\tpublic var width:Float;\r\n\tpublic var height:Float;\r\n\r\n\r\n\tpublic function new(x:Float, y:Float, width:Float, height:Float){\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t}\r\n\r\n}","package flump.library;\r\n\r\nclass SpriteSymbol extends Symbol{\r\n\r\n\tpublic var texture:String;\r\n\tpublic var origin:Point;\r\n\r\n\r\n\tpublic function new(){\r\n\t\tsuper();\r\n\t}\r\n\r\n}","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe;\n\n/**\n\tThe Timer class allows you to create asynchronous timers on platforms that\n\tsupport events.\n\n\tThe intended usage is to create an instance of the Timer class with a given\n\tinterval, set its run() method to a custom function to be invoked and\n\teventually call stop() to stop the Timer.\n\n\tNote that a running Timer may or may not prevent the program to exit\n\tautomatically when main() returns.\n\n\tIt is also possible to extend this class and override its run() method in\n\tthe child class.\n**/\nclass Timer {\n\n\t#if (flash || js)\n\t\tprivate var id : Null<Int>;\n\t#elseif java\n\t\tprivate var timer : java.util.Timer;\n\t\tprivate var task : java.util.TimerTask;\n\t#else\n\t\tprivate var event : MainLoop.MainEvent;\n\t#end\n\n\t/**\n\t\tCreates a new timer that will run every `time_ms` milliseconds.\n\n\t\tAfter creating the Timer instance, it calls `this.run` repeatedly,\n\t\twith delays of `time_ms` milliseconds, until `this.stop` is called.\n\n\t\tThe first invocation occurs after `time_ms` milliseconds, not\n\t\timmediately.\n\n\t\tThe accuracy of this may be platform-dependent.\n\t**/\n\tpublic function new( time_ms : Int ){\n\t\t#if flash\n\t\t\tvar me = this;\n\t\t\tid = untyped __global__[\"flash.utils.setInterval\"](function() { me.run(); },time_ms);\n\t\t#elseif js\n\t\t\tvar me = this;\n\t\t\tid = untyped setInterval(function() me.run(),time_ms);\n\t\t#elseif java\n\t\t\ttimer = new java.util.Timer();\n\t\t\ttimer.scheduleAtFixedRate(task = new TimerTask(this), haxe.Int64.ofInt(time_ms), haxe.Int64.ofInt(time_ms));\n\t\t#else\n\t\t\tvar dt = time_ms / 1000;\n\t\t\tevent = MainLoop.add(function() {\n\t\t\t\t@:privateAccess event.nextRun += dt;\n\t\t\t\trun();\n\t\t\t});\n\t\t\tevent.delay(dt);\n\t\t#end\n\t}\n\n\t/**\n\t\tStops `this` Timer.\n\n\t\tAfter calling this method, no additional invocations of `this.run`\n\t\twill occur.\n\n\t\tIt is not possible to restart `this` Timer once stopped.\n\t**/\n\tpublic function stop() {\n\t\t#if (flash || js)\n\t\t\tif( id == null )\n\t\t\t\treturn;\n\t\t\t#if flash\n\t\t\t\tuntyped __global__[\"flash.utils.clearInterval\"](id);\n\t\t\t#elseif js\n\t\t\t\tuntyped clearInterval(id);\n\t\t\t#end\n\t\t\tid = null;\n\t\t#elseif java\n\t\t\tif(timer != null) {\n\t\t\t\ttimer.cancel();\n\t\t\t\ttimer = null;\n\t\t\t}\n\t\t\ttask = null;\n\t\t#else\n\t\t\tif( event != null ) {\n\t\t\t\tevent.stop();\n\t\t\t\tevent = null;\n\t\t\t}\n\t\t#end\n\t}\n\n\t/**\n\t\tThis method is invoked repeatedly on `this` Timer.\n\n\t\tIt can be overridden in a subclass, or rebound directly to a custom\n\t\tfunction:\n\t\t\tvar timer = new haxe.Timer(1000); // 1000ms delay\n\t\t\ttimer.run = function() { ... }\n\n\t\tOnce bound, it can still be rebound to different functions until `this`\n\t\tTimer is stopped through a call to `this.stop`.\n\t**/\n\tpublic dynamic function run() {\n\n\t}\n\n\t/**\n\t\tInvokes `f` after `time_ms` milliseconds.\n\n\t\tThis is a convenience function for creating a new Timer instance with\n\t\t`time_ms` as argument, binding its run() method to `f` and then stopping\n\t\t`this` Timer upon the first invocation.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function delay( f : Void -> Void, time_ms : Int ) {\n\t\tvar t = new haxe.Timer(time_ms);\n\t\tt.run = function() {\n\t\t\tt.stop();\n\t\t\tf();\n\t\t};\n\t\treturn t;\n\t}\n\n\t/**\n\t\tMeasures the time it takes to execute `f`, in seconds with fractions.\n\n\t\tThis is a convenience function for calculating the difference between\n\t\tTimer.stamp() before and after the invocation of `f`.\n\n\t\tThe difference is passed as argument to Log.trace(), with \"s\" appended\n\t\tto denote the unit. The optional `pos` argument is passed through.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function measure<T>( f : Void -> T, ?pos : PosInfos ) : T {\n\t\tvar t0 = stamp();\n\t\tvar r = f();\n\t\tLog.trace((stamp() - t0) + \"s\", pos);\n\t\treturn r;\n\t}\n\n\t/**\n\t\tReturns a timestamp, in seconds with fractions.\n\n\t\tThe value itself might differ depending on platforms, only differences\n\t\tbetween two values make sense.\n\t**/\n\tpublic static function stamp() : Float {\n\t\t#if flash\n\t\t\treturn flash.Lib.getTimer() / 1000;\n\t\t#elseif (neko || php)\n\t\t\treturn Sys.time();\n\t\t#elseif js\n\t\t\treturn Date.now().getTime() / 1000;\n\t\t#elseif cpp\n\t\t\treturn untyped __global__.__time_stamp();\n\t\t#elseif sys\n\t\t\treturn Sys.time();\n\t\t#else\n\t\t\treturn 0;\n\t\t#end\n\t}\n\n}\n\n#if java\n@:nativeGen\nprivate class TimerTask extends java.util.TimerTask {\n\tvar timer:Timer;\n\tpublic function new(timer:Timer):Void {\n\t\tsuper();\n\t\tthis.timer = timer;\n\t}\n\n\t@:overload override public function run():Void {\n\t\ttimer.run();\n\t}\n}\n#end\n","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage haxe.ds;\n\n/**\n\tArraySort provides a stable implementation of merge sort through its `sort`\n\tmethod. It should be used instead of `Array.sort` in cases where the order\n\tof equal elements has to be retained on all targets.\n**/\nclass ArraySort {\n\n\t/**\n\t\tSorts Array `a` according to the comparison function `cmp`, where\n\t\t`cmp(x,y)` returns 0 if `x == y`, a positive Int if `x > y` and a\n\t\tnegative Int if `x < y`.\n\n\t\tThis operation modifies Array `a` in place.\n\n\t\tThis operation is stable: The order of equal elements is preserved.\n\n\t\tIf `a` or `cmp` are null, the result is unspecified.\n\t**/\n\tstatic public function sort<T>(a:Array<T>, cmp:T -> T -> Int) {\n\t\trec(a, cmp, 0, a.length);\n\t}\n\n\tstatic function rec<T>(a:Array<T>, cmp, from, to) {\n\t\tvar middle = (from + to) >> 1;\n\t\tif (to - from < 12) {\n\t\t\tif (to <= from) return;\n\t\t\tfor (i in (from + 1)...to) {\n\t\t\t\tvar j = i;\n\t\t\t\twhile (j > from) {\n\t\t\t\t\tif (compare(a, cmp, j, j - 1) < 0)\n\t\t\t\t\t\tswap(a, j - 1, j);\n\t\t\t\t\telse\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tj--;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\trec(a, cmp, from, middle);\n\t\trec(a, cmp, middle, to);\n\t\tdoMerge(a, cmp, from, middle, to, middle - from, to - middle);\n\t}\n\n\tstatic function doMerge<T>(a:Array<T>, cmp, from, pivot, to, len1, len2) {\n\t\tvar first_cut, second_cut, len11, len22, new_mid;\n\t\tif (len1 == 0 || len2 == 0)\n\t\t\treturn;\n\t\tif (len1 + len2 == 2) {\n\t\t\tif (compare(a, cmp, pivot, from) < 0)\n\t\t\t\tswap(a, pivot, from);\n\t\t\treturn;\n\t\t}\n\t\tif (len1 > len2) {\n\t\t\tlen11 = len1 >> 1;\n\t\t\tfirst_cut = from + len11;\n\t\t\tsecond_cut = lower(a, cmp, pivot, to, first_cut);\n\t\t\tlen22 = second_cut - pivot;\n\t\t} else {\n\t\t\tlen22 = len2 >> 1;\n\t\t\tsecond_cut = pivot + len22;\n\t\t\tfirst_cut = upper(a, cmp, from, pivot, second_cut);\n\t\t\tlen11 = first_cut - from;\n\t\t}\n\t\trotate(a, cmp, first_cut, pivot, second_cut);\n\t\tnew_mid = first_cut + len22;\n\t\tdoMerge(a, cmp, from, first_cut, new_mid, len11, len22);\n\t\tdoMerge(a, cmp, new_mid, second_cut, to, len1 - len11, len2 - len22);\n\t}\n\n\tstatic function rotate<T>(a:Array<T>, cmp, from, mid, to) {\n\t\tvar n;\n\t\tif (from == mid || mid == to) return;\n\t\tn = gcd(to - from, mid - from);\n\t\twhile (n-- != 0) {\n\t\t\tvar val = a[from + n];\n\t\t\tvar shift = mid - from;\n\t\t\tvar p1 = from + n, p2 = from + n + shift;\n\t\t\twhile (p2 != from + n) {\n\t\t\t\ta[p1] = a[p2];\n\t\t\t\tp1 = p2;\n\t\t\t\tif (to - p2 > shift) p2 += shift;\n\t\t\t\telse p2 = from + (shift - (to - p2));\n\t\t\t}\n\t\t\ta[p1] = val;\n\t\t}\n\t}\n\n\tstatic function gcd(m, n) {\n\t\twhile (n != 0) {\n\t\t\tvar t = m % n;\n\t\t\tm = n;\n\t\t\tn = t;\n\t\t}\n\t\treturn m;\n\t}\n\n\tstatic function upper<T>(a:Array<T>, cmp, from, to, val) {\n\t\tvar len = to - from, half, mid;\n\t\twhile (len > 0) {\n\t\t\thalf = len >> 1;\n\t\t\tmid = from + half;\n\t\t\tif (compare(a, cmp, val, mid) < 0)\n\t\t\t\tlen = half;\n\t\t\telse {\n\t\t\t\tfrom = mid + 1;\n\t\t\t\tlen = len - half - 1;\n\t\t\t}\n\t\t}\n\t\treturn from;\n\t}\n\n\tstatic function lower<T>(a:Array<T>, cmp, from, to, val) {\n\t\tvar len = to - from, half, mid;\n\t\twhile (len > 0) {\n\t\t\thalf = len >> 1;\n\t\t\tmid = from + half;\n\t\t\tif (compare(a, cmp, mid, val) < 0) {\n\t\t\t\tfrom = mid + 1;\n\t\t\t\tlen = len - half - 1;\n\t\t\t} else\n\t\t\t\tlen = half;\n\t\t}\n\t\treturn from;\n\t}\n\n\tstatic function swap<T>(a:Array<T>, i, j) {\n\t\tvar tmp = a[i];\n\t\ta[i] = a[j];\n\t\ta[j] = tmp;\n\t}\n\n\tstatic inline function compare<T>(a:Array<T>, cmp, i, j) {\n\t\treturn cmp(a[i], a[j]);\n\t}\n}","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.ds;\n\n@:coreApi class IntMap<T> implements haxe.Constraints.IMap<Int,T> {\n\n\tprivate var h : Dynamic;\n\n\tpublic inline function new() : Void {\n\t\th = {};\n\t}\n\n\tpublic inline function set( key : Int, value : T ) : Void {\n\t\tuntyped h[key] = value;\n\t}\n\n\tpublic inline function get( key : Int ) : Null<T> {\n\t\treturn untyped h[key];\n\t}\n\n\tpublic inline function exists( key : Int ) : Bool {\n\t\treturn untyped h.hasOwnProperty(key);\n\t}\n\n\tpublic function remove( key : Int ) : Bool {\n\t\tif( untyped !h.hasOwnProperty(key) ) return false;\n\t\tuntyped  __js__(\"delete\")(h[key]);\n\t\treturn true;\n\t}\n\n\tpublic function keys() : Iterator<Int> {\n\t\tvar a = [];\n\t\tuntyped __js__(\"for( var key in {0} ) {1}\", h, if( h.hasOwnProperty(key) ) a.push(key|0));\n\t\treturn a.iterator();\n\t}\n\n\tpublic function iterator() : Iterator<T> {\n\t\treturn untyped {\n\t\t\tref : h,\n\t\t\tit : keys(),\n\t\t\thasNext : function() { return __this__.it.hasNext(); },\n\t\t\tnext : function() { var i = __this__.it.next(); return __this__.ref[i]; }\n\t\t};\n\t}\n\n\tpublic function toString() : String {\n\t\tvar s = new StringBuf();\n\t\ts.add(\"{\");\n\t\tvar it = keys();\n\t\tfor( i in it ) {\n\t\t\ts.add(i);\n\t\t\ts.add(\" => \");\n\t\t\ts.add(Std.string(get(i)));\n\t\t\tif( it.hasNext() )\n\t\t\t\ts.add(\", \");\n\t\t}\n\t\ts.add(\"}\");\n\t\treturn s.toString();\n\t}\n\n}\n","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of h software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and h permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage haxe.ds;\n\n@:coreApi\nclass ObjectMap<K:{ }, V> implements haxe.Constraints.IMap<K,V> {\n\n\tstatic var count = 0;\n\n\tstatic inline function assignId(obj: { } ):Int {\n\t\treturn untyped obj.__id__ = ++count;\n\t}\n\n\tstatic inline function getId(obj: { } ):Int {\n\t\treturn untyped obj.__id__;\n\t}\n\n\tvar h : { };\n\n\tpublic function new() : Void {\n\t\th = { __keys__: {} };\n\t}\n\n\tpublic function set(key:K, value:V):Void untyped {\n\t\tvar id : Int = getId(key) || assignId(key);\n\t\th[id] = value;\n\t\th.__keys__[id] = key;\n\t}\n\n\tpublic inline function get(key:K):Null<V> {\n\t\treturn untyped h[getId(key)];\n\t}\n\n\tpublic inline function exists(key:K):Bool {\n\t\treturn untyped h.__keys__[getId(key)] != null;\n\t}\n\n\tpublic function remove( key : K ) : Bool {\n\t\tvar id = getId(key);\n\t\tif ( untyped h.__keys__[id] == null ) return false;\n\t\tuntyped  __js__(\"delete\")(h[id]);\n\t\tuntyped  __js__(\"delete\")(h.__keys__[id]);\n\t\treturn true;\n\t}\n\n\tpublic function keys() : Iterator<K> {\n\t\tvar a = [];\n\t\tuntyped {\n\t\t\t__js__(\"for( var key in this.h.__keys__ ) {\");\n\t\t\t\tif( h.hasOwnProperty(key) )\n\t\t\t\t\ta.push(h.__keys__[key]);\n\t\t\t__js__(\"}\");\n\t\t}\n\t\treturn a.iterator();\n\t}\n\n\tpublic function iterator() : Iterator<V> {\n\t\treturn untyped {\n\t\t\tref : h,\n\t\t\tit : keys(),\n\t\t\thasNext : function() { return __this__.it.hasNext(); },\n\t\t\tnext : function() { var i = __this__.it.next(); return __this__.ref[getId(i)]; }\n\t\t};\n\t}\n\n\tpublic function toString() : String {\n\t\tvar s = new StringBuf();\n\t\ts.add(\"{\");\n\t\tvar it = keys();\n\t\tfor( i in it ) {\n\t\t\ts.add(Std.string(i));\n\t\t\ts.add(\" => \");\n\t\t\ts.add(Std.string(get(i)));\n\t\t\tif( it.hasNext() )\n\t\t\t\ts.add(\", \");\n\t\t}\n\t\ts.add(\"}\");\n\t\treturn s.toString();\n\t}\n}","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.ds;\n\nprivate class StringMapIterator<T> {\n\tvar map : StringMap<T>;\n\tvar keys : Array<String>;\n\tvar index : Int;\n\tvar count : Int;\n\tpublic inline function new(map:StringMap<T>, keys:Array<String>) {\n\t\tthis.map = map;\n\t\tthis.keys = keys;\n\t\tthis.index = 0;\n\t\tthis.count = keys.length;\n\t}\n\tpublic inline function hasNext() {\n\t\treturn index < count;\n\t}\n\tpublic inline function next() {\n\t\treturn map.get(keys[index++]);\n\t}\n}\n\n@:coreApi class StringMap<T> implements haxe.Constraints.IMap<String,T> {\n\n\tprivate var h : Dynamic;\n\tprivate var rh : Dynamic;\n\n\tpublic inline function new() : Void {\n\t\th = {};\n\t}\n\n\tinline function isReserved(key:String) : Bool {\n\t\treturn untyped __js__(\"__map_reserved\")[key] != null;\n\t}\n\n\tpublic inline function set( key : String, value : T ) : Void {\n\t\tif( isReserved(key) )\n\t\t\tsetReserved(key, value);\n\t\telse\n\t\t\th[cast key] = value;\n\t}\n\n\tpublic inline function get( key : String ) : Null<T> {\n\t\tif( isReserved(key) )\n\t\t\treturn getReserved(key);\n\t\treturn h[cast key];\n\t}\n\n\tpublic inline function exists( key : String ) : Bool {\n\t\tif( isReserved(key) )\n\t\t\treturn existsReserved(key);\n\t\treturn h.hasOwnProperty(key);\n\t}\n\n\tfunction setReserved( key : String, value : T ) : Void {\n\t\tif( rh == null ) rh = {};\n\t\trh[cast \"$\"+key] = value;\n\t}\n\n\tfunction getReserved( key : String ) : Null<T> {\n\t\treturn rh == null ? null : rh[cast \"$\"+key];\n\t}\n\n\tfunction existsReserved( key : String ) : Bool {\n\t\tif( rh == null ) return false;\n\t\treturn untyped rh.hasOwnProperty(\"$\"+key);\n\t}\n\n\tpublic function remove( key : String ) : Bool {\n\t\tif( isReserved(key) ) {\n\t\t\tkey = \"$\" + key;\n\t\t\tif( rh == null || !rh.hasOwnProperty(key) ) return false;\n\t\t\tuntyped __js__(\"delete\")(rh[key]);\n\t\t\treturn true;\n\t\t} else {\n\t\t\tif( !h.hasOwnProperty(key) )\n\t\t\t\treturn false;\n\t\t\tuntyped __js__(\"delete\")(h[key]);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tpublic function keys() : Iterator<String> {\n\t\treturn arrayKeys().iterator();\n\t}\n\t\n\tfunction arrayKeys() : Array<String> {\n\t\tvar out = [];\n\t\tuntyped {\n\t\t\t__js__(\"for( var key in this.h ) {\");\n\t\t\t\tif( h.hasOwnProperty(key) )\n\t\t\t\t\tout.push(key);\n\t\t\t__js__(\"}\");\n\t\t}\n\t\tif( rh != null ) untyped {\n\t\t\t__js__(\"for( var key in this.rh ) {\");\n\t\t\t\tif( key.charCodeAt(0) == \"$\".code )\n\t\t\t\t\tout.push(key.substr(1));\n\t\t\t__js__(\"}\");\n\t\t}\n\t\treturn out;\n\t}\n\n\tpublic inline function iterator() : Iterator<T> {\n\t\treturn new StringMapIterator(this, arrayKeys());\n\t}\n\n\tpublic function toString() : String {\n\t\tvar s = new StringBuf();\n\t\ts.add(\"{\");\n\t\tvar keys = arrayKeys();\n\t\tfor( i in 0...keys.length ) {\n\t\t\tvar k = keys[i];\n\t\t\ts.add(k);\n\t\t\ts.add(\" => \");\n\t\t\ts.add(Std.string(get(k)));\n\t\t\tif( i < keys.length-1 )\n\t\t\t\ts.add(\", \");\n\t\t}\n\t\ts.add(\"}\");\n\t\treturn s.toString();\n\t}\n\n\tstatic function __init__() : Void {\n\t\tuntyped __js__(\"var __map_reserved = {}\");\n\t}\n\n}\n","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.xml;\n\nusing StringTools;\n\n/* poor'man enum : reduce code size + a bit faster since inlined */\nextern private class S {\n\tpublic static inline var IGNORE_SPACES \t= 0;\n\tpublic static inline var BEGIN\t\t\t= 1;\n\tpublic static inline var BEGIN_NODE\t\t= 2;\n\tpublic static inline var TAG_NAME\t\t= 3;\n\tpublic static inline var BODY\t\t\t= 4;\n\tpublic static inline var ATTRIB_NAME\t= 5;\n\tpublic static inline var EQUALS\t\t\t= 6;\n\tpublic static inline var ATTVAL_BEGIN\t= 7;\n\tpublic static inline var ATTRIB_VAL\t\t= 8;\n\tpublic static inline var CHILDS\t\t\t= 9;\n\tpublic static inline var CLOSE\t\t\t= 10;\n\tpublic static inline var WAIT_END\t\t= 11;\n\tpublic static inline var WAIT_END_RET\t= 12;\n\tpublic static inline var PCDATA\t\t\t= 13;\n\tpublic static inline var HEADER\t\t\t= 14;\n\tpublic static inline var COMMENT\t\t= 15;\n\tpublic static inline var DOCTYPE\t\t= 16;\n\tpublic static inline var CDATA\t\t\t= 17;\n\tpublic static inline var ESCAPE\t\t\t= 18;\n}\n\nclass XmlParserException\n{\n\t/**\n\t * the XML parsing error message\n\t */\n\tpublic var message:String;\n\t\n\t/**\n\t * the line number at which the XML parsing error occured\n\t */\n\tpublic var lineNumber:Int;\n\t\n\t/**\n\t * the character position in the reported line at which the parsing error occured\n\t */\n\tpublic var positionAtLine:Int;\n\t\n\t/**\n\t * the character position in the XML string at which the parsing error occured\n\t */\n\tpublic var position:Int;\n\t\n\t/**\n\t * the invalid XML string\n\t */\n\tpublic var xml:String;\n\t\n\tpublic function new(message:String, xml:String, position:Int)\n\t{\n\t\tthis.xml = xml;\n\t\tthis.message = message;\n\t\tthis.position = position;\n\t\tlineNumber = 1;\n\t\tpositionAtLine = 0;\n\t\t\n\t\tfor( i in 0...position)\n\t\t{\n\t\t\tvar c = xml.fastCodeAt(i);\n\t\t\tif (c == '\\n'.code) {\n\t\t\t\tlineNumber++;\n\t\t\t\tpositionAtLine = 0;\n\t\t\t} else {\n\t\t\t\tif (c != '\\r'.code) positionAtLine++;\n\t\t\t}\n\t\t}\n\t}\n\t\n\tpublic function toString():String\n\t{\n\t\treturn Type.getClassName(Type.getClass(this)) + \": \" + message + \" at line \" + lineNumber + \" char \" + positionAtLine;\n\t}\n}\n\nclass Parser\n{\n\tstatic var escapes = {\n\t\tvar h = new haxe.ds.StringMap();\n\t\th.set(\"lt\", \"<\");\n\t\th.set(\"gt\", \">\");\n\t\th.set(\"amp\", \"&\");\n\t\th.set(\"quot\", '\"');\n\t\th.set(\"apos\", \"'\");\n\t\th;\n\t}\n\n\t/**\n\t * Parses the String into an XML Document. Set strict parsing to true in order to enable a strict check of XML attributes and entities.\n\t * \n\t * @throws haxe.xml.XmlParserException\n\t */\n\tstatic public function parse(str:String, strict = false)\n\t{\n\t\tvar doc = Xml.createDocument();\n\t\tdoParse(str, strict, 0, doc);\n\t\treturn doc;\n\t}\n\n\tstatic function doParse(str:String, strict:Bool, p:Int = 0, ?parent:Xml):Int\n\t{\n\t\tvar xml:Xml = null;\n\t\tvar state = S.BEGIN;\n\t\tvar next = S.BEGIN;\n\t\tvar aname = null;\n\t\tvar start = 0;\n\t\tvar nsubs = 0;\n\t\tvar nbrackets = 0;\n\t\tvar c = str.fastCodeAt(p);\n\t\tvar buf = new StringBuf();\n\t\t// need extra state because next is in use\n\t\tvar escapeNext = S.BEGIN;\n\t\tvar attrValQuote = -1;\n\t\tinline function addChild(xml:Xml) {\n\t\t\tparent.addChild(xml);\n\t\t\tnsubs++;\n\t\t}\n\t\twhile (!StringTools.isEof(c))\n\t\t{\n\t\t\tswitch(state)\n\t\t\t{\n\t\t\t\tcase S.IGNORE_SPACES:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase\n\t\t\t\t\t\t\t'\\n'.code,\n\t\t\t\t\t\t\t'\\r'.code,\n\t\t\t\t\t\t\t'\\t'.code,\n\t\t\t\t\t\t\t' '.code:\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tstate = next;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\tcase S.BEGIN:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase '<'.code:\n\t\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\t\tnext = S.BEGIN_NODE;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tstart = p;\n\t\t\t\t\t\t\tstate = S.PCDATA;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\tcase S.PCDATA:\n\t\t\t\t\tif (c == '<'.code)\n\t\t\t\t\t{\n\t\t\t\t\t\tbuf.addSub(str, start, p - start);\n\t\t\t\t\t\tvar child = Xml.createPCData(buf.toString());\n\t\t\t\t\t\tbuf = new StringBuf();\n\t\t\t\t\t\taddChild(child);\n\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\tnext = S.BEGIN_NODE;\n\t\t\t\t\t} else if (c == '&'.code) {\n\t\t\t\t\t\tbuf.addSub(str, start, p - start);\n\t\t\t\t\t\tstate = S.ESCAPE;\n\t\t\t\t\t\tescapeNext = S.PCDATA;\n\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t}\n\t\t\t\tcase S.CDATA:\n\t\t\t\t\tif (c == ']'.code && str.fastCodeAt(p + 1) == ']'.code && str.fastCodeAt(p + 2) == '>'.code)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar child = Xml.createCData(str.substr(start, p - start));\n\t\t\t\t\t\taddChild(child);\n\t\t\t\t\t\tp += 2;\n\t\t\t\t\t\tstate = S.BEGIN;\n\t\t\t\t\t}\n\t\t\t\tcase S.BEGIN_NODE:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase '!'.code:\n\t\t\t\t\t\t\tif (str.fastCodeAt(p + 1) == '['.code)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tp += 2;\n\t\t\t\t\t\t\t\tif (str.substr(p, 6).toUpperCase() != \"CDATA[\")\n\t\t\t\t\t\t\t\t\tthrow new XmlParserException(\"Expected <![CDATA[\", str, p);\n\t\t\t\t\t\t\t\tp += 5;\n\t\t\t\t\t\t\t\tstate = S.CDATA;\n\t\t\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (str.fastCodeAt(p + 1) == 'D'.code || str.fastCodeAt(p + 1) == 'd'.code)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif(str.substr(p + 2, 6).toUpperCase() != \"OCTYPE\")\n\t\t\t\t\t\t\t\t\tthrow new XmlParserException(\"Expected <!DOCTYPE\", str, p);\n\t\t\t\t\t\t\t\tp += 8;\n\t\t\t\t\t\t\t\tstate = S.DOCTYPE;\n\t\t\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if( str.fastCodeAt(p + 1) != '-'.code || str.fastCodeAt(p + 2) != '-'.code )\n\t\t\t\t\t\t\t\tthrow new XmlParserException(\"Expected <!--\", str, p);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tp += 2;\n\t\t\t\t\t\t\t\tstate = S.COMMENT;\n\t\t\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tcase '?'.code:\n\t\t\t\t\t\t\tstate = S.HEADER;\n\t\t\t\t\t\t\tstart = p;\n\t\t\t\t\t\tcase '/'.code:\n\t\t\t\t\t\t\tif( parent == null )\n\t\t\t\t\t\t\t\tthrow new XmlParserException(\"Expected node name\", str, p);\n\t\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\t\tnext = S.CLOSE;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tstate = S.TAG_NAME;\n\t\t\t\t\t\t\tstart = p;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\tcase S.TAG_NAME:\n\t\t\t\t\tif (!isValidChar(c))\n\t\t\t\t\t{\n\t\t\t\t\t\tif( p == start )\n\t\t\t\t\t\t\tthrow new XmlParserException(\"Expected node name\", str, p);\n\t\t\t\t\t\txml = Xml.createElement(str.substr(start, p - start));\n\t\t\t\t\t\taddChild(xml);\n\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\tnext = S.BODY;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\tcase S.BODY:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase '/'.code:\n\t\t\t\t\t\t\tstate = S.WAIT_END;\n\t\t\t\t\t\tcase '>'.code:\n\t\t\t\t\t\t\tstate = S.CHILDS;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tstate = S.ATTRIB_NAME;\n\t\t\t\t\t\t\tstart = p;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\tcase S.ATTRIB_NAME:\n\t\t\t\t\tif (!isValidChar(c))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar tmp;\n\t\t\t\t\t\tif( start == p )\n\t\t\t\t\t\t\tthrow new XmlParserException(\"Expected attribute name\", str, p);\n\t\t\t\t\t\ttmp = str.substr(start,p-start);\n\t\t\t\t\t\taname = tmp;\n\t\t\t\t\t\tif( xml.exists(aname) )\n\t\t\t\t\t\t\tthrow new XmlParserException(\"Duplicate attribute [\" + aname + \"]\", str, p);\n\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\tnext = S.EQUALS;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\tcase S.EQUALS:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase '='.code:\n\t\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\t\tnext = S.ATTVAL_BEGIN;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new XmlParserException(\"Expected =\", str, p);\n\t\t\t\t\t}\n\t\t\t\tcase S.ATTVAL_BEGIN:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase '\"'.code | '\\''.code:\n\t\t\t\t\t\t\tbuf = new StringBuf();\n\t\t\t\t\t\t\tstate = S.ATTRIB_VAL;\n\t\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t\t\tattrValQuote = c;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new XmlParserException(\"Expected \\\"\", str, p);\n\t\t\t\t\t}\n\t\t\t\tcase S.ATTRIB_VAL:\n\t\t\t\t\tswitch (c) {\n\t\t\t\t\t\tcase '&'.code:\n\t\t\t\t\t\t\tbuf.addSub(str, start, p - start);\n\t\t\t\t\t\t\tstate = S.ESCAPE;\n\t\t\t\t\t\t\tescapeNext = S.ATTRIB_VAL;\n\t\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t\tcase '>'.code | '<'.code if( strict ):\n\t\t\t\t\t\t\t// HTML allows these in attributes values\n\t\t\t\t\t\t\tthrow new XmlParserException(\"Invalid unescaped \" + String.fromCharCode(c) + \" in attribute value\", str, p);\n\t\t\t\t\t\tcase _ if (c == attrValQuote):\n\t\t\t\t\t\t\tbuf.addSub(str, start, p - start);\n\t\t\t\t\t\t\tvar val = buf.toString();\n\t\t\t\t\t\t\tbuf = new StringBuf();\n\t\t\t\t\t\t\txml.set(aname, val);\n\t\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\t\tnext = S.BODY;\n\t\t\t\t\t}\n\t\t\t\tcase S.CHILDS:\n\t\t\t\t\tp = doParse(str, strict, p, xml);\n\t\t\t\t\tstart = p;\n\t\t\t\t\tstate = S.BEGIN;\n\t\t\t\tcase S.WAIT_END:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase '>'.code:\n\t\t\t\t\t\t\tstate = S.BEGIN;\n\t\t\t\t\t\tdefault :\n\t\t\t\t\t\t\tthrow new XmlParserException(\"Expected >\", str, p);\n\t\t\t\t\t}\n\t\t\t\tcase S.WAIT_END_RET:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase '>'.code:\n\t\t\t\t\t\t\tif( nsubs == 0 )\n\t\t\t\t\t\t\t\tparent.addChild(Xml.createPCData(\"\"));\n\t\t\t\t\t\t\treturn p;\n\t\t\t\t\t\tdefault :\n\t\t\t\t\t\t\tthrow new XmlParserException(\"Expected >\", str, p);\n\t\t\t\t\t}\n\t\t\t\tcase S.CLOSE:\n\t\t\t\t\tif (!isValidChar(c))\n\t\t\t\t\t{\n\t\t\t\t\t\tif( start == p )\n\t\t\t\t\t\t\tthrow new XmlParserException(\"Expected node name\", str, p);\n\n\t\t\t\t\t\tvar v = str.substr(start,p - start);\n\t\t\t\t\t\tif (v != parent.nodeName)\n\t\t\t\t\t\t\tthrow new XmlParserException(\"Expected </\" +parent.nodeName + \">\", str, p);\n\n\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\tnext = S.WAIT_END_RET;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\tcase S.COMMENT:\n\t\t\t\t\tif (c == '-'.code && str.fastCodeAt(p +1) == '-'.code && str.fastCodeAt(p + 2) == '>'.code)\n\t\t\t\t\t{\n\t\t\t\t\t\taddChild(Xml.createComment(str.substr(start, p - start)));\n\t\t\t\t\t\tp += 2;\n\t\t\t\t\t\tstate = S.BEGIN;\n\t\t\t\t\t}\n\t\t\t\tcase S.DOCTYPE:\n\t\t\t\t\tif(c == '['.code)\n\t\t\t\t\t\tnbrackets++;\n\t\t\t\t\telse if(c == ']'.code)\n\t\t\t\t\t\tnbrackets--;\n\t\t\t\t\telse if (c == '>'.code && nbrackets == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\taddChild(Xml.createDocType(str.substr(start, p - start)));\n\t\t\t\t\t\tstate = S.BEGIN;\n\t\t\t\t\t}\n\t\t\t\tcase S.HEADER:\n\t\t\t\t\tif (c == '?'.code && str.fastCodeAt(p + 1) == '>'.code)\n\t\t\t\t\t{\n\t\t\t\t\t\tp++;\n\t\t\t\t\t\tvar str = str.substr(start + 1, p - start - 2);\n\t\t\t\t\t\taddChild(Xml.createProcessingInstruction(str));\n\t\t\t\t\t\tstate = S.BEGIN;\n\t\t\t\t\t}\n\t\t\t\tcase S.ESCAPE:\n\t\t\t\t\tif (c == ';'.code)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar s = str.substr(start, p - start);\n\t\t\t\t\t\tif (s.fastCodeAt(0) == '#'.code) {\n\t\t\t\t\t\t\tvar c = s.fastCodeAt(1) == 'x'.code\n\t\t\t\t\t\t\t\t? Std.parseInt(\"0\" +s.substr(1, s.length - 1))\n\t\t\t\t\t\t\t\t: Std.parseInt(s.substr(1, s.length - 1));\n\t\t\t\t\t\t\t#if (neko || cpp || php || lua)\n\t\t\t\t\t\t\tif( c >= 128 ) {\n\t\t\t\t\t\t\t\t// UTF8-encode it\n\t\t\t\t\t\t\t\tif( c <= 0x7FF ) {\n\t\t\t\t\t\t\t\t\tbuf.addChar(0xC0 | (c >> 6));\n\t\t\t\t\t\t\t\t\tbuf.addChar(0x80 | (c & 63));\n\t\t\t\t\t\t\t\t} else if( c <= 0xFFFF ) {\n\t\t\t\t\t\t\t\t\tbuf.addChar(0xE0 | (c >> 12));\n\t\t\t\t\t\t\t\t\tbuf.addChar(0x80 | ((c >> 6) & 63));\n\t\t\t\t\t\t\t\t\tbuf.addChar(0x80 | (c & 63));\n\t\t\t\t\t\t\t\t} else if( c <= 0x10FFFF ) {\n\t\t\t\t\t\t\t\t\tbuf.addChar(0xF0 | (c >> 18));\n\t\t\t\t\t\t\t\t\tbuf.addChar(0x80 | ((c >> 12) & 63));\n\t\t\t\t\t\t\t\t\tbuf.addChar(0x80 | ((c >> 6) & 63));\n\t\t\t\t\t\t\t\t\tbuf.addChar(0x80 | (c & 63));\n\t\t\t\t\t\t\t\t} else\n\t\t\t\t\t\t\t\t\tthrow new XmlParserException(\"Cannot encode UTF8-char \" + c, str, p);\n\t\t\t\t\t\t\t} else\n\t\t\t\t\t\t\t#end\n\t\t\t\t\t\t\tbuf.addChar(c);\n\t\t\t\t\t\t} else if (!escapes.exists(s)) {\n\t\t\t\t\t\t\tif( strict )\n\t\t\t\t\t\t\t\tthrow new XmlParserException(\"Undefined entity: \" + s, str, p);\n\t\t\t\t\t\t\tbuf.add('&$s;');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbuf.add(escapes.get(s));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t\tstate = escapeNext;\n\t\t\t\t\t} else if (!isValidChar(c) && c != \"#\".code) {\n\t\t\t\t\t\tif( strict )\n\t\t\t\t\t\t\tthrow new XmlParserException(\"Invalid character in entity: \" + String.fromCharCode(c), str, p);\n\t\t\t\t\t\tbuf.addChar(\"&\".code);\n\t\t\t\t\t\tbuf.addSub(str, start, p - start);\n\t\t\t\t\t\tp--;\n\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t\tstate = escapeNext;\n\t\t\t\t\t}\n\t\t\t}\n\t\t\tc = str.fastCodeAt(++p);\n\t\t}\n\n\t\tif (state == S.BEGIN)\n\t\t{\n\t\t\tstart = p;\n\t\t\tstate = S.PCDATA;\n\t\t}\n\n\t\tif (state == S.PCDATA)\n\t\t{\n\t\t\tif (p != start || nsubs == 0) {\n\t\t\t\tbuf.addSub(str, start, p-start);\n\t\t\t\taddChild(Xml.createPCData(buf.toString()));\n\t\t\t}\n\t\t\treturn p;\n\t\t}\n\n\t\tif( !strict && state == S.ESCAPE && escapeNext == S.PCDATA ) {\n\t\t\tbuf.addChar(\"&\".code);\n\t\t\tbuf.addSub(str, start, p - start);\n\t\t\taddChild(Xml.createPCData(buf.toString()));\n\t\t\treturn p;\n\t\t}\n\n\t\tthrow new XmlParserException(\"Unexpected end\", str, p);\n\t}\n\n\tstatic inline function isValidChar(c) {\n\t\treturn (c >= 'a'.code && c <= 'z'.code) || (c >= 'A'.code && c <= 'Z'.code) || (c >= '0'.code && c <= '9'.code) || c == ':'.code || c == '.'.code || c == '_'.code || c == '-'.code;\n\t}\n}\n","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage js;\n\nprivate class HaxeError extends js.Error {\n\n\tvar val:Dynamic;\n\n\tpublic function new(val:Dynamic) untyped {\n\t\tsuper();\n\t\tthis.val = __define_feature__(\"js.Boot.HaxeError\", val);\n\t\tthis.message = String(val);\n\t\tif (js.Error.captureStackTrace) js.Error.captureStackTrace(this, HaxeError);\n\t}\n\n\tpublic static function wrap(val:Dynamic):Dynamic untyped {\n\t\treturn if (__instanceof__(val, js.Error)) val else new HaxeError(val);\n\t}\n}\n\n@:dox(hide)\nclass Boot {\n\n\tprivate static function __unhtml(s : String) {\n\t\treturn s.split(\"&\").join(\"&amp;\").split(\"<\").join(\"&lt;\").split(\">\").join(\"&gt;\");\n\t}\n\n\tprivate static function __trace(v,i : haxe.PosInfos) {\n\t\tuntyped {\n\t\t\tvar msg = if( i != null ) i.fileName+\":\"+i.lineNumber+\": \" else \"\";\n\t\t\t#if jsfl\n\t\t\tmsg += __string_rec(v,\"\");\n\t\t\tfl.trace(msg);\n\t\t\t#else\n\t\t\tmsg += __string_rec(v, \"\");\n\t\t\tif( i != null && i.customParams != null )\n\t\t\t\tfor( v in i.customParams )\n\t\t\t\t\tmsg += \",\" + __string_rec(v, \"\");\n\t\t\tvar d;\n\t\t\tif( __js__(\"typeof\")(document) != \"undefined\" && (d = document.getElementById(\"haxe:trace\")) != null )\n\t\t\t\td.innerHTML += __unhtml(msg)+\"<br/>\";\n\t\t\telse if( __js__(\"typeof console\") != \"undefined\" && __js__(\"console\").log != null )\n\t\t\t\t__js__(\"console\").log(msg);\n\t\t\t#end\n\t\t}\n\t}\n\n\tprivate static function __clear_trace() {\n\t\tuntyped {\n\t\t\t#if jsfl\n\t\t\tfl.outputPanel.clear();\n\t\t\t#else\n\t\t\tvar d = document.getElementById(\"haxe:trace\");\n\t\t\tif( d != null )\n\t\t\t\td.innerHTML = \"\";\n\t\t\t#end\n\t\t}\n\t}\n\n\tstatic inline function isClass(o:Dynamic) : Bool {\n\t\treturn untyped __define_feature__(\"js.Boot.isClass\", o.__name__);\n\t}\n\n\tstatic inline function isEnum(e:Dynamic) : Bool {\n\t\treturn untyped __define_feature__(\"js.Boot.isEnum\", e.__ename__);\n\t}\n\n\tstatic function getClass(o:Dynamic) : Dynamic {\n\t\tif (Std.is(o, Array))\n\t\t\treturn Array;\n\t\telse {\n\t\t\tvar cl = untyped __define_feature__(\"js.Boot.getClass\", o.__class__);\n\t\t\tif (cl != null)\n\t\t\t\treturn cl;\n\t\t\tvar name = __nativeClassName(o);\n\t\t\tif (name != null)\n\t\t\t\treturn __resolveNativeClass(name);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t@:ifFeature(\"has_enum\")\n\tprivate static function __string_rec(o,s:String) {\n\t\tuntyped {\n\t\t\tif( o == null )\n\t\t\t    return \"null\";\n\t\t\tif( s.length >= 5 )\n\t\t\t\treturn \"<...>\"; // too much deep recursion\n\t\t\tvar t = __js__(\"typeof(o)\");\n\t\t\tif( t == \"function\" && (isClass(o) || isEnum(o)) )\n\t\t\t\tt = \"object\";\n\t\t\tswitch( t ) {\n\t\t\tcase \"object\":\n\t\t\t\tif( __js__(\"o instanceof Array\") ) {\n\t\t\t\t\tif( o.__enum__ ) {\n\t\t\t\t\t\tif( o.length == 2 )\n\t\t\t\t\t\t\treturn o[0];\n\t\t\t\t\t\tvar str = o[0]+\"(\";\n\t\t\t\t\t\ts += \"\\t\";\n\t\t\t\t\t\tfor( i in 2...o.length ) {\n\t\t\t\t\t\t\tif( i != 2 )\n\t\t\t\t\t\t\t\tstr += \",\" + __string_rec(o[i],s);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tstr += __string_rec(o[i],s);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn str + \")\";\n\t\t\t\t\t}\n\t\t\t\t\tvar l = o.length;\n\t\t\t\t\tvar i;\n\t\t\t\t\tvar str = \"[\";\n\t\t\t\t\ts += \"\\t\";\n\t\t\t\t\tfor( i in 0...l )\n\t\t\t\t\t\tstr += (if (i > 0) \",\" else \"\")+__string_rec(o[i],s);\n\t\t\t\t\tstr += \"]\";\n\t\t\t\t\treturn str;\n\t\t\t\t}\n\t\t\t\tvar tostr;\n\t\t\t\ttry {\n\t\t\t\t\ttostr = untyped o.toString;\n\t\t\t\t} catch( e : Dynamic ) {\n\t\t\t\t\t// strange error on IE\n\t\t\t\t\treturn \"???\";\n\t\t\t\t}\n\t\t\t\tif( tostr != null && tostr != __js__(\"Object.toString\") && __typeof__(tostr) == \"function\" ) {\n\t\t\t\t\tvar s2 = o.toString();\n\t\t\t\t\tif( s2 != \"[object Object]\")\n\t\t\t\t\t\treturn s2;\n\t\t\t\t}\n\t\t\t\tvar k : String = null;\n\t\t\t\tvar str = \"{\\n\";\n\t\t\t\ts += \"\\t\";\n\t\t\t\tvar hasp = (o.hasOwnProperty != null);\n\t\t\t\t__js__(\"for( var k in o ) {\");\n\t\t\t\t\tif( hasp && !o.hasOwnProperty(k) )\n\t\t\t\t\t\t__js__(\"continue\");\n\t\t\t\t\tif( k == \"prototype\" || k == \"__class__\" || k == \"__super__\" || k == \"__interfaces__\" || k == \"__properties__\" )\n\t\t\t\t\t\t__js__(\"continue\");\n\t\t\t\t\tif( str.length != 2 )\n\t\t\t\t\t\tstr += \", \\n\";\n\t\t\t\t\tstr += s + k + \" : \"+__string_rec(o[k],s);\n\t\t\t\t__js__(\"}\");\n\t\t\t\ts = s.substring(1);\n\t\t\t\tstr += \"\\n\" + s + \"}\";\n\t\t\t\treturn str;\n\t\t\tcase \"function\":\n\t\t\t\treturn \"<function>\";\n\t\t\tcase \"string\":\n\t\t\t\treturn o;\n\t\t\tdefault:\n\t\t\t\treturn String(o);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static function __interfLoop(cc : Dynamic,cl : Dynamic) {\n\t\tif( cc == null )\n\t\t\treturn false;\n\t\tif( cc == cl )\n\t\t\treturn true;\n\t\tvar intf : Dynamic = cc.__interfaces__;\n\t\tif( intf != null )\n\t\t\tfor( i in 0...intf.length ) {\n\t\t\t\tvar i : Dynamic = intf[i];\n\t\t\t\tif( i == cl || __interfLoop(i,cl) )\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\treturn __interfLoop(cc.__super__,cl);\n\t}\n\n\t@:ifFeature(\"typed_catch\") private static function __instanceof(o : Dynamic,cl : Dynamic) {\n\t\tif( cl == null )\n\t\t\treturn false;\n\t\tswitch( cl ) {\n\t\tcase Int:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"number\" && untyped __js__(\"(o|0) === o\");\n\t\tcase Float:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"number\";\n\t\tcase Bool:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"boolean\";\n\t\tcase String:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"string\";\n\t\tcase Array:\n\t\t\treturn (untyped __js__(\"(o instanceof Array)\")) && o.__enum__ == null;\n\t\tcase Dynamic:\n\t\t\treturn true;\n\t\tdefault:\n\t\t\tif( o != null ) {\n\t\t\t\t// Check if o is an instance of a Haxe class or a native JS object\n\t\t\t\tif( (untyped __js__(\"typeof\"))(cl) == \"function\" ) {\n\t\t\t\t\tif( untyped __js__(\"o instanceof cl\") )\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tif( __interfLoop(getClass(o),cl) )\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\telse if ( (untyped __js__(\"typeof\"))(cl) == \"object\" && __isNativeObj(cl) ) {\n\t\t\t\t\tif( untyped __js__(\"o instanceof cl\") )\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// do not use isClass/isEnum here\n\t\t\tuntyped __feature__(\"Class.*\",if( cl == Class && o.__name__ != null ) return true);\n\t\t\tuntyped __feature__(\"Enum.*\",if( cl == Enum && o.__ename__ != null ) return true);\n\t\t\treturn o.__enum__ == cl;\n\t\t}\n\t}\n\n\t@:ifFeature(\"typed_cast\") private static function __cast(o : Dynamic, t : Dynamic) {\n\t\tif (__instanceof(o, t)) return o;\n\t\telse throw \"Cannot cast \" +Std.string(o) + \" to \" +Std.string(t);\n\t}\n\n\tstatic var __toStr = untyped ({}).toString;\n\t// get native JS [[Class]]\n\tstatic function __nativeClassName(o:Dynamic):String {\n\t\tvar name = untyped __toStr.call(o).slice(8, -1);\n\t\t// exclude general Object and Function\n\t\t// also exclude Math and JSON, because instanceof cannot be called on them\n\t\tif (name == \"Object\" || name == \"Function\" || name == \"Math\" || name == \"JSON\")\n\t\t\treturn null;\n\t\treturn name;\n\t}\n\n\t// check for usable native JS object\n\tstatic function __isNativeObj(o:Dynamic):Bool {\n\t\treturn __nativeClassName(o) != null;\n\t}\n\n\t// resolve native JS class in the global scope:\n\tstatic function __resolveNativeClass(name:String) {\n\t\treturn untyped js.Lib.global[name];\n\t}\n\n}\n","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage js;\n\nimport js.html.Storage;\nimport js.html.XMLHttpRequest;\n\nclass Browser {\n\t/** The global window object. */\n\tpublic static var window(get, never):js.html.Window;\n\tinline static function get_window() return untyped __js__(\"window\");\n\n\t/** Shortcut to Window.document. */\n\tpublic static var document(get, never):js.html.HTMLDocument;\n\tinline static function get_document() return untyped __js__(\"window.document\");\n\n\t/** Shortcut to Window.location. */\n\tpublic static var location(get, never):js.html.Location;\n\tinline static function get_location() return untyped __js__(\"window.location\");\n\n\t/** Shortcut to Window.navigator. */\n\tpublic static var navigator(get, never):js.html.Navigator;\n\tinline static function get_navigator() return untyped __js__(\"window.navigator\");\n\n\t/** Shortcut to Window.console. */\n\tpublic static var console(get, never):js.html.Console;\n\tinline static function get_console() return untyped __js__(\"window.console\");\n\n\t/**\n\t * True if a window object exists, false otherwise.\n\t *\n\t * This can be used to check if the code is being executed in a non-browser\n\t * environment such as node.js.\n\t */\n\tpublic static var supported(get, never):Bool;\n\tinline static function get_supported() return untyped __typeof__(window) != \"undefined\";\n\n\t/**\n\t * Safely gets the browser's local storage, or returns null if localStorage is unsupported or\n\t * disabled.\n\t */\n\tpublic static function getLocalStorage() : Storage\n\t{\n\t\ttry {\n\t\t\tvar s = window.localStorage;\n\t\t\ts.getItem(\"\");\n\t\t\treturn s;\n\t\t} catch( e : Dynamic ) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Safely gets the browser's session storage, or returns null if sessionStorage is unsupported\n\t * or disabled.\n\t */\n\tpublic static function getSessionStorage() : Storage\n\t{\n\t\ttry {\n\t\t\tvar s = window.sessionStorage;\n\t\t\ts.getItem(\"\");\n\t\t\treturn s;\n\t\t} catch( e : Dynamic ) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Creates an XMLHttpRequest, with a fallback to ActiveXObject for ancient versions of Internet\n\t * Explorer.\n\t */\n\tpublic static function createXMLHttpRequest() : XMLHttpRequest\n\t{\n\t\tif( untyped __js__(\"typeof XMLHttpRequest\") != \"undefined\" ) {\n\t\t\treturn new XMLHttpRequest();\n\t\t}\n\t\tif( untyped __js__(\"typeof ActiveXObject\") != \"undefined\" ) {\n\t\t\treturn untyped __new__(\"ActiveXObject\",\"Microsoft.XMLHTTP\");\n\t\t}\n\t\tthrow \"Unable to create XMLHttpRequest object.\";\n\t}\n\n\t/**\n\t\tDisplay an alert message box containing the given message. See also `Window.alert()`.\n\t**/\n\tpublic static function alert( v : Dynamic ) {\n\t\t@:privateAccess window.alert(Boot.__string_rec(v,\"\"));\n\t}\n}\n","package pixi.flump;\r\n\r\nimport flump.*;\r\nimport flump.filters.AnimateTintFilter;\r\nimport flump.library.*;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.display.DisplayObject;\r\nimport pixi.core.graphics.Graphics;\r\nimport pixi.core.math.shapes.Rectangle;\r\nimport pixi.core.sprites.Sprite;\r\nimport pixi.core.ticker.Ticker;\r\nimport pixi.flump.Resource;\r\n\r\n\r\n@:access(pixi.flump.Resource)\r\nclass Movie extends Container implements IFlumpMovie {\r\n\r\n\tpublic var player:MoviePlayer;\r\n\tprivate var symbol:MovieSymbol;\r\n\tprivate var layers = new Map<Layer, Container>();\r\n\tprivate var layerLookup = new Map<String, Container>();\r\n\tprivate var movieChildren = new Map<DisplayObjectKey, DisplayObject>();\r\n\tprivate var displaying = new Map<Layer, DisplayObjectKey>();\r\n\tprivate var ticker:Ticker = untyped __js__ (\"PIXI.ticker.shared\");\r\n\tprivate var master:Bool;\r\n\r\n\tprivate var resolution:Float;\r\n\tprivate var resource:Resource;\r\n\tprivate var resourceId:String;\r\n\r\n\tpublic function new(symbolId:String, resourceId:String = null){\r\n\t\t\r\n\t\tsuper();\r\n\t\tthis.resourceId = resourceId;\r\n\r\n\t\tif(resourceId == null){\r\n\t\t\tresource = Resource.getResourceForMovie(symbolId);\r\n\t\t\tif(resource == null) throw(\"Flump movie does not exist: \" + symbolId);\r\n\t\t}else{\r\n\t\t\tresource = Resource.get(resourceId);\r\n\t\t\tif(resource == null) throw(\"Flump resource does not exist: \" + resourceId);\r\n\t\t}\r\n\r\n\t\tthis.resolution = resource.resolution;\r\n\r\n\t\tthis.symbol = resource.library.movies.get(symbolId);\r\n\t\t\r\n\t\tplayer = new MoviePlayer(symbol, this, resolution);\t\r\n\t\tthis.loop = true;\r\n\r\n\t\tmaster = true;\r\n\t\tonce(\"added\", onAdded);\r\n\t}\r\n\r\n\r\n\tprivate function disableAsMaster(){\r\n\t\tmaster = false;\r\n\t\toff(\"added\", onAdded);\r\n\t}\r\n\r\n\r\n\t/////////////////////////////////////////////////////\r\n\t//\r\n\t//   API\r\n\t//\r\n\t/////////////////////////////////////////////////////\r\n\r\n\tpublic var animationSpeed(default, default):Float = 1.0;\r\n\r\n\tpublic var resX(get, set):Float;\r\n\tpublic function get_resX():Float{\r\n\t\treturn x / resolution;\r\n\t}\r\n\tpublic function set_resX(value:Float):Float{\r\n\t\tx = value * resolution;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tpublic var resY(get, set):Float;\r\n\tpublic function get_resY():Float{\r\n\t\treturn y / resolution;\r\n\t}\r\n\tpublic function set_resY(value:Float):Float{\r\n\t\ty = value * resolution;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tpublic var resScaleX(get, set):Float;\r\n\tpublic function get_resScaleX():Float{\r\n\t\treturn scale.x / resolution;\r\n\t}\r\n\tpublic function set_resScaleX(value:Float):Float{\r\n\t\tscale.x = value * resolution;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tpublic var resScaleY(get, set):Float;\r\n\tpublic function get_resScaleY():Float{\r\n\t\treturn scale.y / resolution;\r\n\t}\r\n\tpublic function set_resScaleY(value:Float):Float{\r\n\t\tscale.y = value * resolution;\r\n\t\treturn value;\r\n\t}\r\n\r\n\t\r\n\tpublic function getLayer(layerId:String):Container{\r\n\t\tif(layerLookup.exists(layerId) == false) throw(\"Layer \" + layerId + \"does not exist\");\r\n\t\treturn layerLookup[layerId];\r\n\t}\r\n\r\n\r\n\tpublic function getChildDisplayObject(layerId:String, keyframeIndex:UInt = 0):DisplayObject{\r\n\t\tvar key = player.getDisplayKey(layerId, keyframeIndex);\r\n\t\treturn movieChildren[key];\r\n\t}\r\n\r\n\r\n\tpublic function getChildMovie(layerId, keyframeIndex:UInt = 0):Movie{\r\n\t\tvar child = getChildDisplayObject(layerId, keyframeIndex);\r\n\t\tif(Std.is(child, Movie) == false) throw(\"Child on layer \" + layerId + \" at keyframeIndex \" + keyframeIndex + \" is not of type flump.Movie!\");\r\n\t\treturn cast child;\r\n\t}\r\n\r\n\r\n\tpublic var symbolId(get, null):String;\r\n\tprivate function get_symbolId(){\r\n\t\treturn symbol.name;\r\n\t}\r\n\r\n\tpublic var loop(default, set):Bool;\r\n\tprivate function set_loop(value){\r\n\t\tif(value && player.playing) player.loop();\r\n\t\telse if(value == false && player.looping) player.play();\r\n\t\treturn loop = value;\r\n\t}\r\n\r\n\r\n\tpublic var onComplete(default, set):Void -> Void;\r\n\tprivate function set_onComplete(value){\r\n\t\treturn onComplete = value;\r\n\t}\r\n\r\n\tpublic var currentFrame(get, set):Int;\r\n\tprivate function set_currentFrame(value){\r\n\t\tplayer.currentFrame = value;\r\n\t\treturn value;\r\n\t}\r\n\tprivate function get_currentFrame():Int{\r\n\t\treturn player.currentFrame;\r\n\t}\r\n\r\n\tpublic var playing(get, null):Bool;\r\n\tprivate function get_playing(){\r\n\t\treturn player.playing || player.looping;\r\n\t}\r\n\r\n\r\n\tpublic var independantTimeline(get, set):Bool;\r\n\tprivate function get_independantTimeline(){\r\n\t\treturn player.independantTimeline;\r\n\t}\r\n\tprivate function set_independantTimeline(value:Bool){\r\n\t\tplayer.independantTimeline = value;\r\n\t\treturn value;\r\n\t}\r\n\r\n\r\n\tpublic var independantControl(get, set):Bool;\r\n\tprivate function get_independantControl(){\r\n\t\treturn player.independantControl;\r\n\t}\r\n\tprivate function set_independantControl(value:Bool){\r\n\t\tplayer.independantControl = value;\r\n\t\treturn value;\r\n\t}\r\n\r\n\r\n\tpublic var totalFrames(get, null):Int;\r\n\t\r\n\tpublic var tint(default, set):Int;\r\n\t\r\n\tprivate function get_totalFrames() {\r\n\t\treturn player.totalFrames;\r\n\t}\r\n\t\r\n\tprivate function set_tint(pTint:Int):Int {\r\n\t\tfor (child in movieChildren) {\r\n\t\t\tif (Std.is(child, pixi.flump.Sprite)) {\r\n\t\t\t\tcast(child, pixi.flump.Sprite).tint = pTint;\r\n\t\t\t} else if (Std.is(child, pixi.flump.Movie)) {\r\n\t\t\t\tcast(child, pixi.flump.Movie).tint = pTint;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn tint = pTint;\r\n\t}\r\n\r\n\r\n\tpublic function stop():Void{\r\n\t\tplayer.stop();\r\n\t}\r\n\r\n\r\n\tpublic function play():Void{\r\n\t\tif(loop) player.loop();\r\n\t\telse player.play();\r\n\t}\r\n\r\n\r\n\tpublic function gotoAndStop(frameNumber:Int):Void{\r\n\t\tif(!loop){\r\n\t\t\tif(frameNumber > player.totalFrames-1) frameNumber = player.totalFrames - 1;\r\n\t\t\telse if(frameNumber < 0) frameNumber = 0;\r\n\t\t}\r\n\t\tplayer.goToFrame(frameNumber).stop();\r\n\t}\r\n\r\n\r\n\tpublic function gotoAndPlay(frameNumber:Int):Void{\r\n\t\tif(!loop){\r\n\t\t\tif(frameNumber > player.totalFrames-1) frameNumber = player.totalFrames - 1;\r\n\t\t\telse if(frameNumber < 0) frameNumber = 0;\r\n\t\t}\r\n\t\tif(loop) player.goToFrame(frameNumber).loop();\r\n\t\telse player.goToFrame(frameNumber).play();\r\n\t}\r\n\r\n\r\n\tpublic function getLabelFrame(label:String):UInt{\r\n\t\treturn player.getLabelFrame(label);\r\n\t}\r\n\r\n\r\n\t/////////////////////////////////////////////////////\r\n\t//\r\n\t//   Other\r\n\t//\r\n\t/////////////////////////////////////////////////////\r\n\r\n\tprivate function tick(){\r\n\t\tplayer.advanceTime(ticker.elapsedMS * animationSpeed);\r\n\t}\r\n\r\n\r\n\tprivate function onAdded(to){\r\n\t\tonce(\"removed\", onRemoved);\r\n\t\tticker.add(tick);\r\n\t}\r\n\r\n\r\n\tprivate function onRemoved(from){\r\n\t\tonce(\"added\", onAdded);\r\n\t\tticker.remove(tick);\r\n\t}\r\n\r\n\r\n\r\n\t/////////////////////////////////////////////////////\r\n\t//\r\n\t//   IFlumpMovie\r\n\t//\r\n\t/////////////////////////////////////////////////////\r\n\r\n\t\r\n\t\r\n\tprivate function createLayer(layer:Layer):Void{\r\n\t\tlayers[layer] = new Container();\r\n\t\tlayers[layer].name = layer.name;\r\n\t\tlayerLookup[layer.name] = layers[layer];\r\n\t\taddChild(layers[layer]);\r\n\t}\r\n\r\n\r\n\tprivate function getChildPlayer(keyframe:Keyframe):MoviePlayer{\r\n\t\tvar movie:Movie = cast movieChildren[keyframe.displayKey];\r\n\t\treturn movie.player;\r\n\t}\r\n\r\n\r\n\tprivate function createFlumpChild(displayKey:DisplayObjectKey):Void{\r\n\t\tmovieChildren[displayKey] = resource.createDisplayObject(displayKey.symbolId);\r\n\t}\r\n\r\n\r\n\tprivate function removeFlumpChild(layer:Layer, displayKey:DisplayObjectKey):Void{\r\n\t\tvar layer = layers[layer];\r\n\t\tlayer.removeChildren();\r\n\t}\r\n\r\n\r\n\tprivate function addFlumpChild(layer:Layer, displayKey:DisplayObjectKey):Void{\r\n\t\tvar layer = layers[layer];\r\n\t\tlayer.addChild( movieChildren[displayKey] );\r\n\t}\r\n\r\n\r\n\tprivate function onAnimationComplete():Void{\r\n\t\tif(onComplete != null) onComplete();\r\n\t}\r\n\r\n\r\n\tprivate function renderFrame(keyframe:Keyframe, x:Float, y:Float, scaleX:Float, scaleY:Float, skewX:Float, skewY:Float, alpha:Float, tintMultiplier:Float, tintColor:UInt):Void{\r\n\t\tvar layer\t\t\t: Container\t\t\t= layers[ keyframe.layer];\r\n\t\tvar lChild \t\t\t: DisplayObject\t\t= null;\r\n\t\tvar spriteSymbol\t: SpriteSymbol\t\t= null;\r\n\t\t\r\n\t\tlayer.x\t= x;\r\n\t\tlayer.y\t= y;\r\n\t\t\r\n\t\tif ( master){\r\n\t\t\tlayer.x /= resolution;\r\n\t\t\tlayer.y /= resolution;\r\n\t\t}\r\n\t\t\r\n\t\tif ( layer.children.length > 0){\r\n\t\t\tlChild\t\t\t= layer.getChildAt( 0);\r\n\t\t\tlChild.scale.x\t= scaleX;\r\n\t\t\tlChild.scale.y\t= scaleY;\r\n\t\t\t\r\n\t\t\tif ( master){\r\n\t\t\t\tlChild.scale.x /= resolution;\r\n\t\t\t\tlChild.scale.y /= resolution;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif ( layer.name != \"flipbook\"){\r\n\t\t\tif ( Std.is( keyframe.symbol, SpriteSymbol)){\r\n\t\t\t\tif ( lChild != null){\r\n\t\t\t\t\tspriteSymbol\t= cast keyframe.symbol;\r\n\t\t\t\t\t\r\n\t\t\t\t\tlChild.pivot.x\t= keyframe.pivot.x - spriteSymbol.origin.x;\r\n\t\t\t\t\tlChild.pivot.y\t= keyframe.pivot.y - spriteSymbol.origin.y;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif ( master){\r\n\t\t\t\t\t\tlChild.pivot.x /= resolution;\r\n\t\t\t\t\t\tlChild.pivot.y /= resolution;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else if ( lChild != null && Std.is( lChild, Container) && cast( lChild, Container).children.length > 0 && cast( lChild, Container).getChildAt( 0).name == \"flipbook\"){\r\n\t\t\t\tlChild.pivot.x\t= keyframe.pivot.x;\r\n\t\t\t\tlChild.pivot.y\t= keyframe.pivot.y;\r\n\t\t\t\t\r\n\t\t\t\tif ( master){\r\n\t\t\t\t\tlChild.pivot.x /= resolution;\r\n\t\t\t\t\tlChild.pivot.y /= resolution;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tif ( lChild != null){\r\n\t\t\t\t\tlChild.x\t= -scaleX * keyframe.pivot.x;\r\n\t\t\t\t\tlChild.y\t= -scaleY * keyframe.pivot.y;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif ( master){\r\n\t\t\t\t\t\tlChild.x /= resolution;\r\n\t\t\t\t\t\tlChild.y /= resolution;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tlayer.skew.x = skewX;\r\n\t\tlayer.skew.y = skewY;\r\n\t\tlayer.alpha  = alpha;\r\n\t\t\r\n\t\tif (keyframe.layer.refAnimatedTint == null) {\r\n\t\t\tif (tintMultiplier != 0) {\r\n\t\t\t\tkeyframe.layer.refAnimatedTint = new AnimateTintFilter(tintColor, tintMultiplier);\r\n\t\t\t\tif (layer.filters == null) layer.filters = [keyframe.layer.refAnimatedTint];\r\n\t\t\t}\r\n\t\t} else if (tintMultiplier == 0) {\r\n\t\t\tlayer.filters.remove(keyframe.layer.refAnimatedTint);\r\n\t\t\tkeyframe.layer.refAnimatedTint = null;\r\n\t\t}\r\n\t\telse keyframe.layer.refAnimatedTint.update(tintColor, tintMultiplier);\r\n\t}\r\n\r\n\tprivate function setMask(layer:Layer):Void{\r\n\t\tif (layer.mask != null) {\r\n\t\t\t\r\n\t\t\t//TODO: Need to create again the mask movie to make it work\r\n\t\t\t// Is the mask movie not available at this stage of the Movie build ?\r\n\t\t\t// Where can we call setMask to avoid this inelegant patch ?\r\n\t\t\t\r\n\t\t\tvar lRect:Rectangle=getLayer(layer.mask).getChildAt(0).getBounds();\t\r\n\t\t\tgetLayer(layer.mask).removeChildAt(0);\r\n\t\t\tvar lGraph:Graphics = new Graphics();\r\n\t\t\tlGraph.beginFill(0);\r\n\t\t\tlGraph.drawRect(lRect.x, lRect.y, lRect.width, lRect.height);\r\n\t\t\tlGraph.endFill();\r\n\t\t\tgetLayer(layer.mask).addChild(lGraph);\r\n\t\t\tlayers[layer].mask = lGraph;\r\n\t\t\t\r\n\t\t}\t\t\r\n\t}\r\n\r\n\tprivate function labelPassed(label:Label){\r\n\t\temit(\"labelPassed\", label.name);\r\n\t}\r\n\t\r\n\t\tprivate function labelHit(label:Label){\r\n\t\temit(\"labelHit\", label.name);\r\n\t}\r\n\t\r\n\r\n\toverride public function destroy(): Void {\r\n\t\tstop();\r\n\t\tonComplete = null;\r\n\t\tfor (layer in layers) layer.removeChildren();\r\n\t\tsymbol = null;\r\n\t\tplayer = null;\r\n\t\tsuper.destroy(true);\r\n\t}\r\n\t\r\n\t/////////////////////////////////////////////////////\r\n\t//\r\n\t//   custom Data\r\n\t//\r\n\t/////////////////////////////////////////////////////\r\n\t\r\n\tpublic function getBaseClass (): String {\r\n\t\treturn symbol.baseClass;\r\n\t}\r\n\t\r\n\tpublic function getCustomData (): Dynamic {\r\n\t\treturn symbol.data;\r\n\t}\r\n\r\n\tpublic function getLayerCustomData (layerId:String, keyframeIndex:UInt = 0): Dynamic {\r\n\t\tvar layer = symbol.getLayer(layerId);\r\n\t\tif(layer == null) throw(\"Layer \" + layerId + \" does not exist.\");\r\n\t\tvar keyframe = symbol.getLayer(layerId).getKeyframeForFrame(keyframeIndex);\r\n\t\tif (keyframe == null) throw(\"Keyframe does not exist at index \" + keyframeIndex);\r\n\t\treturn keyframe.data;\r\n\t}\r\n}","package pixi.flump;\r\n\r\nimport flump.library.FlumpLibrary;\r\nimport pixi.core.math.Point;\r\nimport pixi.core.math.shapes.Rectangle;\r\nimport pixi.core.textures.Texture;\r\nimport pixi.core.textures.BaseTexture;\r\nimport pixi.loaders.Loader;\r\nimport pixi.loaders.Resource;\r\n\r\nusing Reflect;\r\n\r\n@:access(pixi.flump.Resource)\r\nclass Parser{\r\n\r\n\r\n\tpublic static function parse(resolution:Float, ?loadFromCache:Bool = true){\r\n\t\treturn function(resource:Resource, next:Void->Void){\r\n\t\t\tif(resource.data == null || resource.isJson == false) return;\r\n\t\t\tif(!resource.data.hasField(\"md5\") || !resource.data.hasField(\"movies\") || !resource.data.hasField(\"textureGroups\") || !resource.data.hasField(\"frameRate\")) return;\r\n\t\t\t\r\n\t\t\tvar lib:FlumpLibrary = FlumpLibrary.create(resource.data, resolution);\r\n\t\t\tvar textures = new Map<String, Texture>();\r\n\t\t\t\r\n\t\t\tvar atlasLoader = new Loader();\r\n\t\t\tatlasLoader.baseUrl = ~/\\/(.[^\\/]*)$/i.replace(resource.url, \"\");\r\n\r\n\t\t\tfor(atlasSpec in lib.atlases){\r\n\t\t\t\tatlasSpec.file += loadFromCache ? '' : \"?\" + Date.now().getTime();\r\n\t\t\t\tatlasLoader.add(atlasSpec.file, function(atlasResource){\r\n\t\t\t\t\tvar atlasTexture = new BaseTexture(atlasResource.data);\r\n\t\t\t\t\tatlasTexture.resolution = resolution;\r\n\r\n\t\t\t\t\tfor(textureSpec in atlasSpec.textures){\r\n\t\t\t\t\t\tvar frame = new Rectangle(textureSpec.rect.x, textureSpec.rect.y, textureSpec.rect.width, textureSpec.rect.height);\r\n\t\t\t\t\t\tvar origin = new Point(textureSpec.origin.x, textureSpec.origin.y);\r\n\t\t\t\t\t\torigin.x = origin.x / frame.width;\r\n\t\t\t\t\t\torigin.y = origin.y / frame.height;\r\n\t\t\t\t\t\ttextures[textureSpec.symbol] = new Texture(atlasTexture, frame);\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\r\n\t\t\tatlasLoader.once(\"complete\", function(loader:Loader){\r\n\t\t\t\tvar flumpResource = new pixi.flump.Resource(lib, textures, resource.name, resolution);\r\n\t\t\t\tif(resource.name != null) pixi.flump.Resource.resources[resource.name] = flumpResource;\r\n\t\t\t\tresource.data = flumpResource;\r\n\t\t\t\tnext();\r\n\t\t\t});\r\n\t\t\tatlasLoader.load();\r\n\t\t}\r\n\t}\r\n\r\n\r\n}","package pixi.flump;\r\n\r\nimport flump.library.FlumpLibrary;\r\nimport flump.library.SpriteSymbol;\r\nimport flump.library.MovieSymbol;\r\nimport flump.library.Point;\r\nimport pixi.core.math.shapes.Rectangle;\r\nimport pixi.core.display.DisplayObject;\r\nimport pixi.core.textures.BaseTexture;\r\nimport pixi.core.textures.Texture;\r\nimport pixi.core.ticker.Ticker;\r\nimport pixi.loaders.Resource;\r\nimport pixi.loaders.Loader;\r\n\r\nusing Type;\r\n\r\n\r\n@:access(pixi.flump.Movie)\r\nclass Resource{\r\n\t\r\n\tprivate var library:FlumpLibrary;\r\n\tprivate var textures:Map<String, Texture>;\r\n\tprivate var resourceId:String;\r\n\tprivate var resolution:Float;\r\n\r\n\tpublic static var flumpFactory:Factory;\r\n\r\n\r\n\r\n\tprivate static var resources = new Map<String, Resource>();\r\n\r\n\r\n\tpublic static function exists(resourceName:String){\r\n\t\treturn resources.exists(resourceName);\r\n\t}\r\n\r\n\r\n\tpublic static function destroy(resourceName:String){\r\n\t\tif(resources.exists(resourceName) == false) throw(\"Cannot destroy FlumpResource: \" + resourceName + \" as it does not exist.\");\r\n\t\t\r\n\t\tvar resource = resources[resourceName];\r\n\t\tfor(texture in resource.textures)texture.destroy();\r\n\t\tresource.library = null;\r\n\t\tresources.remove(resourceName);\r\n\t}\r\n\r\n\r\n\tprivate static function get(resourceName:String){\r\n\t\tif(!resources.exists(resourceName)) throw(\"Flump resource: \" + resourceName + \" does not exist.\");\r\n\t\treturn resources[resourceName];\r\n\t}\r\n\r\n\t\r\n\tprivate static function getResourceForMovie(symbolId:String):Resource{\r\n\t\tfor(resource in resources){\r\n\t\t\tif(resource.library.movies.exists(symbolId)){\r\n\t\t\t\treturn resource;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthrow(\"Movie: \" + symbolId + \"does not exists in any loaded flump resources.\");\r\n\t}\r\n\r\n\r\n\tprivate static function getResourceForSprite(symbolId:String):Resource{\r\n\t\tfor(resource in resources){\r\n\t\t\tif(resource.library.sprites.exists(symbolId)){\r\n\t\t\t\treturn resource;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthrow(\"Sprite: \" + symbolId + \" does not exists in any loaded flump resources.\");\r\n\t}\r\n\t\r\n\r\n\r\n\tprivate function new(library:FlumpLibrary, textures:Map<String, Texture>, resourceId:String, resolution:Float){\r\n\t\tthis.library = library;\r\n\t\tthis.textures = textures;\r\n\t\tthis.resourceId = resourceId;\r\n\t\tthis.resolution = resolution;\r\n\t}\r\n\r\n\r\n\tprivate function createMovie(id:String):Movie{\r\n\t\tvar movie:Movie;\r\n\t\tif(flumpFactory != null && flumpFactory.displayClassExists(id)){\r\n\t\t\tmovie = flumpFactory.getMovieClass(id).createInstance([]);\r\n\t\t}else{\r\n\t\t\tmovie = new Movie(id, this.resourceId);\r\n\t\t}\r\n\r\n\t\tmovie.disableAsMaster();\r\n\t\treturn movie;\r\n\t}\r\n\r\n\r\n\tprivate function createSprite(id:String):Sprite{\r\n\t\tif(flumpFactory != null && flumpFactory.displayClassExists(id)){\r\n\t\t\treturn flumpFactory.getSpriteClass(id).createInstance([]);\r\n\t\t}else{\r\n\t\t\treturn new Sprite(id, this.resourceId);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tprivate function createDisplayObject(id:String):DisplayObject {\r\n\t\tvar displayObject:DisplayObject = library.movies.exists(id)\r\n\t\t? createMovie(id)\r\n\t\t: createSprite(id);\r\n\t\t\r\n\t\tdisplayObject.name = id;\r\n\t\t\r\n\t\treturn displayObject;\r\n\t}\r\n\r\n}\r\n","package pixi.flump;\r\n\r\nimport flump.library.FlumpLibrary;\r\n\r\n\r\n@:access(pixi.flump.Resource)\r\nclass Sprite extends pixi.core.sprites.Sprite{\r\n\r\n\tpublic var symbolId:String;\r\n\tpublic var resourceId:String;\r\n\tprivate var resolution:Float;\r\n\tprivate var data:Dynamic;\r\n\tprivate var baseClass:String;\r\n\t\r\n\r\n\tpublic function new(symbolId:String, resourceId:String = null){\r\n\t\tthis.symbolId = symbolId;\r\n\t\tthis.resourceId = resourceId;\r\n\r\n\t\tvar resource:Resource;\r\n\t\tif(resourceId != null){\r\n\t\t\tresource = Resource.get(resourceId);\r\n\t\t\tif(resource == null) throw(\"Library: \" + resourceId + \"does has not been loaded.\");\r\n\t\t}else{\r\n\t\t\tresource = Resource.getResourceForSprite(symbolId);\r\n\t\t}\r\n\t\tthis.resolution = resource.resolution;\r\n\r\n\t\tvar symbol = resource.library.sprites[symbolId];\r\n\t\tvar texture = resource.textures[symbol.texture];\r\n\t\tsuper(texture);\r\n\r\n\t\tdata = symbol.data;\r\n\t\tbaseClass = symbol.baseClass;\r\n\r\n\t\tanchor.x = symbol.origin.x / texture.width;\r\n\t\tanchor.y = symbol.origin.y / texture.height;\r\n\r\n\t\t//pivot.x = symbol.origin.x;\r\n\t\t//pivot.y = symbol.origin.y;\r\n\t}\r\n\t\r\n\tpublic var resX(get, set):Float;\r\n\t\r\n\tpublic function get_resX():Float{\r\n\t\treturn x / resolution;\r\n\t}\r\n\tpublic function set_resX(value:Float):Float{\r\n\t\tx = value * resolution;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tpublic var resY(get, set):Float;\r\n\tpublic function get_resY():Float{\r\n\t\treturn y / resolution;\r\n\t}\r\n\tpublic function set_resY(value:Float):Float{\r\n\t\ty = value * resolution;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tpublic var resScaleX(get, set):Float;\r\n\tpublic function get_resScaleX():Float{\r\n\t\treturn scale.x / resolution;\r\n\t}\r\n\tpublic function set_resScaleX(value:Float):Float{\r\n\t\tscale.x = value * resolution;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tpublic var resScaleY(get, set):Float;\r\n\tpublic function get_resScaleY():Float{\r\n\t\treturn scale.y / resolution;\r\n\t}\r\n\tpublic function set_resScaleY(value:Float):Float{\r\n\t\tscale.y = value * resolution;\r\n\t\treturn value;\r\n\t}\r\n\t\r\n\t/////////////////////////////////////////////////////\r\n\t//\r\n\t//   custom Data\r\n\t//\r\n\t/////////////////////////////////////////////////////\r\n\t\r\n\tpublic function getBaseClass (): String {\r\n\t\treturn baseClass;\r\n\t}\r\n\t\r\n\tpublic function getCustomData (): Dynamic {\r\n\t\treturn data;\r\n\t}\r\n}","/*\n * Copyright (C)2005-2016 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage;\n\n// Can't enable @:coreApi because some fields are now inline getters\n// @:coreApi\n@:keepInit\nextern class Math\n{\n\tstatic var PI(default,null) : Float;\n\n\tstatic var NEGATIVE_INFINITY(get, null) : Float;\n\tprivate static inline function get_NEGATIVE_INFINITY () : Float {\n\t\treturn -(untyped __js__(\"Infinity\"));\n\t}\n\n\tstatic var POSITIVE_INFINITY(get,null) : Float;\n\tprivate static inline function get_POSITIVE_INFINITY () : Float {\n\t\treturn (untyped __js__(\"Infinity\"));\n\t}\n\n\tstatic var NaN(get, null) : Float;\n\tprivate static inline function get_NaN () : Float {\n\t\treturn (untyped __js__(\"NaN\"));\n\t}\n\n\tstatic function abs(v:Float):Float;\n\tstatic function acos(v:Float):Float;\n\tstatic function asin(v:Float):Float;\n\tstatic function atan(v:Float):Float;\n\tstatic function atan2(y:Float, x:Float):Float;\n\tstatic function ceil(v:Float):Int;\n\tstatic function cos(v:Float):Float;\n\tstatic function exp(v:Float):Float;\n\tstatic function floor(v:Float):Int;\n\tstatic function log(v:Float):Float;\n\tstatic function max(a:Float, b:Float):Float;\n\tstatic function min(a:Float, b:Float):Float;\n\tstatic function pow(v:Float, exp:Float):Float;\n\tstatic function random() : Float;\n\tstatic function round(v:Float):Int;\n\tstatic function sin(v:Float):Float;\n\tstatic function sqrt(v:Float):Float;\n\tstatic function tan(v:Float):Float;\n\n\tstatic inline function ffloor( v : Float ) : Float {\n\t\treturn floor(v);\n\t}\n\n\tstatic inline function fceil( v : Float ) : Float {\n\t\treturn ceil(v);\n\t}\n\n\tstatic inline function fround( v : Float ) : Float {\n\t\treturn round(v);\n\t}\n\n\tstatic inline function isFinite( f : Float ) : Bool {\n\t\treturn (untyped __js__(\"isFinite\"))(f);\n\t}\n\n\tstatic inline function isNaN( f : Float ) : Bool {\n\t\treturn (untyped __js__(\"isNaN\"))(f);\n\t}\n\n\tstatic function __init__() : Void {\n\t\tuntyped __feature__(\"Type.resolveClass\", $hxClasses[\"Math\"] = Math);\n\t}\n}\n","package com.isartdigital.utils.events;\r\n\r\n/**\r\n * @author Mathieu ANTHOINE\r\n */\r\n\r\nclass EventType \r\n{\r\n\t\r\n\tpublic static inline var GAME_LOOP:String = \"gameLoop\";\r\n\tpublic static inline var RESIZE:String = \"resize\";\r\n\t\r\n\tpublic static inline var ADDED:String = \"added\";\r\n\tpublic static inline var REMOVED:String = \"removed\";\r\n\t\r\n}","package com.isartdigital.utils.events;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass LoadEventType extends EventType\r\n{\r\n\r\n\tpublic static inline var COMPLETE:String = \"complete\";\r\n\tpublic static inline var LOADED:String = \"load\";\r\n\tpublic static inline var PROGRESS:String = \"progress\";\r\n\tpublic static inline var ERROR:String = \"error\";\r\n\t\r\n}","package com.isartdigital.utils.events;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass MouseEventType extends EventType\r\n{\r\n\t\r\n\tpublic static inline var MOUSE_MOVE:String = \"mousemove\";\r\n\tpublic static inline var MOUSE_DOWN:String = \"mousedown\";\r\n\tpublic static inline var MOUSE_OUT:String = \"mouseout\";\r\n\tpublic static inline var MOUSE_OVER:String = \"mouseover\";\r\n\tpublic static inline var MOUSE_UP:String = \"mouseup\";\r\n\tpublic static inline var MOUSE_UP_OUTSIDE:String = \"mouseupoutside\";\r\n\tpublic static inline var CLICK:String = \"click\";\r\n\t\r\n\tpublic static inline var RIGHT_DOWN:String = \"rightdown\";\r\n\tpublic static inline var RIGHT_UP:String = \"rightup\";\r\n\tpublic static inline var RIGHT_UP_OUTSIDE:String = \"rightupoutside\";\r\n\tpublic static inline var RIGHT_CLICK:String = \"rightclick\";\r\n\t\r\n}","package com.isartdigital.utils.events;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass TouchEventType extends EventType\r\n{\r\n\r\n\tpublic static inline var TOUCH_START:String = \"touchstart\";\r\n\tpublic static inline var TOUCH_MOVE:String = \"touchmove\";\r\n\tpublic static inline var TOUCH_END:String = \"touchend\";\r\n\tpublic static inline var TOUCH_END_OUTSIDE:String = \"touchendoutside\";\r\n\tpublic static inline var TAP:String = \"tap\";\r\n\t\r\n}"],
"names":[],
"mappings":"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"
}